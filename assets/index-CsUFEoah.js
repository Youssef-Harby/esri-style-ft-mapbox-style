function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/IdentityManager-Bn6PdTxi.js","assets/substitute-DE4lnavW.js","assets/ElevationLayer-C6gqv7jd.js","assets/MultiOriginJSONSupport-CkxbXwFC.js","assets/ArcGISCachedService-BI7Bfzwb.js","assets/TileInfoTilemapCache-BKbG-KHR.js","assets/TilemapCache-DvdIYHWT.js","assets/ByteSizeUnit-BsxeN7wM.js","assets/LRUCache-DDApZfXW.js","assets/ArcGISService-Kbq2rhkk.js","assets/OperationalLayer-CniiZqNN.js","assets/commonProperties-C-6_1J3u.js","assets/ElevationInfo-DoYTEsSv.js","assets/lengthUtils-D_y24jhC.js","assets/PortalLayer-Cn-viXRJ.js","assets/portalItemUtils-BVIE9rnJ.js","assets/layersCreator-Dl7t5fsu.js","assets/portalLayers-DW8fcf-1.js","assets/associatedFeatureServiceUtils-DxLv7GX9.js","assets/lazyLayerLoader-Cw6DGl6b.js","assets/styleUtils-DFzAwXkg.js","assets/arcgisLayers-DlGrKs2u.js","assets/fetchService-5ItloMEj.js","assets/statsWorker-CDQvJh0B.js","assets/utils-s1MppQ0q.js","assets/quantizationUtils-BpZdSdEI.js","assets/heatmapUtils-Ca5may50.js","assets/vec42-C3rPPDSS.js","assets/vec4f64-CCf6w8sj.js","assets/utils-Cxsl-0yv.js","assets/utils-Dc_4IsWJ.js","assets/ClassBreaksDefinition-BsQjCbig.js","assets/geometryEngineWorker-COiiUg30.js","assets/geometryEngineJSON-BndAMfdG.js","assets/geometryEngineBase-D5BHqdKx.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-C4KGbfEv.js","assets/date-M6n_RqpC.js","assets/OptimizedGeometry-CQuTPb9g.js","assets/FeatureStore-BzHRul2E.js","assets/featureConversionUtils-BjpcOb89.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/BoundsStore-CVpmZkSh.js","assets/PooledRBush-CroL0I4k.js","assets/timeSupport-BduaQAYD.js","assets/QueryEngine-GjdhqNoP.js","assets/WhereClause-DDRM1Vd4.js","assets/TimeOnly-BCylJa2a.js","assets/UnknownTimeZone-CGLiEgWN.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/FieldsIndex-i0ME_Zch.js","assets/RenderState-DaVlEYWY.js","assets/number-CYMKESCT.js","assets/clientSideDefaults-CiO5NAfe.js","assets/defaultsJSON-CHAaurhX.js","assets/EdgeProcessingWorker-CD6Rsptc.js","assets/InterleavedLayout-CZEBUi5V.js","assets/BufferView-QcsnvFy0.js","assets/types-D0PSWh4d.js","assets/Util-BO8YZvBY.js","assets/edgeProcessing-7g_2XC-7.js","assets/deduplicate-C5heuWz4.js","assets/Indices-D4wkIE9e.js","assets/VertexAttribute-BlT9lbVY.js","assets/enums-CYMvjYBC.js","assets/VertexElementDescriptor-BOD-G50G.js","assets/ElevationSamplerWorker-cUHyHXmX.js","assets/meshVertexSpaceUtils-DEh3du9N.js","assets/MeshLocalVertexSpace-BNzcIPRK.js","assets/vec3-B6h0dKFi.js","assets/georeference-BfBRI5v_.js","assets/mat3f64-q3fE-ZOt.js","assets/mat4f64-CSKppSlJ.js","assets/computeTranslationToOriginAndRotation-DDKP-AtY.js","assets/DoubleArray-C-Z_70v8.js","assets/quat-C6CWJZCj.js","assets/quatf64-Bdb9ZJJK.js","assets/FeatureServiceSnappingSourceWorker-BPnJ54P9.js","assets/pbfQueryUtils-DvHQ78_x.js","assets/pbf-DNwX4dno.js","assets/query-BRrh9wCJ.js","assets/queryZScale-CDKIlF1-.js","assets/GeoJSONSourceWorker-C-2NevWt.js","assets/geojson-DE2d6_u5.js","assets/sourceUtils-DZDFRW5u.js","assets/MemorySourceWorker-DqBM4JEj.js","assets/objectIdUtils-4dd1rf9p.js","assets/PBFDecoderWorker-Cn470i4Z.js","assets/FeaturePipelineWorker-Cgp2utes.js","assets/definitions-C14Q9bsB.js","assets/diffUtils-DTfem5XL.js","assets/AttributeStore-B7ATReYS.js","assets/LabelMetric-DPYy6bPZ.js","assets/enums-BRqP_wXA.js","assets/Texture-DAjwpx98.js","assets/Program-DOqJBPKv.js","assets/UpdateTracking2D-DhYnXUH7.js","assets/TurboLine-FHqvtXXo.js","assets/earcut-B92UyuuV.js","assets/GeometryUtils-CaaFuTFm.js","assets/utils-DeNwuiN2.js","assets/Rect-CUzevAry.js","assets/labelUtils-897NphYI.js","assets/BindType-BmZEZMMh.js","assets/highlightReasons-Dxnv-bT3.js","assets/constants-D5zmR9t2.js","assets/tileUtils-B7X19rIS.js","assets/geohashUtils-BBG7YoaA.js","assets/ogcFeatureUtils-Ca_IISQ6.js","assets/CircularArray-DfLrgW_-.js","assets/createConnection-DKUboNhu.js","assets/PointCloudWorker-Bpc_3Ljc.js","assets/vec3f32-nZdmKIgz.js","assets/PointCloudUniqueValueRenderer-B60CnOxD.js","assets/ColorStop-CD5pVs4K.js","assets/I3SBinaryReader-DGkh-Yus.js","assets/orientedBoundingBox-D5imcF38.js","assets/plane-DJPW94Lg.js","assets/RasterWorker-Bbn6op8W.js","assets/dataUtils-EEhoRPty.js","assets/RasterSymbolizer-Cf-aKyR-.js","assets/colorUtils-ORtp61kZ.js","assets/utils-EvxJd6C4.js","assets/colorRamps-CRAqbw4j.js","assets/rasterProjectionHelper-QZIuHC1S.js","assets/SceneLayerSnappingSourceWorker-C7wUaX8I.js","assets/lineSegment-DsBZQ1uB.js","assets/ObjectStack-iytamzLp.js","assets/sphere-D_gmcD-_.js","assets/SceneLayerWorker-DjMihGs_.js","assets/I3SUtil-DzWNbHLT.js","assets/symbolColorUtils-CPc25-0O.js","assets/WFSSourceWorker-DVujonCv.js","assets/wfsUtils-CBdT9k-c.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-CP9fSd0S.js","assets/enums-BRzLM11V.js","assets/config-MDUrh2eL.js","assets/StyleDefinition-pu9RBNlY.js","assets/SourceLayerData-BqvtCo5a.js","assets/StyleRepository-Cafdwzul.js","assets/Popup-CZsZb5wD.js","assets/AttachmentInfo-DJGObZLc.js","assets/AttachmentQuery-CLTfBN0-.js","assets/utils-DmT6aXdk.js","assets/parser-D7tIHZo0.js","assets/jsonUtils-CBHMk4lK.js","assets/UniqueValueRenderer-D3akSGAy.js","assets/sizeVariableUtils-Cmcuvw-4.js","assets/visualVariableUtils-CKI3fhtr.js","assets/jsonUtils-IOVjZB4I.js","assets/styleUtils-DjlYT8lG.js","assets/Version-DzHgqm-8.js","assets/OverrideHelper-DeJTtjvS.js","assets/executeQueryJSON-zOPhjoDI.js","assets/FeatureSet-D3YMrh1Z.js","assets/RelationshipQuery-BYvDYUjL.js","assets/TopFeaturesQuery-Bi2nzVub.js","assets/FeatureLayer-Dj0xy2jK.js","assets/FormTemplate-DH95S61p.js","assets/editsZScale-BxEmPGE1.js","assets/APIKeyMixin-DKL8sUBS.js","assets/BlendLayer-KXQ-pEuy.js","assets/jsonUtils-D2YmUXMm.js","assets/CustomParametersMixin-CzlfVaK2.js","assets/EditBusLayer-CLU6u2CG.js","assets/FeatureEffectLayer-cLIDWQXV.js","assets/FeatureEffect-CSOxBIaq.js","assets/FeatureLayerBase-C5rAAWFZ.js","assets/featureLayerUtils-B03ggaxT.js","assets/LayerFloorInfo-Np6SqyVN.js","assets/serviceCapabilitiesUtils-DcUjDT-6.js","assets/FeatureReductionLayer-EJcVCyry.js","assets/FeatureReductionSelection-D2ImKRF5.js","assets/LabelClass-GX6nV07j.js","assets/MD5-C9MwAd2G.js","assets/OrderedLayer-QmkAwqLL.js","assets/OrderByInfo-D08Vu_-r.js","assets/RefreshableLayer-Bw9tY0Rx.js","assets/ScaleRangeLayer-BwrTF8B6.js","assets/TemporalLayer-DXPxNx43.js","assets/TimeInfo-CCb8GXrz.js","assets/FeatureTemplate-BU6NOqvn.js","assets/FeatureType-CCuQW0ka.js","assets/fieldProperties-CK_KEq-s.js","assets/labelingInfo-BlCJ1E0M.js","assets/versionUtils-DA4wox33.js","assets/popupUtils-DHYN_7mG.js","assets/interfaces-CL2NbQte.js","assets/arcadeUtils-CDO_pvGa.js","assets/ImmutableArray-BlMso3qf.js","assets/webStyleSymbolUtils-CZabqWGU.js","assets/devEnvironmentUtils-Blrp8lZ5.js","assets/geometryServiceUtils-JF1gbGur.js","assets/project-CM9GGar0.js","assets/webglDeps-BvTYyNSJ.js","assets/NestedMap-DgiGbX8E.js","assets/ProgramTemplate-ChnYclWB.js","assets/mapViewDeps-Bg8apit_.js","assets/SDFHelper-DanLHzns.js","assets/floatRGBA-DSFftzoJ.js","assets/Container-DvsDccG0.js","assets/WGLContainer-yEB4so09.js","assets/MagnifierPrograms-YsKzCU0V.js","assets/testSVGPremultipliedAlpha-DvvkZQZS.js","assets/RenderingContext-BsUJcK_7.js","assets/OrderIndependentTransparency-D0wfjx-a.js","assets/basicInterfaces-GbxEOYtk.js","assets/doublePrecisionUtils-B0owpBza.js","assets/imageUtils-CJW8WW2A.js","assets/rasterizingUtils-Ba7fMGg7.js","assets/utils-DO7emzcO.js","assets/FeatureCommandQueue-BjPeZdOM.js","assets/GraphicsView2D--Hvd5g8y.js","assets/normalizeUtilsSync-DsKIwTNX.js","assets/GraphicContainer-DcA4yAug.js","assets/AGraphicContainer-DrMXfmqa.js","assets/TechniqueInstance-Cdityb-A.js","assets/TileContainer-q5S35EOL.js","assets/requestImageUtils-CQUFF1sv.js","assets/TileLayerView2D-CkxHllMB.js","assets/imageUtils-DTXfu9jE.js","assets/Bitmap-B16yU6Cr.js","assets/LayerView-CZ6evVXq.js","assets/scaleUtils-CKMLvBHQ.js","assets/HighlightGraphicContainer-8Yw05IrD.js","assets/RefreshableLayerView-BqMHEva3.js","assets/drapedUtils-pylIfi9V.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/sublayerUtils-C5PgScvu.js","assets/popupUtils-BSybU6p2.js","assets/FeatureLayerView2D-DJqbqzGZ.js","assets/HighlightCounter-BcJ6a7ol.js","assets/BaseDynamicLayerView2D-DWZdnn8v.js","assets/BitmapContainer-DjEJkFRN.js","assets/ExportStrategy-CcriwQXo.js","assets/CatalogLayerView2D-Ct60OCT9.js","assets/CatalogDynamicGroupLayerView2D-BqNV9dWw.js","assets/CatalogFootprintLayerView2D-CVyvWNU2.js","assets/GeoRSSLayerView2D-DpE0RRpT.js","assets/GraphicsLayerView2D-tJKPycaH.js","assets/GroupLayerView2D-CoPxDvnt.js","assets/ImageryLayerView2D-D58dE6aL.js","assets/RasterVFDisplayObject-BlLhDi-j.js","assets/ImageryTileLayerView2D-BTIjYmD2.js","assets/multidimensionalUtils-b_skuXBF.js","assets/rasterUtils-DJOug_Bb.js","assets/RawBlockCache-BMGzlybv.js","assets/KMLLayerView2D-qJrR4BIp.js","assets/kmlUtils-DmglFOYU.js","assets/KnowledgeGraphLayerView2D-CXUJYMGN.js","assets/MapImageLayerView2D-BpMKB7WC.js","assets/ExportImageParameters-BXaKOAaQ.js","assets/MapNotesLayerView2D-BXdeElIo.js","assets/MediaLayerView2D-B_io_3KN.js","assets/perspectiveUtils-DkE9QJR4.js","assets/OGCFeatureLayerView2D-BSeTOH8E.js","assets/RouteLayerView2D-b7L9TV5e.js","assets/Stop-DmbLSp_D.js","assets/StreamLayerView2D-27n69ySr.js","assets/SubtypeGroupLayerView2D-B2FEnv5T.js","assets/VectorTileLayerView2D-Oo0yumRg.js","assets/VideoLayerView2D-Cij3Ubuw.js","assets/GraphicsLayer-E_Mm4XLM.js","assets/WMSLayerView2D-4tFZbKVL.js","assets/ExportWMSImageParameters-DfBNJPW1.js","assets/WMTSLayerView2D-e2cTOOUj.js","assets/calcite-button-DGVDwiim.js","assets/form-FBiGdMfJ.js","assets/dom-DPsTWDAQ.js","assets/guid-DQtJl1SZ.js","assets/interactive-ZIA3ujYL.js","assets/label2-BT0TPJM3.js","assets/component-WqEOSVCt.js","assets/loadable-DWjI4BX9.js","assets/t9n-ossy6xvN.js","assets/observers-C2GFm6c2.js","assets/icon-Be7hGZw_.js","assets/loader-CdgQ8y6F.js","assets/calcite-icon-CutVJLmf.js","assets/monaco-Pit5849K.js","assets/monaco-DORa-AZt.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
var wF=Object.defineProperty;var xF=(e,t,i)=>t in e?wF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var ix=(e,t,i)=>(xF(e,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function i(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=i(s);fetch(s.href,a)}})();function Ds(){}function SF(e,t){for(const i in t)e[i]=t[i];return e}function QC(e){return e()}function K3(){return Object.create(null)}function wf(e){e.forEach(QC)}function dM(e){return typeof e=="function"}function ra(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function TF(e){return Object.keys(e).length===0}function e$(e,...t){if(e==null){for(const r of t)r(void 0);return Ds}const i=e.subscribe(...t);return i.unsubscribe?()=>i.unsubscribe():i}function t$(e){let t;return e$(e,i=>t=i)(),t}function nd(e,t,i){e.$$.on_destroy.push(e$(t,i))}function MF(e,t,i,r){if(e){const s=i$(e,t,i,r);return e[0](s)}}function i$(e,t,i,r){return e[1]&&r?SF(i.ctx.slice(),e[1](r(t))):i.ctx}function IF(e,t,i,r){if(e[2]&&r){const s=e[2](r(i));if(t.dirty===void 0)return s;if(typeof s=="object"){const a=[],u=Math.max(t.dirty.length,s.length);for(let l=0;l<u;l+=1)a[l]=t.dirty[l]|s[l];return a}return t.dirty|s}return t.dirty}function EF(e,t,i,r,s,a){if(s){const u=i$(t,i,r,a);e.p(u,s)}}function kF(e){if(e.ctx.length>32){const t=[],i=e.ctx.length/32;for(let r=0;r<i;r++)t[r]=-1;return t}return-1}function Y3(e){return e??""}function rx(e,t,i){return e.set(i),t}function AF(e){return e&&dM(e.destroy)?e.destroy:Ds}const PF=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Js(e,t){e.appendChild(t)}function yo(e,t,i){e.insertBefore(t,i||null)}function qn(e){e.parentNode&&e.parentNode.removeChild(e)}function Vn(e){return document.createElement(e)}function CF(e){return document.createTextNode(e)}function vn(){return CF(" ")}function $F(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}function Cs(e,t,i){i==null?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function OF(e){return Array.from(e.childNodes)}function X3(e,t,i){e.classList.toggle(t,!!i)}function LF(e,t,{bubbles:i=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:i,cancelable:r})}let dg;function Hy(e){dg=e}function Ng(){if(!dg)throw new Error("Function called outside component initialization");return dg}function pM(e){Ng().$$.on_mount.push(e)}function xf(e){Ng().$$.on_destroy.push(e)}function RF(){const e=Ng();return(t,i,{cancelable:r=!1}={})=>{const s=e.$$.callbacks[t];if(s){const a=LF(t,i,{cancelable:r});return s.slice().forEach(u=>{u.call(e,a)}),!a.defaultPrevented}return!0}}function DF(e,t){return Ng().$$.context.set(e,t),t}function zF(e){return Ng().$$.context.get(e)}const wp=[],Xv=[];let Kp=[];const p2=[],NF=Promise.resolve();let f2=!1;function FF(){f2||(f2=!0,NF.then(r$))}function m2(e){Kp.push(e)}function BF(e){p2.push(e)}const sx=new Set;let hp=0;function r$(){if(hp!==0)return;const e=dg;do{try{for(;hp<wp.length;){const t=wp[hp];hp++,Hy(t),jF(t.$$)}}catch(t){throw wp.length=0,hp=0,t}for(Hy(null),wp.length=0,hp=0;Xv.length;)Xv.pop()();for(let t=0;t<Kp.length;t+=1){const i=Kp[t];sx.has(i)||(sx.add(i),i())}Kp.length=0}while(wp.length);for(;p2.length;)p2.pop()();f2=!1,sx.clear(),Hy(e)}function jF(e){if(e.fragment!==null){e.update(),wf(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(m2)}}function VF(e){const t=[],i=[];Kp.forEach(r=>e.indexOf(r)===-1?t.push(r):i.push(r)),i.forEach(r=>r()),Kp=t}const sv=new Set;let Vh;function s$(){Vh={r:0,c:[],p:Vh}}function n$(){Vh.r||wf(Vh.c),Vh=Vh.p}function fr(e,t){e&&e.i&&(sv.delete(e),e.i(t))}function Vr(e,t,i,r){if(e&&e.o){if(sv.has(e))return;sv.add(e),Vh.c.push(()=>{sv.delete(e),r&&(i&&e.d(1),r())}),e.o(t)}else r&&r()}function UF(e,t,i){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=i,i(e.$$.ctx[r]))}function xn(e){e&&e.c()}function rn(e,t,i){const{fragment:r,after_update:s}=e.$$;r&&r.m(t,i),m2(()=>{const a=e.$$.on_mount.map(QC).filter(dM);e.$$.on_destroy?e.$$.on_destroy.push(...a):wf(a),e.$$.on_mount=[]}),s.forEach(m2)}function sn(e,t){const i=e.$$;i.fragment!==null&&(VF(i.after_update),wf(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function GF(e,t){e.$$.dirty[0]===-1&&(wp.push(e),FF(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ha(e,t,i,r,s,a,u=null,l=[-1]){const y=dg;Hy(e);const w=e.$$={fragment:null,ctx:[],props:a,update:Ds,not_equal:s,bound:K3(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(y?y.$$.context:[])),callbacks:K3(),dirty:l,skip_bound:!1,root:t.target||y.$$.root};u&&u(w.root);let I=!1;if(w.ctx=i?i(e,t.props||{},(E,A,...R)=>{const G=R.length?R[0]:A;return w.ctx&&s(w.ctx[E],w.ctx[E]=G)&&(!w.skip_bound&&w.bound[E]&&w.bound[E](G),I&&GF(e,E)),A}):[],w.update(),I=!0,wf(w.before_update),w.fragment=r?r(w.ctx):!1,t.target){if(t.hydrate){const E=OF(t.target);w.fragment&&w.fragment.l(E),E.forEach(qn)}else w.fragment&&w.fragment.c();t.intro&&fr(e.$$.fragment),rn(e,t.target,t.anchor),r$()}Hy(y)}class Wa{constructor(){ix(this,"$$");ix(this,"$$set")}$destroy(){sn(this,1),this.$destroy=Ds}$on(t,i){if(!dM(i))return Ds;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(i),()=>{const s=r.indexOf(i);s!==-1&&r.splice(s,1)}}$set(t){this.$$set&&!TF(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const qF="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(qF);const dp=[];function nx(e,t){return{subscribe:Qc(e,t).subscribe}}function Qc(e,t=Ds){let i;const r=new Set;function s(l){if(ra(e,l)&&(e=l,i)){const y=!dp.length;for(const w of r)w[1](),dp.push(w,e);if(y){for(let w=0;w<dp.length;w+=2)dp[w][0](dp[w+1]);dp.length=0}}}function a(l){s(l(e))}function u(l,y=Ds){const w=[l,y];return r.add(w),r.size===1&&(i=t(s,a)||Ds),l(e),()=>{r.delete(w),r.size===0&&i&&(i(),i=null)}}return{set:s,update:a,subscribe:u}}const Yp=Qc({center:[-118.805,34.027],zoom:13});function v(e,t,i,r){var s,a=arguments.length,u=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(u=(a<3?s(u):a>3?s(t,i,u):s(t,i))||u);return a>3&&u&&Object.defineProperty(t,i,u),u}function Wse(e,t){return function(i,r){t(i,r,e)}}function Zse(e,t,i,r){function s(a){return a instanceof i?a:new i(function(u){u(a)})}return new(i||(i=Promise))(function(a,u){function l(I){try{w(r.next(I))}catch(E){u(E)}}function y(I){try{w(r.throw(I))}catch(E){u(E)}}function w(I){I.done?a(I.value):s(I.value).then(l,y)}w((r=r.apply(e,t||[])).next())})}const HF="modulepreload",WF=function(e){return"/esri-style-ft-mapbox-style/"+e},Q3={},it=function(t,i,r){let s=Promise.resolve();if(i&&i.length>0){const a=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),l=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));s=Promise.all(i.map(y=>{if(y=WF(y),y in Q3)return;Q3[y]=!0;const w=y.endsWith(".css"),I=w?'[rel="stylesheet"]':"";if(!!r)for(let R=a.length-1;R>=0;R--){const G=a[R];if(G.href===y&&(!w||G.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${I}`))return;const A=document.createElement("link");if(A.rel=w?"stylesheet":HF,w||(A.as="script",A.crossOrigin=""),A.href=y,l&&A.setAttribute("nonce",l),document.head.appendChild(A),w)return new Promise((R,G)=>{A.addEventListener("load",R),A.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${y}`)))})}))}return s.then(()=>t()).catch(a=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a})};let lu;function Ce(e){return typeof lu[e]=="function"?lu[e]=lu[e](globalThis):lu[e]}var qC,HC,WC,ZC;lu=(qC=globalThis.dojoConfig)!=null&&qC.has||(HC=globalThis.esriConfig)!=null&&HC.has?{...(WC=globalThis.dojoConfig)==null?void 0:WC.has,...(ZC=globalThis.esriConfig)==null?void 0:ZC.has}:{},Ce.add=(e,t,i,r)=>((r||lu[e]===void 0)&&(lu[e]=t),i&&Ce(e)),Ce.cache=lu,Ce.add("big-integer-warning-enabled",!0),Ce.add("esri-deprecation-warnings",!0),Ce.add("esri-tests-disable-screenshots",!1),Ce.add("esri-tests-use-full-window",!1),Ce.add("esri-tests-post-to-influx",!0),(()=>{var t;Ce.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(Ce.add("host-browser",e),Ce.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),Ce.add("dom",e),Ce("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,a=parseFloat(s);if(Ce.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),Ce.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),Ce.add("khtml",s.includes("Konqueror")?a:void 0),Ce.add("edge",parseFloat(r.split("Edge/")[1])||void 0),Ce.add("opr",parseFloat(r.split("OPR/")[1])||void 0),Ce.add("webkit",!Ce("wp")&&!Ce("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),Ce.add("chrome",!Ce("edge")&&!Ce("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),Ce.add("android",!Ce("wp")&&parseFloat(r.split("Android ")[1])||void 0),Ce.add("safari",!s.includes("Safari")||Ce("wp")||Ce("chrome")||Ce("android")||Ce("edge")||Ce("opr")?void 0:parseFloat(s.split("Version/")[1])),Ce.add("mac",s.includes("Macintosh")),!Ce("wp")&&/(iPhone|iPod|iPad)/.test(r)){const u=RegExp.$1.replace(/P/,"p"),l=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",y=parseFloat(l.replace(/_/,".").replaceAll("_",""));Ce.add(u,y),Ce.add("ios",y)}Ce("webkit")||(!r.includes("Gecko")||Ce("wp")||Ce("khtml")||Ce("edge")||Ce.add("mozilla",a),Ce("mozilla")&&Ce.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&Ce.add("esri-mobile",t),i&&Ce.add("esri-iPhone",i),Ce.add("esri-geolocation",!!navigator.geolocation)}Ce.add("esri-wasm","WebAssembly"in globalThis),Ce.add("esri-performance-mode-frames-between-render",20),Ce.add("esri-force-performance-mode",!1),Ce.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),Ce.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),Ce.add("esri-atomics","Atomics"in globalThis),Ce.add("esri-workers","Worker"in globalThis),Ce.add("web-feat:cache","caches"in globalThis),Ce.add("esri-workers-arraybuffer-transfer",!Ce("safari")||Number(Ce("safari"))>=12),Ce.add("workers-pool-size",8),Ce.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),Ce.add("featurelayer-simplify-payload-size-factors",[1,1,4]),Ce.add("featurelayer-fast-triangulation-enabled",!0),Ce.add("featurelayer-animation-enabled",!0),Ce.add("featurelayer-snapshot-enabled",!0),Ce.add("featurelayer-snapshot-point-min-threshold",8e4),Ce.add("featurelayer-snapshot-point-max-threshold",4e5),Ce.add("featurelayer-snapshot-point-coverage",.1),Ce.add("featurelayer-query-max-depth",4),Ce.add("featurelayer-query-pausing-enabled",!1),Ce.add("hittest-2d-mobile-tolerance",3),Ce.add("hittest-2d-desktop-tolerance",1),Ce.add("hittest-2d-small-symbol-tolerance",3),Ce.add("hittest-2d-small-symbol-tolerance-threshold",3),Ce.add("featurelayer-advanced-symbols",!1),Ce.add("featurelayer-pbf",!0),Ce.add("featurelayer-pbf-statistics",!1),Ce.add("feature-layers-workers",!0),Ce.add("feature-polyline-generalization-factor",1),Ce.add("mapview-transitions-duration",200),Ce.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),Ce.add("mapserver-pbf-version-support",10.81),Ce.add("mapservice-popup-identify-max-tolerance",20),Ce("host-webworker")||Ce("host-browser")&&(Ce.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),Ce.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{Ce.add("esri-image-decode",!0,!0,!0)}).catch(()=>{Ce.add("esri-image-decode",!1,!0,!0)})}return!1}),Ce.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();let ox=class ch{constructor(t=1){this._seed=t}set seed(t){this._seed=t??Math.random()*ch._m}getInt(){return this._seed=(ch._a*this._seed+ch._c)%ch._m,this._seed}getFloat(){return this.getInt()/(ch._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/ch._m*r}};ox._m=2147483647,ox._a=48271,ox._c=0;function Jse(e,t){for(let i=e.length-1;i>=0;i--){const r=e[i];if(t(r))return r}}function Kse(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):Array.from(new Set(e))}function ib(e,t,i){if(e==null&&t==null)return!0;if(e==null||t==null||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Yse(e,t){let i=e.length!==t.length;i&&(e.length=t.length);for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function ek(e,t,i){let r,s;return i?(r=t.filter(a=>!e.some(u=>i(u,a))),s=e.filter(a=>!t.some(u=>i(u,a)))):(r=t.filter(a=>!e.includes(a)),s=e.filter(a=>!t.includes(a))),{added:r,removed:s}}function Xse(e){return e&&typeof e.length=="number"}const ZF=!!Array.prototype.fill;function Qse(e,t){if(ZF)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function ene(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}let o$=class{constructor(){this.last=0}};const a$=new o$;function y2(e,t,i,r){r=r||a$;const s=Math.max(0,r.last-10);for(let u=s;u<i;++u)if(e[u]===t)return r.last=u,u;const a=Math.min(s,i);for(let u=0;u<a;++u)if(e[u]===t)return r.last=u,u;return-1}function JF(e,t,i,r){const s=i??e.length,a=y2(e,t,s,r);if(a!==-1)return e[a]=e[s-1],i==null&&e.pop(),t}const Po=new Set;function KF(e,t,i=e.length,r=t.length,s,a){if(r===0||i===0)return i;Po.clear();for(let l=0;l<r;++l)Po.add(t[l]);s=s||a$;const u=Math.max(0,s.last-10);for(let l=u;l<i;++l)if(Po.has(e[l])&&(a==null||a.push(e[l]),Po.delete(e[l]),e[l]=e[i-1],--i,--l,Po.size===0||i===0))return Po.clear(),i;for(let l=0;l<u;++l)if(Po.has(e[l])&&(a==null||a.push(e[l]),Po.delete(e[l]),e[l]=e[i-1],--i,--l,Po.size===0||i===0))return Po.clear(),i;return Po.clear(),i}function YF(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}function pg(e,t){return e!=null}function l$(e){return 32+e.length}function fM(){return 16}function ine(e){if(!e)return 0;let t=u$;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=l$(r);break;case"number":t+=fM();break;case"boolean":t+=4}}return t}function XF(e){if(!e)return 0;if(Array.isArray(e))return QF(e);let t=u$;for(const i in e)e.hasOwnProperty(i)&&(t+=c$(e[i]));return t}function QF(e){const t=e.length;if(t===0||typeof e[0]=="number")return 32+8*t;let i=h$;for(let r=0;r<t;r++)i+=c$(e[r]);return i}function c$(e){switch(typeof e){case"object":return XF(e);case"string":return l$(e);case"number":return fM();case"boolean":return 4;default:return 8}}function e8(e,t){return h$+e.length*t}const u$=32,h$=16;function rne(e){return e instanceof ArrayBuffer}function mM(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Int8Array"}function d$(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Uint8Array"}function p$(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Uint8ClampedArray"}function yM(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Int16Array"}function f$(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Uint16Array"}function gM(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Int32Array"}function m$(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Uint32Array"}function rb(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Float32Array"}function sb(e){var t;return((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="Float64Array"}function t8(e){return!("buffer"in e)}function sne(...e){return e.reduce((t,i)=>t+(i?t8(i)?e8(i,fM()):i.byteLength+i8:0),0)}const i8=145,nne=1024;function one(e){return sb(e)||rb(e)||gM(e)||yM(e)||mM(e)}function ane(e){return sb(e)||rb(e)}function lne(e){return sb(e)?179769e303:rb(e)?3402823e32:m$(e)?4294967295:f$(e)?65535:d$(e)||p$(e)?255:gM(e)?2147483647:yM(e)?32767:mM(e)?127:256}function y$(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&y$(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function Ge(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=v$(e);if(t!=null)return t;if(Qv(e))return e.clone();if(g$(e))return e.map(Ge);if(_$(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=Ge(e[r]);return i}function g2(e){if(!e||typeof e!="object"||typeof e=="function"||"HTMLElement"in globalThis&&e instanceof HTMLElement)return e;const t=v$(e);if(t!=null)return t;if(g$(e)){let i=!0;const r=e.map(s=>{const a=g2(s);return s!=null&&a==null&&(i=!1),a});return i?r:null}if(Qv(e))return e.clone();if(e instanceof File||e instanceof Blob)return e;if(!_$(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],a=g2(s);if(s!=null&&a==null)return null;i[r]=a}return i}return null}function Qv(e){return typeof e.clone=="function"}function g$(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function _$(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function tk(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function v$(e){if(mM(e)||d$(e)||p$(e)||yM(e)||f$(e)||gM(e)||m$(e)||rb(e)||sb(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;for(const[i,r]of e)t.set(i,Ge(r));return t}if(e instanceof Set){const t=new Set;for(const i of e)t.add(Ge(i));return t}return null}function _M(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e==null?void 0:e.getTime)=="function"&&typeof(t==null?void 0:t.getTime)=="function"&&e.getTime()===t.getTime()||!1}function b$(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&ib(e,t):e instanceof Set?t instanceof Set&&s8(e,t):e instanceof Map?t instanceof Map&&n8(e,t):!!tk(e)&&tk(t)&&r8(e,t))}function r8(e,t){if(e===null||t===null)return!1;const i=Object.keys(e);if(t===null||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}function s8(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function n8(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function o8(e,t,i=!1){return x$(e,t,i)}function nb(e,t){if(t!=null)return t[e]||w$(e.split("."),!1,t)}function Sf(e,t,i){const r=e.split("."),s=r.pop(),a=w$(r,!0,i);a&&s&&(a[s]=t)}function w$(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function x$(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let a=r[s],u=t[s];return a===u?r:a===void 0?(r[s]=Ge(u),r):(Array.isArray(u)||Array.isArray(r)?(a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],u&&(Array.isArray(u)||(u=[u]),i?u.forEach(l=>{a.includes(l)||a.push(l)}):r[s]=u.concat())):u&&typeof u=="object"?r[s]=x$(a,u,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=u),r)},e||{}):e}var JC;const mi={apiKey:void 0,applicationName:"",applicationUrl:(JC=globalThis.location)==null?void 0:JC.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(o8(mi,globalThis.esriConfig,!0),delete mi.has),!mi.assetsPath){{const e="4.29";mi.assetsPath=`https://js.arcgis.com/${e}/@arcgis/core/assets`}mi.defaultAssetsPath=mi.assetsPath}const a8=/\{([^\}]+)\}/g;function ik(e){return e??""}function S$(e,t){return t?e.replaceAll(a8,typeof t=="object"?(i,r)=>ik(nb(r,t)):(i,r)=>ik(t(r))):e}function cne(e,t){return e.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function T$(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function une(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}function hne(e,t){return new RegExp(`{${t}}`,"ig").test(e)}const rk={info:0,warn:1,error:2,none:3};let pt=class Es{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,Es._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Es.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(t=new Map){const i=Es._loggers;return Es._loggers=t,i},set throttlingDisabled(t){Es._throttlingDisabled=t}}}static getLogger(t){return t=typeof t!="string"?t.declaredClass:t,Es._loggers.get(t)||new Es({module:t})}_log(t,i,...r){if(this._matchLevel(t)){if(i!=="always"&&!Es._throttlingDisabled){const s=this._argsToKey(r),a=this._loggedMessages[t].get(s);if(i==="once"&&a!=null||i==="oncePerTick"&&a&&a>=Es._tickCounter)return;this._loggedMessages[t].set(s,Es._tickCounter),Es._scheduleTickCounterIncrement()}for(const s of mi.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;r!=null;){const s=r[t];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=mi.log.level||"warn";return rk[this._parentWithMember("level",i)]<=rk[t]}_argsToKey(...t){return T$(JSON.stringify(t,(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]"))}static _scheduleTickCounterIncrement(){Es._tickCounterScheduled||(Es._tickCounterScheduled=!0,Promise.resolve().then(()=>{Es._tickCounter++,Es._tickCounterScheduled=!1}))}};pt._loggers=new Map,pt._tickCounter=0,pt._tickCounterScheduled=!1,pt._throttlingDisabled=!1;function l8(e,t){return e.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>r===""?"$":(nb(r,t)??"").toString())}let M$=class{constructor(t,i,r){this.name=t,this.details=r,this.message=(i&&l8(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},gt=class I$ extends M${constructor(t,i,r){super(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return Ge(i)}catch{return"[object]"}}))}}catch(t){throw pt.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new I$(t.name,t.message,t.details)}};gt.prototype.type="error";const sk=new WeakMap;function c8(e,t,i=!1){const r=`🛑 DEPRECATED - ${t}`;if(!i)return void e.warn(r);let s=sk.get(e);s||(s=new Set,sk.set(e,s)),s.has(t)||(s.add(t),e.warn(r))}function E$(e,t,i={}){if(Ce("esri-deprecation-warnings")){const{moduleName:r}=i;af(e,`Function: ${(r?r+"::":"")+t+"()"}`,i)}}function pne(e,t,i={}){if(Ce("esri-deprecation-warnings")){const{moduleName:r}=i;af(e,`Property: ${(r?r+"::":"")+t}`,i)}}function af(e,t,i={}){if(Ce("esri-deprecation-warnings")){const{replacement:r,version:s,see:a,warnOnce:u}=i;let l=t;r&&(l+=`
	🛠️ Replacement: ${r}`),s&&(l+=`
	⚙️ Version: ${s}`),a&&(l+=`
	🔗 See ${a} for more details.`),c8(e,l,u)}}function fne(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function u8(e,t){for(const i of e)if(i!=null&&t(i))return i}function e1(e){return e!=null&&typeof e[Symbol.iterator]=="function"}let vM=class _2{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let t=0;return this._groups.forEach(i=>{t+=i.length}),t}add(t,i){if(e1(t)){const r=this._getOrCreateGroup(i);for(const s of t)this._isHandle(s)&&r.push(s)}else this._isHandle(t)&&this._getOrCreateGroup(i).push(t);return this}forEach(t,i){if(typeof t=="function")this._groups.forEach(r=>r.forEach(t));else{const r=this._getGroup(t);r&&i&&r.forEach(i)}}has(t){return this._groups.has(this._ensureGroupKey(t))}remove(t){if(typeof t!="string"&&e1(t)){for(const i of t)this.remove(i);return this}return this.has(t)?(this._removeAllFromGroup(this._getGroup(t)),this._groups.delete(this._ensureGroupKey(t)),this):this}removeAll(){return this._groups.forEach(t=>this._removeAllFromGroup(t)),this._groups.clear(),this}_isHandle(t){return t&&(!!t.remove||t instanceof _2)}_getOrCreateGroup(t){if(this.has(t))return this._getGroup(t);const i=[];return this._groups.set(this._ensureGroupKey(t),i),i}_getGroup(t){return this._groups.get(this._ensureGroupKey(t))}_ensureGroupKey(t){return t||"_default_"}_removeAllFromGroup(t){for(const i of t)i instanceof _2?i.removeAll():i.remove()}};function k$(e,t){if(e==null)throw new Error(t??"value is None")}function Xi(e){return e==null||e.destroy(),null}function mne(e){return e==null||e.dispose(),null}function er(e){return e==null||e.remove(),null}function fg(e){return e==null||e.abort(),null}function yne(e){return e==null||e.release(),null}function gne(e,t,i){return e!=null&&t!=null?i!=null?i(e,t):e.equals(t):e===t}function h8(e,t){let i;return e.some((r,s)=>(i=t(r,s),i!=null)),i??void 0}const A$=Symbol("Accessor-beforeDestroy"),d8={remove:()=>{}};function Ni(e){return e?{remove(){e&&(e(),e=void 0)}}:d8}function p8(e){e.forEach(t=>t==null?void 0:t.remove())}function Fg(e){return Ni(()=>p8(e))}function fu(e){return e.__accessor__??null}function f8(e,t){var i;return((i=e==null?void 0:e.metadata)==null?void 0:i[t])!=null}function nv(e,t,i){return i?t1(e,t,{policy:i,path:""}):t1(e,t,null)}function t1(e,t,i){return t?Object.keys(t).reduce((r,s)=>{const a=s;let u=null,l="merge";if(i&&(u=i.path?`${i.path}.${s}`:s,l=i.policy(u)),l==="replace"||l==="replace-arrays"&&Array.isArray(r[a]))return r[a]=t[a],r;if(r[a]===void 0)return r[a]=Ge(t[a]),r;let y=r[a],w=t[a];if(y===w)return r;if(Array.isArray(w)||Array.isArray(r))y=y?Array.isArray(y)?r[a]=y.concat():r[a]=[y]:r[a]=[],w&&(Array.isArray(w)||(w=[w]),w.forEach(I=>{y.includes(I)||y.push(I)}));else if(w&&typeof w=="object")if(i){const I=i.path;i.path=u,r[a]=t1(y,w,i),i.path=I}else r[a]=t1(y,w,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[a]=w);return r},e||{}):e}function P$(e){return Array.isArray(e)?e:e.split(".")}function nk(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function m8(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...nk(i));return t}return nk(e)}function C$(e,t,i,r){const s=m8(t);if(s.length!==1){const a=s.map(u=>r(e,u,i));return Fg(a)}return r(e,s[0],i)}function $$(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const r=fu(t);return f8(r,i)?r.get(i):t[i]}function O$(e,t,i){if(e==null)return e;const r=$$(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:O$(r,t,i+1)}function Bg(e,t,i=0){return typeof t!="string"||t.includes(".")?O$(e,P$(t),i):$$(t,e)}function Da(e,t){return Bg(e,t)}function ok(e,t){return Bg(t,e)!==void 0}var bn;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED",e[e.DESTROYED=3]="DESTROYED"})(bn||(bn={}));function jg(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){t=Object.create(t);for(const r in t)t[r]=Ge(t[r]);Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t={},Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function ob(e,t){const i=jg(e);let r=i[t];return r||(r=i[t]={}),r}function y8(e,t){return nv(e,t,_8)}const g8=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function _8(e){return g8.test(e)?"replace":"merge"}function v8(e){return(e==null?void 0:e.release)&&typeof e.release=="function"}function b8(e){return(e==null?void 0:e.acquire)&&typeof e.acquire=="function"}let bd=class v2{constructor(t,i,r,s=1,a=0){if(this._ctor=t,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(a),this._initialSize=a,this._ctor)for(let u=0;u<a;u++)this._pool[u]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(v2.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...t):b8(i)&&i.acquire(...t),i}release(t){t&&!v2.test.disabled&&(this._releaseFunction?this._releaseFunction(t):v8(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}};bd.test={disabled:!1};let w8=class{constructor(t,i){this._observers=t,this._observer=i}remove(){YF(this._observers,this._observer)}},L$=class{constructor(){this._observers=null,this.destroyed=!1}observe(t){if(this.destroyed||t.destroyed)return x8;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const a=i.length;for(let u=0;u<a;++u){const l=i[u];if(l.destroyed)s=!0;else if(l===t){r=!0;break}}return r||(i.push(t),s&&this._removeDestroyedObservers()),new w8(i,t)}_removeDestroyedObservers(){const t=this._observers;if(!t||t.length===0)return;const i=t.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&t[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;t[s]=t[s+r]}}t.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const t=this._observers;if(t!=null){for(const i of t)i.onCommitted();this._observers=null}}};const x8=Ni();var ci;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.LINK_CHART=6]="LINK_CHART",e[e.USER=7]="USER"})(ci||(ci={}));const bne=ci.USER+1;function R$(e){switch(e){case"defaults":return ci.DEFAULTS;case"service":return ci.SERVICE;case"portal-item":return ci.PORTAL_ITEM;case"web-scene":return ci.WEB_SCENE;case"web-map":return ci.WEB_MAP;case"link-chart":return ci.LINK_CHART;case"user":return ci.USER;default:return null}}function b2(e){switch(e){case ci.DEFAULTS:return"defaults";case ci.SERVICE:return"service";case ci.PORTAL_ITEM:return"portal-item";case ci.WEB_SCENE:return"web-scene";case ci.WEB_MAP:return"web-map";case ci.LINK_CHART:return"link-chart";case ci.USER:return"user"}}function S8(e){return b2(e)}var Mi;(function(e){e[e.Dirty=1]="Dirty",e[e.Overridden=2]="Overridden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(Mi||(Mi={}));const i1={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},ay=[];let Wy=i1;function Tt(e){Wy.onObservableAccessed(e)}let ov=!1,av=!1;function jl(e,t,i){if(ov)return bM(e,t,i);D$(e);const r=t.call(i);return z$(),r}function T8(e,t){return jl(i1,e,t)}function bM(e,t,i){const r=ov;ov=!0,D$(e);let s=null;try{s=t.call(i)}catch(a){av&&pt.getLogger("esri.core.accessorSupport.tracking").error(a)}return z$(),ov=r,s}function D$(e){Wy=e,ay.push(e)}function z$(){const e=ay.length;if(e>1){const t=ay.pop();Wy=ay[e-2],t.onTrackingEnd()}else if(e===1){const t=ay.pop();Wy=i1,t.onTrackingEnd()}else Wy=i1}function N$(e,t){if(t.flags&Mi.DepTrackingInitialized)return;const i=av;av=!1,t.flags&Mi.AutoTracked?bM(t,t.metadata.get,e):F$(e,t),av=i}const M8=[];function F$(e,t){t.flags&Mi.ExplicitlyTracking||(t.flags|=Mi.ExplicitlyTracking,bM(t,()=>{const i=t.metadata.dependsOn||M8;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=P$(r);for(let a=0,u=e;a<s.length&&u!=null&&typeof u=="object";++a)u=ak(u,s[a],a!==s.length-1)}else ak(e,r,!1)}),t.flags&=~Mi.ExplicitlyTracking)}function ak(e,t,i){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const a=parseInt(r,10);if(!isNaN(a))return Array.isArray(e)?e[a]:e.at(a)}const s=fu(e);if(s){const a=s.propertiesByName.get(r);a&&(Tt(a),N$(e,a))}return i?e[r]:void 0}let lk=class extends L${constructor(t,i){super(),this.propertyName=t,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=Mi.Dirty|(i.nonNullable?Mi.NonNullable:0)|(i.hasOwnProperty("value")?Mi.HasDefaultValue:0)|(i.get===void 0?Mi.DepTrackingInitialized:0)|(i.dependsOn===void 0?Mi.AutoTracked:0)}destroy(){this.flags&Mi.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(t){Tt(this);const i=t.store,r=this.propertyName,s=this.flags,a=i.get(r);if(s&Mi.Computing||~s&Mi.Dirty&&i.has(r))return a;this.flags|=Mi.Computing;const u=t.host;let l;s&Mi.AutoTracked?l=jl(this,this.metadata.get,u):(F$(u,this),l=this.metadata.get.call(u)),i.set(r,l,ci.COMPUTED);const y=i.get(r);return y===a?this.flags&=~Mi.Dirty:T8(this.commit,this),this.flags&=~Mi.Computing,y}onObservableAccessed(t){if(t===this)return;let i=this._accessed;if(i==null)i=[],this._accessed=i;else if(i.includes(t))return;i.push(t)}onTrackingEnd(){this._clearObservationHandles(),this.flags|=Mi.DepTrackingInitialized;const t=this._accessed;if(t==null||t.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~Mi.Dirty,this.onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}onInvalidated(){~this.flags&Mi.Overridden&&(this.flags|=Mi.Dirty);const t=this._observers;if(t&&t.length>0)for(const i of t)i.onInvalidated()}onCommitted(){const t=this._observers;if(t&&t.length>0){const i=t.slice();for(const r of i)r.onCommitted()}}},I8=class B${constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new B$;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,Ge(r))}),i}get(t){return this._values.get(t)}originOf(){return ci.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}};function g_(e,t,i){return e!==void 0}function ck(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&Mi.NonNullable)||(r.lifecycle,bn.INITIALIZING,!1))}let E8=class{constructor(t){this.host=t,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=bn.INITIALIZING,this.store=new I8,this._origin=ci.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new lk(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=bn.CONSTRUCTING}constructed(){this.lifecycle=bn.CONSTRUCTED}destroy(){this.lifecycle=bn.DESTROYED,this.propertiesByName.forEach(t=>t.destroy())}get initialized(){return this.lifecycle!==bn.INITIALIZING}get(t){const i=this.propertiesByName.get(t);if(i.metadata.get)return i.getComputed(this);Tt(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.propertiesByName.get(t);if(r!==void 0&&r.flags&Mi.HasDefaultValue)return"defaults"}return b2(i)}has(t){return this.propertiesByName.has(t)&&this.store.has(t)}keys(){return[...this.propertiesByName.keys()]}internalGet(t){const i=this.propertiesByName.get(t);if(g_(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.propertiesByName.get(t);g_(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.propertiesByName.get(i);if(!g_(s))return"";const a=new Set,u=jl({onObservableAccessed:y=>a.add(y),onTrackingEnd:()=>{}},()=>{var y;return(y=s.metadata.get)==null?void 0:y.call(t)});let l=`${r}${t.declaredClass.split(".").pop()}.${i}: ${u}
`;if(a.size===0)return l;r+="  ";for(const y of a)y instanceof lk&&(l+=`${r}${y.propertyName}: undefined
`);return l}setAtOrigin(t,i,r){const s=this.propertiesByName.get(t);if(g_(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.propertiesByName.get(t);return i!==void 0&&!!(i.flags&Mi.Overridden)}clearOverride(t){const i=this.propertiesByName.get(t);i&&i.flags&Mi.Overridden&&(i.flags&=~Mi.Overridden,i.notifyChange())}override(t,i){const r=this.propertiesByName.get(t);if(!ck(r,t,i,this))return;const s=r.metadata.cast;if(s){const a=this._cast(s,i),{valid:u,value:l}=a;if(ax.release(a),!u)return;i=l}r.flags|=Mi.Overridden,this._internalSet(r,i)}set(t,i){const r=this.propertiesByName.get(t);if(!ck(r,t,i,this))return;const s=r.metadata.cast;if(s){const u=this._cast(s,i),{valid:l,value:y}=u;if(ax.release(u),!l)return;i=y}const a=r.metadata.set;a?a.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=R$(t)}getDefaultOrigin(){return b2(this._origin)}notifyChange(t){const i=this.propertiesByName.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.propertiesByName.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.propertiesByName.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==bn.INITIALIZING?this._origin:ci.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,a=t.propertyName;s.has(a,r)&&_M(i,s.get(a))&&~t.flags&Mi.Overridden&&r===s.originOf(a)||(t.invalidate(),s.set(a,i,r),t.commit(),N$(this.host,t))}_cast(t,i){const r=ax.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}},k8=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const ax=new bd(k8);function r1(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))r1(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),a=s.splice(-1,1)[0];return void r1(Da(e,s),a,i)}const r=e.__accessor__;r!=null&&A8(t,r),e[t]=i}}function A8(e,t){if(Ce("esri-unknown-property-errors")&&!P8(e,t))throw new gt("set:unknown-property",C8(e,t))}function P8(e,t){return t.metadata[e]!=null}function C8(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}let $8;function O8(){return $8}var uk;(function(e){e[e.Ignore=0]="Ignore",e[e.Destroy=1]="Destroy",e[e.ThrowError=2]="ThrowError"})(uk||(uk={}));function L8(e){e.length=0}let tn=class{constructor(t=50,i=50){this._pool=new bd(Array,void 0,L8,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return lx.acquire()}static release(t){return lx.release(t)}static prune(){lx.prune()}};const lx=new tn(100);let j$=class extends bd{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}};const __=[];function s1(e){__.push(e),__.length===1&&queueMicrotask(()=>{const t=__.slice();__.length=0;for(const i of t)i()})}let V$=class{constructor(t,i=30){this.name=t,this._counter=0,this._samples=new Array(i)}record(t){t!=null&&(this._samples[++this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,i)=>t-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,i)=>t+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var w2;(function(e){const t=(a,u,l,y)=>{let w=u,I=u;const E=l>>>1,A=a[w-1];for(;I<=E;){I=w<<1,I<l&&y(a[I-1],a[I])<0&&++I;const R=a[I-1];if(y(R,A)<=0)break;a[w-1]=R,w=I}a[w-1]=A},i=(a,u)=>a<u?-1:a>u?1:0;function r(a,u,l,y){u===void 0&&(u=0),l===void 0&&(l=a.length),y===void 0&&(y=i);for(let I=l>>>1;I>u;I--)t(a,I,l,y);const w=u+1;for(let I=l-1;I>u;I--){const E=a[u];a[u]=a[I],a[I]=E,t(a,w,I,y)}}function*s(a,u,l,y){u===void 0&&(u=0),l===void 0&&(l=a.length),y===void 0&&(y=i);for(let I=l>>>1;I>u;I--)t(a,I,l,y),yield;const w=u+1;for(let I=l-1;I>u;I--){const E=a[u];a[u]=a[I],a[I]=E,t(a,w,I,y),yield}}e.sort=r,e.iterableSort=s})(w2||(w2={}));const hk=w2,R8=1.5,D8=1.1;let U$=class{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new o$,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>dk(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}at(t){if((t=Math.trunc(t)||0)<0&&(t+=this._length),!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,dk(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=y2(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){return this.removeUnorderedIndex(y2(this.data,t,this.length,this._hint))}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=KF(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){if(t>=this.length||i>=this.length||t===i)return;const r=this.data[t];this.data[t]=this.data[i],this.data[i]=r}sort(t){hk.sort(this.data,0,this.length,t)}iterableSort(t){return hk.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}find(t,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(t.call(i,s,r))return s}}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const a=this.data[s];t.call(i,a,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=a,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const{data:r,length:s}=this;for(let a=0;a<s;++a)t.call(i,r[a],a,r)}forEach(t,i){this.data.slice(0,this.length).forEach(t,i)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}*[Symbol.iterator](){for(let t=0;t<this.length;t++)yield this.data[t]}};function dk(e){e.data.length>R8*e.length&&(e.data.length=Math.floor(e.length*D8))}function z8(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return Ni(()=>e.clearTimeout(r))}}}const Tf=z8(globalThis);function ab(e){return N8(e)||G$(e)}function N8(e){return e!=null&&typeof e=="object"&&"on"in e&&typeof e.on=="function"}function G$(e){return e!=null&&typeof e=="object"&&"addEventListener"in e&&typeof e.addEventListener=="function"}function Vg(e,t,i){if(!ab(e))throw new TypeError("target is not a Evented or EventTarget object");return G$(e)?F8(e,t,i):e.on(t,i)}function F8(e,t,i,r){if(Array.isArray(t)){const s=t.slice();for(const a of s)e.addEventListener(a,i,r);return Ni(()=>{for(const a of s)e.removeEventListener(a,i,r)})}return e.addEventListener(t,i,r),Ni(()=>e.removeEventListener(t,i,r))}function q$(e,t,i){if(!ab(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=Vg(e,t,s=>{r.remove(),i.call(e,s)});return r}function Er(e="Aborted"){return new gt("AbortError",e)}function mr(e,t="Aborted"){if(Vl(e))throw Er(t)}function lb(e){return e instanceof AbortSignal?e:e==null?void 0:e.signal}function Vl(e){const t=lb(e);return t!=null&&t.aborted}function H$(e){if(xo(e))throw e}function pk(e){if(!xo(e))throw e}function vo(e,t){const i=lb(e);if(i!=null){if(!i.aborted)return q$(i,"abort",()=>t());t()}}function wM(e,t){const i=lb(e);if(i!=null)return mr(i),q$(i,"abort",()=>t(Er()))}function B8(e,t){return lb(t)==null?e:new Promise((i,r)=>{let s=vo(t,()=>r(Er()));const a=()=>{s=er(s)};e.then(a,a),e.then(i,r)})}function xo(e){return(e==null?void 0:e.name)==="AbortError"}async function fk(e){try{return await e}catch(t){if(!xo(t))throw t;return}}async function xM(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(u=>e[u]),s=await xM(r),a={};return i.map((u,l)=>a[u]=s[l]),a}const t=e;return Promise.allSettled(t).then(i=>Array.from(t,(r,s)=>{const a=i[s];return a.status==="fulfilled"?{promise:r,value:a.value}:{promise:r,error:a.reason}}))}async function j8(e){return(await Promise.allSettled(e)).filter(t=>t.status==="fulfilled").map(t=>t.value)}async function kne(e){return(await Promise.allSettled(e)).filter(t=>t.status==="rejected").map(t=>t.reason)}function W$(e,t=void 0,i){const r=new AbortController;return vo(i,()=>r.abort()),new Promise((s,a)=>{let u=setTimeout(()=>{u=0,s(t)},e);vo(r,()=>{u&&(clearTimeout(u),a(Er()))})})}function V8(e,t){const i=new AbortController,r=setTimeout(()=>i.abort(),t);return vo(e,()=>{i.abort(),clearTimeout(r)}),{...e,signal:i.signal}}function Tu(e){return e&&typeof e.then=="function"}function mk(e){return Tu(e)?e:Promise.resolve(e)}function U8(e,t=-1){let i,r,s,a,u=null;const l=(...y)=>{if(i){r=y,a&&a.reject(Er()),a=wo();const A=a.promise;if(u){const R=u;u=null,R.abort()}return A}if(s=a||wo(),a=null,t>0){const A=new AbortController;i=mk(e(...y,A.signal));const R=i;W$(t).then(()=>{i===R&&(a?A.abort():u=A)})}else i=1,i=mk(e(...y));const w=()=>{const A=r;r=s=i=u=null,A!=null&&l(...A)},I=i,E=s;return I.then(w,w),I.then(E.resolve,E.reject),E.promise};return l}function wo(){let e,t;const i=new Promise((s,a)=>{e=s,t=a}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,a)=>Tf.setTimeout(()=>r.reject(a),s),r.promise=i,r}async function yk(e){await Promise.resolve(),mr(e)}function Ane(e){return e}function Pne(e){return 1e3*e}function Cne(e){return e}let G8=class{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}},q8=class{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}},x2=0;const Um={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},S2=["prepare","preRender","render","postRender","update","finish"],T2=[],od=new U$;let H8=class{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function W8(){Xh!=null&&(cancelAnimationFrame(Xh),Xh=requestAnimationFrame(SM))}const n1={frameTasks:od,willDispatch:!1,clearFrameTasks:Z8,dispatch:J$,executeFrameTasks:J8,reschedule:W8};function Ug(e){const t=new q8(e);return T2.push(t),n1.willDispatch||(n1.willDispatch=!0,s1(J$)),t}function lf(e){const t=new G8(e);return od.push(t),Xh==null&&(x2=performance.now(),Xh=requestAnimationFrame(SM)),new H8(t)}let Xh=null;function Z8(e=!1){od.forAll(t=>{t.removed=!0}),e&&Z$()}function SM(){const e=performance.now();Xh=null,Xh=od.length>0?requestAnimationFrame(SM):null,n1.executeFrameTasks(e)}function J8(e){const t=e-x2;x2=e;const i=1e3/60,r=Math.max(0,t-i);Um.time=e,Um.frameDuration=i-r;for(let s=0;s<S2.length;s++){const a=performance.now(),u=S2[s];od.forAll(l=>{var y;l.paused||l.removed||(s===0&&l.ticks++,l.phases[u]&&(Um.elapsedFrameTime=performance.now()-e,Um.deltaTime=l.ticks===0?0:t,(y=l.phases[u])==null||y.call(l,Um)))}),K8[s].record(performance.now()-a)}Z$(),Y8.record(performance.now()-e)}const v_=new U$;function Z$(){od.forAll(e=>{e.removed&&v_.push(e)}),od.removeUnorderedMany(v_.data,v_.length),v_.clear()}function J$(){for(;T2.length;){const e=T2.shift();e.isActive&&e.callback()}n1.willDispatch=!1}function Rne(e=1,t){const i=wo(),r=()=>{Vl(t)?i.reject(Er()):e===0?i():(--e,s1(()=>r()))};return r(),i.promise}const K8=S2.map(e=>new V$(e)),Y8=new V$("total");function X8(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}function gk(e,t){if(!t)return e;for(const i of t)e.add(i);return e}function K$(e,t){const i=new Set;return gk(i,e),gk(i,t),i}function Q8(e,t){const i=new Set;for(const r of t)e.has(r)&&i.add(r);return i}function Dne(e,t){if(!e||!t)return!1;if(e===t)return!0;for(const i of e)if(!t.has(i))return!1;return!0}function zne(e,t){if(e==null&&t==null)return!0;if(e==null||t==null||e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function e9(e,t){const i=new Set(e);for(const r of t)i.delete(r);return i}function t9(e,t){return e9(K$(e,t),Q8(e,t))}let i9=0;function Zy(){return++i9}let cb=class{constructor(t){this._accessed=[],this._handles=[],this._observerObject=new r9(t),_k.register(this,new WeakRef(this._observerObject),this)}destroy(){var t;_k.unregister(this._observerObject),this._accessed.length=0,(t=this._observerObject)==null||t.destroy(),this.clear()}onObservableAccessed(t){const i=this._accessed;i.includes(t)||i.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed,r=this._observerObject;for(let s=0;s<i.length;++s)t.push(i[s].observe(r));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}},r9=class{constructor(t){this._notify=t,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}destroy(){this.destroyed=!0,this._notify=s9}};const _k=new FinalizationRegistry(e=>{var t;(t=e.deref())==null||t.destroy()});function s9(){}let Xp=!1;const o1=[];function Y$(e,t){let i=new cb(a),r=null,s=!1;function a(){if(!i||s)return;if(Xp)return void Q$(a);const l=r;i.clear(),Xp=!0,s=!0,r=jl(i,e),s=!1,Xp=!1,t(r,l),eO()}function u(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=jl(i,e),s=!1,Ni(u)}function X$(e,t){let i=new cb(s),r=null;function s(){t(r,u)}function a(){i&&(i.destroy(),i=null),r=null}function u(){return i?(i.clear(),r=jl(i,e),r):null}return u(),Ni(a)}function n9(e){let t=new cb(r),i=!1;function r(){t&&!i&&(Xp?Q$(r):(t.clear(),Xp=!0,i=!0,jl(t,e),i=!1,Xp=!1,eO()))}function s(){t&&(t.destroy(),t=null)}return i=!0,jl(t,e),i=!1,Ni(s)}function Q$(e){o1.includes(e)||o1.unshift(e)}function eO(){for(;o1.length;)o1.pop()()}var Jy;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(Jy||(Jy={}));let mg=class{constructor(){this.uid=Zy(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,a){return this.pool.acquire(Jy.Untracked,t,i,r,s,a,_M)}static acquireTracked(t,i,r,s){return this.pool.acquire(Jy.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===Jy.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i,void 0,void 0)}acquire(t,i,r,s,a,u,l){this.uid=Zy(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=a,this.path=u,this.equals=l}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Zy(),this.removed=!0}};mg.pool=new j$(mg);const lv=new tn,Fl=new Set;let a1;function l1(e){Fl.delete(e),Fl.add(e),a1||(a1=Ug(l9))}function o9(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function a9(e){for(const t of Fl.values())t.target===e&&(t.removed=!0)}function l9(){let e=10;for(;a1&&e--;){a1=null;const t=c9(),i=lv.acquire();for(const r of t){const s=r.uid;o9(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Fl)r.removed&&(i.push(r),Fl.delete(r));for(const r of i)mg.pool.release(r);lv.release(i),lv.release(t),M2.forEach(r=>r())}}function c9(){const e=lv.acquire();e.length=Fl.size;let t=0;for(const i of Fl)e[t]=i,++t;return Fl.clear(),e}const M2=new Set;function u9(e){return M2.add(e),Ni(()=>M2.delete(e))}function h9(e,t,i){let r=C$(e,t,i,(s,a,u)=>{let l,y,w=X$(()=>Bg(s,a),(I,E)=>{var A;((A=s.__accessor__)==null?void 0:A.lifecycle)===bn.DESTROYED||l&&l.uid!==y?r.remove():(l||(l=mg.acquireUntracked(I,u,E,s,a),y=l.uid),l1(l))});return Ni(()=>{w.remove(),l&&(l.uid!==y||l.removed||(l.removed=!0,l1(l)),l=null),r=w=null})});return r}function d9(e,t,i){const r=C$(e,t,i,(s,a,u)=>{let l=!1;return Y$(()=>Bg(s,a),(y,w)=>{s.__accessor__.lifecycle!==bn.DESTROYED?l||(l=!0,_M(w,y)||u.call(s,y,w,a,s),l=!1):r.remove()})});return r}function p9(e,t,i,r=!1){return e.__accessor__&&e.__accessor__.lifecycle!==bn.DESTROYED?r?d9(e,t,i):h9(e,t,i):Ni()}function f9(e,t,i){let r,s,a=X$(e,(u,l)=>{r&&r.uid!==s?a.remove():(r||(r=mg.acquireTracked(u,t,l,i),s=r.uid),l1(r))});return Ni(()=>{a.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,l1(r)),r=null),a=null})}function m9(e,t,i){let r=!1;return Y$(e,(s,a)=>{r||(r=!0,i(a,s)||t(s,a),r=!1)})}function y9(e,t,i=!1,r=b$){return i?m9(e,t,r):f9(e,t,r)}function vk(e){return X8(Fl,t=>t.oldValue===e)}function ub(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function tO(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}function jne(e){const t=new Map;return i=>(t.has(i)||t.set(i,e(i)),t.get(i))}const Qp=()=>pt.getLogger("esri.core.accessorSupport.ensureTypes");function g9(e){return e==null?e:new Date(e)}function _9(e){return e==null?e:!!e}function v9(e){return e==null?e:e.toString()}function Wo(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function TM(e){return e==null?e:Math.round(parseFloat(e))}function iO(e){return(e==null?void 0:e.constructor)&&e.constructor.__accessorMetadata__!==void 0}function c1(e,t){return t!=null&&e&&!(t instanceof e)}function rO(e){return e&&"isCollection"in e}function bk(e){return e!=null&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function b9(e,t){if(!(t!=null&&t.constructor)||!rO(t.constructor))return I2(e,t)?t:new e(t);const i=bk(e.prototype.itemType),r=bk(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(I2(e,t),t):new e(t):t}function I2(e,t){return!!iO(t)&&(Qp().error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+db(e)+"'"),!0)}function hb(e,t){return t==null?t:rO(e)?b9(e,t):c1(e,t)?I2(e,t)?t:new e(t):t}function db(e){var t;return((t=e==null?void 0:e.prototype)==null?void 0:t.declaredClass)||"unknown"}const w9=new WeakMap;function x9(e){switch(e){case Number:return Wo;case ar:return TM;case Boolean:return _9;case String:return v9;case Date:return g9;default:return tO(w9,e,()=>hb.bind(null,e))}}function an(e,t){const i=x9(e);return arguments.length===1?i:i(t)}function yg(e,t,i){return arguments.length===1?yg.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function S9(e,t){return arguments.length===1?yg(i=>an(e,i)):yg(i=>an(e,i),t)}function sO(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>sO(e,t-1,r)):e(i)}function u1(e,t,i){if(arguments.length===2)return a=>u1(e,t,a);if(!i)return i;i=sO(e,t,i);let r=t,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let a=0;a<r;a++)i=[i];return i}function T9(e,t,i){return arguments.length===2?u1(r=>an(e,r),t):u1(r=>an(e,r),t,i)}function nO(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function E2(e,t){if(arguments.length===2)return E2(e).call(null,t);const i=new Set,r=e.filter(l=>typeof l!="function"),s=e.filter(l=>typeof l=="function");for(const l of e)typeof l!="string"&&typeof l!="number"||i.add(l);let a=null,u=null;return(l,y)=>{if(l==null)return l;const w=typeof l,I=w==="string"||w==="number";return I&&(i.has(l)||s.some(E=>w==="string"&&E===String||w==="number"&&E===Number))||w==="object"&&s.some(E=>!c1(l,E))?l:(I&&r.length?(a||(a=r.map(E=>typeof E=="string"?`'${E}'`:`${E}`).join(", ")),Qp().error("Accessor#set",`'${l}' is not a valid value for this property, only the following values are valid: ${a}`)):typeof l=="object"&&s.length?(u||(u=s.map(E=>db(E)).join(", ")),Qp().error("Accessor#set",`'${l}' is not a valid value for this property, value must be one of ${u}`)):Qp().error("Accessor#set",`'${l}' is not a valid value for this property`),y&&(y.valid=!1),null)}}function Ul(e,t){if(arguments.length===2)return Ul(e).call(null,t);const i={},r=[],s=[];for(const y in e.typeMap){const w=e.typeMap[y];i[y]=an(w),r.push(db(w)),s.push(y)}const a=()=>`'${r.join("', '")}'`,u=()=>`'${s.join("', '")}'`,l=typeof e.key=="string"?y=>y[e.key]:e.key;return y=>{if(e.base&&!c1(e.base,y)||y==null)return y;const w=l(y)||e.defaultKeyValue,I=i[w];if(!I)return Qp().error("Accessor#set",`Invalid property value, value needs to be one of ${a()}, or a plain object that can autocast (having .type = ${u()})`),null;if(!c1(e.typeMap[w],y))return y;if(typeof e.key=="string"&&!iO(y)){const E={};for(const A in y)A!==e.key&&(E[A]=y[A]);return I(E)}return I(y)}}let ar=class{};const Une={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function M9(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function oO(e){switch(e.type){case"native":return an(e.value);case"array":return yg(oO(e.value));case"one-of":return I9(e);default:return null}}function I9(e){let t=null;return(i,r)=>A2(i,e)?i:(t==null&&(t=k2(e)),Qp().error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function k2(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case ar:return"integer";case Date:return"date";default:return db(e.value)}case"array":return`array of ${k2(e.value)}`;case"one-of":{const t=e.values.map(i=>k2(i));return`one of ${t.slice(0,-1)} or ${t[t.length-1]}`}}return"unknown"}function A2(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case ar:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!A2(i,t.value));case"one-of":return t.values.some(i=>A2(e,i))}}function M(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=ob(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&pt.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const a=e.aliasOf;if(a){const y=typeof a=="string"?a:a.source,w=typeof a=="string"?null:a.overridable===!0;let I;s.dependsOn=[y],s.get=function(){let E=Da(this,y);if(typeof E=="function"){I||(I=y.split(".").slice(0,-1).join("."));const A=Da(this,I);A&&(E=E.bind(A))}return E},s.readOnly||(s.set=w?function(E){this._override(i,E)}:function(E){r1(this,y,E)})}const u=e.type,l=e.types;s.cast||(u?s.cast=E9(u):l&&(Array.isArray(l)?s.cast=yg(Ul(l[0])):s.cast=Ul(l))),y8(s,e),e.range&&(s.cast=k9(s.cast,e.range))}}function aO(e,t,i){const r=ob(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function E9(e){let t=0,i=e;if(M9(e))return oO(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(nO(r))return t===0?E2(r):u1(E2(r),t);if(t===1)return S9(r);if(t>1)return T9(r,t);const s=e;return s.from?s.from:an(s)}function k9(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}function A9(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(a=>{t[a]=s}),delete t[r]}}}let Gl=class extends M${constructor(t,i,r){super(t,i,r)}};Gl.prototype.type="warning";function lO(e){var t;return!!e&&((t=e.prototype)==null?void 0:t.declaredClass)&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const P2=()=>pt.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function wk(e,t,i){var r,s;e&&(!i&&!t.read||(r=t.read)!=null&&r.reader||((s=t.read)==null?void 0:s.enabled)===!1||$9(e)&&Sf("read.reader",MM(e),t))}function MM(e){var i,r;const t=e.ndimArray??0;if(t>1)return C9(e);if(t===1)return xk(e);if("type"in e&&uO(e.type)){const s=(r=(i=e.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,a=xk(typeof s=="function"?{type:s}:{types:s});return(u,l,y)=>{const w=a(u,l,y);return w&&new e.type(w)}}return IM(e)}function IM(e){return"type"in e?P9(e.type):O9(e.types)}function P9(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void P2().error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const a=new e;return a.read(t,r),a}:e.fromJSON}function cO(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>cO(e,s,i,r-1)):e(t,void 0,i)}function C9(e){const t=IM(e),i=cO.bind(null,t),r=e.ndimArray??0;return(s,a,u)=>{if(s==null)return s;s=i(s,u,r);let l=r,y=s;for(;l>0&&Array.isArray(y);)l--,y=y[0];if(y!==void 0)for(let w=0;w<l;w++)s=[s];return s}}function xk(e){const t=IM(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const u=[];for(const l of i){const y=t(l,void 0,s);y!==void 0&&u.push(y)}return u}const a=t(i,void 0,s);return a!==void 0?[a]:void 0}}function uO(e){if(!lO(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?EM(t.Type):hO(t.Type))}function $9(e){return"types"in e?hO(e.types):EM(e.type)}function EM(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||uO(e))}function hO(e){for(const t in e.typeMap)if(!EM(e.typeMap[t]))return!1;return!0}function O9(e){let t=null;const i=e.errorContext??"type",r=e.validate;return(s,a,u)=>{if(s==null)return s;const l=typeof s;if(l!=="object")return void P2().error(`Expected JSON value of type 'object' to deserialize, but got '${l}'`);t||(t=L9(e));const y=e.key;if(typeof y!="string")return;const w=s[y],I=w?t[w]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!I){const A=`Type '${w||"unknown"}' is not supported`;return u!=null&&u.messages&&s&&u.messages.push(new Gl(`${i}:unsupported`,A,{definition:s,context:u})),void P2().error(A)}const E=new I;return E.read(s,u),r?r(E):E}}function L9(e){var i,r;const t={};for(const s in e.typeMap){const a=e.typeMap[s],u=jg(a.prototype);if(typeof e.key=="function")continue;const l=u[e.key];if(!l)continue;(i=l.json)!=null&&i.type&&Array.isArray(l.json.type)&&l.json.type.length===1&&typeof l.json.type[0]=="string"&&(t[l.json.type[0]]=a);const y=(r=l.json)==null?void 0:r.write;if(!(y!=null&&y.writer)){t[s]=a;continue}const w=y.target,I=typeof w=="string"?w:e.key,E={};y.writer(s,E,I),E[I]&&(t[E[I]]=a)}return t}function R9(e){if(e.json||(e.json={}),Tk(e.json),Mk(e.json),Sk(e.json),e.json.origins)for(const t in e.json.origins)Tk(e.json.origins[t]),Mk(e.json.origins[t]),Sk(e.json.origins[t]);return!0}function Sk(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function Tk(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function Mk(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}function Ik(e,t){if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const i=(e==null?void 0:e.ndimArray)??0;e&&(i===1||"type"in e&&lO(e.type))?t.write.writer=N9:i>1?t.write.writer=F9(i):t.types?Array.isArray(t.types)?t.write.writer=z9(t.types[0]):t.write.writer=D9(t.types):t.write.writer=gg}function D9(e){return(t,i,r,s)=>t?dO(t,e,s)?gg(t,i,r,s):void 0:gg(t,i,r,s)}function dO(e,t,i){for(const r in t.typeMap)if(e instanceof t.typeMap[r])return!0;if(i!=null&&i.messages){const r=t.errorContext??"type",s=`Values of type '${(typeof t.key!="function"?e[t.key]:e.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new gt(`${r}:unsupported`,s,{definition:e,context:i})),pt.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function z9(e){return(t,i,r,s)=>!t||!Array.isArray(t)?gg(t,i,r,s):gg(t.filter(a=>dO(a,e,s)),i,r,s)}function gg(e,t,i,r){Sf(i,h1(e,r),t)}function h1(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?d1(e):e}function d1(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function N9(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(a=>h1(a,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[h1(e,r)],Sf(i,s,t)}function pO(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>pO(r,t,i-1)):h1(e,t)}function F9(e){return(t,i,r,s)=>{let a;if(t===null)a=null;else{a=pO(t,s,e);let u=e,l=a;for(;u>0&&Array.isArray(l);)u--,l=l[0];if(l!==void 0)for(let y=0;y<u;y++)a=[a]}Sf(r,a,i)}}function B9(e,t){return kM(e,"any",t==null?void 0:t.origin)}function C2(e,t){return kM(e,"read",t==null?void 0:t.origin)}function fO(e,t){return kM(e,"write",t==null?void 0:t.origin)}function kM(e,t,i){let r=e==null?void 0:e.json;if(r!=null&&r.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(t==="any"||t in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(t==="any"||t in s)&&(r=s)}return r}function j9(e){const t=V9(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?U9(r):t;wk(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write={...e.json.write}),Ik(s,r)}wk(t,e.json,!0),Ik(t,e.json)}function V9(e){return e.json.types?$2(e.json):e.type?mO(e):$2(e)}function U9(e){return e.type?mO(e):$2(e)}function mO(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!nO(i);)i=i[0],t++;return{type:i,ndimArray:t}}function $2(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function G9(e){R9(e)&&(A9(e),j9(e))}const cx=new Set,ux=new Set;function me(e){return t=>{e??(e="esri.core.Accessor"),t.prototype.declaredClass=e,H9(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!cx.has(s.initialize)&&(cx.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!ux.has(s.destroy)&&(ux.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);cx.clear(),ux.clear();const a=class extends t{constructor(...l){if(super(...l),this.constructor===a&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let y=i.length-1;y>=0;y--)i[y].call(this)}}),r.length){let y=!1;const w=this[A$];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!y){y=!0,w.call(this);for(let I=0;I<r.length;I++)r[I].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript(...l)}}};a.__accessorMetadata__=jg(t.prototype),a.prototype.declaredClass=e;const u=(e||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(a,"name",{value:u,configurable:!0}),a}}function q9(e,t){return t.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(e);if(r===void 0)return;Tt(r);const s=i.store;return s.has(e)?s.get(e):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(e);if(r!==void 0)return r.getComputed(i)}}function H9(e){const t=e.prototype,i=jg(t),r={};for(const s of Object.getOwnPropertyNames(i)){const a=i[s];G9(a),r[s]={enumerable:!0,configurable:!0,get:q9(s,a),set(u){const l=this.__accessor__;if(l!==void 0){if(!Object.isFrozen(this)){if(l.initialized&&a.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(l.lifecycle===bn.CONSTRUCTED&&a.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);l.set(s,u)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:u})}}}Object.defineProperties(e.prototype,r)}var yO,gO;function W9(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return(t=e.constructor)!=null&&t.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const Pc=Symbol("Accessor-Handles"),O2=Symbol("Accessor-Initialized");let Pt=class _O{static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const a=this;class u extends a{constructor(...y){super(...y),this.inherited=null,s&&s.apply(this,y)}}jg(u.prototype);for(const l in t){const y=t[l];u.prototype[l]=typeof y=="function"?function(...w){const I=this.inherited;let E;this.inherited=function(...A){if(a.prototype[l])return a.prototype[l].apply(this,A)};try{E=y.apply(this,w)}catch(A){throw this.inherited=I,A}return this.inherited=I,E}:t[l]}for(const l in i){const y=W9(i[l]);M(y)(u.prototype,l)}return me(r)(u)}constructor(...t){if(this[yO]=null,this[gO]=!1,this.constructor===_O)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new E8(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),t.length>0&&this.normalizeCtorArgs&&(i.ctorArgs=this.normalizeCtorArgs.apply(this,t))}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[O2]=!0}initialize(){}[A$](){this[Pc]=Xi(this[Pc])}destroy(){var t;this.destroyed||(a9(this),this.__accessor__.destroy(),(t=O8())==null||t.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[O2]}get destroyed(){var t;return((t=this.__accessor__)==null?void 0:t.lifecycle)===bn.DESTROYED||!1}commitProperty(t){Da(this,t)}get(t){return E$(pt.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Da(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return r1(this,t,i),this}watch(t,i,r){return p9(this,t,i,r)}addHandles(t,i){if(this.destroyed){const s=Array.isArray(t)?t:[t];for(const a of s)a.remove();return}let r=this[Pc];r==null&&(r=this[Pc]=new vM),r.add(t,i)}removeHandles(t){const i=this[Pc];i!=null&&i.remove(t)}removeAllHandles(){const t=this[Pc];t!=null&&t.removeAll()}hasHandles(t){const i=this[Pc];return i!=null&&i.has(t)}_override(t,i){i===void 0?this.__accessor__.clearOverride(t):this.__accessor__.override(t,i)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_overrideIfSome(t,i){i==null?this.__accessor__.clearOverride(t):this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}};yO=Pc,gO=O2;let Z9=class vO{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new vO;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,Ge(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i;return((i=this._values.get(t))==null?void 0:i.origin)??ci.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===ci.DEFAULTS){const s=this._values.get(t);if((s==null?void 0:s.origin)!=null&&s.origin>r)return}this._values.set(t,new J9(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===ci.DEFAULTS?t:ci.USER}},J9=class{constructor(t,i){this.value=t,this.origin=i}};function K9(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),ci.DEFAULTS)});const r=e.metadata;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),ci.DEFAULTS)})}function Y9(e,t,i){if(!(e!=null&&e.read)||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&ok(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&ok(s,i))return!0;return!1}function X9(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function Q9(e,t,i,r,s){let a=C2(t[i],s);X9(a)&&(e[i]=!0);for(const u of Object.getOwnPropertyNames(t))a=C2(t[u],s),Y9(a,i,r)&&(e[u]=!0)}function eB(e,t,i,r){const s=i.metadata,a=B9(s[t],r),u=a==null?void 0:a.default;if(u===void 0)return;const l=typeof u=="function"?u.call(e,t,r):u;l!==void 0&&i.set(t,l)}const bO={origin:"service"};function tB(e,t,i=bO){if(!t||typeof t!="object")return;const r=fu(e),s=r.metadata,a={};for(const u of Object.getOwnPropertyNames(t))Q9(a,s,u,t,i);r.setDefaultOrigin(i.origin);for(const u of Object.getOwnPropertyNames(a)){const l=C2(s[u],i).read,y=l==null?void 0:l.source;let w;w=y&&typeof y=="string"?Bg(t,y):t[u],l!=null&&l.reader&&(w=l.reader.call(e,w,t,i)),w!==void 0&&r.set(u,w)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const u of Object.getOwnPropertyNames(s))a[u]||eB(e,u,r,i)}r.setDefaultOrigin("user")}function Hne(e,t,i,r=bO){var a;const s={...r,messages:[]};i(s),(a=s.messages)==null||a.forEach(u=>{u.type!=="warning"||e.loaded?r!=null&&r.messages&&r.messages.push(u):e.loadWarnings.push(u)})}function iB(e,t,i,r,s){var u,l;const a={};return(l=(u=t.write)==null?void 0:u.writer)==null||l.call(e,r,a,i,s),a}function wO(e,t,i,r,s,a){if(!(r!=null&&r.write))return!1;const u=Da(e,i);if(!s&&r.write.overridePolicy){const l=r.write.overridePolicy.call(e,u,i,a??void 0);l!==void 0&&(s=l)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&(a!=null&&a.layerContainerType)&&!s.layerContainerTypes.includes(a.layerContainerType))return!1;if((u===null&&!s.allowNull&&!s.writerEnsuresNonNull||u===void 0)&&s.isRequired){const l=new gt("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return l&&(a!=null&&a.messages)?a.messages.push(l):l&&!a&&pt.getLogger("esri.core.accessorSupport.write").error(l.name,l.message),!1}return!(u===void 0||u===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!t.store.multipleOriginsSupported||t.store.originOf(i)===ci.DEFAULTS)&&rB(e,i,a,r,u)||!s.ignoreOrigin&&(a!=null&&a.origin)&&t.store.multipleOriginsSupported&&t.store.originOf(i)<R$(a.origin))}function rB(e,t,i,r,s){const a=r.default;if(a===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof a=="function"){if(Array.isArray(s)){const u=a.call(e,t,i??void 0);return ib(u,s)}return!1}return a===s}function Wne(e,t,i,r){const s=fu(e),a=s.metadata,u=fO(a[t],r);return!!u&&wO(e,s,t,u,i,r)}function sB(e,t,i){var a,u;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return nv(t,e.toJSON(i));const r=fu(e),s=r.metadata;for(const l in s){const y=fO(s[l],i);if(!wO(e,r,l,y,void 0,i))continue;const w=Da(e,l),I=iB(e,y,y.write&&typeof y.write.target=="string"?y.write.target:l,w,i);Object.keys(I).length>0&&(t=nv(t,I),(u=(a=i==null?void 0:i.resources)==null?void 0:a.pendingOperations)!=null&&u.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>nv(t,I,()=>"replace-arrays"))),i!=null&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:l,oldOrigin:S8(r.store.originOf(l)),newOrigin:i.origin}))}return t}const Gg=e=>{let t=class extends e{constructor(...i){super(...i);const r=fu(this),s=r.store,a=new Z9;r.store=a,K9(r,s,a)}read(i,r){tB(this,i,r)}write(i,r){return sB(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return nB.call(this,i,r)}};return t=v([me("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function nB(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}function L2(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}let wt=class extends Gg(Pt){};wt=v([me("esri.core.JSONSupport")],wt);const oB=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,aB={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Ek(e){const t=e==null?void 0:e.match(oB);if(!t)return null;const[,i,r,s]=t;if(!i)return null;let a=null,u=null,l=null;const{devext:y,qaext:w,www:I}=aB;if(r)if(a=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:u,portalHostname:l}=y);break;case"qa":({customBaseUrl:u,portalHostname:l}=w);break;default:return null}else({customBaseUrl:u,portalHostname:l}=I);else switch(i.toLowerCase()){case"devext":({customBaseUrl:u,portalHostname:l}=y);break;case"qaext":({customBaseUrl:u,portalHostname:l}=w);break;case"www":({customBaseUrl:u,portalHostname:l}=I);break;default:return null}return{customBaseUrl:u,isPortal:!1,portalHostname:l,urlKey:a}}function lB(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}function cB(e){const t=atob(e),i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i.buffer}function uB(e){const t=new Uint8Array(e);let i="";for(let r=0;r<t.length;r++)i+=String.fromCharCode(t[r]);return btoa(i)}const hB=()=>pt.getLogger("esri.core.urlUtils"),Mf=mi.request,kk="esri/config: esriConfig.request.proxyUrl is not set.",xO=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,SO=/^\s*http:/i,dB=/^\s*https:/i,pB=/^\s*file:/i,fB=/:\d+$/,mB=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,yB=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),gB=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let ef=class{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(yB);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(gB),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const b_={},_B=new ef(mi.applicationUrl);let Os=_B;const vB=bB();let AM=vB;const PM=()=>Os,Kne=()=>AM;function bB(){const e=Os.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${Os.scheme}://${Os.host}${Os.port!=null?`:${Os.port}`:""}`}${t}`}function ln(e){if(!e)return null;const t={path:null,query:null},i=new ef(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=CM(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function CM(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let a,u;s<0?(a=decodeURIComponent(r),u=""):(a=decodeURIComponent(r.slice(0,s)),u=decodeURIComponent(r.slice(s+1)));let l=i[a];typeof l=="string"&&(l=i[a]=[l]),Array.isArray(l)?l.push(u):i[a]=u}return i}function _g(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",a=t==null?void 0:t[i];return a?s+encodeURIComponent(a(r)):Array.isArray(r)?r.map(u=>L2(u)?s+encodeURIComponent(JSON.stringify(u)):s+encodeURIComponent(u)).join("&"):L2(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function wB(e=!1){let t,i=Mf.proxyUrl;if(typeof e=="string"){t=kB(e);const r=pb(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw hB().warn(kk),new gt("urlUtils:proxy-not-set",kk);return t&&R2()&&(i=zM(i)),ln(i)}function Yne(e){const t=pb(e);let i,r;if(t){const s=$M(t.proxyUrl);i=s.path,r=s.query?CM(s.query):null}if(i){const s=ln(e);e=i+"?"+s.path;const a=_g({...r,...s.query});a&&(e=`${e}?${a}`)}return e}const Gm={path:"",query:""};function $M(e){const t=e.indexOf("?");return t!==-1?(Gm.path=e.slice(0,t),Gm.query=e.slice(t+1)):(Gm.path=e,Gm.query=null),Gm}function TO(e){return e=(e=f1(e=OB(e=$M(e).path),!0)).toLowerCase()}function xB(e){const t={proxyUrl:e.proxyUrl,urlPrefix:TO(e.urlPrefix)},i=Mf.proxyRules,r=t.urlPrefix;let s=i.length;for(let a=0;a<i.length;a++){const u=i[a].urlPrefix;if(r.indexOf(u)===0){if(r.length===u.length)return-1;s=a;break}u.indexOf(r)===0&&(s=a+1)}return i.splice(s,0,t),s}function pb(e){const t=Mf.proxyRules,i=TO(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function Xne(e,t){if(!e||!t)return!1;e=p1(e),t=p1(t);const i=Ek(e),r=Ek(t);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&cf(e,t,!0)}function SB(e,t){return e=p1(e),t=p1(t),f1(e)===f1(t)}function p1(e){const t=(e=du(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function MO(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=Mf.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function cf(e,t,i=!1){if(!e||!t)return!1;const r=z2(e),s=z2(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function OM(e){if(typeof e=="string"){if(!Hn(e))return!0;e=z2(e)}if(cf(e,Os))return!0;const t=Mf.trustedServers||[];for(let i=0;i<t.length;i++){const r=TB(t[i]);for(let s=0;s<r.length;s++)if(cf(e,r[s]))return!0}return!1}function TB(e){return b_[e]||(DM(e)||ja(e)?b_[e]=[new ef(mo(e))]:b_[e]=[new ef(`http://${e}`),new ef(`https://${e}`)]),b_[e]}function mo(e,t=AM,i){return ja(e)?i&&i.preserveProtocolRelative?e:Os.scheme==="http"&&Os.authority===Xo(e).slice(2)?`http:${e}`:`https:${e}`:DM(e)?e:fb(e[0]==="/"?$B(t):t,e)}function LM(e,t=AM,i){if(e==null||!Hn(e))return e;const r=du(e),s=r.toLowerCase(),a=du(t).toLowerCase().replace(/\/+$/,""),u=i?du(i).toLowerCase().replace(/\/+$/,""):null;if(u&&a.indexOf(u)!==0)return e;const l=(E,A,R)=>(R=E.indexOf(A,R))===-1?E.length:R;let y=l(s,"/",s.indexOf("//")+2),w=-1;for(;s.slice(0,y+1)===a.slice(0,y)+"/"&&(w=y+1,y!==s.length);)y=l(s,"/",y+1);if(w===-1||u&&w<u.length)return e;e=r.slice(w);const I=a.slice(w-1).replaceAll(/[^/]+/g,"").length;if(I>0)for(let E=0;E<I;E++)e=`../${e}`;else e=`./${e}`;return e}function du(e){return e=DB(e=RB(e=LB(e=mo(e=e.trim()))))}function fb(...e){const t=e.filter(pg);if(!(t!=null&&t.length))return;const i=[];if(Hn(t[0])){const s=t[0],a=s.indexOf("//");a!==-1&&(i.push(s.slice(0,a+1)),PB(t[0])&&(i[0]+="/"),t[0]=s.slice(a+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,a)=>a?s.concat(a.split("/")):s,[]);for(let s=0;s<r.length;s++){const a=r[s];a===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!a&&s===r.length-1||a&&(a!=="."||i.length===0))&&i.push(a)}return i.join("/")}function Xo(e,t=!1){if(e==null||RM(e)||wd(e))return null;let i=e.indexOf("://");if(i===-1&&ja(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=f1(e,!0)),e}function Hn(e){return ja(e)||DM(e)}function RM(e){return e!=null&&e.slice(0,5)==="blob:"}function wd(e){return e!=null&&e.slice(0,5)==="data:"}function MB(e){const t=vg(e);return t&&t.isBase64?cB(t.data):null}function Qne(e){return uB(e).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const IB=/^data:(.*?)(;base64)?,(.*)$/;function vg(e){const t=e.match(IB);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function IO(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}async function eoe(e){return(await fetch(e)).blob()}function toe(e){const t=MB(e);if(!t)return null;const i=vg(e);return new Blob([t],{type:i.mediaType})}function ioe(e,t){EB(e,t)}function EB(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function ja(e){return e!=null&&e[0]==="/"&&e[1]==="/"}function DM(e){return e!=null&&xO.test(e)}function kB(e){return e!=null&&dB.test(e)||Os.scheme==="https"&&ja(e)}function AB(e){return e!=null&&SO.test(e)||Os.scheme==="http"&&ja(e)}function PB(e){return e!=null&&pB.test(e)}function zM(e){return ja(e)?`https:${e}`:e.replace(SO,"https:")}function CB(){return Os.scheme==="http"}function R2(){return Os.scheme==="https"}function f1(e,t=!1){return ja(e)?e.slice(2):(e=e.replace(xO,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function $B(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function roe(e){let t=0;if(Hn(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function soe(e,t){if(!e)return"";const i=ln(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(t!=null&&t.length))return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function OB(e){return e.endsWith("/")?e:`${e}/`}function EO(e){return e.replace(/\/+$/,"")}function LB(e){if(/^https?:\/\//i.test(e)){const t=$M(e);e=(e=t.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function RB(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function DB(e){const t=Mf.httpsDomains;if(!AB(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),fB.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return CB()&&r===Os.authority&&!mB.test(e)||(R2()&&r===Os.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||R2()&&!pb(e))&&(e=zM(e)),e}function D2(e,t,i){if(!(t&&i&&e&&Hn(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),a=e.indexOf(":",r+2),u=Math.min(s<0?e.length:s,a<0?e.length:a);return e.slice(r+2,u).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(u)}`}function z2(e){return typeof e=="string"?new ef(mo(e)):(e.scheme||(e.scheme=Os.scheme),e)}function noe(e){return NB.test(e)}function kO(e,t){const i=ln(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function zB(e,t,i){const r=ln(e),s=r.query||{};return s[t]=String(i),`${r.path}?${_g(s)}`}function hx(e,t){if(!t)return e;const i=ln(e),r=i.query||{};for(const[a,u]of Object.entries(t))u!=null&&(r[a]=u);const s=_g(r);return s?`${i.path}?${s}`:i.path}function ooe(e){if(e==null)return null;const t=e.match(AO);return t?t[2]:null}function Ak(e){if(e==null)return null;const t=e.match(AO);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}async function aoe(e){return typeof e=="string"?vg(e)??{data:e}:new Promise((t,i)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(vg(r.result)),r.onerror=s=>i(s)})}const AO=/([^.]*)\.([^\/]*)$/,NB=/(^data:image\/svg|\.svg$)/i,PO="20240321",CO="9cf5a4b8555fda94595b625a40b922e012baf071";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const FB="4.29";let wi,NM=FB;NM="4.29.10";function loe(e){wi=e}function coe(e){const t=wi==null?void 0:wi.findCredential(e);return t!=null&&t.token?zB(e,"token",t.token):e}Ce("host-webworker");const BB=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function $O(e){const t=Xo(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!BB.has(t)&&!e.endsWith("/sharing/rest/generateToken")}function jB(e,t,i=!1,r){return new Promise((s,a)=>{if(Vl(r))return void a(Pk());let u=()=>{w(),a(new Error(`Unable to load ${t}`))},l=()=>{const I=e;w(),s(I)},y=()=>{if(!e)return;const I=e;w(),I.src="",a(Pk())};const w=()=>{Ce("esri-image-decode")||(e.removeEventListener("error",u),e.removeEventListener("load",l)),u=null,l=null,e=null,r!=null&&r.removeEventListener("abort",y),y=null,i&&URL.revokeObjectURL(t)};r!=null&&r.addEventListener("abort",y),Ce("esri-image-decode")?e.decode().then(l,u):(e.addEventListener("error",u),e.addEventListener("load",l))})}function Pk(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}const VB="Timeout exceeded";function UB(){return new Error(VB)}function GB(e){mi.request.crossOriginNoCorsDomains||(mi.request.crossOriginNoCorsDomains={});const t=mi.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[Xo(i)??""]=0:(t[Xo("http://"+i)??""]=0,t[Xo("https://"+i)??""]=0)}function qB(e){const t=mi.request.crossOriginNoCorsDomains;if(t){let i=Xo(e);if(i)return i=i.toLowerCase(),!cf(i,PM())&&t[i]<Date.now()-36e5}return!1}async function HB(e){var s;const t=mi.request.crossOriginNoCorsDomains,i=Xo(e);t&&i&&(t[i.toLowerCase()]=Date.now());const r=ln(e);e=r.path,((s=r.query)==null?void 0:s.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function Qr(e,t){var w;e instanceof URL&&(e=e.toString()),(t==null?void 0:t.query)instanceof URLSearchParams&&(t.query=CM(t.query.toString().replaceAll("+"," ")));const i=wd(e),r=RM(e);r||i||(e=du(e));const s={url:e,requestOptions:{...t}};let a=MO(e);if(a){const I=await ej(a,s);if(I!=null)return{data:I,getAllHeaders:uf,getHeader:uf,httpStatus:200,requestOptions:s.requestOptions,url:s.url};a.after||a.error||(a=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"&&(Ce("host-webworker")||Ce("host-node")))throw za("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(t.method==="head"){if(t.body)throw za("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw za("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await YB(),m1)return m1.execute(e,t);const u=new AbortController;vo(t,()=>u.abort());const l={controller:u,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:s,redoRequest:!1,useIdentity:qo.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},y=await ij(l);return(w=a==null?void 0:a.after)==null||w.call(a,y),y}let m1;const qo=mi.request,OO="FormData"in globalThis,WB=new Set([499,498,403,401]),ZB=new Set(["COM_0056","COM_0057","SB_0008"]),JB=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],uf=()=>null,y1=Symbol();function KB(e){const t=Xo(e);t&&!Qr._corsServers.includes(t)&&Qr._corsServers.push(t)}function Ck(e){const t=Xo(e);return!t||t.endsWith(".arcgis.com")||Qr._corsServers.includes(t)||OM(t)}function za(e,t,i,r){let s="Error";const a={url:i.url,requestOptions:i.requestOptions,getAllHeaders:uf,getHeader:uf,ssl:!1};if(t instanceof gt)return t.details?(t.details=Ge(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=a,t;if(t){const u=r&&(()=>Array.from(r.headers)),l=r&&(I=>r.headers.get(I)),y=r==null?void 0:r.status,w=t.message;w&&(s=w),u&&l&&(a.getAllHeaders=u,a.getHeader=l),a.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||y||0,a.subCode=t.subcode,a.messageCode=t.messageCode,typeof t.details=="string"?a.messages=[t.details]:a.messages=t.details,a.raw=y1 in t?t[y1]:t}return xo(t)?Er():new gt(e,s,a)}async function YB(){Ce("host-webworker")&&!m1&&(m1=await it(()=>import("./request-CXBwlp-N.js"),[]))}async function N2(){wi||await it(()=>import("./IdentityManager-Bn6PdTxi.js"),__vite__mapDeps([0,1]))}async function XB(e){var l;const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let a=null,u=null;if(OO&&"HTMLFormElement"in globalThis&&(s instanceof FormData?a=s:s instanceof HTMLFormElement&&(a=new FormData(s))),typeof s=="string"&&(u=s),e.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:qo.priority,redirect:"follow",signal:r},(a||u)&&(e.fetchOptions.body=a||u),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||(l=i.query)!=null&&l.token||a!=null&&a.get("token")),!e.hasToken&&mi.apiKey&&$O(t)&&(i.query||(i.query={}),i.query.token=mi.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!LO(t)&&!Vl(r)){let y;i.authMode==="immediate"?(await N2(),y=await wi.getCredential(t,{signal:r}),e.credential=y):i.authMode==="no-prompt"?(await N2(),y=await wi.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=y):wi&&(y=wi.findCredential(t)),y&&(e.credentialToken=y.token,e.useSSL=!!y.ssl)}}function LO(e){return JB.some(t=>t.test(e))}async function QB(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions??{},s=RM(t)||wd(t),a=i.responseType||"json",u=s?0:i.timeout!=null?i.timeout:qo.timeout;let l=!1;if(!s){e.useSSL&&(t=zM(t));let A={...i.query};e.credentialToken&&(A.token=e.credentialToken);let R=_g(A);Ce("esri-url-encodes-apostrophe")&&(R=R.replaceAll("'","%27"));const G=t.length+1+R.length;let K;l=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||G>qo.maxUrlLength;const Y=i.useProxy||!!pb(t);if(Y){const ae=wB(t);K=ae.path,!l&&K.length+1+G>qo.maxUrlLength&&(l=!0),ae.query&&(A={...ae.query,...A})}if(r.method==="HEAD"&&(l||Y)){if(l)throw G>qo.maxUrlLength?za("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):za("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(Y)throw za("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(l?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=hx(t,A):(r.body=_g(A),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=hx(t,A),Y&&(e.useProxy=!0,t=`${K}?${t}`),A.token&&OO&&r.body instanceof FormData&&!lB(t)&&r.body.set("token",A.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!cf(t,PM())){if(OM(t))e.withCredentials=!0;else if(wi){const ae=wi.findServerInfo(t);ae!=null&&ae.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include",qB(t)&&await HB(l?hx(t,A):t))}let y,w,I=0,E=!1;u>0&&(I=setTimeout(()=>{E=!0,e.controller.abort()},u));try{if(i.responseType==="native-request-init")w=r,w.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||l||tj(i.headers)||!s&&!e.useProxy&&qo.proxyUrl&&!Ck(t)){if(Qr._beforeFetch&&await Qr._beforeFetch(t,r),y=await fetch(t,r),Qr._afterFetch&&await Qr._afterFetch(y),e.useProxy||KB(t),i.responseType==="native")w=y;else if(r.method!=="HEAD")if(y.ok){switch(a){case"array-buffer":w=await y.arrayBuffer();break;case"blob":case"image":w=await y.blob();break;default:w=await y.text()}if(I&&(clearTimeout(I),I=0),a==="json"||a==="xml"||a==="document")if(w)switch(a){case"json":w=JSON.parse(w);break;case"xml":w=$k(w,"application/xml");break;case"document":w=$k(w,"text/html")}else w=null;if(w){if(a==="array-buffer"||a==="blob"){const A=y.headers.get("Content-Type");if(A&&/application\/json|text\/plain/i.test(A)&&w[a==="blob"?"size":"byteLength"]<=750)try{const R=await new Response(w).json();R.error&&(w=R)}catch{}}a==="image"&&w instanceof Blob&&(w=await Ok(URL.createObjectURL(w),e,!0))}}else{w=await y.text();try{w=JSON.parse(w)}catch{}}}else w=await Ok(t,e)}catch(A){if(A.name==="AbortError")throw E?UB():Er("Request canceled");if(!(!y&&A instanceof TypeError&&qo.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||Ck(t))throw A;e.redoRequest=!0,xB({proxyUrl:qo.proxyUrl,urlPrefix:Xo(t)??""})}finally{I&&clearTimeout(I)}return[y,w]}async function ej(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let i,r;try{r=await e.before(t)}catch(s){i=za("request:interceptor",s,t)}if((r instanceof Error||r instanceof gt)&&(i=za("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function tj(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function $k(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function ij(e){var a,u;let t,i;await XB(e);try{do[t,i]=await QB(e);while(!await rj(e,t,i))}catch(l){const y=za("request:server",l,e.params,t);throw y.details.ssl=e.useSSL,(a=e.interceptor)!=null&&a.error&&e.interceptor.error(y),y}const r=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!e.hasToken&&!e.credentialToken&&((u=i.user)!=null&&u.username)&&!OM(r)){const l=Xo(r,!0);l&&qo.trustedServers.push(l)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&GB(i.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&wi){const l=wi.findServerInfo(s.server);let y=l==null?void 0:l.owningSystemUrl;if(y){y=y.replace(/\/?$/,"/sharing");const w=wi.findCredential(y,s.userId);w&&wi._getIdenticalSvcIdx(y,w)===-1&&w.resources.unshift(y)}}return{data:i,getAllHeaders:t?()=>Array.from(t.headers):uf,getHeader:t?l=>t.headers.get(l):uf,httpStatus:(t==null?void 0:t.status)??200,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function rj(e,t,i){var w;if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,a;if(i&&(i.error?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[y1]=i,s.details=i.messages)),!s&&!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[y1]=i,s;let u,l=null;s&&(a=Number(s.code),l=s.hasOwnProperty("subcode")?Number(s.subcode):null,u=s.messageCode,u=u==null?void 0:u.toUpperCase());const y=r.authMode;if(a===403&&(l===4||(w=s.message)!=null&&w.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(y!=="no-prompt"||a===498)&&a!==void 0&&WB.has(a)&&!LO(e.params.url)&&(a!==403||(!u||!ZB.has(u))&&(l==null||l===2&&e.credentialToken))){await N2();try{const I=await wi.getCredential(e.params.url,{error:za("request:server",s,e.params),prompt:y!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=I,e.credentialToken=I.token,e.useSSL=e.useSSL||I.ssl,!1}catch(I){if(y==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;s=I}}if(s)throw s;return!0}function Ok(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=qo.priority,s.src=e,jB(s,e,i,r)}Qr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Qr._beforeFetch=void 0,Qr._afterFetch=void 0;let cv=class RO{constructor(){this._emitter=new RO.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}};(function(e){class t{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,a){var w;let u=(w=this._listenersMap)==null?void 0:w.get(s);if(!u)return!1;const l=this._target||this;let y=!1;for(const I of u.slice()){const E="deref"in I?I.deref():I;E?E==null||E.call(l,a):y=!0}return y&&(u=u.filter(I=>!("deref"in I)||I.deref()!=null),this._listenersMap.set(s,u)),u.length>0}on(s,a){if(Array.isArray(s)){const l=s.map(y=>this.on(y,a));return Fg(l)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const u=this._listenersMap.get(s)||[];return u.push(a),this._listenersMap.set(s,u),Ni(()=>{var w;const l=(w=this._listenersMap)==null?void 0:w.get(s),y=(l==null?void 0:l.indexOf(a))??-1;y>=0&&l.splice(y,1)})}once(s,a){const u=this.on(s,l=>{u.remove();const y="deref"in a?a.deref():a;y==null||y.call(null,l)});return u}hasEventListener(s){var u;const a=(u=this._listenersMap)==null?void 0:u.get(s);return a!=null&&a.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(a,u){return this._emitter.emit(a,u)}on(a,u){return this._emitter.on(a,u)}once(a,u){return this._emitter.once(a,u)}hasEventListener(a){return this._emitter.hasEventListener(a)}};return s=v([me("esri.core.Evented")],s),s};let i=class extends Pt{constructor(){super(...arguments),this._emitter=new cv.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=v([me("esri.core.Evented")],i),e.EventedAccessor=i})(cv||(cv={}));const Mu=cv;var pi;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(pi||(pi={}));function DO(e){return(t,i)=>{t[i]=e}}let qg=class extends L${notify(){const t=this._observers;if(t&&t.length>0){const i=t.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Rl;let sj=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}},nj=class{constructor(t,i,r,s,a){this.target=t,this.added=i,this.removed=r,this.start=s,this.deleteCount=a}};const no=new bd(sj,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1});function dx(e){return e?e instanceof Ol?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function px(e){if(e!=null&&e.length)return e[0]}function oj(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let a=0;for(;a<s&&e[i+a]===t[r+a];)a++;return a}function zO(e,t,i,r){t&&t.forEach((s,a,u)=>{e.push(s),zO(e,i.call(r,s,a,u),i,r)})}const wc=new Set,xc=new Set,Sc=new Set,fx=new Map;let aj=0,Ol=Rl=class extends Mu.EventedAccessor{static isCollection(e){return e!=null&&e instanceof Rl}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new qg,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:aj++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof Rl?{items:e}:e:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Tt(this._observable),this._items}set items(e){this._emitBeforeChanges(pi.ADD)||(this._splice(0,this.length,dx(e)),this._emitAfterChanges(pi.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Ni(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(e,t)}once(e,t){const i="deref"in t?()=>t.deref():()=>t,r=this.on(e,s=>{var a;(a=i())==null||a.call(null,s),r.remove()});return r}add(e,t){if(Tt(this._observable),this._emitBeforeChanges(pi.ADD))return this;const i=this.getNextIndex(t??null);return this._splice(i,0,[e]),this._emitAfterChanges(pi.ADD),this}addMany(e,t=this._items.length){if(Tt(this._observable),!(e!=null&&e.length))return this;if(this._emitBeforeChanges(pi.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,dx(e)),this._emitAfterChanges(pi.ADD),this}at(e){if(Tt(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(Tt(this._observable),!this.length||this._emitBeforeChanges(pi.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(pi.REMOVE),e}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Tt(this._observable),this._createNewInstance({items:this._items.map(Ge)})}concat(...e){Tt(this._observable);const t=e.map(dx);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Tt(this._observable),!this.length||this._emitBeforeChanges(pi.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(pi.REMOVE)}every(e,t){return Tt(this._observable),this._items.every(e,t)}filter(e,t){let i;return Tt(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return Tt(this._observable),this._items.find(e,t)}findIndex(e,t){return Tt(this._observable),this._items.findIndex(e,t)}flatten(e,t){Tt(this._observable);const i=[];return zO(i,this,e,t),new Rl(i)}forEach(e,t){return Tt(this._observable),this._items.forEach(e,t)}getItemAt(e){return Tt(this._observable),this._items[e]}getNextIndex(e){Tt(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Tt(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Tt(this._observable),this._items.indexOf(e,t)}join(e=","){return Tt(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Tt(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Tt(this._observable);const i=this._items.map(e,t);return new Rl({items:i})}reorder(e,t=this.length-1){Tt(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(pi.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(pi.MOVE)}return e}}pop(){if(Tt(this._observable),!this.length||this._emitBeforeChanges(pi.REMOVE))return;const e=px(this._splice(this.length-1,1));return this._emitAfterChanges(pi.REMOVE),e}push(...e){return Tt(this._observable),this._emitBeforeChanges(pi.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(pi.ADD)),this.length}reduce(e,t){Tt(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){Tt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return Tt(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Tt(this._observable),e<0||e>=this.length||this._emitBeforeChanges(pi.REMOVE))return;const t=px(this._splice(e,1));return this._emitAfterChanges(pi.REMOVE),t}removeMany(e){if(Tt(this._observable),!(e!=null&&e.length)||this._emitBeforeChanges(pi.REMOVE))return[];const t=e instanceof Rl?e.toArray():e,i=this._items,r=[],s=t.length;for(let a=0;a<s;a++){const u=t[a],l=i.indexOf(u);if(l>-1){const y=1+oj(t,i,a+1,l+1),w=this._splice(l,y);w&&w.length>0&&r.push.apply(r,w),a+=y-1}}return this._emitAfterChanges(pi.REMOVE),r}reverse(){if(Tt(this._observable),this._emitBeforeChanges(pi.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(pi.MOVE),this}shift(){if(Tt(this._observable),!this.length||this._emitBeforeChanges(pi.REMOVE))return;const e=px(this._splice(0,1));return this._emitAfterChanges(pi.REMOVE),e}slice(e=0,t=this.length){return Tt(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Tt(this._observable),this._items.some(e,t)}sort(e){if(Tt(this._observable),!this.length||this._emitBeforeChanges(pi.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(pi.MOVE),this}splice(e,t,...i){Tt(this._observable);const r=(t?pi.REMOVE:0)|(i.length?pi.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return Tt(this._observable),this._items.slice()}toJSON(){return Tt(this._observable),this.toArray()}toLocaleString(){return Tt(this._observable),this._items.toLocaleString()}toString(){return Tt(this._observable),this._items.toString()}unshift(...e){return Tt(this._observable),!e.length||this._emitBeforeChanges(pi.ADD)||(this._splice(0,0,e),this._emitAfterChanges(pi.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let a,u;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=Ug(()=>this._dispatchChange())),e<0&&(e+=this.length),t){if(u=r.splice(e,t),this.hasEventListener("before-remove")){const l=no.acquire();l.target=this,l.cancellable=!0;for(let y=0,w=u.length;y<w;y++)a=u[y],l.reset(a),this.emit("before-remove",l),l.defaultPrevented&&(u.splice(y,1),r.splice(e,0,a),e+=1,y-=1,w-=1);no.release(l)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const l=no.acquire();l.target=this,l.cancellable=!1;const y=u.length;for(let w=0;w<y;w++)l.reset(u[w]),this.emit("after-remove",l);no.release(l)}}if(i!=null&&i.length){if(s){const I=[];for(const E of i){const A=s.ensureType(E);A==null&&E!=null||I.push(A)}i=I}const l=this.hasEventListener("before-add"),y=this.hasEventListener("after-add"),w=e===this.length;if(l||y){const I=no.acquire();I.target=this,I.cancellable=!0;const E=no.acquire();E.target=this,E.cancellable=!1;for(const A of i)l?(I.reset(A),this.emit("before-add",I),I.defaultPrevented||(w?r.push(A):r.splice(e++,0,A),this._set("length",r.length),y&&(E.reset(A),this.emit("after-add",E)))):(w?r.push(A):r.splice(e++,0,A),this._set("length",r.length),E.reset(A),this.emit("after-add",E));no.release(E),no.release(I)}else{if(w)for(const I of i)r.push(I);else r.splice(e,0,...i);this._set("length",r.length)}}if((i!=null&&i.length||u!=null&&u.length)&&this._notifyChangeEvent(i,u),this.hasEventListener("after-splice")){const l=new nj(this,i,u,e,t);this.emit("after-splice",l)}return u}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=no.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,no.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=no.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),no.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;wc.clear(),xc.clear(),Sc.clear();for(const{added:y,removed:w}of i){if(y)if(Sc.size===0&&xc.size===0)for(const I of y)wc.add(I);else for(const I of y)xc.has(I)?(Sc.add(I),xc.delete(I)):Sc.has(I)||wc.add(I);if(w)if(Sc.size===0&&wc.size===0)for(const I of w)xc.add(I);else for(const I of w)wc.has(I)?wc.delete(I):(Sc.delete(I),xc.add(I))}const r=tn.acquire();wc.forEach(y=>{r.push(y)});const s=tn.acquire();xc.forEach(y=>{s.push(y)});const a=this._items,u=t.items,l=tn.acquire();if(Sc.forEach(y=>{u.indexOf(y)!==a.indexOf(y)&&l.push(y)}),t.listeners&&(r.length||s.length||l.length)){const y={target:this,added:r,removed:s,moved:l},w=t.listeners.length;for(let I=0;I<w;I++){const E=t.listeners[I];E.removed||E.callback.call(this,y)}}tn.release(r),tn.release(s),tn.release(l)}wc.clear(),xc.clear(),Sc.clear()}};Ol.ofType=e=>{if(!e)return Rl;if(fx.has(e))return fx.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends Rl{};return v([DO({Type:e,ensureType:typeof e=="function"?an(e):Ul(e)})],i.prototype,"itemType",void 0),i=v([me(`esri.core.Collection<${t}>`)],i),fx.set(e,i),i},v([M()],Ol.prototype,"_updating",void 0),v([M()],Ol.prototype,"length",void 0),v([M()],Ol.prototype,"items",null),v([M({readOnly:!0})],Ol.prototype,"updating",null),Ol=Rl=v([me("esri.core.Collection")],Ol);const At=Ol;function ad(e,t,i=At){return t||(t=new i),t===e||(t.removeAll(),lj(e)?t.addMany(e):e&&t.add(e)),t}function NO(e){return e}function lj(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}var eu;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(eu||(eu={}));let cj=class{constructor(){this._resolver=wo(),this._status=eu.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=eu.RESOLVED,this._cleanUp()},()=>{this._status=eu.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===eu.RESOLVED}isRejected(){return this._status===eu.REJECTED}isFulfilled(){return this._status!==eu.PENDING}abort(){this._resolver.reject(Er())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const t=wo(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||xo(s)||this._resolver.reject(s)}),t.resolve()}};const FM=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new cj,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=v([me("esri.core.Promise")],t),t};let g1=class extends FM(Pt){};g1=v([me("esri.core.Promise")],g1);const uj="not-loaded",hj="loading",dj="failed",Lk="loaded",FO=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=a=>{const u=new Promise((l,y)=>{const w=wM(a,y);this.destroyed&&y(new gt("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(l,y).finally(()=>{w&&w.remove()})});if(this.loadStatus===uj){this._set("loadStatus",hj);const l=this._loadController=new AbortController;s({signal:l.signal})}return r(),u}})),this.when(()=>{this._set("loadStatus",Lk),this._loadController=null},r=>{this._set("loadStatus",dj),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=fg(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Lk}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new gt("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort(),this._promiseProps.abort()),this}};return v([M({readOnly:!0})],t.prototype,"loaded",null),v([M({readOnly:!0})],t.prototype,"loadError",void 0),v([M({clonable:!1})],t.prototype,"loadStatus",void 0),v([M({type:[Gl],readOnly:!0})],t.prototype,"loadWarnings",null),t=v([me("esri.core.Loadable")],t),t};let ly=class extends FO(g1){};ly=v([me("esri.core.Loadable")],ly),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=FO,e.isLoadable=t}(ly||(ly={}));const mu=ly;function yoe(e,t,i){return xM(e.map((r,s)=>t.apply(i,[r,s])))}async function pj(e,t,i){return(await xM(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}function BM(e){return{ok:!0,value:e}}function jM(e){return{ok:!1,error:e}}function fj(e){return e!=null&&e.ok===!0?e.value:null}function mj(e){return e!=null&&e.ok===!1?e.error:null}async function BO(e){if(e==null)return{ok:!1,error:new Error("no promise provided")};try{return BM(await e)}catch(t){return jM(t)}}async function goe(e){try{return BM(await e)}catch(t){return H$(t),jM(t)}}function VM(e,t){return new Cc(e,t)}let Cc=class extends Pt{get value(){return fj(this._result)}get error(){return mj(this._result)}get finished(){return this._result!=null}constructor(t,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=fg(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=t(r),this.promise.then(s=>{this._result=BM(s),this._cleanup()},s=>{this._result=jM(s),this._cleanup()}),this._abortHandle=vo(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=er(this._abortHandle),this._abortController=null}};v([M()],Cc.prototype,"value",null),v([M()],Cc.prototype,"error",null),v([M()],Cc.prototype,"finished",null),v([M()],Cc.prototype,"promise",void 0),v([M()],Cc.prototype,"_result",void 0),Cc=v([me("esri.core.asyncUtils.ReactiveTask")],Cc);async function jO(e,t){return await e.load(),yj(e,t)}async function yj(e,t){const i=[],r=(...a)=>{for(const u of a)u!=null&&(Array.isArray(u)?r(...u):At.isCollection(u)?u.forEach(l=>r(l)):mu.isLoadable(u)&&i.push(u))};t(r);let s=null;if(await pj(i,async a=>{const u=await BO(gj(a)?a.loadAll():a.load());u.ok!==!1||s||(s=u)}),s)throw s.error;return e}function gj(e){return"loadAll"in e&&typeof e.loadAll=="function"}function ni(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(a,u)=>{const l=a.constructor.prototype;for(const y of r){const w=aO(a,y,s);w.write&&typeof w.write=="object"||(w.write={}),i&&(w.write.target=i),w.write.writer=l[u]}}}let hs=class{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=t,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,a)=>{const u=this.toJSON(r);u!==void 0&&Sf(a,u,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(t==null)return null;if(this._apiToJSON.hasOwnProperty(t)){const i=this._apiToJSON[t];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:t}fromJSON(t){return t!=null&&this._jsonToAPI.hasOwnProperty(t)?this._jsonToAPI[t]:this._options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}};function In(){return function(e,t){return new hs(e,{ignoreUnknown:!0,...t})}}let UM=class{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const a=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*a,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const gr=new UM(6378137,1/298.257223563,3e5,.006694379990137799),Na=new UM(3396190,1/169.8944472236118,23e4),yu=new UM(1737400,0,0);function fi(e){if(!mi.assetsPath)throw pt.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new gt("assets:path-not-set","config.assetsPath is not set");return fb(mi.assetsPath,e)}let mx,xe=null;function GM(){return!!xe}function _j(){return!!Ce("esri-wasm")}function VO(){return mx||(mx=it(()=>import("./pe-wasm-BeY1kFc9.js"),[]).then(e=>e.p).then(({default:e})=>e({locateFile:t=>fi(`esri/geometry/support/${t}`)})).then(e=>{GO(e)}),mx)}var F2,Wi,B2;(function(e){function t(a,u,l){xe.ensureCache.prepare();const y=Dh(l),w=l===y,I=xe.ensureFloat64(y),E=xe._pe_geog_to_proj(xe.getPointer(a),u,I);return E&&ou(l,u,I,w),E}function i(a,u,l,y){switch(y){case Wi.PE_TRANSFORM_P_TO_G:return r(a,u,l);case Wi.PE_TRANSFORM_G_TO_P:return t(a,u,l)}return 0}function r(a,u,l){return s(a,u,l,0)}function s(a,u,l,y){xe.ensureCache.prepare();const w=Dh(l),I=l===w,E=xe.ensureFloat64(w),A=xe._pe_proj_to_geog_center(xe.getPointer(a),u,E,y);return A&&ou(l,u,E,I),A}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(F2||(F2={})),function(e){function t(){e.PE_BUFFER_MAX=xe.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=xe.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=xe.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=xe.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=xe.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=xe.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=xe.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=xe.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=xe.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=xe.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=xe.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=xe.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=xe.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=xe.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=xe.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=xe.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=xe.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=xe.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=xe.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=xe.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_STR_FMT_WKT=xe.PeDefs.prototype.PE_STR_FMT_WKT,e.PE_STR_FMT_WKT2=xe.PeDefs.prototype.PE_STR_FMT_WKT2,e.PE_PARM_X0=xe.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=xe.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=xe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=xe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=xe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=xe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=xe.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=xe.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=xe.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=xe.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(Wi||(Wi={})),function(e){const t={},i={},r=R=>{if(R){const G=R.getType();switch(G){case Wi.PE_TYPE_GEOGCS:R=xe.castObject(R,xe.PeGeogcs);break;case Wi.PE_TYPE_PROJCS:R=xe.castObject(R,xe.PeProjcs);break;case Wi.PE_TYPE_GEOGTRAN:R=xe.castObject(R,xe.PeGeogtran);break;default:G&Wi.PE_TYPE_UNIT&&(R=xe.castObject(R,xe.PeUnit))}}return R};function s(){xe.PeFactory.prototype.initialize(null)}function a(R){return u(Wi.PE_TYPE_COORDSYS,R)}function u(R,G){let K=null,Y=t[R];if(Y||(Y={},t[R]=Y),Y.hasOwnProperty(String(G)))K=Y[G];else{const ae=xe.PeFactory.prototype.factoryByType(R,G);xe.compare(ae,xe.NULL)||(K=ae,Y[G]=K)}return K=r(K),K}function l(R,G){let K=null,Y=i[R];if(Y||(Y={},i[R]=Y),Y.hasOwnProperty(G))K=Y[G];else{const ae=xe.PeFactory.prototype.fromString(R,G);xe.compare(ae,xe.NULL)||(K=ae,Y[G]=K)}return K=r(K),K}function y(R){return u(Wi.PE_TYPE_GEOGCS,R)}function w(R){return u(Wi.PE_TYPE_GEOGTRAN,R)}function I(R){return xe.PeFactory.prototype.getCode(R)}function E(R){return u(Wi.PE_TYPE_PROJCS,R)}function A(R){return u(Wi.PE_TYPE_UNIT,R)}e.initialize=s,e.coordsys=a,e.factoryByType=u,e.fromString=l,e.geogcs=y,e.geogtran=w,e.getCode=I,e.projcs=E,e.unit=A}(B2||(B2={}));let UO=null;var _1,j2,V2,U2,v1,G2,b1,w1,q2;function GO(e){function t(a,u,l){a[u]=l(a[u])}xe=e,Wi.init(),_1.init(),v1.init(),b1.init(),w1.init(),UO=class extends xe.PeGCSExtent{destroy(){xe.destroy(this)}};const i=[xe.PeDatum,xe.PeGeogcs,xe.PeGeogtran,xe.PeObject,xe.PeParameter,xe.PePrimem,xe.PeProjcs,xe.PeSpheroid,xe.PeUnit];for(const a of i)t(a.prototype,"getName",u=>function(){return u.call(this,new Array(Wi.PE_NAME_MAX))});for(const a of[xe.PeGeogtran,xe.PeProjcs])t(a.prototype,"getParameters",u=>function(){const l=new Array(Wi.PE_PARM_MAX);let y=u.call(this);for(let w=0;w<l.length;w++){const I=xe.getValue(y,"*");l[w]=I?xe.wrapPointer(I,xe.PeParameter):null,y+=Int32Array.BYTES_PER_ELEMENT}return l});t(xe.PeHorizon.prototype,"getCoord",a=>function(){const u=this.getSize();if(!u)return null;const l=[];return ou(l,u,a.call(this)),l}),t(xe.PeGTlistExtendedEntry.prototype,"getEntries",a=>{const u=xe._pe_getPeGTlistExtendedGTsSize();return function(){let l=null;const y=a.call(this);if(!xe.compare(y,xe.NULL)){l=[y];const w=this.getSteps();if(w>1){const I=xe.getPointer(y);for(let E=1;E<w;E++)l.push(xe.wrapPointer(I+u*E,xe.PeGTlistExtendedGTs))}}return l}});const r=xe._pe_getPeHorizonSize(),s=a=>function(){let u=this._cache;if(u||(u=new Map,this._cache=u),u.has(a))return u.get(a);let l=null;const y=a.call(this);if(!xe.compare(y,xe.NULL)){l=[y];const w=y.getNump();if(w>1){const I=xe.getPointer(y);for(let E=1;E<w;E++)l.push(xe.wrapPointer(I+r*E,xe.PeHorizon))}}return u.set(a,l),l};t(xe.PeProjcs.prototype,"horizonGcsGenerate",s),t(xe.PeProjcs.prototype,"horizonPcsGenerate",s),xe.PeObject.prototype.toString=function(a=Wi.PE_STR_OPTS_NONE){xe.ensureCache.prepare();const u=xe.getPointer(this),l=xe.ensureInt8(new Array(Wi.PE_BUFFER_MAX));return xe.UTF8ToString(xe._pe_object_to_string_ext(u,a,l))}}function vl(e){if(!e)return;const t=xe.getClass(e);if(!t)return;const i=xe.getCache(t);if(!i)return;const r=xe.getPointer(e);r&&delete i[r]}function w_(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(xe.ensureInt8(r));return i}function Dh(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function ou(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=xe.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let a=0;a<t;a++)s&&(e[a]=new Array(2)),e[a][0]=xe.getValue(i,"double"),e[a][1]=xe.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=xe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=xe._pe_getPeGTlistExtendedEntrySize()}function r(s,a,u,l,y,w){let I=null;const E=new xe.PeInteger(w);try{const A=xe.PeGTlistExtended.prototype.getGTlist(s,a,u,l,y,E);if((w=E.val)&&(I=[A],w>1)){const R=xe.getPointer(A);for(let G=1;G<w;G++)I.push(xe.wrapPointer(R+t*G,xe.PeGTlistExtendedEntry))}}finally{xe.destroy(E)}return I}e.init=i,e.getGTlist=r})(_1||(_1={})),function(e){function t(i){if(i!=null&&i.length){for(const r of i)vl(r),r.getEntries().forEach(s=>{vl(s);const a=s.getGeogtran();vl(a),a.getParameters().forEach(vl),[a.getGeogcs1(),a.getGeogcs2()].forEach(u=>{vl(u);const l=u.getDatum();vl(l),vl(l.getSpheroid()),vl(u.getPrimem()),vl(u.getUnit())})});xe.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(j2||(j2={})),function(e){function t(i,r,s,a,u){xe.ensureCache.prepare();const l=Dh(s),y=s===l,w=xe.ensureFloat64(l);let I=0;a&&(I=xe.ensureFloat64(a));const E=xe._pe_geog_to_geog(xe.getPointer(i),r,w,I,u);return E&&ou(s,r,w,y),E}e.geogToGeog=t}(V2||(V2={})),function(e){const t=(w,I,E,A,R,G)=>{let K,Y;switch(xe.ensureCache.prepare(),w){case"dd":K=xe._pe_geog_to_dd,Y=Wi.PE_DD_MAX;break;case"ddm":K=xe._pe_geog_to_ddm,Y=Wi.PE_DDM_MAX;break;case"dms":K=xe._pe_geog_to_dms,Y=Wi.PE_DMS_MAX}let ae=0;I&&(ae=xe.getPointer(I));const Te=Dh(A),_e=xe.ensureFloat64(Te),be=w_(E,Y),ke=K(ae,E,_e,R,xe.ensureInt32(be));if(ke)for(let Ae=0;Ae<E;Ae++)G[Ae]=xe.UTF8ToString(be[Ae]);return ke},i=(w,I,E,A,R)=>{let G;switch(xe.ensureCache.prepare(),w){case"dd":G=xe._pe_dd_to_geog;break;case"ddm":G=xe._pe_ddm_to_geog;break;case"dms":G=xe._pe_dms_to_geog}let K=0;I&&(K=xe.getPointer(I));const Y=A.map(be=>xe.ensureString(be)),ae=xe.ensureInt32(Y),Te=xe.ensureFloat64(new Array(2*E)),_e=G(K,E,ae,Te);return _e&&ou(R,E,Te),_e};function r(w,I,E,A,R){return t("dms",w,I,E,A,R)}function s(w,I,E,A){return i("dms",w,I,E,A)}function a(w,I,E,A,R){return t("ddm",w,I,E,A,R)}function u(w,I,E,A){return i("ddm",w,I,E,A)}function l(w,I,E,A,R){return t("dd",w,I,E,A,R)}function y(w,I,E,A){return i("dd",w,I,E,A)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=a,e.ddmToGeog=u,e.geogToDd=l,e.ddToGeog=y}(U2||(U2={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=xe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=xe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=xe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=xe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=xe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,a,u,l,y,w,I){xe.ensureCache.prepare();let E=0;s&&(E=xe.getPointer(s));const A=Dh(u),R=xe.ensureFloat64(A),G=w_(a,Wi.PE_MGRS_MAX),K=xe.ensureInt32(G),Y=xe._pe_geog_to_mgrs_extended(E,a,R,l,y,w,K);if(Y)for(let ae=0;ae<a;ae++)I[ae]=xe.UTF8ToString(G[ae]);return Y}function r(s,a,u,l,y){xe.ensureCache.prepare();let w=0;s&&(w=xe.getPointer(s));const I=u.map(G=>xe.ensureString(G)),E=xe.ensureInt32(I),A=xe.ensureFloat64(new Array(2*a)),R=xe._pe_mgrs_to_geog_extended(w,a,E,l,A);return R&&ou(y,a,A),R}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(v1||(v1={})),function(e){function t(r,s,a,u,l,y,w){xe.ensureCache.prepare();let I=0;r&&(I=xe.getPointer(r));const E=Dh(a),A=xe.ensureFloat64(E),R=w_(s,Wi.PE_MGRS_MAX),G=xe.ensureInt32(R),K=xe._pe_geog_to_usng(I,s,A,u,l,y,G);if(K)for(let Y=0;Y<s;Y++)w[Y]=xe.UTF8ToString(R[Y]);return K}function i(r,s,a,u){xe.ensureCache.prepare();let l=0;r&&(l=xe.getPointer(r));const y=a.map(A=>xe.ensureString(A)),w=xe.ensureInt32(y),I=xe.ensureFloat64(new Array(2*s)),E=xe._pe_usng_to_geog(l,s,w,I);return E&&ou(u,s,I),E}e.geogToUsng=t,e.usngToGeog=i}(G2||(G2={})),function(e){function t(){e.PE_UTM_OPTS_NONE=xe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=xe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=xe.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,a,u,l,y){xe.ensureCache.prepare();let w=0;s&&(w=xe.getPointer(s));const I=Dh(u),E=xe.ensureFloat64(I),A=w_(a,Wi.PE_UTM_MAX),R=xe.ensureInt32(A),G=xe._pe_geog_to_utm(w,a,E,l,R);if(G)for(let K=0;K<a;K++)y[K]=xe.UTF8ToString(A[K]);return G}function r(s,a,u,l,y){xe.ensureCache.prepare();let w=0;s&&(w=xe.getPointer(s));const I=u.map(G=>xe.ensureString(G)),E=xe.ensureInt32(I),A=xe.ensureFloat64(new Array(2*a)),R=xe._pe_utm_to_geog(w,a,E,l,A);return R&&ou(y,a,A),R}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(b1||(b1={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=xe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=xe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=xe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=xe.PePCSInfo.prototype.PE_POLE_POINT}function r(s,a=e.PE_PCSINFO_OPTION_DOMAIN){let u=null,l=null;return t.has(s)&&(l=t.get(s),l[a]&&(u=l[a])),u||(u=xe.PePCSInfo.prototype.generate(s,a),l||(l=[],t.set(s,l)),l[a]=u),u}e.init=i,e.generate=r}(w1||(w1={})),function(e){function t(){return xe.PeVersion.prototype.version_string()}e.versionString=t}(q2||(q2={}));const vj=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return F2},get PeDefs(){return Wi},get PeFactory(){return B2},get PeGCSExtent(){return UO},get PeGTTransformations(){return V2},get PeGTlistExtended(){return _1},get PeGTlistExtendedEntry(){return j2},get PeNotationDms(){return U2},get PeNotationMgrs(){return v1},get PeNotationUsng(){return G2},get PeNotationUtm(){return b1},get PePCSInfo(){return w1},get PeVersion(){return q2},_init:GO,get _pe(){return xe},isLoaded:GM,isSupported:_j,load:VO},Symbol.toStringTag,{value:"Module"}));var ld;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(ld||(ld={}));let m;const U={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(m=2e3;m<=2045;m++)U[m]=0;for(m=2056;m<=2065;m++)U[m]=0;for(m=2067;m<=2135;m++)U[m]=0;for(m=2137;m<=2154;m++)U[m]=0;for(m=2161;m<=2170;m++)U[m]=0;for(m=2172;m<=2193;m++)U[m]=0;for(m=2195;m<=2198;m++)U[m]=0;for(m=2200;m<=2203;m++)U[m]=0;for(m=2205;m<=2217;m++)U[m]=0;for(m=2222;m<=2224;m++)U[m]=1;for(m=2225;m<=2250;m++)U[m]=2;for(m=2251;m<=2253;m++)U[m]=1;for(m=2257;m<=2264;m++)U[m]=2;for(m=2274;m<=2279;m++)U[m]=2;for(m=2280;m<=2282;m++)U[m]=1;for(m=2283;m<=2289;m++)U[m]=2;for(m=2290;m<=2292;m++)U[m]=0;for(m=2308;m<=2313;m++)U[m]=0;for(m=2315;m<=2491;m++)U[m]=0;for(m=2494;m<=2866;m++)U[m]=0;for(m=2867;m<=2869;m++)U[m]=1;for(m=2870;m<=2888;m++)U[m]=2;for(m=2891;m<=2895;m++)U[m]=2;for(m=2896;m<=2898;m++)U[m]=1;for(m=2902;m<=2908;m++)U[m]=2;for(m=2915;m<=2920;m++)U[m]=2;for(m=2921;m<=2923;m++)U[m]=1;for(m=2924;m<=2930;m++)U[m]=2;for(m=2931;m<=2962;m++)U[m]=0;for(m=2964;m<=2968;m++)U[m]=2;for(m=2969;m<=2973;m++)U[m]=0;for(m=2975;m<=2991;m++)U[m]=0;for(m=2995;m<=3051;m++)U[m]=0;for(m=3054;m<=3079;m++)U[m]=0;for(m=3081;m<=3088;m++)U[m]=0;for(m=3092;m<=3101;m++)U[m]=0;for(m=3106;m<=3138;m++)U[m]=0;for(m=3146;m<=3151;m++)U[m]=0;for(m=3153;m<=3166;m++)U[m]=0;for(m=3168;m<=3172;m++)U[m]=0;for(m=3174;m<=3203;m++)U[m]=0;for(m=3294;m<=3358;m++)U[m]=0;for(m=3367;m<=3403;m++)U[m]=0;for(m=3408;m<=3416;m++)U[m]=0;for(m=3417;m<=3438;m++)U[m]=2;for(m=3441;m<=3446;m++)U[m]=2;for(m=3447;m<=3450;m++)U[m]=0;for(m=3451;m<=3459;m++)U[m]=2;for(m=3460;m<=3478;m++)U[m]=0;for(m=3554;m<=3559;m++)U[m]=0;for(m=3560;m<=3570;m++)U[m]=2;for(m=3571;m<=3581;m++)U[m]=0;for(m=3594;m<=3597;m++)U[m]=0;for(m=3601;m<=3604;m++)U[m]=0;for(m=3637;m<=3639;m++)U[m]=0;for(m=3665;m<=3667;m++)U[m]=0;for(m=3693;m<=3695;m++)U[m]=0;for(m=3701;m<=3727;m++)U[m]=0;for(m=3728;m<=3739;m++)U[m]=2;for(m=3740;m<=3751;m++)U[m]=0;for(m=3753;m<=3760;m++)U[m]=2;for(m=3761;m<=3773;m++)U[m]=0;for(m=3775;m<=3777;m++)U[m]=0;for(m=3779;m<=3781;m++)U[m]=0;for(m=3783;m<=3785;m++)U[m]=0;for(m=3788;m<=3791;m++)U[m]=0;for(m=3797;m<=3802;m++)U[m]=0;for(m=3814;m<=3816;m++)U[m]=0;for(m=3825;m<=3829;m++)U[m]=0;for(m=3832;m<=3841;m++)U[m]=0;for(m=3844;m<=3852;m++)U[m]=0;for(m=3873;m<=3885;m++)U[m]=0;for(m=3890;m<=3893;m++)U[m]=0;for(m=3907;m<=3912;m++)U[m]=0;for(m=3942;m<=3950;m++)U[m]=0;for(m=3968;m<=3970;m++)U[m]=0;for(m=3973;m<=3976;m++)U[m]=0;for(m=3986;m<=3989;m++)U[m]=0;for(m=3994;m<=3997;m++)U[m]=0;for(m=4048;m<=4051;m++)U[m]=0;for(m=4056;m<=4063;m++)U[m]=0;for(m=4093;m<=4096;m++)U[m]=0;for(m=4390;m<=4398;m++)U[m]=0;for(m=4399;m<=4413;m++)U[m]=2;for(m=4418;m<=4433;m++)U[m]=2;for(m=4455;m<=4457;m++)U[m]=2;for(m=4484;m<=4489;m++)U[m]=0;for(m=4491;m<=4554;m++)U[m]=0;for(m=4568;m<=4589;m++)U[m]=0;for(m=4652;m<=4656;m++)U[m]=0;for(m=4766;m<=4800;m++)U[m]=0;for(m=5014;m<=5016;m++)U[m]=0;for(m=5069;m<=5072;m++)U[m]=0;for(m=5105;m<=5130;m++)U[m]=0;for(m=5167;m<=5188;m++)U[m]=0;for(m=5253;m<=5259;m++)U[m]=0;for(m=5269;m<=5275;m++)U[m]=0;for(m=5292;m<=5311;m++)U[m]=0;for(m=5329;m<=5331;m++)U[m]=0;for(m=5343;m<=5349;m++)U[m]=0;for(m=5355;m<=5357;m++)U[m]=0;for(m=5387;m<=5389;m++)U[m]=0;for(m=5459;m<=5463;m++)U[m]=0;for(m=5479;m<=5482;m++)U[m]=0;for(m=5518;m<=5520;m++)U[m]=0;for(m=5530;m<=5539;m++)U[m]=0;for(m=5550;m<=5552;m++)U[m]=0;for(m=5562;m<=5583;m++)U[m]=0;for(m=5623;m<=5625;m++)U[m]=2;for(m=5631;m<=5639;m++)U[m]=0;for(m=5649;m<=5653;m++)U[m]=0;for(m=5663;m<=5680;m++)U[m]=0;for(m=5682;m<=5685;m++)U[m]=0;for(m=5875;m<=5877;m++)U[m]=0;for(m=5896;m<=5899;m++)U[m]=0;for(m=5921;m<=5940;m++)U[m]=0;for(m=6050;m<=6125;m++)U[m]=0;for(m=6244;m<=6275;m++)U[m]=0;for(m=6328;m<=6348;m++)U[m]=0;for(m=6350;m<=6356;m++)U[m]=0;for(m=6366;m<=6372;m++)U[m]=0;for(m=6381;m<=6387;m++)U[m]=0;for(m=6393;m<=6404;m++)U[m]=0;for(m=6480;m<=6483;m++)U[m]=0;for(m=6511;m<=6514;m++)U[m]=0;for(m=6579;m<=6581;m++)U[m]=0;for(m=6619;m<=6624;m++)U[m]=0;for(m=6625;m<=6627;m++)U[m]=2;for(m=6628;m<=6632;m++)U[m]=0;for(m=6634;m<=6637;m++)U[m]=0;for(m=6669;m<=6692;m++)U[m]=0;for(m=6707;m<=6709;m++)U[m]=0;for(m=6720;m<=6723;m++)U[m]=0;for(m=6732;m<=6738;m++)U[m]=0;for(m=6931;m<=6933;m++)U[m]=0;for(m=6956;m<=6959;m++)U[m]=0;for(m=7005;m<=7007;m++)U[m]=0;for(m=7057;m<=7070;m++)U[m]=2;for(m=7074;m<=7082;m++)U[m]=0;for(m=7109;m<=7118;m++)U[m]=0;for(m=7119;m<=7127;m++)U[m]=1;for(m=7374;m<=7376;m++)U[m]=0;for(m=7528;m<=7586;m++)U[m]=0;for(m=7587;m<=7645;m++)U[m]=2;for(m=7692;m<=7696;m++)U[m]=0;for(m=7755;m<=7787;m++)U[m]=0;for(m=7791;m<=7795;m++)U[m]=0;for(m=7799;m<=7801;m++)U[m]=0;for(m=7803;m<=7805;m++)U[m]=0;for(m=7825;m<=7831;m++)U[m]=0;for(m=7845;m<=7859;m++)U[m]=0;for(m=8013;m<=8032;m++)U[m]=0;for(m=8065;m<=8068;m++)U[m]=1;for(m=8518;m<=8529;m++)U[m]=2;for(m=8533;m<=8536;m++)U[m]=2;for(m=8538;m<=8540;m++)U[m]=2;for(m=8677;m<=8679;m++)U[m]=0;for(m=8836;m<=8840;m++)U[m]=0;for(m=8857;m<=8859;m++)U[m]=0;for(m=8908;m<=8910;m++)U[m]=0;for(m=9154;m<=9159;m++)U[m]=0;for(m=9205;m<=9218;m++)U[m]=0;for(m=9271;m<=9273;m++)U[m]=0;for(m=9295;m<=9297;m++)U[m]=0;for(m=9356;m<=9360;m++)U[m]=0;for(m=9404;m<=9407;m++)U[m]=0;for(m=9476;m<=9482;m++)U[m]=0;for(m=9487;m<=9494;m++)U[m]=0;for(m=9697;m<=9699;m++)U[m]=0;for(m=9821;m<=9865;m++)U[m]=0;for(m=10285;m<=10291;m++)U[m]=0;for(m=10314;m<=10317;m++)U[m]=0;for(m=10448;m<=10465;m++)U[m]=0;for(m=11114;m<=11118;m++)U[m]=0;for(m=20004;m<=20032;m++)U[m]=0;for(m=20047;m<=20049;m++)U[m]=0;for(m=20062;m<=20092;m++)U[m]=0;for(m=20135;m<=20138;m++)U[m]=0;for(m=20248;m<=20258;m++)U[m]=0;for(m=20348;m<=20358;m++)U[m]=0;for(m=20436;m<=20440;m++)U[m]=0;for(m=20822;m<=20824;m++)U[m]=0;for(m=20904;m<=20932;m++)U[m]=0;for(m=20934;m<=20936;m++)U[m]=0;for(m=21004;m<=21032;m++)U[m]=0;for(m=21035;m<=21037;m++)U[m]=0;for(m=21095;m<=21097;m++)U[m]=0;for(m=21148;m<=21150;m++)U[m]=0;for(m=21207;m<=21264;m++)U[m]=0;for(m=21307;m<=21364;m++)U[m]=0;for(m=21413;m<=21423;m++)U[m]=0;for(m=21453;m<=21463;m++)U[m]=0;for(m=21473;m<=21483;m++)U[m]=0;for(m=21780;m<=21782;m++)U[m]=0;for(m=21891;m<=21894;m++)U[m]=0;for(m=21896;m<=21899;m++)U[m]=0;for(m=22171;m<=22177;m++)U[m]=0;for(m=22181;m<=22187;m++)U[m]=0;for(m=22191;m<=22197;m++)U[m]=0;for(m=22207;m<=22222;m++)U[m]=0;for(m=22229;m<=22232;m++)U[m]=0;for(m=22234;m<=22236;m++)U[m]=0;for(m=22243;m<=22250;m++)U[m]=0;for(m=22262;m<=22265;m++)U[m]=0;for(m=22307;m<=22322;m++)U[m]=0;for(m=22348;m<=22357;m++)U[m]=0;for(m=22407;m<=22422;m++)U[m]=0;for(m=22462;m<=22465;m++)U[m]=0;for(m=22521;m<=22525;m++)U[m]=0;for(m=22607;m<=22622;m++)U[m]=0;for(m=22641;m<=22646;m++)U[m]=0;for(m=22648;m<=22657;m++)U[m]=0;for(m=22707;m<=22722;m++)U[m]=0;for(m=22762;m<=22765;m++)U[m]=0;for(m=22807;m<=22822;m++)U[m]=0;for(m=22991;m<=22994;m++)U[m]=0;for(m=23028;m<=23038;m++)U[m]=0;for(m=23301;m<=23333;m++)U[m]=2;for(m=23830;m<=23853;m++)U[m]=0;for(m=23866;m<=23872;m++)U[m]=0;for(m=23877;m<=23884;m++)U[m]=0;for(m=23886;m<=23894;m++)U[m]=0;for(m=23946;m<=23948;m++)U[m]=0;for(m=24311;m<=24313;m++)U[m]=0;for(m=24342;m<=24347;m++)U[m]=0;for(m=24370;m<=24374;m++)U[m]=10;for(m=24375;m<=24381;m++)U[m]=0;for(m=24718;m<=24721;m++)U[m]=0;for(m=24817;m<=24821;m++)U[m]=0;for(m=24877;m<=24882;m++)U[m]=0;for(m=24891;m<=24893;m++)U[m]=0;for(m=25391;m<=25395;m++)U[m]=0;for(m=25828;m<=25838;m++)U[m]=0;for(m=26191;m<=26195;m++)U[m]=0;for(m=26391;m<=26393;m++)U[m]=0;for(m=26701;m<=26722;m++)U[m]=0;for(m=26729;m<=26799;m++)U[m]=2;for(m=26801;m<=26803;m++)U[m]=2;for(m=26811;m<=26813;m++)U[m]=2;for(m=26847;m<=26870;m++)U[m]=2;for(m=26891;m<=26899;m++)U[m]=0;for(m=26901;m<=26923;m++)U[m]=0;for(m=26929;m<=26946;m++)U[m]=0;for(m=26948;m<=26998;m++)U[m]=0;for(m=27037;m<=27040;m++)U[m]=0;for(m=27205;m<=27232;m++)U[m]=0;for(m=27258;m<=27260;m++)U[m]=0;for(m=27391;m<=27398;m++)U[m]=0;for(m=27561;m<=27564;m++)U[m]=0;for(m=27571;m<=27574;m++)U[m]=0;for(m=27581;m<=27584;m++)U[m]=0;for(m=27591;m<=27594;m++)U[m]=0;for(m=28191;m<=28193;m++)U[m]=0;for(m=28348;m<=28358;m++)U[m]=0;for(m=28402;m<=28432;m++)U[m]=0;for(m=28462;m<=28492;m++)U[m]=0;for(m=29118;m<=29122;m++)U[m]=0;for(m=29168;m<=29172;m++)U[m]=0;for(m=29177;m<=29185;m++)U[m]=0;for(m=29187;m<=29195;m++)U[m]=0;for(m=29900;m<=29903;m++)U[m]=0;for(m=30161;m<=30179;m++)U[m]=0;for(m=30491;m<=30494;m++)U[m]=0;for(m=30729;m<=30732;m++)U[m]=0;for(m=31251;m<=31259;m++)U[m]=0;for(m=31265;m<=31268;m++)U[m]=0;for(m=31275;m<=31279;m++)U[m]=0;for(m=31281;m<=31297;m++)U[m]=0;for(m=31461;m<=31469;m++)U[m]=0;for(m=31491;m<=31495;m++)U[m]=0;for(m=31917;m<=31922;m++)U[m]=0;for(m=31965;m<=32e3;m++)U[m]=0;for(m=32001;m<=32003;m++)U[m]=2;for(m=32005;m<=32031;m++)U[m]=2;for(m=32033;m<=32060;m++)U[m]=2;for(m=32064;m<=32067;m++)U[m]=2;for(m=32074;m<=32077;m++)U[m]=2;for(m=32081;m<=32086;m++)U[m]=0;for(m=32107;m<=32130;m++)U[m]=0;for(m=32133;m<=32159;m++)U[m]=0;for(m=32164;m<=32167;m++)U[m]=2;for(m=32180;m<=32199;m++)U[m]=0;for(m=32201;m<=32260;m++)U[m]=0;for(m=32301;m<=32360;m++)U[m]=0;for(m=32401;m<=32460;m++)U[m]=0;for(m=32501;m<=32560;m++)U[m]=0;for(m=32601;m<=32662;m++)U[m]=0;for(m=32664;m<=32667;m++)U[m]=2;for(m=32701;m<=32761;m++)U[m]=0;for(m=53001;m<=53004;m++)U[m]=0;for(m=53008;m<=53019;m++)U[m]=0;for(m=53021;m<=53032;m++)U[m]=0;for(m=53034;m<=53037;m++)U[m]=0;for(m=53042;m<=53046;m++)U[m]=0;for(m=53074;m<=53080;m++)U[m]=0;for(m=54001;m<=54004;m++)U[m]=0;for(m=54008;m<=54019;m++)U[m]=0;for(m=54021;m<=54032;m++)U[m]=0;for(m=54034;m<=54037;m++)U[m]=0;for(m=54042;m<=54046;m++)U[m]=0;for(m=54048;m<=54053;m++)U[m]=0;for(m=54074;m<=54080;m++)U[m]=0;for(m=54098;m<=54101;m++)U[m]=0;for(m=102001;m<=102040;m++)U[m]=0;for(m=102042;m<=102063;m++)U[m]=0;for(m=102065;m<=102067;m++)U[m]=0;for(m=102070;m<=102117;m++)U[m]=0;for(m=102122;m<=102216;m++)U[m]=0;for(m=102221;m<=102377;m++)U[m]=0;for(m=102382;m<=102388;m++)U[m]=0;for(m=102389;m<=102398;m++)U[m]=2;for(m=102399;m<=102444;m++)U[m]=0;for(m=102445;m<=102447;m++)U[m]=2;for(m=102448;m<=102458;m++)U[m]=0;for(m=102459;m<=102468;m++)U[m]=2;for(m=102469;m<=102499;m++)U[m]=0;for(m=102500;m<=102519;m++)U[m]=1;for(m=102520;m<=102524;m++)U[m]=0;for(m=102525;m<=102529;m++)U[m]=2;for(m=102530;m<=102588;m++)U[m]=0;for(m=102590;m<=102598;m++)U[m]=0;for(m=102601;m<=102603;m++)U[m]=0;for(m=102605;m<=102628;m++)U[m]=0;for(m=102629;m<=102646;m++)U[m]=2;for(m=102648;m<=102700;m++)U[m]=2;for(m=102701;m<=102703;m++)U[m]=0;for(m=102707;m<=102730;m++)U[m]=2;for(m=102733;m<=102758;m++)U[m]=2;for(m=102767;m<=102900;m++)U[m]=0;for(m=102901;m<=102933;m++)U[m]=2;for(m=102934;m<=102950;m++)U[m]=13;for(m=102951;m<=102955;m++)U[m]=0;for(m=102961;m<=102963;m++)U[m]=0;for(m=102965;m<=102969;m++)U[m]=0;for(m=102971;m<=102973;m++)U[m]=0;for(m=102975;m<=102989;m++)U[m]=0;for(m=102990;m<=102992;m++)U[m]=1;for(m=102997;m<=103002;m++)U[m]=0;for(m=103003;m<=103008;m++)U[m]=2;for(m=103009;m<=103011;m++)U[m]=0;for(m=103012;m<=103014;m++)U[m]=2;for(m=103019;m<=103021;m++)U[m]=0;for(m=103022;m<=103024;m++)U[m]=2;for(m=103029;m<=103031;m++)U[m]=0;for(m=103032;m<=103034;m++)U[m]=2;for(m=103065;m<=103068;m++)U[m]=0;for(m=103074;m<=103076;m++)U[m]=0;for(m=103077;m<=103079;m++)U[m]=1;for(m=103080;m<=103082;m++)U[m]=0;for(m=103083;m<=103085;m++)U[m]=2;for(m=103090;m<=103093;m++)U[m]=0;for(m=103097;m<=103099;m++)U[m]=0;for(m=103100;m<=103102;m++)U[m]=2;for(m=103107;m<=103109;m++)U[m]=0;for(m=103110;m<=103112;m++)U[m]=2;for(m=103113;m<=103116;m++)U[m]=0;for(m=103117;m<=103120;m++)U[m]=2;for(m=103153;m<=103157;m++)U[m]=0;for(m=103158;m<=103162;m++)U[m]=2;for(m=103163;m<=103165;m++)U[m]=0;for(m=103166;m<=103168;m++)U[m]=1;for(m=103169;m<=103171;m++)U[m]=2;for(m=103186;m<=103188;m++)U[m]=0;for(m=103189;m<=103191;m++)U[m]=2;for(m=103192;m<=103195;m++)U[m]=0;for(m=103196;m<=103199;m++)U[m]=2;for(m=103200;m<=103224;m++)U[m]=0;for(m=103225;m<=103227;m++)U[m]=1;for(m=103232;m<=103237;m++)U[m]=0;for(m=103238;m<=103243;m++)U[m]=2;for(m=103244;m<=103246;m++)U[m]=0;for(m=103247;m<=103249;m++)U[m]=2;for(m=103254;m<=103256;m++)U[m]=0;for(m=103257;m<=103259;m++)U[m]=2;for(m=103264;m<=103266;m++)U[m]=0;for(m=103267;m<=103269;m++)U[m]=2;for(m=103300;m<=103375;m++)U[m]=0;for(m=103381;m<=103383;m++)U[m]=0;for(m=103384;m<=103386;m++)U[m]=1;for(m=103387;m<=103389;m++)U[m]=0;for(m=103390;m<=103392;m++)U[m]=2;for(m=103397;m<=103399;m++)U[m]=0;for(m=103400;m<=103471;m++)U[m]=2;for(m=103476;m<=103478;m++)U[m]=0;for(m=103479;m<=103481;m++)U[m]=2;for(m=103486;m<=103488;m++)U[m]=0;for(m=103489;m<=103491;m++)U[m]=2;for(m=103492;m<=103495;m++)U[m]=0;for(m=103496;m<=103499;m++)U[m]=2;for(m=103528;m<=103543;m++)U[m]=0;for(m=103544;m<=103548;m++)U[m]=2;for(m=103549;m<=103551;m++)U[m]=0;for(m=103552;m<=103554;m++)U[m]=1;for(m=103555;m<=103557;m++)U[m]=2;for(m=103558;m<=103560;m++)U[m]=0;for(m=103571;m<=103573;m++)U[m]=0;for(m=103574;m<=103576;m++)U[m]=2;for(m=103577;m<=103580;m++)U[m]=0;for(m=103581;m<=103583;m++)U[m]=2;for(m=103595;m<=103694;m++)U[m]=0;for(m=103696;m<=103699;m++)U[m]=0;for(m=103700;m<=103793;m++)U[m]=2;for(m=103794;m<=103890;m++)U[m]=0;for(m=103891;m<=103896;m++)U[m]=2;for(m=103900;m<=103971;m++)U[m]=2;for(m=103972;m<=103977;m++)U[m]=0;for(m=112e3;m<=112101;m++)U[m]=0;const qO=[102100,102113,3857,3785],bj=[104905,104971],wj=[4326,...qO,...bj],Rk='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',x_=[-20037508342788905e-9,20037508342788905e-9],S_=[-20037508342787e-6,20037508342787e-6],HO={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:x_,origin:S_,dx:1e-5},102100:{wkTemplate:Rk,valid:x_,origin:S_,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:x_,origin:S_,dx:1e-5},3857:{wkTemplate:Rk,valid:x_,origin:S_,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function ds(e,t){if(e===t)return!0;if(e==null||t==null)return!1;const i=e.wkid,r=t.wkid;if(i!=null||r!=null){if(i===r||cd(e)&&cd(t))return!0;const u=e.latestWkid;if(u!=null&&r===u)return!0;const l=t.latestWkid;return l!=null&&i===l}let s,a;return e.wkt2&&t.wkt2?(s=e.wkt2,a=t.wkt2):e.wkt&&t.wkt&&(s=e.wkt,a=t.wkt),!(!s||!a)&&s.toUpperCase()===a.toUpperCase()}function Mn(e){const t=e==null?void 0:e.wkid;return t!=null&&t>=2e3&&HO[t]||null}function WO(e){if(!e)return;const{wkid:t,vcsWkid:i}=e;if(t)return i?JSON.stringify({wkid:t,vcsWkid:i}):String(t);const r=e.wkt||e.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function qM(e){if(!Jo(e))return!1;const{wkid:t}=e;if(t)return U[t]==null;const i=e.wkt2||e.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function xj(e){return!(ZO(e)||JO(e))}function bg(e){return(e==null?void 0:e.wkid)===4326}function woe(e){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(e)}function xoe(e){return(e==null?void 0:e.wkid)===ld.CGCS2000}function cd(e){const t=e==null?void 0:e.wkid;return t!=null&&t>=2e3&&qO.includes(t)}function Sj(e){return(e==null?void 0:e.wkid)===32662}function mb(e){return e===ld.GCSMARS2000||e===ld.GCSMARS2000_SPHERE}function ZO(e){return mb(e==null?void 0:e.wkid)}function yb(e){return e===ld.GCSMOON2000}function JO(e){return yb(e==null?void 0:e.wkid)}function Tj(e){const t=e==null?void 0:e.wkid;return t!=null&&t>=2e3&&wj.includes(t)}function Jo(e){if(e==null)return!1;const t=e.wkid;return t!=null&&t>=2e3||e.wkt2!=null||e.wkt!=null}const KO={wkid:4326,wkt:S$(HO[4326].wkTemplate,{Central_Meridian:"0.0"})},YO={wkid:102100,latestWkid:3857},Mj={wkid:32662};function HM(e){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const Ij=HM(gr),WM=HM(Na),ZM=HM(yu),Ej={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${gr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},kj=WM.wkt.toUpperCase(),Aj=ZM.wkt.toUpperCase();function Pj(e){if(e!=null&&Jo(e)){const t=e.wkid,i=e.wkt2??e.wkt;if(mb(t))return Na;const r=i==null?void 0:i.toUpperCase();if(i&&r===kj)return Na;if(yb(t)||r&&r===Aj)return yu}return gr}function Soe(e){return mb(e)?Na:yb(e)?yu:gr}function x1(e){return ds(e,Ij)}function gu(e){return x1(e)||ds(e,WM)||ds(e,ZM)}const Toe=39.37,Cj=gr.radius*Math.PI/200,XO=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,Qh=U,QO=/UNIT\[([^\]]+)]/i,$j=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),Oj=In()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),ya=e=>e*e,Tc=e=>e*e*e,wg={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:ya(.001)},"square-centimeters":{inBaseUnits:ya(.01)},"square-decimeters":{inBaseUnits:ya(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:ya(1e3)},"square-inches":{inBaseUnits:ya(.0254)},"square-feet":{inBaseUnits:ya(.3048)},"square-yards":{inBaseUnits:ya(.9144)},"square-miles":{inBaseUnits:ya(1609.344)},"square-us-feet":{inBaseUnits:ya(1200/3937)},acres:{inBaseUnits:.0015625*ya(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Tc(.001)},"cubic-centimeters":{inBaseUnits:1e3*Tc(.01)},"cubic-decimeters":{inBaseUnits:1e3*Tc(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Tc(1e3)},"cubic-inches":{inBaseUnits:1e3*Tc(.0254)},"cubic-feet":{inBaseUnits:1e3*Tc(.3048)},"cubic-yards":{inBaseUnits:1e3*Tc(.9144)},"cubic-miles":{inBaseUnits:1e3*Tc(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},Lj=(()=>{const e={};for(const t in wg)for(const i in wg[t].units)e[i]=t;return e})();function Rj(e,t,i){return e*wg[i].units[t].inBaseUnits}function Dj(e,t,i){return e/wg[i].units[t].inBaseUnits}function H2(e){const t=Lj[e];if(!t)throw new Error("unknown type");return t}function Dk(e,t=null){return t=t||H2(e),wg[t].baseUnit===e}function zj(e,t,i){if(t===i)return e;const r=H2(t);if(r!==H2(i))throw new Error("incompatible units");const s=Dk(t,r)?e:Rj(e,t,r);return Dk(i,r)?s:Dj(s,i,r)}function Moe(e,t,i){return zj(e,t,"meters")/(i*Math.PI/180)}function eL(e){return Oj.fromJSON(e.toLowerCase())||null}function zk(e){if(e!=null&&!xj(e))return 1;const t=xd(e);return t>1e5?1:t}function Nj(e){return xd(e)>=Pj(e).metersPerDegree?"meters":iL(e)}function xd(e,t=gr.metersPerDegree){return Fj(e,!0)??t}function Fj(e,t=!1){const i=(e==null?void 0:e.wkid)??null,r=(e==null?void 0:e.wkt2)??(e==null?void 0:e.wkt)??null;let s=null;if(i){if(mb(i))return Na.metersPerDegree;if(yb(i))return yu.metersPerDegree;s=Qh.values[Qh[i]],!s&&t&&$j.has(i)&&(s=Cj)}else r&&(sL(r)?s=Nk(XO.exec(r),s):rL(r)&&(s=Nk(QO.exec(r),s)));return s}function Ioe(e){return qM(e)?1:xd(e)}function Nk(e,t){return e!=null&&e[1]?tL(e[1]):t}function tL(e){return parseFloat(e.split(",")[1])}function iL(e){const t=(e==null?void 0:e.wkid)??null,i=(e==null?void 0:e.wkt2)??(e==null?void 0:e.wkt)??null;let r=null;if(t)r=Qh.units[Qh[t]];else if(i){const s=sL(i)?XO:rL(i)?QO:null;if(s){const a=s.exec(i);a!=null&&a[1]&&(r=jj(a[1]))}}return r!=null?eL(r):null}function rL(e){return/^GEOCCS/i.test(e)}function sL(e){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(e)}const Bj=1e-7;function jj(e){const t=/[\\"']{1}([^\\"']+)/.exec(e);let i=t==null?void 0:t[1];if(!i||!Qh.units.includes(i)){const r=tL(e);i=null;const s=Qh.values;for(let a=0;a<s.length;++a)if(Math.abs(r-s[a])<Bj){i=Qh.units[a];break}}return i}const Vj={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Uj={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},Gj={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},Eoe=In()(Vj),koe=In()(Uj),Aoe=In()(Gj);var va;let li=va=class extends wt{static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return va.WebMercator;if(e.wkid===4326)return va.WGS84}const t=new va;return t.read(e),t}constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return bg(this)}get isWebMercator(){return cd(this)}get isGeographic(){return qM(this)}get isWrappable(){return Tj(this)}get metersPerUnit(){return xd(this)}get unit(){return iL(this)||(this.isGeographic?"degrees":null)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===va.WGS84)return new va(KO);if(this===va.WebMercator)return new va(YO);const e=new va;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(e.wkt=this.wkt),this.wkt2!=null&&(e.wkt2=this.wkt2)),this.imageCoordinateSystem&&(e.imageCoordinateSystem=Ge(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return ds(this,e)}toJSON(e){return this.write(void 0,e)}};li.GCS_NAD_1927=null,li.WGS84=null,li.WebMercator=null,li.PlateCarree=null,v([M({readOnly:!0})],li.prototype,"isWGS84",null),v([M({readOnly:!0})],li.prototype,"isWebMercator",null),v([M({readOnly:!0})],li.prototype,"isGeographic",null),v([M({readOnly:!0})],li.prototype,"isWrappable",null),v([M({type:ar,json:{write:!0}})],li.prototype,"latestWkid",void 0),v([M({readOnly:!0})],li.prototype,"metersPerUnit",null),v([M({readOnly:!0})],li.prototype,"unit",null),v([M({type:ar,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],li.prototype,"wkid",void 0),v([M({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],li.prototype,"wkt",void 0),v([ni("wkt"),ni("web-scene","wkt")],li.prototype,"writeWkt",null),v([M({type:String,json:{write:!1}})],li.prototype,"wkt2",void 0),v([M({type:ar,json:{write:!0}})],li.prototype,"vcsWkid",void 0),v([M({type:ar,json:{write:!0}})],li.prototype,"latestVcsWkid",void 0),v([M()],li.prototype,"imageCoordinateSystem",void 0),li=va=v([me("esri.geometry.SpatialReference")],li),li.prototype.toJSON.isDefaultToJSON=!0,li.GCS_NAD_1927=new li({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),li.WGS84=new li(KO),li.WebMercator=new li(YO),li.PlateCarree=new li(Mj),Object.freeze&&(Object.freeze(li.GCS_NAD_1927),Object.freeze(li.WGS84),Object.freeze(li.WebMercator),Object.freeze(li.PlateCarree));const si=li;function yi(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(a,u)=>{const l=a.constructor.prototype;r.forEach(y=>{const w=aO(a,y,s);w.read&&typeof w.read=="object"||(w.read={}),w.read.reader=l[u],i&&(w.read.source=(w.read.source||[]).concat(i))})}}let ba=class extends wt{constructor(...t){super(...t),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=si.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(t,i){if(t instanceof si)return t;if(t!=null){const r=new si;return r.read(t,i),r}return t}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(t){return this.cache[t]}setCacheValue(t,i){this.cache[t]=i}};v([M()],ba.prototype,"type",void 0),v([M({readOnly:!0})],ba.prototype,"cache",null),v([M({readOnly:!0})],ba.prototype,"extent",null),v([M({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ba.prototype,"hasM",void 0),v([M({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ba.prototype,"hasZ",void 0),v([M({type:si,json:{write:!0},value:si.WGS84})],ba.prototype,"spatialReference",void 0),v([yi("spatialReference")],ba.prototype,"readSpatialReference",null),ba=v([me("esri.geometry.Geometry")],ba);const Iu=ba,qj=Object.prototype.toString;function Hj(e){const t="__accessorMetadata__"in e?an(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return Wj.apply(this,i)}}function Wj(e,t,i,r){ob(e,t).cast=r}function Zj(e){return(t,i)=>{ob(t,e).cast=t[i]}}function es(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&qj.call(e[0])==="[object Function]"?Hj(e[0]):e.length===1&&typeof e[0]=="string"?Zj(e[0]):void 0}function Jj(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}const Kj=57.29577951308232,Yj=.017453292519943;function Fk(e){return e*Kj}function Bk(e){return e*Yj}function Coe(e){return Math.PI/2-2*Math.atan(Math.exp(-e/gr.radius))}function W2(e){return e.wkid!=null||e.wkt!=null}const yx=[0,0];function S1(e,t,i,r,s){const a=e,u=s;if(u.spatialReference=i,"x"in a&&"x"in u)[u.x,u.y]=t(a.x,a.y,yx,r);else if("xmin"in a&&"xmin"in u)[u.xmin,u.ymin]=t(a.xmin,a.ymin,yx,r),[u.xmax,u.ymax]=t(a.xmax,a.ymax,yx,r);else if("paths"in a&&"paths"in u||"rings"in a&&"rings"in u){const l="paths"in a?a.paths:a.rings,y=[];let w;for(let I=0;I<l.length;I++){const E=l[I];w=[],y.push(w);for(let A=0;A<E.length;A++)w.push(t(E[A][0],E[A][1],[0,0],r)),E[A].length>2&&w[A].push(E[A][2]),E[A].length>3&&w[A].push(E[A][3])}"paths"in u?u.paths=y:u.rings=y}else if("points"in a&&"points"in u){const l=a.points,y=[];for(let w=0;w<l.length;w++)y[w]=t(l[w][0],l[w][1],[0,0],r),l[w].length>2&&y[w].push(l[w][2]),l[w].length>3&&y[w].push(l[w][3]);u.points=y}return s}function uv(e,t){const i=e&&(W2(e)?e:e.spatialReference),r=t&&(W2(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!ds(r,i)||cd(r)&&bg(i)||cd(i)&&bg(r))}function gb(e,t){if(e==null)return null;const i=e.spatialReference,r=t&&(W2(t)?t:t.spatialReference);return uv(i,r)?ds(i,r)?Ge(e):cd(r)?S1(e,Up,si.WebMercator,!1,Ge(e)):bg(r)?S1(e,Ky,si.WGS84,!1,Ge(e)):null:null}function Up(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=Bk(t);return i[0]=Bk(e)*gr.radius,i[1]=gr.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function Ky(e,t,i=[0,0],r=!1){const s=Fk(e/gr.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=Fk(Math.PI/2-2*Math.atan(Math.exp(-t/gr.radius))),i}function ed(e,t=!1,i=Ge(e)){return S1(e,Up,si.WebMercator,t,i)}function cy(e,t=!1,i=Ge(e)){return S1(e,Ky,si.WGS84,t,i)}var hv;const qm=[0,0];function jk(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let Ks=hv=class extends Iu{static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(e,t,i,r,s){let a;if(Array.isArray(e))a=e,s=t,e=a[0],t=a[1],i=a[2],r=a[3];else if(e&&typeof e=="object"){if(a=e,e=a.x!=null?a.x:a.longitude,t=a.y!=null?a.y:a.latitude,i=a.z,r=a.m,(s=a.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new si(s)),a.longitude!=null||a.latitude!=null){if(a.longitude==null)pt.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(a.latitude==null)pt.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!a.declaredClass&&s&&s.isWebMercator){const l=Up(a.longitude,a.latitude,qm);e=l[0],t=l[1]}}}else jk(i)?(s=i,i=null):jk(r)&&(s=r,r=null);const u={x:e,y:t};return u.x==null&&u.y!=null?pt.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):u.y==null&&u.x!=null&&pt.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(u.spatialReference=s),i!=null&&(u.z=i),r!=null&&(u.m=r),u}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return Ky(t,i,qm)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;e!=null&&t&&(t.isWebMercator?this._set("y",Up(i,e,qm)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return Ky(e,t,qm)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;e!=null&&i&&(i.isWebMercator?this._set("x",Up(e,t,qm)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new hv;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return hv.copy(e,this),this}equals(e){if(e==null)return!1;const{x:t,y:i,z:r,m:s,spatialReference:a}=this,{z:u,m:l}=e;let{x:y,y:w,spatialReference:I}=e;if(!a.equals(I))if(a.isWebMercator&&I.isWGS84)[y,w]=Up(y,w),I=a;else{if(!a.isWGS84||!I.isWebMercator)return!1;[y,w]=Ky(y,w),I=a}return t===y&&i===w&&r===u&&s===l&&a.wkid===I.wkid}offset(e,t,i){return this.x+=e,this.y+=t,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const e=Mn(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let a;return t>r?(a=Math.ceil(Math.abs(t-r)/s),t-=a*s):t<i&&(a=Math.ceil(Math.abs(t-i)/s),t+=a*s),this._set("x",t),this}distance(e){return Jj(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};v([M({readOnly:!0})],Ks.prototype,"cache",null),v([M({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ks.prototype,"hasM",null),v([M({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ks.prototype,"hasZ",null),v([M({type:Number})],Ks.prototype,"latitude",null),v([M({type:Number})],Ks.prototype,"longitude",null),v([M({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),es(e=>isNaN(e)?e:Wo(e))],Ks.prototype,"x",void 0),v([ni("x")],Ks.prototype,"writeX",null),v([yi("x")],Ks.prototype,"readX",null),v([M({type:Number,json:{write:!0}})],Ks.prototype,"y",void 0),v([M({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ks.prototype,"z",void 0),v([M({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ks.prototype,"m",void 0),Ks=hv=v([me("esri.geometry.Point")],Ks),Ks.prototype.toJSON.isDefaultToJSON=!0;const Ht=Ks,gx=[0,0];function _b(e,t){return t!=null&&en(e,t.x,t.y,t.z)}function $oe(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!hf(e,i))return!1;return!0}function Xj(e,t){const{xmin:i,ymin:r,zmin:s,xmax:a,ymax:u,zmax:l}=t;return e.hasZ&&t.hasZ?en(e,i,r,s)&&en(e,i,u,s)&&en(e,a,u,s)&&en(e,a,r,s)&&en(e,i,r,l)&&en(e,i,u,l)&&en(e,a,u,l)&&en(e,a,r,l):en(e,i,r)&&en(e,i,u)&&en(e,a,u)&&en(e,a,r)}function hf(e,t){return en(e,t[0],t[1])}function Qj(e,t){return en(e,t[0],t[1],t[2])}function en(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function nL(e,t){return gx[1]=t.y,gx[0]=t.x,eV(e,gx)}function eV(e,t){return oL(e.rings,t)}function oL(e,t){if(!e)return!1;if(tV(e))return Vk(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=Vk(i,e[r],t);return i}function tV(e){return!Array.isArray(e[0][0])}function Vk(e,t,i){const[r,s]=i;let a=e,u=0;for(let l=0,y=t.length;l<y;l++){u++,u===y&&(u=0);const[w,I]=t[l],[E,A]=t[u];(I<s&&A>=s||A<s&&I>=s)&&w+(s-I)/(A-I)*(E-w)<r&&(a=!a)}return a}function iV(e,t){return _b(e,t)}function rV(e,t){const i=e.hasZ&&t.hasZ;let r,s,a;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(a=t.zmin,e.zmax<a)return!1}else if(a=e.zmin,t.zmax<a)return!1}return!0}function sV(e,t){const{points:i,hasZ:r}=t,s=r?Qj:hf;for(const a of i)if(s(e,a))return!0;return!1}const ud=[0,0],hd=[0,0],dd=[0,0],pd=[0,0],nV=[ud,hd,dd,pd],aL=[[dd,ud],[ud,hd],[hd,pd],[pd,dd]];function oV(e,t){return aV(e,t.rings)}function aV(e,t){ud[0]=e.xmin,ud[1]=e.ymax,hd[0]=e.xmax,hd[1]=e.ymax,dd[0]=e.xmin,dd[1]=e.ymin,pd[0]=e.xmax,pd[1]=e.ymin;for(const i of nV)if(oL(t,i))return!0;for(const i of t){if(!i.length)continue;let r=i[0];if(hf(e,r))return!0;for(let s=1;s<i.length;s++){const a=i[s];if(hf(e,a)||lL(r,a,aL))return!0;r=a}}return!1}function lV(e,t){ud[0]=e.xmin,ud[1]=e.ymax,hd[0]=e.xmax,hd[1]=e.ymax,dd[0]=e.xmin,dd[1]=e.ymin,pd[0]=e.xmax,pd[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(hf(e,s))return!0;for(let a=1;a<r.length;a++){const u=r[a];if(hf(e,u)||lL(s,u,aL))return!0;s=u}}return!1}const Kr=[0,0];function cV(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const a=i[s],u=i[s+1];for(let l=t+1;l<e.length;l++)for(let y=0;y<e[l].length-1;y++){const w=e[l][y],I=e[l][y+1];if(Z2(a,u,w,I,Kr)&&!(Kr[0]===a[0]&&Kr[1]===a[1]||Kr[0]===w[0]&&Kr[1]===w[1]||Kr[0]===u[0]&&Kr[1]===u[1]||Kr[0]===I[0]&&Kr[1]===I[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let a=r-1;s===0&&(a=r-2);const u=i[s],l=i[s+1];for(let y=s+2;y<a;y++){const w=i[y],I=i[y+1];if(Z2(u,l,w,I,Kr)&&!(Kr[0]===u[0]&&Kr[1]===u[1]||Kr[0]===w[0]&&Kr[1]===w[1]||Kr[0]===l[0]&&Kr[1]===l[1]||Kr[0]===I[0]&&Kr[1]===I[1]))return!0}}}return!1}function lL(e,t,i){for(let r=0;r<i.length;r++)if(Z2(e,t,i[r][0],i[r][1]))return!0;return!1}function Z2(e,t,i,r,s){const[a,u]=e,[l,y]=t,[w,I]=i,[E,A]=r,R=E-w,G=a-w,K=l-a,Y=A-I,ae=u-I,Te=y-u,_e=Y*K-R*Te;if(_e===0)return!1;const be=(R*ae-Y*G)/_e,ke=(K*ae-Te*G)/_e;return be>=0&&be<=1&&ke>=0&&ke<=1&&(s&&(s[0]=a+be*(l-a),s[1]=u+be*(y-u)),!0)}function uV(e){switch(e){case"esriGeometryEnvelope":case"extent":return rV;case"esriGeometryMultipoint":case"multipoint":return sV;case"esriGeometryPoint":case"point":return iV;case"esriGeometryPolygon":case"polygon":return oV;case"esriGeometryPolyline":case"polyline":return lV}}var ao;function hV(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function Mc(e,t,i){return t==null?i:i==null?t:e(t,i)}let Fr=ao=class extends Iu{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return hV(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?si.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s??si.WGS84}}static fromBounds(e,t){return new ao({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new ao({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new Ht({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new ao;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&uv(t,i)&&(e=t.isWebMercator?ed(e):cy(e,!0)),e.type==="point"?_b(this,e):e.type==="extent"&&Xj(this,e)}equals(e){if(this===e)return!0;if(e==null)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&uv(t,i)&&(e=t.isWebMercator?ed(e):cy(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(e==null)return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!ds(t,i)&&uv(t,i)&&(e=t.isWebMercator?ed(e):cy(e,!0)),uV(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Mc(Math.min,this.zmin,e.zmin),this.zmax=Mc(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Mc(Math.min,this.mmin,e.mmin),this.mmax=Mc(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:e!=null&&this.intersects(e)?(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Mc(Math.max,this.zmin,e.zmin),this.zmax=Mc(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Mc(Math.max,this.mmin,e.mmin),this.mmax=Mc(Math.min,this.mmax,e.mmax)),this):null}toJSON(e){return this.write({},e)}_shiftCM(e=Mn(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?cy(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new si(S$((t.isWGS84?e.altTemplate:null)??e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,a=this.xmax;return s>=i&&s<=r&&a>=i&&a<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;const s=i??Mn(r);if(s==null)return this;const a=this._getParts(s).map(y=>y.extent);if(a.length<2)return a[0]||this;if(a.length>2)return e?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(e)return this._shiftCM(s);if(t)return a;let u=!0,l=!0;return a.forEach(y=>{y.hasZ||(u=!1),y.hasM||(l=!1)}),{rings:a.map(y=>{const w=[[y.xmin,y.ymin],[y.xmin,y.ymax],[y.xmax,y.ymax],[y.xmax,y.ymin],[y.xmin,y.ymin]];if(u){const I=(y.zmax-y.zmin)/2;for(let E=0;E<w.length;E++)w[E].push(I)}if(l){const I=(y.mmax-y.mmin)/2;for(let E=0;E<w.length;E++)w[E].push(I)}return w}),hasZ:u,hasM:l,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:a,spatialReference:u}=this,l=this.width,y=this.xmin,w=this.xmax;let I;e=e||Mn(u);const[E,A]=e.valid;I=this._normalizeX(this.xmin,e);const R=I.x,G=I.frameId;I=this._normalizeX(this.xmax,e);const K=I.x,Y=I.frameId,ae=R===K&&l>0;if(l>2*A){const Te=new ao(y<w?R:K,s,A,a,u),_e=new ao(E,s,y<w?K:R,a,u),be=new ao(0,s,A,a,u),ke=new ao(E,s,0,a,u),Ae=[],Ve=[];Te.contains(be)&&Ae.push(G),Te.contains(ke)&&Ve.push(G),_e.contains(be)&&Ae.push(Y),_e.contains(ke)&&Ve.push(Y);for(let Ze=G+1;Ze<Y;Ze++)Ae.push(Ze),Ve.push(Ze);t.push({extent:Te,frameIds:[G]},{extent:_e,frameIds:[Y]},{extent:be,frameIds:Ae},{extent:ke,frameIds:Ve})}else R>K||ae?t.push({extent:new ao(R,s,A,a,u),frameIds:[G]},{extent:new ao(E,s,K,a,u),frameIds:[Y]}):t.push({extent:new ao(R,s,K,a,u),frameIds:[G]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let a=0;a<t.length;a++)t[a].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let a,u=0;return e>r?(a=Math.ceil(Math.abs(e-r)/s),e-=a*s,u=a):e<i&&(a=Math.ceil(Math.abs(e-i)/s),e+=a*s,u=-a),{x:e,frameId:u}}};v([M({readOnly:!0})],Fr.prototype,"cache",null),v([M({readOnly:!0})],Fr.prototype,"center",null),v([M({readOnly:!0})],Fr.prototype,"extent",null),v([M({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Fr.prototype,"hasM",null),v([M({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Fr.prototype,"hasZ",null),v([M({readOnly:!0})],Fr.prototype,"height",null),v([M({readOnly:!0})],Fr.prototype,"width",null),v([M({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Fr.prototype,"xmin",void 0),v([M({type:Number,json:{write:!0}})],Fr.prototype,"ymin",void 0),v([M({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Fr.prototype,"mmin",void 0),v([M({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Fr.prototype,"zmin",void 0),v([M({type:Number,json:{write:!0}})],Fr.prototype,"xmax",void 0),v([M({type:Number,json:{write:!0}})],Fr.prototype,"ymax",void 0),v([M({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Fr.prototype,"mmax",void 0),v([M({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Fr.prototype,"zmax",void 0),Fr=ao=v([me("esri.geometry.Extent")],Fr),Fr.prototype.toJSON.isDefaultToJSON=!0;const tr=Fr;let Yy;var KC,YC;const dV=((KC=globalThis.esriConfig)==null?void 0:KC.locale)??((YC=globalThis.dojoConfig)==null?void 0:YC.locale);function cL(){var e;return dV??((e=globalThis.navigator)==null?void 0:e.language)??"en"}function Wn(){return Yy===void 0&&(Yy=cL()),Yy}function pV(e=Wn()){const t=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(e);return t==null?void 0:t[1].toLowerCase()}const Xy=[];function JM(e){return Xy.push(e),Ni(()=>Xy.splice(Xy.indexOf(e),1))}const J2=[];function KM(e){return J2.push(e),Ni(()=>Xy.splice(J2.indexOf(e),1))}function fV(){const e=cL();Yy!==e&&(Yy=e,[...J2].forEach(t=>{t.call(null,e)}),[...Xy].forEach(t=>{t.call(null,e)}))}var XC;(XC=globalThis.addEventListener)==null||XC.call(globalThis,"languagechange",fV);let T_;function mV(e){return T_&&!T_.destroyed||(T_=e()),T_}var K2;const yV=new hs({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let lo=K2=class extends Pt{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new K2({categories:this.categories?Ge(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i=[];this.categories&&(i=this.categories.map(u=>Array.isArray(u)?JSON.stringify(u):u));let r="";if(this.extent){const u=gb(this.extent,si.WGS84);u!=null&&(r=`${u.xmin},${u.ymin},${u.xmax},${u.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const a={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(a.sortField=this.sortField.split(",").map(u=>yV.toJSON(u.trim())).join(","),a.sortOrder=this.sortOrder),{query:{...t,...a}}}};v([M()],lo.prototype,"categories",void 0),v([M()],lo.prototype,"disableExtraQuery",void 0),v([M({type:tr})],lo.prototype,"extent",void 0),v([M()],lo.prototype,"filter",void 0),v([M()],lo.prototype,"num",void 0),v([M()],lo.prototype,"query",void 0),v([M()],lo.prototype,"sortField",void 0),v([M()],lo.prototype,"sortOrder",null),v([M()],lo.prototype,"start",void 0),lo=K2=v([me("esri.portal.PortalQueryParams")],lo);const Nl=lo;var Y2;let Cr=Y2=class extends wt{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,t=this.thumbnail;return e&&t&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){var t;const e=(t=this.portal)==null?void 0:t.restUrl;return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal.request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal.request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new gt("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new Y2;return t.sourceJSON=e,t.read(e),t}queryItems(e,t){let i=an(Nl,e);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Nl,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new Nl,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,t))}_fetchCategorySchemaSet(e,t){const i=this.portal;return i.fetchSelf(i.authMode,!0,t).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const a=new Nl;return a.disableExtraQuery=!0,a.num=1,a.query=s,i.queryGroups(a,t)}throw new gt("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],a=new Nl;return a.num=1,a.query=`typekeywords:"${e}"`,s.queryItems(a,t)}throw new gt("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",t).then(s=>{const a=s==null?void 0:s.categorySchema;return a!=null&&a.length?a:[]}):[])}};v([M()],Cr.prototype,"access",void 0),v([M({type:Date})],Cr.prototype,"created",void 0),v([M()],Cr.prototype,"description",void 0),v([M()],Cr.prototype,"id",void 0),v([M()],Cr.prototype,"isInvitationOnly",void 0),v([M({type:Date})],Cr.prototype,"modified",void 0),v([M()],Cr.prototype,"owner",void 0),v([M()],Cr.prototype,"portal",void 0),v([M()],Cr.prototype,"snippet",void 0),v([M()],Cr.prototype,"sortField",void 0),v([M()],Cr.prototype,"sortOrder",void 0),v([M()],Cr.prototype,"sourceJSON",void 0),v([M()],Cr.prototype,"tags",void 0),v([M()],Cr.prototype,"thumbnail",void 0),v([M({readOnly:!0})],Cr.prototype,"thumbnailUrl",null),v([M()],Cr.prototype,"title",void 0),v([M({readOnly:!0})],Cr.prototype,"url",null),Cr=Y2=v([me("esri.portal.PortalGroup")],Cr);const X2=Cr;let uh=class extends Pt{constructor(t){super(t),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};v([M()],uh.prototype,"nextQueryParams",void 0),v([M()],uh.prototype,"queryParams",void 0),v([M()],uh.prototype,"results",void 0),v([M()],uh.prototype,"total",void 0),uh=v([me("esri.portal.PortalQueryResult")],uh);const gV=uh;let Tl=class extends wt{constructor(t){super(t),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var i;const t=(i=this.portal)==null?void 0:i.restUrl;return t?`${t}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new gt("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};v([M({type:Date})],Tl.prototype,"created",void 0),v([M()],Tl.prototype,"id",void 0),v([M()],Tl.prototype,"portal",void 0),v([M()],Tl.prototype,"title",void 0),v([M({readOnly:!0})],Tl.prototype,"url",null),v([M()],Tl.prototype,"username",void 0),Tl=v([me("esri.portal.PortalFolder")],Tl);const _V=Tl;var Q2;let Bi=Q2=class extends wt{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal.normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){var t;const e=(t=this.portal)==null?void 0:t.restUrl;return e?`${e}/content/users/${this.username}`:null}get url(){var t;const e=(t=this.portal)==null?void 0:t.restUrl;return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e==null?void 0:e.data,r=e==null?void 0:e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let a=this.userContentUrl;return r&&(a+="/"+(typeof r=="string"?r:r.id)),this.portal.request(a+"/addItem",s).then(u=>(t.id=u.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal.request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal.request(this.userContentUrl??"",e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=_V.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=X2.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){const t=e??{};let i,r=this.userContentUrl??"";return t.folder&&(r+="/"+t.folder.id),it(()=>Promise.resolve().then(()=>fL),void 0).then(({default:s})=>{i=s;const a={folders:!1,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"};return this.portal.request(r,{query:a})}).then(s=>{let a;return s!=null&&s.items?(a=s.items.map(u=>{const l=i.fromJSON(u);return l.portal=this.portal,l}),Promise.all(a.map(u=>u.load())).catch(u=>u).then(()=>({items:a,nextStart:s.nextStart,total:s.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new X2({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new gt("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new gt("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new Q2;return t.sourceJSON=e,t.read(e),t}};v([M()],Bi.prototype,"access",void 0),v([M({type:Date})],Bi.prototype,"created",void 0),v([M()],Bi.prototype,"culture",void 0),v([M()],Bi.prototype,"description",void 0),v([M()],Bi.prototype,"email",void 0),v([M()],Bi.prototype,"favGroupId",void 0),v([M()],Bi.prototype,"fullName",void 0),v([M({type:Date})],Bi.prototype,"modified",void 0),v([M()],Bi.prototype,"orgId",void 0),v([M()],Bi.prototype,"portal",void 0),v([M()],Bi.prototype,"preferredView",void 0),v([M()],Bi.prototype,"privileges",void 0),v([M()],Bi.prototype,"region",void 0),v([M()],Bi.prototype,"role",void 0),v([M()],Bi.prototype,"roleId",void 0),v([M()],Bi.prototype,"sourceJSON",void 0),v([M()],Bi.prototype,"thumbnail",void 0),v([M({readOnly:!0})],Bi.prototype,"thumbnailUrl",null),v([M()],Bi.prototype,"units",void 0),v([M({readOnly:!0})],Bi.prototype,"userContentUrl",null),v([M({readOnly:!0})],Bi.prototype,"url",null),v([M()],Bi.prototype,"username",void 0),v([M()],Bi.prototype,"userType",void 0),Bi=Q2=v([me("esri.portal.PortalUser")],Bi);const uL=Bi;var Nn;let M_;const Uk={PortalGroup:()=>Promise.resolve({default:X2}),PortalItem:()=>it(()=>Promise.resolve().then(()=>fL),void 0),PortalUser:()=>Promise.resolve({default:uL})};let Ye=Nn=class extends Gg(mu){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=mi.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){Gk.unregister(this),this.defaultBasemap=Xi(this.defaultBasemap),this.defaultDevBasemap=Xi(this.defaultDevBasemap),this.defaultVectorBasemap=Xi(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=er(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)mi.request.trustedServers.includes(t)||mi.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){var i;const e=(i=this.user)==null?void 0:i.orgId,t=!e||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=uL.fromJSON(e),t.portal=this),t}load(e){const t=it(()=>Promise.resolve().then(()=>JV),void 0).then(({default:i})=>{mr(e),M_=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,e)).then(i=>{var r;if(wi){const s=wi;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==Nn.AUTH_MODE_AUTO&&this.authMode!==Nn.AUTH_MODE_NO_PROMPT||((r=this._esriIdCredentialCreateHandle)==null||r.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",vV(new WeakRef(this))),Gk.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await it(()=>import("./ElevationLayer-C6gqv7jd.js"),__vite__mapDeps([2,3,4,5,6,7,8,9,10,11,12,13,14,15]))).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}async fetchBasemaps(e,t){const i=await this._fetchBasemaps(e,t);if((t==null?void 0:t.include3d)===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(e,t);i.unshift(...r)}return i}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):Vl(e)?Promise.reject(Er()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new Nl;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return Vl(e)?Promise.reject(Er()):Promise.resolve([])}fetchRegions(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Wn();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Wn();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return mV(()=>new Nn)}queryGroups(e,t){return this.queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this.queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",t)}fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s={authMode:e,query:{culture:Wn().toLowerCase()},withCredentials:!0,...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this.request(r,s)}queryPortal(e,t,i,r){const s=an(Nl,t),a=u=>this.request(this.restUrl+e,{...s.toRequestOptions(this),...r}).then(l=>{const y=s.clone();return y.start=l.nextStart,new gV({nextQueryParams:y,queryParams:s,total:l.total,results:Nn._resultsToTypedArray(u,{portal:this},l,r)})}).then(l=>Promise.all(l.results.map(y=>typeof y.when=="function"?y.when():l)).then(()=>l,y=>(H$(y),l)));return i&&Uk[i]?Uk[i]().then(({default:u})=>(mr(r),a(u))):a()}signIn(){if(this.authMode===Nn.AUTH_MODE_ANONYMOUS||this.authMode===Nn.AUTH_MODE_NO_PROMPT&&!wi)return Promise.reject(new gt("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this.fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return wi?wi.getCredential(this.restUrl,{prompt:this.authMode!==Nn.AUTH_MODE_NO_PROMPT}).then(t=>e(t)):e(this.credential)}normalizeUrl(e){var i;const t=(i=this.credential)==null?void 0:i.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}requestToTypedArray(e,t,i){return this.request(e,t).then(r=>{const s=Nn._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(a=>typeof a.when=="function"?a.when():r)).then(()=>s,()=>s)})}request(e,t={}){const i={f:"json",...t.query},{authMode:r=this.authMode===Nn.AUTH_MODE_ANONYMOUS||this.authMode===Nn.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:a=!1,method:u="auto",responseType:l="json",signal:y}=t,w={authMode:r,body:s,cacheBust:a,method:u,query:i,responseType:l,timeout:0,signal:y};return t.withCredentials&&(w.withCredentials=!0),Qr(this._normalizeSSL(e),w).then(I=>I.data)}toJSON(){throw new gt("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Nn({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new gt("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}async _fetchBasemaps(e,t){const i=new Nl;i.query=e||(mi.apiKey&&$O(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,t);if(!r.total)return[];const s=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const a=await s.queryItems(i,t);return a.total?a.results.filter(u=>u.type==="Web Map").map(u=>new M_({portalItem:u})):[]}async _fetchBasemaps3D(e,t){const i=e||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new Nl({query:i,disableExtraQuery:!0}),s=await this.queryGroups(r,t);if(!s.total)return[];const a=s.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=a.sortField||"name",r.sortOrder=a.sortOrder||"desc";const u=await a.queryItems(r,t);return u.total?u.results.filter(l=>l.type==="Web Scene").map(l=>new M_({portalItem:l})):[]}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const t=M_.fromJSON(e);return t.portalItem={portal:this},t}return null}static _resultsToTypedArray(e,t,i,r){let s=[];if(i){const a=r!=null?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(u=>{const l=Object.assign(e?e.fromJSON(u):u,t);return typeof l.load=="function"&&l.load(a),l}))}else s=[];return s}};Ye.AUTH_MODE_ANONYMOUS="anonymous",Ye.AUTH_MODE_AUTO="auto",Ye.AUTH_MODE_IMMEDIATE="immediate",Ye.AUTH_MODE_NO_PROMPT="no-prompt",v([M()],Ye.prototype,"access",void 0),v([M()],Ye.prototype,"allSSL",void 0),v([M()],Ye.prototype,"authMode",void 0),v([M()],Ye.prototype,"authorizedCrossOriginDomains",void 0),v([yi("authorizedCrossOriginDomains")],Ye.prototype,"readAuthorizedCrossOriginDomains",null),v([M()],Ye.prototype,"basemapGalleryGroupQuery",void 0),v([M({json:{name:"3DBasemapGalleryGroupQuery"}})],Ye.prototype,"basemapGalleryGroupQuery3D",void 0),v([M()],Ye.prototype,"bingKey",void 0),v([M()],Ye.prototype,"canListApps",void 0),v([M()],Ye.prototype,"canListData",void 0),v([M()],Ye.prototype,"canListPreProvisionedItems",void 0),v([M()],Ye.prototype,"canProvisionDirectPurchase",void 0),v([M()],Ye.prototype,"canSearchPublic",void 0),v([M()],Ye.prototype,"canShareBingPublic",void 0),v([M()],Ye.prototype,"canSharePublic",void 0),v([M()],Ye.prototype,"canSignInArcGIS",void 0),v([M()],Ye.prototype,"canSignInIDP",void 0),v([M()],Ye.prototype,"colorSetsGroupQuery",void 0),v([M()],Ye.prototype,"commentsEnabled",void 0),v([M({type:Date})],Ye.prototype,"created",void 0),v([M()],Ye.prototype,"credential",void 0),v([M()],Ye.prototype,"culture",void 0),v([M()],Ye.prototype,"currentVersion",void 0),v([M()],Ye.prototype,"customBaseUrl",void 0),v([M()],Ye.prototype,"defaultBasemap",void 0),v([yi("defaultBasemap")],Ye.prototype,"readDefaultBasemap",null),v([M()],Ye.prototype,"defaultDevBasemap",void 0),v([yi("defaultDevBasemap")],Ye.prototype,"readDefaultDevBasemap",null),v([M({type:tr})],Ye.prototype,"defaultExtent",void 0),v([M()],Ye.prototype,"defaultVectorBasemap",void 0),v([yi("defaultVectorBasemap")],Ye.prototype,"readDefaultVectorBasemap",null),v([M()],Ye.prototype,"description",void 0),v([M()],Ye.prototype,"devBasemapGalleryGroupQuery",void 0),v([M()],Ye.prototype,"eueiEnabled",void 0),v([M({readOnly:!0})],Ye.prototype,"extraQuery",null),v([M()],Ye.prototype,"featuredGroups",void 0),v([M()],Ye.prototype,"featuredItemsGroupQuery",void 0),v([M()],Ye.prototype,"galleryTemplatesGroupQuery",void 0),v([M()],Ye.prototype,"layoutGroupQuery",void 0),v([M()],Ye.prototype,"livingAtlasGroupQuery",void 0),v([M()],Ye.prototype,"hasCategorySchema",void 0),v([M()],Ye.prototype,"helpBase",void 0),v([M()],Ye.prototype,"helperServices",void 0),v([M()],Ye.prototype,"helpMap",void 0),v([M()],Ye.prototype,"homePageFeaturedContent",void 0),v([M()],Ye.prototype,"homePageFeaturedContentCount",void 0),v([M()],Ye.prototype,"httpPort",void 0),v([M()],Ye.prototype,"httpsPort",void 0),v([M()],Ye.prototype,"id",void 0),v([M()],Ye.prototype,"ipCntryCode",void 0),v([M({readOnly:!0})],Ye.prototype,"isOrganization",null),v([M()],Ye.prototype,"isPortal",void 0),v([M()],Ye.prototype,"isReadOnly",void 0),v([M({readOnly:!0})],Ye.prototype,"itemPageUrl",null),v([M()],Ye.prototype,"layerTemplatesGroupQuery",void 0),v([M()],Ye.prototype,"maxTokenExpirationMinutes",void 0),v([M({type:Date})],Ye.prototype,"modified",void 0),v([M()],Ye.prototype,"name",void 0),v([M()],Ye.prototype,"portalHostname",void 0),v([M()],Ye.prototype,"portalMode",void 0),v([M()],Ye.prototype,"portalProperties",void 0),v([M()],Ye.prototype,"region",void 0),v([M({readOnly:!0})],Ye.prototype,"restUrl",null),v([M()],Ye.prototype,"rotatorPanels",void 0),v([M()],Ye.prototype,"showHomePageDescription",void 0),v([M()],Ye.prototype,"sourceJSON",void 0),v([M()],Ye.prototype,"staticImagesUrl",void 0),v([M({json:{name:"2DStylesGroupQuery"}})],Ye.prototype,"stylesGroupQuery2d",void 0),v([M({json:{name:"stylesGroupQuery"}})],Ye.prototype,"stylesGroupQuery3d",void 0),v([M()],Ye.prototype,"supportsHostedServices",void 0),v([M()],Ye.prototype,"symbolSetsGroupQuery",void 0),v([M()],Ye.prototype,"templatesGroupQuery",void 0),v([M()],Ye.prototype,"thumbnail",void 0),v([M({readOnly:!0})],Ye.prototype,"thumbnailUrl",null),v([M()],Ye.prototype,"units",void 0),v([M()],Ye.prototype,"url",void 0),v([M()],Ye.prototype,"urlKey",void 0),v([yi("urlKey")],Ye.prototype,"readUrlKey",null),v([M()],Ye.prototype,"user",void 0),v([yi("user")],Ye.prototype,"readUser",null),v([M()],Ye.prototype,"use3dBasemaps",void 0),v([M()],Ye.prototype,"useStandardizedQuery",void 0),v([M()],Ye.prototype,"useVectorBasemaps",void 0),v([M()],Ye.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ye=Nn=v([me("esri.portal.Portal")],Ye);const _u=Ye,Gk=new FinalizationRegistry(e=>{e.remove()});function vV(e){const t=wi;return()=>{const i=e.deref();i&&t.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let Ml=class extends Pt{constructor(t){super(t),this.portalItem=null}normalizeCtorArgs(t){return t!=null&&t.portalItem&&t.path?{...t,path:this._normalizePath(t.path,t.portalItem)}:t}set path(t){t!=null&&Hn(t)?pt.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",t)}_castPath(t){return this._normalizePath(t,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(t="json",i){const r=this.cdnUrl;if(r==null)throw new gt("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:t,query:{token:this.portalItem.apiKey},signal:i==null?void 0:i.signal})}async update(t,i){const{addOrUpdateResources:r}=await it(()=>import("./resourceUtils-D95xMZCv.js"),[]);return await r(this.portalItem,[{resource:this,content:t,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"update",i),this}hasPath(){return this.path!=null}_normalizePath(t,i){return t==null?t:(t=t.replace(/^\/+/,""),i!=null&&Hn(t)&&(t=LM(t,i.itemUrl)),t==null?void 0:t.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};v([M()],Ml.prototype,"portalItem",void 0),v([M({type:String,value:null})],Ml.prototype,"path",null),v([es("path")],Ml.prototype,"_castPath",null),v([M({type:String,readOnly:!0})],Ml.prototype,"url",null),v([M({type:String,readOnly:!0})],Ml.prototype,"cdnUrl",null),v([M({type:String,readOnly:!0})],Ml.prototype,"itemRelativeUrl",null),Ml=v([me("esri.portal.PortalItemResource")],Ml);const bV=Ml;let uy=class extends Pt{constructor(t){super(t),this.created=null,this.rating=null}};v([M()],uy.prototype,"created",void 0),v([M()],uy.prototype,"rating",void 0),uy=v([me("esri.portal.PortalRating")],uy);const _x=uy;function Hg(e,t){var r;const i=(r=t==null?void 0:t.url)==null?void 0:r.path;if(e&&i&&(e=mo(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const s=LM(e,t.portalItem.itemUrl);s!=null&&wV.test(s)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(s).path)}return(e=eS(e,t==null?void 0:t.portal))&&bb.test(e)?XM(e):e}function vb(e,t,i=xg.YES){var s,a;if((e=e&&bb.test(e)?dL(e):e)==null)return e;!Hn(e)&&(t!=null&&t.blockedRelativeUrls)&&t.blockedRelativeUrls.push(e);let r=mo(e);if(t){const u=((s=t.verifyItemRelativeUrls)==null?void 0:s.rootPath)||((a=t.url)==null?void 0:a.path);if(u){const l=eS(u,t.portal),y=eS(r,t.portal);r=LM(y,l,l),r!=null&&r!==y&&r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=hL(r,t==null?void 0:t.portal),Hn(r)&&(r=du(r)),t!=null&&t.resources&&(t!=null&&t.portalItem)&&!Hn(r)&&!wd(r)&&i===xg.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r),compress:!1}),r}function YM(e,t,i){return Hg(e,i)}function df(e,t,i,r){const s=vb(e,r);s!==void 0&&(t[i]=s)}const bb=/\/items\/([^\/]+)\/resources\/(.*)/,wV=/^\.\/resources\//;function xV(e){const t=(e==null?void 0:e.match(bb))??null;return(t==null?void 0:t[1])??null}function SV(e){const t=(e==null?void 0:e.match(bb))??null;if(t==null)return null;const i=t[2],r=i.lastIndexOf("/");if(r===-1){const{path:u,extension:l}=Ak(i);return{prefix:null,filename:u,extension:l}}const{path:s,extension:a}=Ak(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:a}}function hL(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?D2(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function eS(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=PM();return cf(r,`${r.scheme}://${i}`)?D2(e,t.portalHostname,i):D2(e,i,t.portalHostname)}function XM(e){if(!e)return e||null;let t=e;return t&&wi&&!wi.findCredential(t)&&(t=wi._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}function dL(e){if(!e)return e||null;let t=e;return t=t.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),t=t.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),t=t.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),t&&wi&&!wi.findCredential(t)&&(t=wi._normalizeAGOLorgDomain(t)),t}var xg;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(xg||(xg={}));const zoe=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return xg},ensureMainOnlineDomain:hL,fromCDNUrl:dL,fromJSON:Hg,itemIdFromResourceUrl:xV,prefixAndFilenameFromResourceUrl:SV,read:YM,toCDNUrl:XM,toJSON:vb,write:df},Symbol.toStringTag,{value:"Module"}));var hh;const TV=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),MV=new Set(["KML","GeoJson","CSV"]);let Gt=hh=class extends Gg(mu){static from(e){return hb(hh,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Geocoding Service"?i="Locator":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replaceAll(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="Raster function template"?i="Raster Function Template":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")?i="Instant App":e==="Insights Page"?i="Insights Report":e==="Excalibur Imagery Project"?i="Excalibur Project":e==="3DTiles Service"?i="3D tiles layer":e==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(e){return e&&e.length?new tr(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){var R;const e=((R=this.type)==null?void 0:R.toLowerCase())||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,a=!1,u=!1,l=!1,y=!1,w=!1,I=!1,E=!1,A=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(a=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(u=t.includes("Table"),l=t.includes("Route Layer"),y=t.includes("Markup"),w=t.includes("Spatiotemporal"),I=t.includes("UtilityNetwork"),s=w&&u?"spatiotemporaltable":u?"table":l?"routelayer":y?"markup":w?"spatiotemporal":I?"utilitynetwork":a?"featureshosted":"features"):e==="map service"||e==="wms"||e==="wmts"?(w=t.includes("Spatiotemporal"),E=t.includes("Relational"),s=w||E?"mapimages":a||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages"):s=e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="video service"?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":e==="geoprocessing service"?t.includes("Web Tool")?"tool":"layers":e==="geodata service"?"geodataservice":e==="3dtiles service"?t.includes("3DObject")?"3dobjecttileslayer":t.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):e==="web map"||e==="cityengine web scene"?s="maps":e==="web scene"?s=t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?s="instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?s="apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?s="mapsgray":e==="service definition"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="netcdf"||e==="administrative report"?s="datafiles":e==="360 vr experience"?s="360vr":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?s="appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?s="addindesktop":e==="pdf"?s="pdf":e==="microsoft word"?s="word":e==="microsoft excel"?s="excel":e==="microsoft powerpoint"?s="ppt":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?s="datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?s="toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?s="layersgray":e==="scene package"?s="scenepackage":e==="3dtiles package"?s="3dtileslayerpackage":e==="3dtiles service"?s="3dtileslayer":e==="mobile scene package"?s="mobilescenepackage":e==="tile package"||e==="compact tile package"?s="tilepackage":e==="task file"?s="taskfile":e==="report template"?s="report-template":e==="statistical data collection"?s="statisticaldatacollection":e==="insights workbook"?s="workbook":e==="insights model"?s="insightsmodel":e==="insights page"?s="insightspage":e==="insights theme"?s="insightstheme":e==="hub initiative"?s="hubinitiative":e==="hub page"?s="hubpage":e==="hub site application"?s="hubsite":e==="hub event"?s="hubevent":e==="hub project"?s="hubproject":e==="relational database connection"?s="relationaldatabaseconnection":e==="big data file share"?s="datastorecollection":e==="image collection"?s="imagecollection":e==="desktop style"?s="desktopstyle":e==="style"?s="style":e==="dashboard"?s="dashboard":e==="raster function template"?s="rasterprocessingtemplate":e==="vector tile package"?s="vectortilepackage":e==="ortho mapping project"?s="orthomappingproject":e==="ortho mapping template"?s="orthomappingtemplate":e==="solution"?s="solutions":e==="geopackage"?s="geopackage":e==="deep learning package"?s="deeplearningpackage":e==="real time analytic"?s="realtimeanalytics":e==="big data analytic"?s="bigdataanalytics":e==="feed"?s="feed":e==="excalibur imagery project"?s="excaliburimageryproject":e==="notebook"?s="notebook":e==="storymap"?s="storymap":e==="survey123 add in"?s="survey123addin":e==="mission"?s="mission":e==="mission report"?s="missionreport":e==="mission template"?s="missiontemplate":e==="quickcapture project"?s="quickcaptureproject":e==="pro report"?s="proreport":e==="pro report template"?s="proreporttemplate":e==="urban model"?s="urbanmodel":e==="web experience"?s="experiencebuilder":e==="web experience template"?s="webexperiencetemplate":e==="experience builder widget"?s="experiencebuilderwidget":e==="experience builder widget package"?s="experiencebuilderwidgetpackage":e==="workflow"?s="workflow":e==="kernel gateway connection"?s="kernelgatewayconnection":e==="insights script"?s="insightsscript":e==="hub initiative template"?s="hubinitiativetemplate":e==="storymap theme"?s="storymaptheme":e==="knowledge graph"?s="knowledgegraph":e==="knowledge studio project"?s="knowledgestudio":e==="native application"?s="nativeapp":e==="native application installer"?s="nativeappinstaller":e==="web link chart"?s="linkchart":e==="knowledge graph web investigation"?s="investigation":e==="ogcfeatureserver"?s="features":e==="pro project"?s="proproject":e==="insights workbook package"?s="insightsworkbookpackage":e==="apache parquet"?s="apacheparquet":e==="notebook code snippets"||e==="notebook code snippet library"?s="notebookcodesnippets":e==="suitability model"?s="suitabilitymodel":e==="esri classifier definition"?s="classifierdefinition":e==="esri classification schema"?s="classificationschema":e==="insights data engineering workbook"?s="dataengineeringworkbook":e==="insights data engineering model"?s="dataengineeringmodel":e==="deep learning studio project"?s="deeplearningproject":e==="discussion"?s="discussion":e==="allsource project"?s="allsourceproject":e==="api key"?s="apikey":e==="data pipeline"?s="datapipelines":e==="group layer"?(A=t.includes("Map"),s=A?"layergroup2d":"layergroup"):s=e==="media layer"?"onlinemedialayer":e==="form"?t.includes("Survey123")?"survey":"datafilesgray":e==="csv"?"csv":e==="image"?"image":"maps",s?fi(i+s+r+".png"):null}get isLayer(){return this.type!=null&&TV.has(this.type)}get itemCdnUrl(){return XM(this.itemUrl)}get itemPageUrl(){var t;const e=(t=this.portal)==null?void 0:t.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){var t;const e=(t=this.portal)==null?void 0:t.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const e=this.itemUrl,t=this.thumbnail;return e&&t?((i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${t}?f=json`))??null:null}get userItemUrl(){var i,r,s;const e=(i=this.portal)==null?void 0:i.restUrl;if(!e)return null;const t=this.owner||((s=(r=this.portal)==null?void 0:r.user)==null?void 0:s.username);return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=_u.getDefault()),i=t.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:e!=null?e.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof _x&&(e=e.rating),e==null||isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new _x({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:Ge(this.applicationProxies),avgRating:this.avgRating,categories:Ge(this.categories),created:Ge(this.created),culture:this.culture,description:this.description,extent:Ge(this.extent),groupCategories:Ge(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Ge(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Ge(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Ge(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Ge(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new hh({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){var i;const e=this.toJSON();for(const r of["tags","typeKeywords","categories"])e[r]=(i=e[r])==null?void 0:i.join(", ");const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return this.portal.request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return t.rating!=null?(t.created=new Date(t.created),new _x(t)):null}fetchRelatedItems(e,t){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},hh)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const t=e==null?void 0:e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new gt("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new gt("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:i}=this;await t.signIn();const{copyResources:r,folder:s,tags:a,title:u}=e||{},l={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!r,tags:a==null?void 0:a.join(","),title:u}},{itemId:y}=await t.request(`${i}/copy`,l);return new hh({id:y,portal:t})}updateThumbnail(e){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")wd(t)?r.query={data:t}:r.query={url:mo(t)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new gt("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){const{fetchResources:i}=await it(()=>import("./resourceUtils-D95xMZCv.js"),[]);return i(this,e,t)}async addResource(e,t,i){const{addOrUpdateResources:r}=await it(()=>import("./resourceUtils-D95xMZCv.js"),[]);return e.portalItem=this,await r(this,[{resource:e,content:t,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"add",i),e}async removeResource(e,t){const{removeResource:i}=await it(()=>import("./resourceUtils-D95xMZCv.js"),[]);if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new gt("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await it(()=>import("./resourceUtils-D95xMZCv.js"),[]);return t(this,e)}resourceFromPath(e){return new bV({portalItem:this,path:e})}toJSON(){var i,r;const e=this.extent,t={accessInformation:this.accessInformation,categories:Ge(this.categories),created:(i=this.created)==null?void 0:i.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(r=this.modified)==null?void 0:r.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Ge(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Ge(this.typeKeywords),url:this.url};return y$(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new hh({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};v([M({type:["private","shared","org","public"]})],Gt.prototype,"access",void 0),v([M()],Gt.prototype,"accessInformation",void 0),v([M({type:String})],Gt.prototype,"apiKey",void 0),v([M({json:{read:{source:"appProxies"}}})],Gt.prototype,"applicationProxies",void 0),v([M()],Gt.prototype,"avgRating",void 0),v([M()],Gt.prototype,"categories",void 0),v([M({type:Date})],Gt.prototype,"created",void 0),v([M()],Gt.prototype,"culture",void 0),v([M()],Gt.prototype,"description",void 0),v([M({readOnly:!0})],Gt.prototype,"displayName",null),v([M({type:tr})],Gt.prototype,"extent",void 0),v([yi("extent")],Gt.prototype,"readExtent",null),v([M()],Gt.prototype,"groupCategories",void 0),v([M({readOnly:!0})],Gt.prototype,"iconUrl",null),v([M()],Gt.prototype,"id",void 0),v([M({readOnly:!0})],Gt.prototype,"isLayer",null),v([M({type:Boolean,readOnly:!0})],Gt.prototype,"isOrgItem",void 0),v([M()],Gt.prototype,"itemControl",void 0),v([M({readOnly:!0})],Gt.prototype,"itemPageUrl",null),v([M({readOnly:!0})],Gt.prototype,"itemUrl",null),v([M()],Gt.prototype,"licenseInfo",void 0),v([M({type:Date})],Gt.prototype,"modified",void 0),v([M()],Gt.prototype,"name",void 0),v([M()],Gt.prototype,"numComments",void 0),v([M()],Gt.prototype,"numRatings",void 0),v([M()],Gt.prototype,"numViews",void 0),v([M()],Gt.prototype,"owner",void 0),v([M()],Gt.prototype,"ownerFolder",void 0),v([M({type:_u})],Gt.prototype,"portal",void 0),v([M()],Gt.prototype,"screenshots",void 0),v([M()],Gt.prototype,"size",void 0),v([M()],Gt.prototype,"snippet",void 0),v([M()],Gt.prototype,"sourceJSON",void 0),v([M({type:String})],Gt.prototype,"sourceUrl",void 0),v([M({type:String})],Gt.prototype,"spatialReference",void 0),v([M()],Gt.prototype,"tags",void 0),v([M()],Gt.prototype,"thumbnail",void 0),v([M({readOnly:!0})],Gt.prototype,"thumbnailUrl",null),v([M()],Gt.prototype,"title",void 0),v([M()],Gt.prototype,"type",void 0),v([M()],Gt.prototype,"typeKeywords",void 0),v([M({type:String,json:{read(e,t){var i;if(MV.has(t.type)){const r=(i=this.portal)==null?void 0:i.restUrl;e||(e=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return e}}})],Gt.prototype,"url",void 0),v([M({readOnly:!0})],Gt.prototype,"userItemUrl",null),Gt=hh=v([me("esri.portal.PortalItem")],Gt);const pL=Gt,fL=Object.freeze(Object.defineProperty({__proto__:null,default:pL},Symbol.toStringTag,{value:"Module"})),qk=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,IV={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Hk(e){return e in IV}const hy=[],tf=new Map;function Wk(e){for(const t of tf.keys())mL(e.pattern,t)&&tf.delete(t)}function EV(e){return hy.includes(e)||(Wk(e),hy.unshift(e)),Ni(()=>{const t=hy.indexOf(e);t>-1&&(hy.splice(t,1),Wk(e))})}async function QM(e){const t=Wn();tf.has(e)||tf.set(e,AV(e,t));const i=tf.get(e);return i&&await PV.add(i),i}function kV(e){if(!qk.test(e))return null;const t=qk.exec(e);if(t===null)return null;const[,i,r]=t,s=i+(r?"-"+r.toUpperCase():"");return Hk(s)?s:Hk(i)?i:null}async function AV(e,t){const i=[];for(const r of hy)if(mL(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new gt("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new gt("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function mL(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}KM(()=>{tf.clear()});const PV=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=wo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function CV(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,i=await QM("esri/t9n/basemaps");return i[e]||i[t]}const tS={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return fi("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return fi("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return fi("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return fi("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return fi("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return fi("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return fi("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return fi("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return fi("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return fi("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return fi("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return fi("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return fi("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return fi("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},$V=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let $c=class extends Pt{constructor(t){super(t),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const t=Wn().toLowerCase();switch(t){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=pV(t);return i==="pt"?"pt-BR":i&&$V.has(i)?i:"global"}};v([M()],$c.prototype,"id",void 0),v([M()],$c.prototype,"language",void 0),v([M()],$c.prototype,"places",void 0),v([M()],$c.prototype,"serviceUrl",void 0),v([M()],$c.prototype,"worldview",void 0),$c=v([me("esri.support.BasemapStyle")],$c);const OV=$c;function LV(e){return e!=null&&typeof e=="object"&&"type"in e&&e.type==="subtype-group"&&"sublayers"in e}function pp(e){return(e==null?void 0:e.type)==="subtype-sublayer"}const Foe={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function Boe(e){const t=e==null?void 0:e.type;return t==="building-scene"||t==="integrated-mesh"||t==="point-cloud"||t==="scene"}function wb(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function joe(e){var t;return((e==null?void 0:e.type)==="feature"||(e==null?void 0:e.type)==="subtype-group")&&((t=e.source)==null?void 0:t.type)==="feature-layer"}async function Voe(e,t){const i=wi==null?void 0:wi.findServerInfo(e);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=e.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${e.substring(0,r)}/rest/info`,a=t!=null?t.signal:null,{data:u}=await Qr(s,{query:{f:"json"},responseType:"json",signal:a});return(u==null?void 0:u.owningSystemUrl)||null}function RV(e){if(!("capabilities"in e))return!1;switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function DV(e){return RV(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null}function zV(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function NV(e){return!!zV(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)}const FV=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),BV=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function jV(e){return e.layerContainerType==="basemap"?FV:e.layerContainerType==="operational-layers"?BV:null}function VV(e,t){if(t.restrictedWebMapWriting){const i=jV(t);return i==null||i.has(e.type)&&!wb(e)}return!0}function UV(e,t){var i;if(t)if(wb(e)){const r=nb("featureCollection.layers",t),s=(i=r==null?void 0:r[0])==null?void 0:i.layerDefinition;s&&Zk(e,s)}else e.type!=="group"&&Zk(e,t)}function Zk(e,t){"maxScale"in e&&(t.maxScale=d1(e.maxScale)??void 0),"minScale"in e&&(t.minScale=d1(e.minScale)??void 0)}function GV(e,t){if(UV(e,t),t&&(t.id=e.id,"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=d1(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts"))if(wb(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function Jk(e,t,i){if(!e.persistenceEnabled)return null;if(!("write"in e)||!e.write)return i!=null&&i.messages&&i.messages.push(new gt("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(wb(e)&&!e.isTable)t=e.resourceInfo;else if(VV(e,i)){const r={};return e.write(r,i)?r:null}return t!=null&&GV(e,t=Ge(t)),t}var dy;let qV=0;const HV="esri.Basemap";let Fn=dy=class extends Gg(mu){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+qV++,this.baseLayers=new At,this.referenceLayers=new At;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&pt.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(e=>{pt.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const i of e)i.destroy();const t=this.referenceLayers.toArray();for(const i of t)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Xi(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",ad(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const a=Jk(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);a!=null&&r.push(a)}),this.referenceLayers.forEach(s=>{const a=Jk(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);a!=null&&(s.type!=="scene"&&(a.isReference=!0),r.push(a))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",ad(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return jO(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(t=>Qv(t)?t.clone():t),referenceLayers:this.referenceLayers.map(t=>Qv(t)?t.clone():t)};return this.loaded&&(e.loadStatus="loaded"),new dy({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){var i;return e=e||{},t!=null&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&((i=this.resourceInfo)!=null&&i.data.baseMapLayers)&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const s=Ge(r);return s.url&&ja(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&ja(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i,style:r}=this;mr(e);const s=[];if(t){const a=t.context?t.context.url:null;if(s.push(this._loadLayersFromJSON(t.data,a,e)),t.data.id&&!t.data.title){const u=t.data.id;s.push(CV(u).then(l=>{l&&this.read({title:l},t.context)}))}}else i?s.push(this._loadFromItem(i,e)):r&&s.push(this._loadFromStylesService(r,e));await Promise.all(s)}async _loadLayersFromJSON(e,t,i){var y,w;const r=(y=this.resourceInfo)==null?void 0:y.context,s=((w=this.portalItem)==null?void 0:w.portal)||(r==null?void 0:r.portal)||null,a=ZV[(r==null?void 0:r.origin)||""]??"web-map",{populateOperationalLayers:u}=await it(()=>import("./layersCreator-Dl7t5fsu.js"),__vite__mapDeps([16,17,18,19,15,20])),l=[];if(mr(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const I={context:{...r,origin:a,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},E=G=>a==="web-scene"&&G.layerType==="ArcGISSceneServiceLayer"||G.isReference,A=u(this.baseLayers,e.baseMapLayers.filter(G=>!E(G)),I);l.push(A);const R=u(this.referenceLayers,e.baseMapLayers.filter(E),I);l.push(R)}await Promise.allSettled(l)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=ln(e.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:WV[e.type||""]??"web-map",portal:e.portal||_u.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||_u.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}async _loadFromStylesService(e,t){const i=`${e.serviceUrl}/${e.id}`,r=(await Qr(i,{query:{language:e.getLanguageParamValue(),places:e.places,worldview:e.worldview},signal:t==null?void 0:t.signal})).data,s=ln(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=tS[e];return t?t.itemId?new dy({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):dy.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};v([M({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:At}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],Fn.prototype,"baseLayers",null),v([M({type:String,json:{origins:{"web-scene":{write:!0}}}})],Fn.prototype,"id",void 0),v([M({type:pL})],Fn.prototype,"portalItem",void 0),v([M()],Fn.prototype,"referenceLayers",null),v([M({readOnly:!0})],Fn.prototype,"resourceInfo",void 0),v([M({type:si})],Fn.prototype,"spatialReference",void 0),v([M({type:OV})],Fn.prototype,"style",void 0),v([M()],Fn.prototype,"thumbnailUrl",void 0),v([M({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Fn.prototype,"title",void 0),v([ni("title")],Fn.prototype,"writeTitle",null),Fn=dy=v([me(HV)],Fn);const WV={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},ZV={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},Qy=Fn,JV=Object.freeze(Object.defineProperty({__proto__:null,default:Qy},Symbol.toStringTag,{value:"Module"})),T1={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function KV(e){return!!T1[e]||!!T1[e.toLowerCase()]}function yL(e){return T1[e]??T1[e.toLowerCase()]}function Uoe(e){return[...yL(e)]}function vx(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function YV(e,t,i,r=1){const s=(e%360+360)%360/360,a=i<=.5?i*(t+1):i+t-i*t,u=2*i-a;return[Math.round(255*vx(u,a,s+1/3)),Math.round(255*vx(u,a,s)),Math.round(255*vx(u,a,s-1/3)),r]}function Goe(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,a=t?e.length===9:e.length===5;let u=+("0x"+e.substr(1));if(isNaN(u))return null;const l=[0,0,0,1];let y;return a&&(y=u&r,u>>=i,l[3]=s*y/255),y=u&r,u>>=i,l[2]=s*y,y=u&r,u>>=i,l[1]=s*y,y=u&r,u>>=i,l[0]=s*y,l}function Eu(){return[0,0,0]}function XV(e){return[e[0],e[1],e[2]]}function Wg(e,t,i){return[e,t,i]}function QV(e,t=Eu()){const i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function e7(e,t){return new Float64Array(e,t,3)}function gL(){return Eu()}function _L(){return Wg(1,1,1)}function vL(){return Wg(1,0,0)}function bL(){return Wg(0,1,0)}function wL(){return Wg(0,0,1)}const t7=gL(),i7=_L(),r7=vL(),s7=bL(),n7=wL();Object.freeze(Object.defineProperty({__proto__:null,ONES:i7,UNIT_X:r7,UNIT_Y:s7,UNIT_Z:n7,ZEROS:t7,clone:XV,create:Eu,createView:e7,fromArray:QV,fromValues:Wg,ones:_L,unitX:vL,unitY:bL,unitZ:wL,zeros:gL},Symbol.toStringTag,{value:"Module"}));let eI=1e-6;function sa(){return eI}function o7(e){eI=e}const tI=Math.random,a7=Math.PI/180,l7=180/Math.PI;function iI(e){return e*a7}function c7(e){return e*l7}function u7(e,t){return Math.abs(e-t)<=eI*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:tI,equals:u7,getEpsilon:sa,setEpsilon:o7,toDegree:c7,toRadian:iI},Symbol.toStringTag,{value:"Module"}));function rI(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function h7(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function xL(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function d7(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function SL(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function TL(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function ML(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function p7(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function f7(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function m7(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function y7(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function g7(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function _7(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function v7(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function IL(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function b7(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function EL(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function kL(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function AL(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function w7(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function x7(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function iS(e,t){const i=t[0],r=t[1],s=t[2];let a=i*i+r*r+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function PL(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function S7(e,t,i){const r=t[0],s=t[1],a=t[2],u=i[0],l=i[1],y=i[2];return e[0]=s*y-a*l,e[1]=a*u-r*y,e[2]=r*l-s*u,e}function T7(e,t,i,r){const s=t[0],a=t[1],u=t[2];return e[0]=s+r*(i[0]-s),e[1]=a+r*(i[1]-a),e[2]=u+r*(i[2]-u),e}function M7(e,t,i,r,s,a){const u=a*a,l=u*(2*a-3)+1,y=u*(a-2)+a,w=u*(a-1),I=u*(3-2*a);return e[0]=t[0]*l+i[0]*y+r[0]*w+s[0]*I,e[1]=t[1]*l+i[1]*y+r[1]*w+s[1]*I,e[2]=t[2]*l+i[2]*y+r[2]*w+s[2]*I,e}function I7(e,t,i,r,s,a){const u=1-a,l=u*u,y=a*a,w=l*u,I=3*a*l,E=3*y*u,A=y*a;return e[0]=t[0]*w+i[0]*I+r[0]*E+s[0]*A,e[1]=t[1]*w+i[1]*I+r[1]*E+s[1]*A,e[2]=t[2]*w+i[2]*I+r[2]*E+s[2]*A,e}function E7(e,t){t=t||1;const i=tI,r=2*i()*Math.PI,s=2*i()-1,a=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=s*t,e}function k7(e,t,i){const r=t[0],s=t[1],a=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*a+i[12],e[1]=i[1]*r+i[5]*s+i[9]*a+i[13],e[2]=i[2]*r+i[6]*s+i[10]*a+i[14],e}function A7(e,t,i){const r=t[0],s=t[1],a=t[2];return e[0]=r*i[0]+s*i[3]+a*i[6],e[1]=r*i[1]+s*i[4]+a*i[7],e[2]=r*i[2]+s*i[5]+a*i[8],e}function P7(e,t,i){const r=i[0],s=i[1],a=i[2],u=i[3],l=t[0],y=t[1],w=t[2],I=s*w-a*y,E=a*l-r*w,A=r*y-s*l,R=s*A-a*E,G=a*I-r*A,K=r*E-s*I,Y=2*u;return e[0]=l+I*Y+2*R,e[1]=y+E*Y+2*G,e[2]=w+A*Y+2*K,e}function C7(e,t,i,r){const s=[],a=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],a[0]=s[0],a[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),a[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e}function $7(e,t,i,r){const s=[],a=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],a[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),a[1]=s[1],a[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e}function O7(e,t,i,r){const s=[],a=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],a[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),a[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),a[2]=s[2],e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e}function L7(e,t){iS(Kk,e),iS(Yk,t);const i=PL(Kk,Yk);return i>1?0:i<-1?Math.PI:Math.acos(i)}const Kk=Eu(),Yk=Eu();function R7(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function D7(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function z7(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],a=t[0],u=t[1],l=t[2],y=sa();return Math.abs(i-a)<=y*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-u)<=y*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-l)<=y*Math.max(1,Math.abs(s),Math.abs(l))}function N7(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],a=i[2]-t[2];let u=r*r+s*s+a*a;return u>0?(u=1/Math.sqrt(u),e[0]=r*u,e[1]=s*u,e[2]=a*u,e):(e[0]=0,e[1]=0,e[2]=0,e)}const F7=SL,B7=TL,j7=ML,V7=EL,U7=kL,G7=rI,q7=AL;Object.freeze(Object.defineProperty({__proto__:null,abs:m7,add:d7,angle:L7,bezier:I7,ceil:p7,copy:h7,cross:S7,direction:N7,dist:V7,distance:EL,div:j7,divide:ML,dot:PL,equals:z7,exactEquals:D7,floor:f7,hermite:M7,inverse:x7,len:G7,length:rI,lerp:T7,max:_7,min:g7,mul:B7,multiply:TL,negate:w7,normalize:iS,random:E7,rotateX:C7,rotateY:$7,rotateZ:O7,round:v7,scale:IL,scaleAndAdd:b7,set:xL,sign:y7,sqrDist:U7,sqrLen:q7,squaredDistance:kL,squaredLength:AL,str:R7,sub:F7,subtract:SL,transformMat3:A7,transformMat4:k7,transformQuat:P7},Symbol.toStringTag,{value:"Module"}));const Xk=new Float32Array(1);function qoe(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function Va(e,t,i){return Math.min(Math.max(e,t),i)}function Hoe(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function H7(e,t,i){return e+(t-e)*i}function Woe(e,t,i,r,s){return H7(r,s,(e-t)/(i-t))}function CL(e){return e*Math.PI/180}function $L(e){return 180*e/Math.PI}function Zoe(e){return Math.acos(Va(e,-1,1))}function OL(e){return Math.asin(Va(e,-1,1))}function bx(e,t,i=1e-6){return e===t?!0:!Number.isFinite(e)||!Number.isFinite(t)?!1:(e>t?e-t:t-e)<=i}const M1=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function W7(e){return M1.setFloat64(0,e),M1.getBigInt64(0)}function Z7(e){return M1.setBigInt64(0,e),M1.getFloat64(0)}const wx=BigInt("1000000");J7(1);function J7(e){const t=W7(e=Math.abs(e)),i=Z7(t<=wx?wx:t-wx);return Math.abs(e-i)}function Joe(e){return LL(Math.max(-Qk,Math.min(e,Qk)))}function LL(e){return Xk[0]=e,Xk[0]}function Koe(e,t){const i=rI(e),r=OL(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return xL(t,i,r,s),t}function Yoe(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(bx(t,1)&&bx(i,1)&&bx(r,1))}const Qk=LL(34028234663852886e22);function I_(e){return Va(TM(e),0,255)}function E_(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}function k_(e,t){const i=e.toString(16).padStart(2,"0");return t?i.substring(0,1):i}let dv=class Br{static blendColors(t,i,r,s=new Br){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),a=r[1];if(a==="rgb"&&s.length===3||a==="rgba"&&s.length===4){const u=s[0];if(u.charAt(u.length-1)==="%"){const l=s.map(y=>2.56*parseFloat(y));return s.length===4&&(l[3]=parseFloat(s[3])),Br.fromArray(l,i)}return Br.fromArray(s.map(l=>parseFloat(l)),i)}if(a==="hsl"&&s.length===3||a==="hsla"&&s.length===4)return Br.fromArray(YV(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new Br){if(t[0]!=="#"||isNaN(+`0x${t.substring(1)}`))return null;switch(t.length){case 4:case 5:{const r=parseInt(t.substring(1,2),16),s=parseInt(t.substring(2,3),16),a=parseInt(t.substring(3,4),16),u=t.length===5?15:parseInt(t.substring(4),16);return Br.fromArray([r+16*r,s+16*s,a+16*a,(u+16*u)/255],i)}case 7:case 9:{const r=parseInt(t.substring(1,3),16),s=parseInt(t.substring(3,5),16),a=parseInt(t.substring(5,7),16),u=t.length===7?255:parseInt(t.substring(7),16);return Br.fromArray([r,s,a,u/255],i)}default:return null}}static fromArray(t,i=new Br){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=KV(t)?yL(t):null;return r&&Br.fromArray(r,i)||Br.fromRgb(t,i)||Br.fromHex(t,i)}static fromJSON(t){return t!=null?new Br([t[0],t[1],t[2],(t[3]??255)/255]):void 0}static toUnitRGB(t){return t!=null?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return t!=null?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){return typeof t=="string"?Br.fromString(t,this):Array.isArray(t)?Br.fromArray(t,this):(this._set(t.r??0,t.g??0,t.b??0,t.a??1),t instanceof Br||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(t){const i=(t==null?void 0:t.capitalize)??!1,r=(t==null?void 0:t.digits)??6,s=r===3||r===4,a=r===4||r===8,u=`#${k_(this.r,s)}${k_(this.g,s)}${k_(this.b,s)}${a?k_(Math.round(255*this.a),s):""}`;return i?u.toUpperCase():u}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=Br.AlphaMode.ALWAYS){const i=I_(this.r),r=I_(this.g),s=I_(this.b);return t===Br.AlphaMode.ALWAYS||this.a!==1?[i,r,s,I_(255*this.a)]:[i,r,s]}clone(){return new Br(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return t!=null&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(E_(this.r,0,255)),this.g=Math.round(E_(this.g,0,255)),this.b=Math.round(E_(this.b,0,255)),this.a=E_(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}};dv.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(dv||(dv={}));const oi=dv;function Xoe(e){}function K7(e){return()=>e}function Ot(e,t={}){const i=e instanceof hs?e:new hs(e,t),r={type:(t==null?void 0:t.ignoreUnknown)??1?i.apiValues:String,json:{type:i.jsonValues,read:!(t!=null&&t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(r.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(r.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(r.json.name=t.name),(t==null?void 0:t.nonNullable)!==void 0&&(r.nonNullable=t.nonNullable),M(r)}var rS;let pv=rS=class extends wt{constructor(e){super(e),this.type="none"}clone(){return new rS({type:this.type})}};v([Ot({none:"none",stayAbove:"stay-above"})],pv.prototype,"type",void 0),pv=rS=v([me("esri.ground.NavigationConstraint")],pv);function RL(e){const t=TM(100*(1-e));return Math.max(0,Math.min(t,100))}function DL(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}var sS;let Il=sS=class extends Gg(mu){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new At;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&pt.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(e=>{xo(e)||pt.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)Xi(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",ad(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(a=>{if("write"in a){const u={};K7(a)().write(u,r)&&s.push(u)}else r!=null&&r.messages&&r.messages.push(new gt("layer:unsupported",`Layers (${a.title}, ${a.id}) of type '${a.declaredClass}' cannot be persisted in the ground`,{layer:a}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return jO(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await it(()=>import("./ElevationQuery-skrkOBAo.js"),[]);mr(t);const r=new i,s=this.layers.filter(eA).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await it(()=>import("./ElevationQuery-skrkOBAo.js"),[]);mr(t);const r=new i,s=this.layers.filter(eA).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:Ge(this.surfaceColor),navigationConstraint:Ge(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new sS({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,i){const r=(t==null?void 0:t.origin)||"web-scene",s=(t==null?void 0:t.portal)||null,a=(t==null?void 0:t.url)||null,{populateOperationalLayers:u}=await it(()=>import("./layersCreator-Dl7t5fsu.js"),__vite__mapDeps([16,17,18,19,15,20]));mr(i);const l=[];if(e.layers&&Array.isArray(e.layers)){const y={context:{origin:r,url:a,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};l.push(u(this.layers,e.layers,y))}await Promise.allSettled(l)}};function Y7(e){return e&&"createElevationSampler"in e}function eA(e){return e.type==="elevation"||Y7(e)}v([M({json:{read:!1}})],Il.prototype,"layers",null),v([ni("layers")],Il.prototype,"writeLayers",null),v([M({readOnly:!0})],Il.prototype,"resourceInfo",void 0),v([M({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:ar,read:{reader:DL,source:"transparency"},write:{writer:(e,t)=>{t.transparency=RL(e)},target:"transparency"}}})],Il.prototype,"opacity",void 0),v([M({type:oi,json:{type:[ar],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Il.prototype,"surfaceColor",void 0),v([M({type:pv,json:{write:!0}})],Il.prototype,"navigationConstraint",void 0),Il=sS=v([me("esri.Ground")],Il);const I1=Il;let xp=class extends At{constructor(t){super(t),this.getCollections=null}initialize(){this.addHandles(n9(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const t=this.getCollections!=null?this.getCollections():null;if(t==null)return void this.removeAll();let i=0;for(const r of t)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(t){return new At(t)}_processCollection(t,i){if(!i)return t;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const a=this.indexOf(s,t);a>=0?a!==t&&this.reorder(s,t):this.add(s,t),++t}if(this.getChildrenFunction){const a=this.getChildrenFunction(s);if(Array.isArray(a))for(const u of a)t=this._processCollection(t,u);else t=this._processCollection(t,a)}}return t}};v([M()],xp.prototype,"getCollections",void 0),v([M()],xp.prototype,"getChildrenFunction",void 0),v([M()],xp.prototype,"itemFilterFunction",void 0),xp=v([me("esri.core.CollectionFlattener")],xp);const Sg=xp;function X7(e){var t,i;return!(!(e&&typeof e=="object"&&"loaded"in e&&e.loaded&&((i=(t=DV(e))==null?void 0:t.operations)!=null&&i.supportsEditing)&&"type"in e)||"editingEnabled"in e&&!NV(e))}const Q7=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,eU="screenUtils.toPt: input not recognized!",zL=96;function eae(e){return e?e/72*zL:0}function fd(e){return e?72*e/zL:0}function Qi(e){if(typeof e=="string"){const t=e.match(Q7);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",a=r==="px"?fd(i):i;return s?-a:a}return console.warn(eU),null}return e}function nn(e=0,t=0){return{x:e,y:t}}function tae(e=0,t=0){return[e,t]}function NL(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function tU(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function iU(e,t,i,r,s,a,u,l,y,w,I,E,A,R,G,K){const Y=new Float32Array(16);return Y[0]=e,Y[1]=t,Y[2]=i,Y[3]=r,Y[4]=s,Y[5]=a,Y[6]=u,Y[7]=l,Y[8]=y,Y[9]=w,Y[10]=I,Y[11]=E,Y[12]=A,Y[13]=R,Y[14]=G,Y[15]=K,Y}function rU(e,t){return new Float32Array(e,t,16)}const sU=NL();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:sU,clone:tU,create:NL,createView:rU,fromValues:iU},Symbol.toStringTag,{value:"Module"}));function nU(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function oU(e,t,i,r,s,a,u,l,y,w,I,E,A,R,G,K,Y){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=a,e[5]=u,e[6]=l,e[7]=y,e[8]=w,e[9]=I,e[10]=E,e[11]=A,e[12]=R,e[13]=G,e[14]=K,e[15]=Y,e}function xb(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function aU(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],a=t[6],u=t[7],l=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=s,e[13]=u,e[14]=l}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function lU(e,t){return FL(e,t)||xb(e),e}function FL(e,t){const i=t[0],r=t[1],s=t[2],a=t[3],u=t[4],l=t[5],y=t[6],w=t[7],I=t[8],E=t[9],A=t[10],R=t[11],G=t[12],K=t[13],Y=t[14],ae=t[15],Te=i*l-r*u,_e=i*y-s*u,be=i*w-a*u,ke=r*y-s*l,Ae=r*w-a*l,Ve=s*w-a*y,Ze=I*K-E*G,lt=I*Y-A*G,ct=I*ae-R*G,ut=E*Y-A*K,nt=E*ae-R*K,It=A*ae-R*Y;let ht=Te*It-_e*nt+be*ut+ke*ct-Ae*lt+Ve*Ze;return ht?(ht=1/ht,e[0]=(l*It-y*nt+w*ut)*ht,e[1]=(s*nt-r*It-a*ut)*ht,e[2]=(K*Ve-Y*Ae+ae*ke)*ht,e[3]=(A*Ae-E*Ve-R*ke)*ht,e[4]=(y*ct-u*It-w*lt)*ht,e[5]=(i*It-s*ct+a*lt)*ht,e[6]=(Y*be-G*Ve-ae*_e)*ht,e[7]=(I*Ve-A*be+R*_e)*ht,e[8]=(u*nt-l*ct+w*Ze)*ht,e[9]=(r*ct-i*nt-a*Ze)*ht,e[10]=(G*Ae-K*be+ae*Te)*ht,e[11]=(E*be-I*Ae-R*Te)*ht,e[12]=(l*lt-u*ut-y*Ze)*ht,e[13]=(i*ut-r*lt+s*Ze)*ht,e[14]=(K*_e-G*ke-Y*Te)*ht,e[15]=(I*ke-E*_e+A*Te)*ht,e):null}function cU(e,t){const i=t[0],r=t[1],s=t[2],a=t[3],u=t[4],l=t[5],y=t[6],w=t[7],I=t[8],E=t[9],A=t[10],R=t[11],G=t[12],K=t[13],Y=t[14],ae=t[15];return e[0]=l*(A*ae-R*Y)-E*(y*ae-w*Y)+K*(y*R-w*A),e[1]=-(r*(A*ae-R*Y)-E*(s*ae-a*Y)+K*(s*R-a*A)),e[2]=r*(y*ae-w*Y)-l*(s*ae-a*Y)+K*(s*w-a*y),e[3]=-(r*(y*R-w*A)-l*(s*R-a*A)+E*(s*w-a*y)),e[4]=-(u*(A*ae-R*Y)-I*(y*ae-w*Y)+G*(y*R-w*A)),e[5]=i*(A*ae-R*Y)-I*(s*ae-a*Y)+G*(s*R-a*A),e[6]=-(i*(y*ae-w*Y)-u*(s*ae-a*Y)+G*(s*w-a*y)),e[7]=i*(y*R-w*A)-u*(s*R-a*A)+I*(s*w-a*y),e[8]=u*(E*ae-R*K)-I*(l*ae-w*K)+G*(l*R-w*E),e[9]=-(i*(E*ae-R*K)-I*(r*ae-a*K)+G*(r*R-a*E)),e[10]=i*(l*ae-w*K)-u*(r*ae-a*K)+G*(r*w-a*l),e[11]=-(i*(l*R-w*E)-u*(r*R-a*E)+I*(r*w-a*l)),e[12]=-(u*(E*Y-A*K)-I*(l*Y-y*K)+G*(l*A-y*E)),e[13]=i*(E*Y-A*K)-I*(r*Y-s*K)+G*(r*A-s*E),e[14]=-(i*(l*Y-y*K)-u*(r*Y-s*K)+G*(r*y-s*l)),e[15]=i*(l*A-y*E)-u*(r*A-s*E)+I*(r*y-s*l),e}function uU(e){const t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=e[6],y=e[7],w=e[8],I=e[9],E=e[10],A=e[11],R=e[12],G=e[13],K=e[14],Y=e[15];return(t*u-i*a)*(E*Y-A*K)-(t*l-r*a)*(I*Y-A*G)+(t*y-s*a)*(I*K-E*G)+(i*l-r*u)*(w*Y-A*R)-(i*y-s*u)*(w*K-E*R)+(r*y-s*l)*(w*G-I*R)}function BL(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],y=t[5],w=t[6],I=t[7],E=t[8],A=t[9],R=t[10],G=t[11],K=t[12],Y=t[13],ae=t[14],Te=t[15];let _e=i[0],be=i[1],ke=i[2],Ae=i[3];return e[0]=_e*r+be*l+ke*E+Ae*K,e[1]=_e*s+be*y+ke*A+Ae*Y,e[2]=_e*a+be*w+ke*R+Ae*ae,e[3]=_e*u+be*I+ke*G+Ae*Te,_e=i[4],be=i[5],ke=i[6],Ae=i[7],e[4]=_e*r+be*l+ke*E+Ae*K,e[5]=_e*s+be*y+ke*A+Ae*Y,e[6]=_e*a+be*w+ke*R+Ae*ae,e[7]=_e*u+be*I+ke*G+Ae*Te,_e=i[8],be=i[9],ke=i[10],Ae=i[11],e[8]=_e*r+be*l+ke*E+Ae*K,e[9]=_e*s+be*y+ke*A+Ae*Y,e[10]=_e*a+be*w+ke*R+Ae*ae,e[11]=_e*u+be*I+ke*G+Ae*Te,_e=i[12],be=i[13],ke=i[14],Ae=i[15],e[12]=_e*r+be*l+ke*E+Ae*K,e[13]=_e*s+be*y+ke*A+Ae*Y,e[14]=_e*a+be*w+ke*R+Ae*ae,e[15]=_e*u+be*I+ke*G+Ae*Te,e}function hU(e,t,i){const r=i[0],s=i[1],a=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*a+t[12],e[13]=t[1]*r+t[5]*s+t[9]*a+t[13],e[14]=t[2]*r+t[6]*s+t[10]*a+t[14],e[15]=t[3]*r+t[7]*s+t[11]*a+t[15];else{const u=t[0],l=t[1],y=t[2],w=t[3],I=t[4],E=t[5],A=t[6],R=t[7],G=t[8],K=t[9],Y=t[10],ae=t[11];e[0]=u,e[1]=l,e[2]=y,e[3]=w,e[4]=I,e[5]=E,e[6]=A,e[7]=R,e[8]=G,e[9]=K,e[10]=Y,e[11]=ae,e[12]=u*r+I*s+G*a+t[12],e[13]=l*r+E*s+K*a+t[13],e[14]=y*r+A*s+Y*a+t[14],e[15]=w*r+R*s+ae*a+t[15]}return e}function dU(e,t,i){const r=i[0],s=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function pU(e,t,i,r){let s,a,u,l,y,w,I,E,A,R,G,K,Y,ae,Te,_e,be,ke,Ae,Ve,Ze,lt,ct,ut,nt=r[0],It=r[1],ht=r[2],hi=Math.sqrt(nt*nt+It*It+ht*ht);return hi<sa()?null:(hi=1/hi,nt*=hi,It*=hi,ht*=hi,s=Math.sin(i),a=Math.cos(i),u=1-a,l=t[0],y=t[1],w=t[2],I=t[3],E=t[4],A=t[5],R=t[6],G=t[7],K=t[8],Y=t[9],ae=t[10],Te=t[11],_e=nt*nt*u+a,be=It*nt*u+ht*s,ke=ht*nt*u-It*s,Ae=nt*It*u-ht*s,Ve=It*It*u+a,Ze=ht*It*u+nt*s,lt=nt*ht*u+It*s,ct=It*ht*u-nt*s,ut=ht*ht*u+a,e[0]=l*_e+E*be+K*ke,e[1]=y*_e+A*be+Y*ke,e[2]=w*_e+R*be+ae*ke,e[3]=I*_e+G*be+Te*ke,e[4]=l*Ae+E*Ve+K*Ze,e[5]=y*Ae+A*Ve+Y*Ze,e[6]=w*Ae+R*Ve+ae*Ze,e[7]=I*Ae+G*Ve+Te*Ze,e[8]=l*lt+E*ct+K*ut,e[9]=y*lt+A*ct+Y*ut,e[10]=w*lt+R*ct+ae*ut,e[11]=I*lt+G*ct+Te*ut,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function fU(e,t,i){const r=Math.sin(i),s=Math.cos(i),a=t[4],u=t[5],l=t[6],y=t[7],w=t[8],I=t[9],E=t[10],A=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*s+w*r,e[5]=u*s+I*r,e[6]=l*s+E*r,e[7]=y*s+A*r,e[8]=w*s-a*r,e[9]=I*s-u*r,e[10]=E*s-l*r,e[11]=A*s-y*r,e}function mU(e,t,i){const r=Math.sin(i),s=Math.cos(i),a=t[0],u=t[1],l=t[2],y=t[3],w=t[8],I=t[9],E=t[10],A=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*s-w*r,e[1]=u*s-I*r,e[2]=l*s-E*r,e[3]=y*s-A*r,e[8]=a*r+w*s,e[9]=u*r+I*s,e[10]=l*r+E*s,e[11]=y*r+A*s,e}function yU(e,t,i){const r=Math.sin(i),s=Math.cos(i),a=t[0],u=t[1],l=t[2],y=t[3],w=t[4],I=t[5],E=t[6],A=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*s+w*r,e[1]=u*s+I*r,e[2]=l*s+E*r,e[3]=y*s+A*r,e[4]=w*s-a*r,e[5]=I*s-u*r,e[6]=E*s-l*r,e[7]=A*s-y*r,e}function gU(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function _U(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vU(e,t,i){if(t===0)return xb(e);let r,s,a,u=i[0],l=i[1],y=i[2],w=Math.sqrt(u*u+l*l+y*y);return w<sa()?null:(w=1/w,u*=w,l*=w,y*=w,r=Math.sin(t),s=Math.cos(t),a=1-s,e[0]=u*u*a+s,e[1]=l*u*a+y*r,e[2]=y*u*a-l*r,e[3]=0,e[4]=u*l*a-y*r,e[5]=l*l*a+s,e[6]=y*l*a+u*r,e[7]=0,e[8]=u*y*a+l*r,e[9]=l*y*a-u*r,e[10]=y*y*a+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function bU(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wU(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xU(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function jL(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=r+r,y=s+s,w=a+a,I=r*l,E=r*y,A=r*w,R=s*y,G=s*w,K=a*w,Y=u*l,ae=u*y,Te=u*w;return e[0]=1-(R+K),e[1]=E+Te,e[2]=A-ae,e[3]=0,e[4]=E-Te,e[5]=1-(I+K),e[6]=G+Y,e[7]=0,e[8]=A+ae,e[9]=G-Y,e[10]=1-(I+R),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function SU(e,t){const i=TU,r=-t[0],s=-t[1],a=-t[2],u=t[3],l=t[4],y=t[5],w=t[6],I=t[7],E=r*r+s*s+a*a+u*u;return E>0?(i[0]=2*(l*u+I*r+y*a-w*s)/E,i[1]=2*(y*u+I*s+w*r-l*a)/E,i[2]=2*(w*u+I*a+l*s-y*r)/E):(i[0]=2*(l*u+I*r+y*a-w*s),i[1]=2*(y*u+I*s+w*r-l*a),i[2]=2*(w*u+I*a+l*s-y*r)),jL(e,t,i),e}const TU=Eu();function MU(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function IU(e,t){const i=t[0],r=t[1],s=t[2],a=t[4],u=t[5],l=t[6],y=t[8],w=t[9],I=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(a*a+u*u+l*l),e[2]=Math.sqrt(y*y+w*w+I*I),e}function EU(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function kU(e,t,i,r){const s=t[0],a=t[1],u=t[2],l=t[3],y=s+s,w=a+a,I=u+u,E=s*y,A=s*w,R=s*I,G=a*w,K=a*I,Y=u*I,ae=l*y,Te=l*w,_e=l*I,be=r[0],ke=r[1],Ae=r[2];return e[0]=(1-(G+Y))*be,e[1]=(A+_e)*be,e[2]=(R-Te)*be,e[3]=0,e[4]=(A-_e)*ke,e[5]=(1-(E+Y))*ke,e[6]=(K+ae)*ke,e[7]=0,e[8]=(R+Te)*Ae,e[9]=(K-ae)*Ae,e[10]=(1-(E+G))*Ae,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function AU(e,t,i,r,s){const a=t[0],u=t[1],l=t[2],y=t[3],w=a+a,I=u+u,E=l+l,A=a*w,R=a*I,G=a*E,K=u*I,Y=u*E,ae=l*E,Te=y*w,_e=y*I,be=y*E,ke=r[0],Ae=r[1],Ve=r[2],Ze=s[0],lt=s[1],ct=s[2],ut=(1-(K+ae))*ke,nt=(R+be)*ke,It=(G-_e)*ke,ht=(R-be)*Ae,hi=(1-(A+ae))*Ae,Zi=(Y+Te)*Ae,gi=(G+_e)*Ve,Ut=(Y-Te)*Ve,ir=(1-(A+K))*Ve;return e[0]=ut,e[1]=nt,e[2]=It,e[3]=0,e[4]=ht,e[5]=hi,e[6]=Zi,e[7]=0,e[8]=gi,e[9]=Ut,e[10]=ir,e[11]=0,e[12]=i[0]+Ze-(ut*Ze+ht*lt+gi*ct),e[13]=i[1]+lt-(nt*Ze+hi*lt+Ut*ct),e[14]=i[2]+ct-(It*Ze+Zi*lt+ir*ct),e[15]=1,e}function PU(e,t){const i=t[0],r=t[1],s=t[2],a=t[3],u=i+i,l=r+r,y=s+s,w=i*u,I=r*u,E=r*l,A=s*u,R=s*l,G=s*y,K=a*u,Y=a*l,ae=a*y;return e[0]=1-E-G,e[1]=I+ae,e[2]=A-Y,e[3]=0,e[4]=I-ae,e[5]=1-w-G,e[6]=R+K,e[7]=0,e[8]=A+Y,e[9]=R-K,e[10]=1-w-E,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function CU(e,t,i,r,s,a,u){const l=1/(i-t),y=1/(s-r),w=1/(a-u);return e[0]=2*a*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*y,e[6]=0,e[7]=0,e[8]=(i+t)*l,e[9]=(s+r)*y,e[10]=(u+a)*w,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*a*2*w,e[15]=0,e}function $U(e,t,i,r,s){const a=1/Math.tan(t/2);let u;return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(u=1/(r-s),e[10]=(s+r)*u,e[14]=2*s*r*u):(e[10]=-1,e[14]=-2*r),e}function OU(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),u=Math.tan(t.leftDegrees*Math.PI/180),l=Math.tan(t.rightDegrees*Math.PI/180),y=2/(u+l),w=2/(s+a);return e[0]=y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=w,e[6]=0,e[7]=0,e[8]=-(u-l)*y*.5,e[9]=(s-a)*w*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function LU(e,t,i,r,s,a,u){const l=1/(t-i),y=1/(r-s),w=1/(a-u);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*w,e[11]=0,e[12]=(t+i)*l,e[13]=(s+r)*y,e[14]=(u+a)*w,e[15]=1,e}function RU(e,t,i,r){const s=t[0],a=t[1],u=t[2];let l=s-i[0],y=a-i[1],w=u-i[2];const I=sa();if(Math.abs(l)<I&&Math.abs(y)<I&&Math.abs(w)<I)return void xb(e);let E=1/Math.sqrt(l*l+y*y+w*w);l*=E,y*=E,w*=E;const A=r[0],R=r[1],G=r[2];let K=R*w-G*y,Y=G*l-A*w,ae=A*y-R*l;E=Math.sqrt(K*K+Y*Y+ae*ae),E?(E=1/E,K*=E,Y*=E,ae*=E):(K=0,Y=0,ae=0);let Te=y*ae-w*Y,_e=w*K-l*ae,be=l*Y-y*K;E=Math.sqrt(Te*Te+_e*_e+be*be),E?(E=1/E,Te*=E,_e*=E,be*=E):(Te=0,_e=0,be=0),e[0]=K,e[1]=Te,e[2]=l,e[3]=0,e[4]=Y,e[5]=_e,e[6]=y,e[7]=0,e[8]=ae,e[9]=be,e[10]=w,e[11]=0,e[12]=-(K*s+Y*a+ae*u),e[13]=-(Te*s+_e*a+be*u),e[14]=-(l*s+y*a+w*u),e[15]=1}function DU(e,t,i,r){const s=t[0],a=t[1],u=t[2],l=r[0],y=r[1],w=r[2];let I=s-i[0],E=a-i[1],A=u-i[2],R=I*I+E*E+A*A;R>0&&(R=1/Math.sqrt(R),I*=R,E*=R,A*=R);let G=y*A-w*E,K=w*I-l*A,Y=l*E-y*I;return R=G*G+K*K+Y*Y,R>0&&(R=1/Math.sqrt(R),G*=R,K*=R,Y*=R),e[0]=G,e[1]=K,e[2]=Y,e[3]=0,e[4]=E*Y-A*K,e[5]=A*G-I*Y,e[6]=I*K-E*G,e[7]=0,e[8]=I,e[9]=E,e[10]=A,e[11]=0,e[12]=s,e[13]=a,e[14]=u,e[15]=1,e}function zU(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function NU(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function FU(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function VL(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function BU(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function jU(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function VU(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function UU(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],a=e[3],u=e[4],l=e[5],y=e[6],w=e[7],I=e[8],E=e[9],A=e[10],R=e[11],G=e[12],K=e[13],Y=e[14],ae=e[15],Te=t[0],_e=t[1],be=t[2],ke=t[3],Ae=t[4],Ve=t[5],Ze=t[6],lt=t[7],ct=t[8],ut=t[9],nt=t[10],It=t[11],ht=t[12],hi=t[13],Zi=t[14],gi=t[15],Ut=sa();return Math.abs(i-Te)<=Ut*Math.max(1,Math.abs(i),Math.abs(Te))&&Math.abs(r-_e)<=Ut*Math.max(1,Math.abs(r),Math.abs(_e))&&Math.abs(s-be)<=Ut*Math.max(1,Math.abs(s),Math.abs(be))&&Math.abs(a-ke)<=Ut*Math.max(1,Math.abs(a),Math.abs(ke))&&Math.abs(u-Ae)<=Ut*Math.max(1,Math.abs(u),Math.abs(Ae))&&Math.abs(l-Ve)<=Ut*Math.max(1,Math.abs(l),Math.abs(Ve))&&Math.abs(y-Ze)<=Ut*Math.max(1,Math.abs(y),Math.abs(Ze))&&Math.abs(w-lt)<=Ut*Math.max(1,Math.abs(w),Math.abs(lt))&&Math.abs(I-ct)<=Ut*Math.max(1,Math.abs(I),Math.abs(ct))&&Math.abs(E-ut)<=Ut*Math.max(1,Math.abs(E),Math.abs(ut))&&Math.abs(A-nt)<=Ut*Math.max(1,Math.abs(A),Math.abs(nt))&&Math.abs(R-It)<=Ut*Math.max(1,Math.abs(R),Math.abs(It))&&Math.abs(G-ht)<=Ut*Math.max(1,Math.abs(G),Math.abs(ht))&&Math.abs(K-hi)<=Ut*Math.max(1,Math.abs(K),Math.abs(hi))&&Math.abs(Y-Zi)<=Ut*Math.max(1,Math.abs(Y),Math.abs(Zi))&&Math.abs(ae-gi)<=Ut*Math.max(1,Math.abs(ae),Math.abs(gi))}function GU(e){const t=sa(),i=e[0],r=e[1],s=e[2],a=e[4],u=e[5],l=e[6],y=e[8],w=e[9],I=e[10];return Math.abs(1-(i*i+a*a+y*y))<=t&&Math.abs(1-(r*r+u*u+w*w))<=t&&Math.abs(1-(s*s+l*l+I*I))<=t}function qU(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[8]===0&&e[9]===0&&e[10]===1}const HU=BL,WU=VL;Object.freeze(Object.defineProperty({__proto__:null,add:FU,adjoint:cU,copy:nU,determinant:uU,equals:UU,exactEquals:VU,frob:NU,fromQuat:PU,fromQuat2:SU,fromRotation:vU,fromRotationTranslation:jL,fromRotationTranslationScale:kU,fromRotationTranslationScaleOrigin:AU,fromScaling:_U,fromTranslation:gU,fromXRotation:bU,fromYRotation:wU,fromZRotation:xU,frustum:CU,getRotation:EU,getScaling:IU,getTranslation:MU,hasIdentityRotation:qU,identity:xb,invert:FL,invertOrIdentity:lU,isOrthoNormal:GU,lookAt:RU,mul:HU,multiply:BL,multiplyScalar:BU,multiplyScalarAndAdd:jU,ortho:LU,perspective:$U,perspectiveFromFieldOfView:OU,rotate:pU,rotateX:fU,rotateY:mU,rotateZ:yU,scale:dU,set:oU,str:zU,sub:WU,subtract:VL,targetTo:DU,translate:hU,transpose:aU},Symbol.toStringTag,{value:"Module"}));const tA=()=>pt.getLogger("esri.support.basemapUtils");function ZU(){return{}}function JU(e){for(const t in e){const i=e[t];Xi(i),delete e[t]}}function KU(e,t){let i;if(typeof e=="string"){const r=e in tS,s=!r&&e.includes("/");if(!r&&!s){const a=Object.entries(tS).filter(([u,l])=>mi.apiKey&&!l.classic||!mi.apiKey&&(l.classic||l.is3d)).map(([u])=>`"${u}"`).sort().join(", ");return tA().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${a}`),null}t&&(i=t[e]),i||(i=r?Qy.fromId(e):new Qy({style:{id:e}}),t&&(t[e]=i))}else i=an(Qy,e);return i!=null&&i.destroyed&&(tA().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function YU(e){return new Sg({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return!!i&&"tables"in i&&i.tables.includes(t)}})}function xx(e){for(const t of e.values())t==null||t.destroy();e.clear()}const iA={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function XU(e){let t=null;if(typeof e=="string")if(e in iA){const i=iA[e];t=new I1({resourceInfo:{data:{layers:[i]}}})}else pt.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=an(I1,e);return t}function pf(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var nS;function rA(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function QU(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let Oc=nS=class extends Iu{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){var s;if(!e&&!t)return{};const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):QU(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=(s=i.points)==null?void 0:s[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new tr,i=this.hasZ,r=this.hasM,s=i?3:2,a=e[0],u=rA(Math.min),l=rA(Math.max);let y,w,I,E,[A,R]=a,[G,K]=a;for(let Y=0,ae=e.length;Y<ae;Y++){const Te=e[Y],[_e,be]=Te;if(A=u(A,_e),R=u(R,be),G=l(G,_e),K=l(K,be),i&&Te.length>2){const ke=Te[2];y=u(y,ke),I=l(I,ke)}if(r&&Te.length>s){const ke=Te[s];w=u(w,ke),E=l(E,ke)}}return t.xmin=A,t.ymin=R,t.xmax=G,t.ymax=K,t.spatialReference=this.spatialReference,i?(t.zmin=y,t.zmax=I):(t.zmin=void 0,t.zmax=void 0),r?(t.mmin=w,t.mmax=E):(t.mmin=void 0,t.mmax=void 0),t}writePoints(e,t){t.points=Ge(this.points)}addPoint(e){return pf(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:Ge(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new nS(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new Ht(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new Ht(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(pf(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};v([M({readOnly:!0})],Oc.prototype,"cache",null),v([M()],Oc.prototype,"extent",null),v([M({type:[[Number]],json:{write:{isRequired:!0}}})],Oc.prototype,"points",void 0),v([ni("points")],Oc.prototype,"writePoints",null),Oc=nS=v([me("esri.geometry.Multipoint")],Oc),Oc.prototype.toJSON.isDefaultToJSON=!0;const Sb=Oc;function iae(e){const t=[];for(e.reset();e.nextPath();){const i=[];for(;e.nextPoint();)i.push([e.x,e.y]);t.push(i)}return e.reset(),t}function eG(e){const t=[];for(;e.nextPoint();)t.push([e.x,e.y]);return e.seekPathStart(),t}var E1;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(E1||(E1={}));function UL(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function tG(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function iG(e,t,i,r){return rG(e,t,i[r],i[r+1])}function rG(e,t,i,r){const[s,a]=t,[u,l]=i,[y,w]=r,I=y-u,E=w-l,A=I*I+E*E,R=(s-u)*I+(a-l)*E,G=Math.min(1,Math.max(0,R/A));return e[0]=u+I*G,e[1]=l+E*G,e}function rae(e,t,i,r,s,a){let u=i,l=r,y=s-u,w=a-l;if(y!==0||w!==0){const I=((e-u)*y+(t-l)*w)/(y*y+w*w);I>1?(u=s,l=a):I>0&&(u+=y*I,l+=w*I)}return y=e-u,w=t-l,y*y+w*w}function GL(e,t){return tG(e,t,.5)}function qL(e,t=E1.X,i=E1.Y){let r=0;const s=e.length;let a=e[0];for(let u=0;u<s-1;u++){const l=e[u+1];r+=(l[t]-a[t])*(l[i]+a[i]),a=l}return r>=0}function sG(e){const t=e.length;return t>2&&ib(e[0],e[t-1])}function sae(e){if("rings"in e&&(nG(e),e.rings.length>0&&!qL(e.rings[0])))for(const t of e.rings)t.reverse()}function nG(e){if("rings"in e)for(const t of e.rings)sG(t)||t.push(t[0].slice())}function nae(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function oG(e){return e?aG(e.rings,e.hasZ??!1):null}function aG(e,t){if(!(e!=null&&e.length))return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let a=0,u=e.length;a<u;a++){const l=HL(e[a],t,s);l&&r.push(l)}if(r.sort((a,u)=>{let l=a[2]-u[2];return l===0&&t&&(l=a[4]-u[4]),l}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const a=e[0]&&e[0].length?lG(e[0],t):null;if(!a)return null;i[0]=a[0],i[1]=a[1],t&&a.length>2&&(i[2]=a[2])}return i}function HL(e,t,i){let r=0,s=0,a=0,u=0,l=0;const y=e.length?e[0][0]:0,w=e.length?e[0][1]:0,I=e.length&&t?e[0][2]:0;for(let A=0;A<e.length;A++){const R=e[A],G=e[(A+1)%e.length],[K,Y,ae]=R,Te=K-y,_e=Y-w,[be,ke,Ae]=G,Ve=be-y,Ze=ke-w,lt=Te*Ze-Ve*_e;if(u+=lt,r+=(Te+Ve)*lt,s+=(_e+Ze)*lt,t&&R.length>2&&G.length>2){const ct=ae-I,ut=Ae-I,nt=Te*ut-Ve*ct;a+=(ct+ut)*nt,l+=nt}K<i[0]&&(i[0]=K),K>i[1]&&(i[1]=K),Y<i[2]&&(i[2]=Y),Y>i[3]&&(i[3]=Y),t&&(ae<i[4]&&(i[4]=ae),ae>i[5]&&(i[5]=ae))}if(u>0&&(u*=-1),l>0&&(l*=-1),!u)return null;u*=.5,l*=.5;const E=[r/(6*u)+y,s/(6*u)+w,u];return t&&(i[4]===i[5]||l===0?(E[3]=(i[4]+i[5])/2,E[4]=0):(E[3]=a/(6*l)+I,E[4]=l)),E}function oae(e,t){let i=0,r=0,s=0;e.nextPoint();const a=e.pathSize?e.x:0,u=e.pathSize?e.y:0;for(let l=0;l<e.pathSize;l++){e.seekInPath(l);const y=[e.x,e.y];e.seekInPath((l+1)%e.pathSize);const w=[e.x,e.y],[I,E]=y,A=I-a,R=E-u,[G,K]=w,Y=G-a,ae=K-u,Te=A*ae-Y*R;s+=Te,i+=(A+Y)*Te,r+=(R+ae)*Te,I<t[0]&&(t[0]=I),I>t[1]&&(t[1]=I),E<t[2]&&(t[2]=E),E>t[3]&&(t[3]=E)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+a,r/(6*s)+u,s]):null}function lG(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,a=0,u=0,l=0;for(let y=0,w=e.length;y<w-1;y++){const I=e[y],E=e[y+1];if(I&&E){i[0]=I[0],i[1]=I[1],r[0]=E[0],r[1]=E[1],t&&I.length>2&&E.length>2&&(i[2]=I[2],r[2]=E[2]);const A=UL(i,r);if(A){s+=A;const R=GL(I,E);a+=A*R[0],u+=A*R[1],t&&R.length>2&&(l+=A*R[2])}}}return s>0?t?[a/s,u/s,l/s]:[a/s,u/s]:e.length?e[0]:null}function cG(e){const{hasZ:t,totalSize:i}=e;if(i===0)return null;const r=[],s=[],a=t?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(e.reset();e.nextPath();){const u=HL(eG(e),e.hasZ,a);u&&s.push(u)}if(s.sort((u,l)=>{let y=u[2]-l[2];return y===0&&t&&(y=u[4]-l[4]),y}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],t&&(r[2]=s[0][3]),(r[0]<a[0]||r[0]>a[1]||r[1]<a[2]||r[1]>a[3]||t&&(r[2]<a[4]||r[2]>a[5]))&&(r.length=0)),!r.length){e.reset(),e.nextPath();const u=e.pathSize?uG(e):null;if(!u)return null;r[0]=u[0],r[1]=u[1],t&&u.length>2&&(r[2]=u[2])}return r}function uG(e){const{hasZ:t}=e,i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,a=0,u=0,l=0;if(e.nextPoint()){let y=e.x,w=e.y,I=e.z;for(;e.nextPoint();){const E=e.x,A=e.y,R=e.z;i[0]=y,i[1]=w,r[0]=E,r[1]=A,t&&(i[2]=I,r[2]=R);const G=UL(i,r);if(G){s+=G;const K=GL(i,r);a+=G*K[0],u+=G*K[1],t&&K.length>2&&(l+=G*K[2])}y=E,w=A,I=R}}return s>0?t?[a/s,u/s,l/s]:[a/s,u/s]:e.pathSize?(e.seekPathStart(),e.nextPoint(),[e.x,e.y]):null}const hG=1e-6;function aae(e){let t=0;for(e.reset();e.nextPath();)t+=e.getCurrentRingArea();if(t<hG){const s=cG(e);return s?[s[0],s[1]]:null}const i=[0,0];if(e.reset(),!e.nextPath()||!e.nextPoint())return null;const r=[e.x,e.y];for(e.reset();e.nextPath();)pG(i,r,e);return i[0]*=1/t,i[1]*=1/t,i[0]+=r[0],i[1]+=r[1],i}const dG=1/3;function pG(e,t,i){if(!e||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let a,u=i.x-r,l=i.y-s,y=0,w=0;for(;i.nextPoint();)y=i.x-r,w=i.y-s,a=.5*dG*(y*l-w*u),e[0]+=a*(u+y),e[1]+=a*(l+w),u=y,l=w;const I=i.getCurrentRingArea(),E=[r,s];return E[0]-=t[0],E[1]-=t[1],E[0]*=I,E[1]*=I,e[0]+=E[0],e[1]+=E[1],e}function Sn(e=mG){return[e[0],e[1],e[2],e[3]]}function WL(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function lae(e,t,i,r,s=Sn()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function cae(e,t=Sn()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function uae(e,t){return new tr({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function hae(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function dae(e,t,i){if(t!=null)if("length"in t)oS(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}else WL(i,e)}function ZL(e){return e==null||e[0]>=e[2]?0:e[2]-e[0]}function JL(e){return e==null||e[1]>=e[3]?0:e[3]-e[1]}function pae(e){return ZL(e)*JL(e)}function fae(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function mae(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function fG(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function yae(e){return e?WL(e,sA):Sn(sA)}function oS(e){return e!=null&&e.length===4}function gae(e,t){return oS(e)&&oS(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const sA=[1/0,1/0,-1/0,-1/0],mG=[0,0,0,0];function KL(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function YL(e){return e.points!==void 0}function XL(e){return e.x!==void 0&&e.y!==void 0}function QL(e){return e.paths!==void 0}function e5(e){return e.rings!==void 0}function t5(e){function t(i,r){return i==null?r:r==null?i:e(i,r)}return t}const cu=t5(Math.min),uu=t5(Math.max);function _ae(e,t){return QL(t)?ff(e,t.paths,!1,!1):e5(t)?ff(e,t.rings,!1,!1):YL(t)?sI(e,t.points,!1,!1,!1,!1):KL(t)?i5(e,t):(XL(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function vae(e){let t,i,r,s;for(e.reset(),t=r=1/0,i=s=-1/0;e.nextPath();){const a=yG(e);t=Math.min(a[0],t),r=Math.min(a[1],r),i=Math.max(a[2],i),s=Math.max(a[3],s)}return Sn([t,r,i,s])}function yG(e){let t,i,r,s;for(t=r=1/0,i=s=-1/0;e.nextPoint();)t=Math.min(e.x,t),r=Math.min(e.y,r),i=Math.max(e.x,i),s=Math.max(e.y,s);return Sn([t,r,i,s])}function bae(e,t){return QL(t)?ff(e,t.paths,!0,!1):e5(t)?ff(e,t.rings,!0,!1):YL(t)?sI(e,t.points,!0,!1,!0,!1):KL(t)?i5(e,t,!0,!1,!0,!1):(XL(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function ff(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let a,u,l,y,[w,I]=t[0][0],[E,A]=t[0][0];for(let R=0;R<t.length;R++){const G=t[R];for(let K=0;K<G.length;K++){const Y=G[K],[ae,Te]=Y;if(w=cu(w,ae),I=cu(I,Te),E=uu(E,ae),A=uu(A,Te),i&&Y.length>2){const _e=Y[2];a=cu(a,_e),u=uu(u,_e)}if(r&&Y.length>s){const _e=Y[s];l=cu(a,_e),y=uu(u,_e)}}}return i?r?(e[0]=w,e[1]=I,e[2]=a,e[3]=l,e[4]=E,e[5]=A,e[6]=u,e[7]=y,e.length=8,e):(e[0]=w,e[1]=I,e[2]=a,e[3]=E,e[4]=A,e[5]=u,e.length=6,e):r?(e[0]=w,e[1]=I,e[2]=l,e[3]=E,e[4]=A,e[5]=y,e.length=6,e):(e[0]=w,e[1]=I,e[2]=E,e[3]=A,e.length=4,e)}function i5(e,t,i,r,s,a){const u=t.xmin,l=t.xmax,y=t.ymin,w=t.ymax;let I=t.zmin,E=t.zmax,A=t.mmin,R=t.mmax;return s?(I=I||0,E=E||0,a?(A=A||0,R=R||0,e[0]=u,e[1]=y,e[2]=I,e[3]=A,e[4]=l,e[5]=w,e[6]=E,e[7]=R,e):(e[0]=u,e[1]=y,e[2]=I,e[3]=l,e[4]=w,e[5]=E,e)):a?(A=A||0,R=R||0,e[0]=u,e[1]=y,e[2]=A,e[3]=l,e[4]=w,e[5]=R,e):(e[0]=u,e[1]=y,e[2]=l,e[3]=w,e)}function sI(e,t,i,r,s,a){const u=i?3:2,l=r&&a,y=i&&s;if(!t.length||!t[0].length)return null;let w,I,E,A,[R,G]=t[0],[K,Y]=t[0];for(let ae=0;ae<t.length;ae++){const Te=t[ae],[_e,be]=Te;if(R=cu(R,_e),G=cu(G,be),K=uu(K,_e),Y=uu(Y,be),y&&Te.length>2){const ke=Te[2];w=cu(w,ke),I=uu(I,ke)}if(l&&Te.length>u){const ke=Te[u];E=cu(w,ke),A=uu(I,ke)}}return s?(w=w||0,I=I||0,a?(E=E||0,A=A||0,e[0]=R,e[1]=G,e[2]=w,e[3]=E,e[4]=K,e[5]=Y,e[6]=I,e[7]=A,e):(e[0]=R,e[1]=G,e[2]=w,e[3]=K,e[4]=Y,e[5]=I,e)):a?(E=E||0,A=A||0,e[0]=R,e[1]=G,e[2]=E,e[3]=K,e[4]=Y,e[5]=A,e):(e[0]=R,e[1]=G,e[2]=K,e[3]=Y,e)}function gG(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function _G(e){return e.points!==void 0}function vG(e){return e.x!==void 0&&e.y!==void 0}function bG(e){return e.paths!==void 0}function wG(e){return e.rings!==void 0}const nI=[];function r5(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function s5(e,t,i,r,s,a){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:a}}function n5(e,t,i,r,s,a){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:a}}function o5(e,t,i,r,s,a,u,l){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:a,zmax:u,mmax:l}}function oI(e,t=!1,i=!1){return t?i?o5(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):s5(e[0],e[1],e[2],e[3],e[4],e[5]):i?n5(e[0],e[1],e[2],e[3],e[4],e[5]):r5(e[0],e[1],e[2],e[3])}function wae(e){return e?gG(e)?e:vG(e)?SG(e):wG(e)?a5(e):bG(e)?l5(e):_G(e)?xG(e):null:null}function xG(e){const{hasZ:t,hasM:i,points:r}=e;return oI(sI(nI,r,t??!1,i??!1),t,i)}function SG(e){const{x:t,y:i,z:r,m:s}=e,a=s!=null;return r!=null?a?o5(t,i,r,s,t,i,r,s):s5(t,i,r,t,i,r):a?n5(t,i,s,t,i,s):r5(t,i,t,i)}function a5(e){const{hasZ:t,hasM:i,rings:r}=e,s=ff(nI,r,t??!1,i??!1);return s?oI(s,t,i):null}function l5(e){const{hasZ:t,hasM:i,paths:r}=e,s=ff(nI,r,t??!1,i??!1);return s?oI(s,t,i):null}var fv;function nA(e){return!Array.isArray(e[0])}let wa=fv=class extends Iu{static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const u of t)u.hasZ&&(r=!0),u.hasM&&(s=!0);const a={rings:t.map(u=>{const l=[[u.xmin,u.ymin],[u.xmin,u.ymax],[u.xmax,u.ymax],[u.xmax,u.ymin],[u.xmin,u.ymin]];if(r&&u.hasZ){const y=u.zmin+.5*(u.zmax-u.zmin);for(let w=0;w<l.length;w++)l[w].push(y)}if(s&&u.hasM){const y=u.mmin+.5*(u.mmax-u.mmin);for(let w=0;w<l.length;w++)l[w].push(y)}return l}),spatialReference:i};return r&&(a.hasZ=!0),s&&(a.hasM=!0),new fv(a)}constructor(...e){super(...e),this.rings=[],this.type="polygon"}normalizeCtorArgs(e,t){var u,l;let i,r,s=null,a=null;return e&&!Array.isArray(e)?(s=e.rings??null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||si.WGS84,s.length&&((u=s[0])==null?void 0:u[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),a=(l=s[0])==null?void 0:l[0],a&&(i===void 0&&r===void 0?(i=a.length>2,r=a.length>3):i===void 0?i=r?a.length>3:a.length>2:r===void 0&&(r=i?a.length>3:a.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=oG(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new Ht;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=a5(this);if(!t)return null;const i=new tr(t);return i.spatialReference=e,i}get isSelfIntersecting(){return cV(this.rings)}writeRings(e,t){t.rings=Ge(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(nA(e)){const r=[];for(let s=0,a=e.length;s<a;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new fv;return e.spatialReference=this.spatialReference,e.rings=Ge(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(e==null)return!1;const t=this.spatialReference,i=e.spatialReference;if(t!=null!=(i!=null)||t!=null&&i!=null&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,a,u,l],[y,w,I,E])=>s===y&&a===w&&(u==null&&I==null||u===I)&&(l==null&&E==null||l===E);for(let s=0;s<this.rings.length;s++){const a=this.rings[s],u=e.rings[s];if(!ib(a,u,r))return!1}return!0}contains(e){if(!e)return!1;const t=gb(e,this.spatialReference);return nL(this,t??e)}isClockwise(e){let t;return t=nA(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,qL(t)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new Ht(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Ht(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Ht(i[0],i[1],i[2],i[3],this.spatialReference):new Ht(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(pf(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new Ht(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new Ht(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(pf(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};v([M({readOnly:!0})],wa.prototype,"cache",null),v([M({readOnly:!0})],wa.prototype,"centroid",null),v([M({readOnly:!0})],wa.prototype,"extent",null),v([M({readOnly:!0})],wa.prototype,"isSelfIntersecting",null),v([M({type:[[[Number]]],json:{write:{isRequired:!0}}})],wa.prototype,"rings",void 0),v([ni("rings")],wa.prototype,"writeRings",null),wa=fv=v([me("esri.geometry.Polygon")],wa),wa.prototype.toJSON.isDefaultToJSON=!0;const vu=wa;var aS;function TG(e){return!Array.isArray(e[0])}let Lc=aS=class extends Iu{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){var u,l;let i,r,s=null,a=null;return e&&!Array.isArray(e)?(s=e.paths??null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||si.WGS84,s.length&&((u=s[0])==null?void 0:u[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),a=(l=s[0])==null?void 0:l[0],a&&(i===void 0&&r===void 0?(i=a.length>2,r=!1):i===void 0?i=!r&&a.length>3:r===void 0&&(r=!i&&a.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=l5(this);if(!t)return null;const i=new tr(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=Ge(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(TG(e)){const r=[];for(let s=0,a=e.length;s<a;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new aS;return e.spatialReference=this.spatialReference,e.paths=Ge(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new Ht(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new Ht(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new Ht(i[0],i[1],i[2],i[3],this.spatialReference):new Ht(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(pf(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new Ht(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new Ht(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(pf(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};v([M({readOnly:!0})],Lc.prototype,"cache",null),v([M({readOnly:!0})],Lc.prototype,"extent",null),v([M({type:[[[Number]]],json:{write:{isRequired:!0}}})],Lc.prototype,"paths",void 0),v([ni("paths")],Lc.prototype,"writePaths",null),Lc=aS=v([me("esri.geometry.Polyline")],Lc),Lc.prototype.toJSON.isDefaultToJSON=!0;const Ko=Lc,MG=In()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),xae=In()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function c5(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function u5(e){return e.points!==void 0}function h5(e){return e.x!==void 0&&e.y!==void 0}function d5(e){return e.paths!==void 0}function aI(e){return e.rings!==void 0}function mf(e){return e==null?null:e instanceof Iu?e:h5(e)?Ht.fromJSON(e):d5(e)?Ko.fromJSON(e):aI(e)?vu.fromJSON(e):u5(e)?Sb.fromJSON(e):c5(e)?tr.fromJSON(e):null}function lI(e){return e?h5(e)?"esriGeometryPoint":d5(e)?"esriGeometryPolyline":aI(e)?"esriGeometryPolygon":c5(e)?"esriGeometryEnvelope":u5(e)?"esriGeometryMultipoint":null:null}const IG={esriGeometryPoint:Ht,esriGeometryPolyline:Ko,esriGeometryPolygon:vu,esriGeometryEnvelope:tr,esriGeometryMultipoint:Sb};function EG(e){return e&&IG[e]||null}const Tb={base:Iu,key:"type",typeMap:{extent:tr,multipoint:Sb,point:Ht,polyline:Ko,polygon:vu}};Ul(Tb);let p5=0;const cI=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+p5++})}};return t=v([me("esri.core.Identifiable")],t),t},uI=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:p5++})}};return t=v([me("esri.core.NumericIdentifiable")],t),t};let oA=class extends cI(class{}){};oA=v([me("esri.core.Identifiable")],oA);async function kG(e){const t="portalItem"in e?e:{portalItem:e},{fromItem:i}=await it(()=>import("./portalLayers-DW8fcf-1.js").then(r=>r.p),__vite__mapDeps([17,18,19,15]));try{return await i(t)}catch(r){const s=t&&t.portalItem,a=(s==null?void 0:s.id)||"unset",u=s&&s.portal&&s.portal.url||mi.portalUrl;throw pt.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+u+"', id: '"+a+"')",r),r}}let AG=0,$r=class extends Mu.EventedMixin(cI(mu)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new tr(-180,-90,180,90,si.WGS84),this.id=Date.now().toString(16)+"-layer-"+AG++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=si.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(t){const i=typeof t=="string"?{url:t}:t;return(await it(()=>import("./arcgisLayers-DlGrKs2u.js"),__vite__mapDeps([21,18,22,19]))).fromUrl(i)}static fromPortalItem(t){return kG(t)}initialize(){this.when().catch(t=>{xo(t)||pt.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:t})})}destroy(){const t=this.parent;if(t){const i=this;"layers"in t&&t.layers.includes(i)?t.layers.remove(i):"tables"in t&&t.tables.includes(i)?t.tables.remove(i):"baseLayers"in t&&t.baseLayers.includes(i)?t.baseLayers.remove(i):"referenceLayers"in t&&t.referenceLayers.includes(i)&&t.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return ln(this.url)}async fetchAttributionData(){const t=this.attributionDataUrl;if(this.hasAttributionData&&t)return(await Qr(t,{query:{f:"json"},responseType:"json"})).data;throw new gt("layer:no-attribution-data","Layer does not have attribution data")}};v([M({type:String})],$r.prototype,"attributionDataUrl",void 0),v([M({type:tr})],$r.prototype,"fullExtent",void 0),v([M({readOnly:!0})],$r.prototype,"hasAttributionData",null),v([M({type:String,clonable:!1})],$r.prototype,"id",void 0),v([M({type:Boolean,nonNullable:!0})],$r.prototype,"legendEnabled",void 0),v([M({type:["show","hide","hide-children"]})],$r.prototype,"listMode",void 0),v([M({type:Number,range:{min:0,max:1},nonNullable:!0})],$r.prototype,"opacity",void 0),v([M({clonable:!1})],$r.prototype,"parent",void 0),v([M({readOnly:!0})],$r.prototype,"parsedUrl",null),v([M({type:Boolean,readOnly:!0})],$r.prototype,"persistenceEnabled",void 0),v([M({type:Boolean})],$r.prototype,"popupEnabled",void 0),v([M({type:Boolean})],$r.prototype,"attributionVisible",void 0),v([M({type:si})],$r.prototype,"spatialReference",void 0),v([M({type:String})],$r.prototype,"title",void 0),v([M({readOnly:!0,json:{read:!1}})],$r.prototype,"type",void 0),v([M()],$r.prototype,"url",void 0),v([M({type:Boolean,nonNullable:!0})],$r.prototype,"visible",void 0),$r=v([me("esri.layers.Layer")],$r);const PG=$r;function lS(e,t,i){let r,s;if(e)for(let a=0,u=e.length;a<u;a++){if(r=e.at(a),(r==null?void 0:r[t])===i)return r;if((r==null?void 0:r.type)==="group"&&(s=lS(r.layers,t,i),s))return s}}const CG=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new At;const r=u=>{u.parent&&"remove"in u.parent&&u.parent.remove(u)},s=u=>{u.parent=this,this.layerAdded(u),u.type!=="elevation"&&u.type!=="base-elevation"||pt.getLogger(this).error(`Layer 'title:${u.title}, id:${u.id}' of type '${u.type}' is not supported as an operational layer and will therefore be ignored.`)},a=u=>{u.parent=null,this.layerRemoved(u)};this.addHandles([this.layers.on("before-add",u=>r(u.item)),this.layers.on("after-add",u=>s(u.item)),this.layers.on("after-remove",u=>a(u.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",ad(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof PG){const a=i;a.parent===this?this.reorder(a,r):s.add(a,r)}else Tu(i)?i.then(a=>{this.destroyed||this.add(a,r)}):pt.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let a=s.getNextIndex(r);i.slice().forEach(u=>{u.parent!==this?(s.add(u,a),a+=1):this.reorder(u,a)})}findLayerById(i){return lS(this.layers,"id",i)}findLayerByUid(i){return lS(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return v([M()],t.prototype,"layers",null),t=v([me("esri.support.LayersMixin")],t),t};function cS(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const a=e.at(r);if(a[t]===i)return a;if((a==null?void 0:a.type)==="group"){const u=cS(a.tables,t,i);if(u)return u}}}const $G=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new At,this.addHandles([this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&pt.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",ad(i,this._get("tables")))}findTableById(i){return cS(this.tables,"id",i)}findTableByUid(i){return cS(this.tables,"uid",i)}};return v([M()],t.prototype,"tables",null),t=v([me("esri.support.TablesMixin")],t),t};let Do=class extends $G(CG(Mu.EventedMixin(Pt))){constructor(t){super(t),this.allLayers=new Sg({getCollections:()=>{var i,r,s;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=YU(this),this.basemap=null,this.editableLayers=new Sg({getCollections:()=>[this.allLayers],itemFilterFunction:X7}),this.ground=new I1,this._basemapCache=ZU()}destroy(){JU(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Xi(this.basemap),Xi(this.ground),this._set("ground",null)}castBasemap(t){return KU(t,this._basemapCache)}castGround(t){return XU(t)??this._get("ground")}findLayerById(t){return this.allLayers.find(i=>i.id===t)}findTableById(t){return this.allTables.find(i=>i.id===t)}};v([M({readOnly:!0,dependsOn:[]})],Do.prototype,"allLayers",void 0),v([M({readOnly:!0})],Do.prototype,"allTables",void 0),v([M({type:Qy,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Do.prototype,"basemap",void 0),v([es("basemap")],Do.prototype,"castBasemap",null),v([M({readOnly:!0})],Do.prototype,"editableLayers",void 0),v([M({type:I1,nonNullable:!0})],Do.prototype,"ground",void 0),v([es("ground")],Do.prototype,"castGround",null),v([M()],Do.prototype,"undoRedo",void 0),Do=v([me("esri.Map")],Do);const f5=Do,Za=e=>{let t=class extends e{clone(){var y;const i=fu(this);k$(i,"unable to clone instance of non-accessor class");const r=i.metadata,s=i.store,a={},u=new Map;for(const w in r){const I=r[w],E=s==null?void 0:s.originOf(w),A=I.clonable;if(I.readOnly||A===!1||E!==ci.USER&&E!==ci.DEFAULTS&&E!==ci.WEB_MAP&&E!==ci.WEB_SCENE)continue;const R=this[w];let G=null;G=typeof A=="function"?A(R):A==="reference"?R:g2(R),R!=null&&G==null||(E===ci.DEFAULTS?u.set(w,G):a[w]=G)}const l=new(Object.getPrototypeOf(this)).constructor(a);if(u.size){const w=(y=fu(l))==null?void 0:y.store;if(w)for(const[I,E]of u)w.set(I,E,ci.DEFAULTS)}return l}};return t=v([me("esri.core.Clonable")],t),t};let uS=class extends Za(Pt){};uS=v([me("esri.core.Clonable")],uS);let dh=class extends uS{constructor(t){super(t),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(t){return t!=null&&this.row===t.row&&this.rows===t.rows&&this.column===t.column&&this.columns===t.columns}};v([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],dh.prototype,"row",void 0),v([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],dh.prototype,"column",void 0),v([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],dh.prototype,"rows",void 0),v([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],dh.prototype,"columns",void 0),dh=v([me("esri.CameraLayout")],dh);const m5=dh;let hI=class{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,a=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),a&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return Va(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}};function dI(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}dI(new hI(0,2*Math.PI));dI(new hI(-Math.PI,Math.PI));const OG=dI(new hI(0,360));let xa=class extends Za(wt){constructor(...t){super(...t),this.position=new Ht([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new m5}normalizeCtorArgs(t,i,r,s){if(t&&typeof t=="object"&&("x"in t||Array.isArray(t))){const a={position:t};return i!=null&&(a.heading=i),r!=null&&(a.tilt=r),s!=null&&(a.fov=s),a}return t}writePosition(t,i,r,s){const a=t.clone();a.x=Wo(t.x||0),a.y=Wo(t.y||0),a.z=t.hasZ?Wo(t.z||0):t.z,i[r]=a.write({},s)}readPosition(t,i){const r=new Ht;return r.read(t,i),r.x=Wo(r.x||0),r.y=Wo(r.y||0),r.z=r.hasZ?Wo(r.z||0):r.z,r}equals(t){return t!=null&&this.tilt===t.tilt&&this.heading===t.heading&&this.fov===t.fov&&this.position.equals(t.position)&&this.layout.equals(t.layout)}};v([M({type:Ht,json:{write:{isRequired:!0}}})],xa.prototype,"position",void 0),v([ni("position")],xa.prototype,"writePosition",null),v([yi("position")],xa.prototype,"readPosition",null),v([M({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),es(e=>OG.normalize(Wo(e)))],xa.prototype,"heading",void 0),v([M({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),es(e=>Va(Wo(e),-180,180))],xa.prototype,"tilt",void 0),v([M({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],xa.prototype,"fov",void 0),v([M({type:m5,nonNullable:!0,json:{read:!1,write:!1}})],xa.prototype,"layout",void 0),xa=v([me("esri.Camera")],xa);const LG=xa;var hS;let Rc=hS=class extends wt{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new hS({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function Sx(){return{enabled:!this.camera}}v([M({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Sx}}}}})],Rc.prototype,"rotation",void 0),v([es("rotation")],Rc.prototype,"castRotation",null),v([M({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Sx}}}}})],Rc.prototype,"scale",void 0),v([M({types:Tb,json:{read:mf,write:!0,origins:{"web-scene":{read:mf,write:{overridePolicy:Sx}}}}})],Rc.prototype,"targetGeometry",void 0),v([M({type:LG,json:{write:!0}})],Rc.prototype,"camera",void 0),Rc=hS=v([me("esri.Viewpoint")],Rc);const Fa=Rc;function qt(e,t,i={}){return pI(e,t,i,y5)}function md(e,t,i={}){return pI(e,t,i,g5)}function pI(e,t,i={},r){let s=null;const a=i.once?(u,l)=>{r(u)&&(er(s),t(u,l))}:(u,l)=>{r(u)&&t(u,l)};if(s=y9(e,a,i.sync,i.equals),i.initial){const u=e();a(u,u)}return s}function yd(e,t,i,r={}){let s=null,a=null,u=null;function l(){var I;s&&a&&(a.remove(),(I=r.onListenerRemove)==null||I.call(r,s),s=null,a=null)}function y(I){r.once&&r.once&&er(u),i(I)}const w=qt(e,(I,E)=>{var A;l(),ab(I)&&(s=I,a=Vg(I,t,y),(A=r.onListenerAdd)==null||A.call(r,I))},{sync:r.sync,initial:!0});return u=Ni(()=>{w.remove(),l()}),u}function Mb(e,t){return RG(e,g5,t)}function RG(e,t,i){if(Vl(i))return Promise.reject(Er());const r=e();if(t!=null&&t(r))return Promise.resolve(r);let s=null;function a(){s=er(s)}return new Promise((u,l)=>{s=Fg([vo(i,()=>{a(),l(Er())}),pI(e,y=>{a(),u(y)},{sync:!1,once:!0},t??y5)])})}function y5(e){return!0}function g5(e){return!!e}const gd={sync:!0},on={initial:!0},Zo={sync:!0,initial:!0};let k1=class{constructor(t=i=>i.values().next().value){this._peeker=t,this._observable=new qg,this._items=new Set}get length(){return Tt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let t;for(t of this._items);return t}peek(){if(this.length!==0)return this._peeker(this._items)}push(t){this.contains(t)||(this._items.add(t),this._observable.notify())}contains(t){return Tt(this._observable),this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),this._observable.notify(),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),this._observable.notify(),t}remove(t){this.contains(t)&&(this._items.delete(t),this._observable.notify())}filter(t){const i=this.length;return this._items.forEach(r=>{t(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Tt(this._observable),yield*this._items}};const _5=new FinalizationRegistry(e=>{e.close()});function DG(e,t){_5.register(e,t,t)}function zG(e){_5.unregister(e)}const v5="worker:port-closed";var Xr;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(Xr||(Xr={}));let NG=0;function b5(){return NG++}function FG(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function Tg(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function fI(e,t,i,r){if(t.type===Xr.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==Xr.INVOKE&&t.type!==Xr.RESPONSE)return void e.postMessage(t);let s;if(FG(i)?(s=aA(i.transferList),t.data=i.result):(s=aA(r),t.data=i),s){if(Ce("ff")){for(const a of s)if("byteLength"in a&&a.byteLength>267386880){const u="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case Xr.INVOKE:throw u;case Xr.RESPONSE:return void fI(e,{type:Xr.RESPONSE,jobId:t.jobId,error:Tg(u)})}}}e.postMessage(t,s)}else e.postMessage(t)}function Mg(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function aA(e){if(!(e!=null&&e.length))return null;if(Ce("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!BG(i));return t.length?t:null}function BG(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)==null?void 0:t.name)==="ArrayBuffer"}async function jG(e){try{return await e}catch(t){const i=(t==null?void 0:t.name)===v5;if(!(xo(t)||i))throw t;return}}function w5(e,t,i){return new Proxy({},{get:(r,s,a)=>(...u)=>{let l,y;const w=u[u.length-1];VG(w)&&(l=w.signal,y=w.transferList,u.pop());const I=e.apply(t?`${t}.${s.toString()}`:s.toString(),u,{transferList:y,signal:l});return i!=null&&i.ignoreConnectionErrors?jG(I):I}})}function VG(e){return typeof e=="object"&&!Array.isArray(e)&&e!=null&&("signal"in e||"transferList"in e||Object.keys(e).length===0)}const UG={statsWorker:()=>it(()=>import("./statsWorker-CDQvJh0B.js"),__vite__mapDeps([23,24,25,26,27,28,29,30,31])),geometryEngineWorker:()=>it(()=>import("./geometryEngineWorker-COiiUg30.js"),__vite__mapDeps([32,33,34,35])),CSVSourceWorker:()=>it(()=>import("./CSVSourceWorker-C4KGbfEv.js"),__vite__mapDeps([36,37,35,38,39,40,41,42,43,44,45,8,46,47,48,49,25,24,26,27,28,29,30,31,50,51,52,53,54])),EdgeProcessingWorker:()=>it(()=>import("./EdgeProcessingWorker-CD6Rsptc.js"),__vite__mapDeps([55,56,57,27,58,59,28,60,61,62,63,64,65])),ElevationSamplerWorker:()=>it(()=>import("./ElevationSamplerWorker-cUHyHXmX.js"),__vite__mapDeps([66,43,67,68,69,70,71,72,73,74,75,76,27,28,57])),FeatureServiceSnappingSourceWorker:()=>it(()=>import("./FeatureServiceSnappingSourceWorker-BPnJ54P9.js"),__vite__mapDeps([77,39,40,38,41,42,43,44,35,45,8,46,47,48,49,25,24,26,27,28,29,30,31,50,51,12,13,78,79,80,81,7])),GeoJSONSourceWorker:()=>it(()=>import("./GeoJSONSourceWorker-C-2NevWt.js"),__vite__mapDeps([82,40,38,41,39,42,43,44,35,45,8,46,47,48,49,25,24,26,27,28,29,30,31,50,51,83,37,53,54,84])),LercWorker:()=>it(()=>import("./LercWorker-BtCRArnR.js"),[]),MemorySourceWorker:()=>it(()=>import("./MemorySourceWorker-DqBM4JEj.js"),__vite__mapDeps([85,40,38,41,86,39,42,43,44,35,45,8,46,47,48,49,25,24,26,27,28,29,30,31,50,51,53,54,84,37])),PBFDecoderWorker:()=>it(()=>import("./PBFDecoderWorker-Cn470i4Z.js"),__vite__mapDeps([87,40,38,41,78,79])),FeaturePipelineWorker:()=>it(()=>import("./FeaturePipelineWorker-Cgp2utes.js"),__vite__mapDeps([88,89,90,91,92,64,93,94,95,65,96,97,98,99,38,100,101,102,54,103,59,27,28,104,105,50,48,47,44,40,41,35,106,107,45,8,46,49,25,24,26,29,30,31,51,80,78,79,81,108,83,37,53,84,109,110])),PointCloudWorker:()=>it(()=>import("./PointCloudWorker-Bpc_3Ljc.js"),__vite__mapDeps([111,75,71,76,27,112,113,114,115,63,116,72,28,73,117])),RasterWorker:()=>it(()=>import("./RasterWorker-Bbn6op8W.js"),__vite__mapDeps([118,119,120,121,27,28,122,123,124])),SceneLayerSnappingSourceWorker:()=>it(()=>import("./SceneLayerSnappingSourceWorker-C7wUaX8I.js"),__vite__mapDeps([125,126,127,117,27,71,72,76,28,128,59,60,61,62,56,57,58,63,64,65])),SceneLayerWorker:()=>it(()=>import("./SceneLayerWorker-DjMihGs_.js"),__vite__mapDeps([129,74,68,69,28,128,27,127,117,71,72,76,130,73,115,63,131,116,75])),WFSSourceWorker:()=>it(()=>import("./WFSSourceWorker-DVujonCv.js"),__vite__mapDeps([132,40,38,41,39,42,43,44,35,45,8,46,47,48,49,25,24,26,27,28,29,30,31,50,51,83,37,84,133,134])),WorkerTileHandler:()=>it(()=>import("./WorkerTileHandler-CP9fSd0S.js"),__vite__mapDeps([135,136,99,101,137,138,93,79,97,89,139,140,64,65,121,27,28,98])),Lyr3DWorker:()=>it(()=>import("./Lyr3DWorker-Djfw15u0.js"),[])},{CLOSE:lA,ABORT:cA,INVOKE:uA,RESPONSE:Hm,OPEN_PORT:hA,ON:GG}=Xr,qG=2;let HG=class{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===Xr.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},bu=class Sp{static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new Sp(i.port1,{channel:i,client:r});return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),Sp.clients.set(s,r),i.port2}static loadWorker(t){const i=UG[t];return i?i():Promise.resolve(null)}constructor(t,i,r){this._port=t,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new HG(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:lA}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){return this.apply(t,[i],r)}apply(t,i,r){const s=r==null?void 0:r.signal,a=r==null?void 0:r.transferList;if(!this._port)return Promise.reject(new gt(v5,`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const u=b5();return new Promise((l,y)=>{if(Vl(s))return this._processWork(),void y(Er());const w=vo(s,()=>{const E=this._outJobs.get(u);E&&(this._outJobs.delete(u),this._processWork(),er(E.abortHandle),this._post({type:cA,jobId:u}),y(Er()))}),I={resolve:l,reject:y,abortHandle:w,debugInfo:t};this._outJobs.set(u,I),this._post({type:uA,jobId:u,methodName:t,abortable:s!=null},i,a)})}createInvokeProxy(t,i){return w5(this,t,i)}on(t,i){const r=new MessageChannel;function s(a){i(a.data)}return this._port.postMessage({type:Xr.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),Ni(()=>{r.port1.postMessage({type:Xr.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:hA,port:t.port2}),t.port1}_processWork(){var u;if(this._outJobs.size>=qG)return;const t=(u=this._jobQueue)==null?void 0:u.pop();if(!t)return;const{methodName:i,data:r,invokeOptions:s,resolver:a}=t;this.apply(i,r,s).then(l=>a.resolve(l)).catch(l=>a.reject(l))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{er(t.abortHandle),t.reject(Er(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(t){this._schedule!=null?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=Mg(t);if(i)switch(i.type){case Hm:this._onResponseMessage(i);break;case uA:this._invokeQueue.push(i);break;case cA:this._onAbortMessage(i);break;case lA:this._onCloseMessage();break;case hA:this._onOpenPortMessage(i);break;case GG:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Sp.clients.get(this)===t&&t.destroy(),Sp.clients.delete(this),t!=null&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s=[],abortable:a}=t,u=a?new AbortController:null,l=this._inJobs;let y,w=this._client,I=w[i];try{if(!I&&i&&i.includes(".")){const E=i.split(".");for(let A=0;A<E.length-1;A++)w=w[E[A]],I=w[E[A+1]]}if(typeof I!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:u?u.signal:null}),y=I.apply(w,s)}catch(E){return void this._post({type:Hm,jobId:r,error:Tg(E)})}Tu(y)?(l.set(r,{controller:u,promise:y}),y.then(E=>{l.has(r)&&(l.delete(r),this._post({type:Hm,jobId:r},E))},E=>{l.has(r)&&(l.delete(r),xo(E)||this._post({type:Hm,jobId:r,error:Tg(E||{message:`Error encountered at method ${i}`})}))})):this._post({type:Hm,jobId:r},y)}_onOpenPortMessage(t){new Sp(t.port,{client:this._client})}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,a=>{i.postMessage(a)}),s=Vg(t.port,"message",a=>{const u=Mg(a);(u==null?void 0:u.type)===Xr.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,a=this._outJobs;if(!a.has(i))return;const u=a.get(i);a.delete(i),this._processWork(),er(u.abortHandle),r?u.reject(gt.fromJSON(JSON.parse(r))):u.resolve(s)}_post(t,i,r){return fI(this._port,t,i,r)}};bu.kernelInfo={buildDate:PO,fullVersion:NM,revision:CO},bu.clients=new Map;let WG=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new k1}destroy(){this.close()}get closed(){var t;return!((t=this._clients)!=null&&t.length)}open(t,i){return new Promise((r,s)=>{let a=!0;const u=l=>{mr(i.signal),a&&(a=!1,l())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let l=0;l<t.length;++l){const y=t[l];Tu(y)?this._clientPromises[l]=y.then(w=>(this._clients[l]=new bu(w,i,this._ongoingJobsQueue),u(r),this._clients[l]),()=>(u(s),null)):(this._clients[l]=new bu(y,i,this._ongoingJobsQueue),this._clientPromises[l]=Promise.resolve(this._clients[l]),u(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let a=0;a<this._clientPromises.length;++a){const u=this._clientPromises[a];s[a]=u.then(l=>l==null?void 0:l.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.resolver.reject(Er(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,zG(this)}invoke(t,i,r){return this.apply(t,[i],r)}apply(t,i,r){const s=wo();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:r,resolver:s});for(let a=0;a<this._clientPromises.length;a++){const u=this._clients[a];u?u.jobAdded():this._clientPromises[a].then(l=>l==null?void 0:l.jobAdded())}return s.promise}createInvokeProxy(t){return w5(this,t)}on(t,i){return Promise.all(this._clientPromises).then(()=>Fg(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(a=>{a&&(i[s]=a.openPort()),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}};const ZG={async request(e,t){var u,l;const i=e.options,r=i.responseType;i.signal=t==null?void 0:t.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&((u=MO(e.url))!=null&&u.after)?r:"array-buffer";const s=await Qr(e.url,i),a={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((l=s.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete a.data.signal,a;case"blob":a.data=await a.data.arrayBuffer();break;case"json":a.data=new TextEncoder().encode(JSON.stringify(a.data)).buffer;break;case"text":a.data=new TextEncoder().encode(a.data).buffer}return{result:a,transferList:[a.data]}}},dA=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class Sd extends Error{}class JG extends Sd{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class KG extends Sd{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class YG extends Sd{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class Gp extends Sd{}class x5 extends Sd{constructor(t){super(`Invalid unit ${t}`)}}class wn extends Sd{}class Ic extends Sd{constructor(){super("Zone is an abstract class")}}const at="numeric",ta="short",Zn="long",A1={year:at,month:at,day:at},S5={year:at,month:ta,day:at},XG={year:at,month:ta,day:at,weekday:ta},T5={year:at,month:Zn,day:at},M5={year:at,month:Zn,day:at,weekday:Zn},I5={hour:at,minute:at},E5={hour:at,minute:at,second:at},k5={hour:at,minute:at,second:at,timeZoneName:ta},A5={hour:at,minute:at,second:at,timeZoneName:Zn},P5={hour:at,minute:at,hourCycle:"h23"},C5={hour:at,minute:at,second:at,hourCycle:"h23"},$5={hour:at,minute:at,second:at,hourCycle:"h23",timeZoneName:ta},O5={hour:at,minute:at,second:at,hourCycle:"h23",timeZoneName:Zn},L5={year:at,month:at,day:at,hour:at,minute:at},R5={year:at,month:at,day:at,hour:at,minute:at,second:at},D5={year:at,month:ta,day:at,hour:at,minute:at},z5={year:at,month:ta,day:at,hour:at,minute:at,second:at},QG={year:at,month:ta,day:at,weekday:ta,hour:at,minute:at},N5={year:at,month:Zn,day:at,hour:at,minute:at,timeZoneName:ta},F5={year:at,month:Zn,day:at,hour:at,minute:at,second:at,timeZoneName:ta},B5={year:at,month:Zn,day:at,weekday:Zn,hour:at,minute:at,timeZoneName:Zn},j5={year:at,month:Zn,day:at,weekday:Zn,hour:at,minute:at,second:at,timeZoneName:Zn};class Zg{get type(){throw new Ic}get name(){throw new Ic}get ianaName(){return this.name}get isUniversal(){throw new Ic}offsetName(t,i){throw new Ic}formatOffset(t,i){throw new Ic}offset(t){throw new Ic}equals(t){throw new Ic}get isValid(){throw new Ic}}let Tx=null;class Ib extends Zg{static get instance(){return Tx===null&&(Tx=new Ib),Tx}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return K5(t,i,r)}formatOffset(t,i){return eg(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let mv={};function eq(e){return mv[e]||(mv[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),mv[e]}const tq={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function iq(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,a,u,l,y,w,I]=r;return[u,s,a,l,y,w,I]}function rq(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:a,value:u}=i[s],l=tq[a];a==="era"?r[l]=u:Zt(l)||(r[l]=parseInt(u,10))}return r}let A_={};class ia extends Zg{static create(t){return A_[t]||(A_[t]=new ia(t)),A_[t]}static resetCache(){A_={},mv={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=ia.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return K5(t,i,r,this.name)}formatOffset(t,i){return eg(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=eq(this.name);let[s,a,u,l,y,w,I]=r.formatToParts?rq(r,i):iq(r,i);l==="BC"&&(s=-Math.abs(s)+1);const A=kb({year:s,month:a,day:u,hour:y===24?0:y,minute:w,second:I,millisecond:0});let R=+i;const G=R%1e3;return R-=G>=0?G:1e3+G,(A-R)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let pA={};function sq(e,t={}){const i=JSON.stringify([e,t]);let r=pA[i];return r||(r=new Intl.ListFormat(e,t),pA[i]=r),r}let dS={};function pS(e,t={}){const i=JSON.stringify([e,t]);let r=dS[i];return r||(r=new Intl.DateTimeFormat(e,t),dS[i]=r),r}let fS={};function nq(e,t={}){const i=JSON.stringify([e,t]);let r=fS[i];return r||(r=new Intl.NumberFormat(e,t),fS[i]=r),r}let mS={};function oq(e,t={}){const{base:i,...r}=t,s=JSON.stringify([e,r]);let a=mS[s];return a||(a=new Intl.RelativeTimeFormat(e,t),mS[s]=a),a}let py=null;function aq(){return py||(py=new Intl.DateTimeFormat().resolvedOptions().locale,py)}let fA={};function lq(e){let t=fA[e];if(!t){const i=new Intl.Locale(e);t="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,fA[e]=t}return t}function cq(e){const t=e.indexOf("-x-");t!==-1&&(e=e.substring(0,t));const i=e.indexOf("-u-");if(i===-1)return[e];{let r,s;try{r=pS(e).resolvedOptions(),s=e}catch{const y=e.substring(0,i);r=pS(y).resolvedOptions(),s=y}const{numberingSystem:a,calendar:u}=r;return[s,a,u]}}function uq(e,t,i){return(i||t)&&(e.includes("-u-")||(e+="-u"),i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function hq(e){const t=[];for(let i=1;i<=12;i++){const r=Ft.utc(2009,i,1);t.push(e(r))}return t}function dq(e){const t=[];for(let i=1;i<=7;i++){const r=Ft.utc(2016,11,13+i);t.push(e(r))}return t}function P_(e,t,i,r){const s=e.listingMode();return s==="error"?null:s==="en"?i(t):r(t)}function pq(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class fq{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:a,...u}=r;if(!i||Object.keys(u).length>0){const l={useGrouping:!1,...r};r.padTo>0&&(l.minimumIntegerDigits=r.padTo),this.inf=nq(t,l)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):_I(t,3);return Lr(i,this.padTo)}}}class mq{constructor(t,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=t;else if(t.zone.type==="fixed"){const u=-1*(t.offset/60),l=u>=0?`Etc/GMT+${u}`:`Etc/GMT${u}`;t.offset!==0&&ia.create(l).valid?(s=l,this.dt=t):(s="UTC",this.dt=t.offset===0?t:t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone)}else t.zone.type==="system"?this.dt=t:t.zone.type==="iana"?(this.dt=t,s=t.zone.name):(s="UTC",this.dt=t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone);const a={...this.opts};a.timeZone=a.timeZone||s,this.dtf=pS(i,a)}format(){return this.originalZone?this.formatToParts().map(({value:t})=>t).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const t=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?t.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):t}resolvedOptions(){return this.dtf.resolvedOptions()}}class yq{constructor(t,i,r){this.opts={style:"long",...r},!i&&Z5()&&(this.rtf=oq(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):Dq(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}const gq={firstDay:1,minimalDays:4,weekend:[6,7]};class Ri{static fromOpts(t){return Ri.create(t.locale,t.numberingSystem,t.outputCalendar,t.weekSettings,t.defaultToEN)}static create(t,i,r,s,a=!1){const u=t||Ir.defaultLocale,l=u||(a?"en-US":aq()),y=i||Ir.defaultNumberingSystem,w=r||Ir.defaultOutputCalendar,I=yS(s)||Ir.defaultWeekSettings;return new Ri(l,y,w,I,u)}static resetCache(){py=null,dS={},fS={},mS={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return Ri.create(t,i,r,s)}constructor(t,i,r,s,a){const[u,l,y]=cq(t);this.locale=u,this.numberingSystem=i||l||null,this.outputCalendar=r||y||null,this.weekSettings=s,this.intl=uq(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=a,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=pq(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Ri.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,yS(t.weekSettings)||this.weekSettings,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,i=!1){return P_(this,t,Q5,()=>{const r=i?{month:t,day:"numeric"}:{month:t},s=i?"format":"standalone";return this.monthsCache[s][t]||(this.monthsCache[s][t]=hq(a=>this.extract(a,r,"month"))),this.monthsCache[s][t]})}weekdays(t,i=!1){return P_(this,t,i4,()=>{const r=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},s=i?"format":"standalone";return this.weekdaysCache[s][t]||(this.weekdaysCache[s][t]=dq(a=>this.extract(a,r,"weekday"))),this.weekdaysCache[s][t]})}meridiems(){return P_(this,void 0,()=>r4,()=>{if(!this.meridiemCache){const t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ft.utc(2016,11,13,9),Ft.utc(2016,11,13,19)].map(i=>this.extract(i,t,"dayperiod"))}return this.meridiemCache})}eras(t){return P_(this,t,s4,()=>{const i={era:t};return this.eraCache[t]||(this.eraCache[t]=[Ft.utc(-40,1,1),Ft.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),a=s.formatToParts(),u=a.find(l=>l.type.toLowerCase()===r);return u?u.value:null}numberFormatter(t={}){return new fq(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new mq(t,this.intl,i)}relFormatter(t={}){return new yq(this.intl,this.isEnglish(),t)}listFormatter(t={}){return sq(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:J5()?lq(this.locale):gq}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}let Mx=null;class Rs extends Zg{static get utcInstance(){return Mx===null&&(Mx=new Rs(0)),Mx}static instance(t){return t===0?Rs.utcInstance:new Rs(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Rs(Ab(i[1],i[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${eg(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${eg(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return eg(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class _q extends Zg{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function au(e,t){if(Zt(e)||e===null)return t;if(e instanceof Zg)return e;if(wq(e)){const i=e.toLowerCase();return i==="default"?t:i==="local"||i==="system"?Ib.instance:i==="utc"||i==="gmt"?Rs.utcInstance:Rs.parseSpecifier(i)||ia.create(e)}else return td(e)?Rs.instance(e):typeof e=="object"&&"offset"in e&&typeof e.offset=="function"?e:new _q(e)}let mA=()=>Date.now(),yA="system",gA=null,_A=null,vA=null,bA=60,wA,xA=null;class Ir{static get now(){return mA}static set now(t){mA=t}static set defaultZone(t){yA=t}static get defaultZone(){return au(yA,Ib.instance)}static get defaultLocale(){return gA}static set defaultLocale(t){gA=t}static get defaultNumberingSystem(){return _A}static set defaultNumberingSystem(t){_A=t}static get defaultOutputCalendar(){return vA}static set defaultOutputCalendar(t){vA=t}static get defaultWeekSettings(){return xA}static set defaultWeekSettings(t){xA=yS(t)}static get twoDigitCutoffYear(){return bA}static set twoDigitCutoffYear(t){bA=t%100}static get throwOnInvalid(){return wA}static set throwOnInvalid(t){wA=t}static resetCaches(){Ri.resetCache(),ia.resetCache()}}class Yo{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const V5=[0,31,59,90,120,151,181,212,243,273,304,334],U5=[0,31,60,91,121,152,182,213,244,274,305,335];function go(e,t){return new Yo("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function mI(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function G5(e,t,i){return i+(Jg(e)?U5:V5)[t-1]}function q5(e,t){const i=Jg(e)?U5:V5,r=i.findIndex(a=>a<t),s=t-i[r];return{month:r+1,day:s}}function yI(e,t){return(e-t+7)%7+1}function P1(e,t=4,i=1){const{year:r,month:s,day:a}=e,u=G5(r,s,a),l=yI(mI(r,s,a),i);let y=Math.floor((u-l+14-t)/7),w;return y<1?(w=r-1,y=Ig(w,t,i)):y>Ig(r,t,i)?(w=r+1,y=1):w=r,{weekYear:w,weekNumber:y,weekday:l,...Pb(e)}}function SA(e,t=4,i=1){const{weekYear:r,weekNumber:s,weekday:a}=e,u=yI(mI(r,1,t),i),l=rf(r);let y=s*7+a-u-7+t,w;y<1?(w=r-1,y+=rf(w)):y>l?(w=r+1,y-=rf(r)):w=r;const{month:I,day:E}=q5(w,y);return{year:w,month:I,day:E,...Pb(e)}}function Ix(e){const{year:t,month:i,day:r}=e,s=G5(t,i,r);return{year:t,ordinal:s,...Pb(e)}}function TA(e){const{year:t,ordinal:i}=e,{month:r,day:s}=q5(t,i);return{year:t,month:r,day:s,...Pb(e)}}function MA(e,t){if(!Zt(e.localWeekday)||!Zt(e.localWeekNumber)||!Zt(e.localWeekYear)){if(!Zt(e.weekday)||!Zt(e.weekNumber)||!Zt(e.weekYear))throw new Gp("Cannot mix locale-based week fields with ISO-based week fields");return Zt(e.localWeekday)||(e.weekday=e.localWeekday),Zt(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),Zt(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function vq(e,t=4,i=1){const r=Eb(e.weekYear),s=_o(e.weekNumber,1,Ig(e.weekYear,t,i)),a=_o(e.weekday,1,7);return r?s?a?!1:go("weekday",e.weekday):go("week",e.weekNumber):go("weekYear",e.weekYear)}function bq(e){const t=Eb(e.year),i=_o(e.ordinal,1,rf(e.year));return t?i?!1:go("ordinal",e.ordinal):go("year",e.year)}function H5(e){const t=Eb(e.year),i=_o(e.month,1,12),r=_o(e.day,1,C1(e.year,e.month));return t?i?r?!1:go("day",e.day):go("month",e.month):go("year",e.year)}function W5(e){const{hour:t,minute:i,second:r,millisecond:s}=e,a=_o(t,0,23)||t===24&&i===0&&r===0&&s===0,u=_o(i,0,59),l=_o(r,0,59),y=_o(s,0,999);return a?u?l?y?!1:go("millisecond",s):go("second",r):go("minute",i):go("hour",t)}function Zt(e){return typeof e>"u"}function td(e){return typeof e=="number"}function Eb(e){return typeof e=="number"&&e%1===0}function wq(e){return typeof e=="string"}function xq(e){return Object.prototype.toString.call(e)==="[object Date]"}function Z5(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function J5(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function Sq(e){return Array.isArray(e)?e:[e]}function IA(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const a=[t(s),s];return r&&i(r[0],a[0])===r[0]?r:a},null)[1]}function Tq(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function yf(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function yS(e){if(e==null)return null;if(typeof e!="object")throw new wn("Week settings must be an object");if(!_o(e.firstDay,1,7)||!_o(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some(t=>!_o(t,1,7)))throw new wn("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function _o(e,t,i){return Eb(e)&&e>=t&&e<=i}function Mq(e,t){return e-t*Math.floor(e/t)}function Lr(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function tu(e){if(!(Zt(e)||e===null||e===""))return parseInt(e,10)}function ih(e){if(!(Zt(e)||e===null||e===""))return parseFloat(e)}function gI(e){if(!(Zt(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function _I(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function Jg(e){return e%4===0&&(e%100!==0||e%400===0)}function rf(e){return Jg(e)?366:365}function C1(e,t){const i=Mq(t-1,12)+1,r=e+(t-i)/12;return i===2?Jg(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function kb(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function EA(e,t,i){return-yI(mI(e,1,t),i)+t-1}function Ig(e,t=4,i=1){const r=EA(e,t,i),s=EA(e+1,t,i);return(rf(e)-r+s)/7}function gS(e){return e>99?e:e>Ir.twoDigitCutoffYear?1900+e:2e3+e}function K5(e,t,i,r=null){const s=new Date(e),a={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(a.timeZone=r);const u={timeZoneName:t,...a},l=new Intl.DateTimeFormat(i,u).formatToParts(s).find(y=>y.type.toLowerCase()==="timezonename");return l?l.value:null}function Ab(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function Y5(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new wn(`Invalid unit value ${e}`);return t}function $1(e,t){const i={};for(const r in e)if(yf(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=Y5(s)}return i}function eg(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${Lr(i,2)}:${Lr(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Lr(i,2)}${Lr(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function Pb(e){return Tq(e,["hour","minute","second","millisecond"])}const Iq=["January","February","March","April","May","June","July","August","September","October","November","December"],X5=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Eq=["J","F","M","A","M","J","J","A","S","O","N","D"];function Q5(e){switch(e){case"narrow":return[...Eq];case"short":return[...X5];case"long":return[...Iq];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const e4=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],t4=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],kq=["M","T","W","T","F","S","S"];function i4(e){switch(e){case"narrow":return[...kq];case"short":return[...t4];case"long":return[...e4];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const r4=["AM","PM"],Aq=["Before Christ","Anno Domini"],Pq=["BC","AD"],Cq=["B","A"];function s4(e){switch(e){case"narrow":return[...Cq];case"short":return[...Pq];case"long":return[...Aq];default:return null}}function $q(e){return r4[e.hour<12?0:1]}function Oq(e,t){return i4(t)[e.weekday-1]}function Lq(e,t){return Q5(t)[e.month-1]}function Rq(e,t){return s4(t)[e.year<0?0:1]}function Dq(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},a=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&a){const E=e==="days";switch(t){case 1:return E?"tomorrow":`next ${s[e][0]}`;case-1:return E?"yesterday":`last ${s[e][0]}`;case 0:return E?"today":`this ${s[e][0]}`}}const u=Object.is(t,-0)||t<0,l=Math.abs(t),y=l===1,w=s[e],I=r?y?w[1]:w[2]||w[1]:y?s[e][0]:e;return u?`${l} ${I} ago`:`in ${l} ${I}`}function kA(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const zq={D:A1,DD:S5,DDD:T5,DDDD:M5,t:I5,tt:E5,ttt:k5,tttt:A5,T:P5,TT:C5,TTT:$5,TTTT:O5,f:L5,ff:D5,fff:N5,ffff:B5,F:R5,FF:z5,FFF:F5,FFFF:j5};class Ls{static create(t,i={}){return new Ls(t,i)}static parseFormat(t){let i=null,r="",s=!1;const a=[];for(let u=0;u<t.length;u++){const l=t.charAt(u);l==="'"?(r.length>0&&a.push({literal:s||/^\s+$/.test(r),val:r}),i=null,r="",s=!s):s||l===i?r+=l:(r.length>0&&a.push({literal:/^\s+$/.test(r),val:r}),r=l,i=l)}return r.length>0&&a.push({literal:s||/^\s+$/.test(r),val:r}),a}static macroTokenToFormatOpts(t){return zq[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...i}).format()}dtFormatter(t,i={}){return this.loc.dtFormatter(t,{...this.opts,...i})}formatDateTime(t,i){return this.dtFormatter(t,i).format()}formatDateTimeParts(t,i){return this.dtFormatter(t,i).formatToParts()}formatInterval(t,i){return this.dtFormatter(t.start,i).dtf.formatRange(t.start.toJSDate(),t.end.toJSDate())}resolvedOptions(t,i){return this.dtFormatter(t,i).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return Lr(t,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",a=(R,G)=>this.loc.extract(t,R,G),u=R=>t.isOffsetFixed&&t.offset===0&&R.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,R.format):"",l=()=>r?$q(t):a({hour:"numeric",hourCycle:"h12"},"dayperiod"),y=(R,G)=>r?Lq(t,R):a(G?{month:R}:{month:R,day:"numeric"},"month"),w=(R,G)=>r?Oq(t,R):a(G?{weekday:R}:{weekday:R,month:"long",day:"numeric"},"weekday"),I=R=>{const G=Ls.macroTokenToFormatOpts(R);return G?this.formatWithSystemDefault(t,G):R},E=R=>r?Rq(t,R):a({era:R},"era"),A=R=>{switch(R){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return u({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return u({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return u({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return l();case"d":return s?a({day:"numeric"},"day"):this.num(t.day);case"dd":return s?a({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return w("short",!0);case"cccc":return w("long",!0);case"ccccc":return w("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return w("short",!1);case"EEEE":return w("long",!1);case"EEEEE":return w("narrow",!1);case"L":return s?a({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?a({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return y("short",!0);case"LLLL":return y("long",!0);case"LLLLL":return y("narrow",!0);case"M":return s?a({month:"numeric"},"month"):this.num(t.month);case"MM":return s?a({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return y("short",!1);case"MMMM":return y("long",!1);case"MMMMM":return y("narrow",!1);case"y":return s?a({year:"numeric"},"year"):this.num(t.year);case"yy":return s?a({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?a({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?a({year:"numeric"},"year"):this.num(t.year,6);case"G":return E("short");case"GG":return E("long");case"GGGGG":return E("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"n":return this.num(t.localWeekNumber);case"nn":return this.num(t.localWeekNumber,2);case"ii":return this.num(t.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(t.localWeekYear,4);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return I(R)}};return kA(Ls.parseFormat(i),A)}formatDurationFromString(t,i){const r=y=>{switch(y[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=y=>w=>{const I=r(w);return I?this.num(y.get(I),w.length):w},a=Ls.parseFormat(i),u=a.reduce((y,{literal:w,val:I})=>w?y:y.concat(I),[]),l=t.shiftTo(...u.map(r).filter(y=>y));return kA(a,s(l))}}const n4=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function If(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function Ef(...e){return t=>e.reduce(([i,r,s],a)=>{const[u,l,y]=a(t,s);return[{...i,...u},l||r,y]},[{},null,1]).slice(0,2)}function kf(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function o4(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=tu(t[i+s]);return[r,null,i+s]}}const a4=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Nq=`(?:${a4.source}?(?:\\[(${n4.source})\\])?)?`,vI=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,l4=RegExp(`${vI.source}${Nq}`),bI=RegExp(`(?:T${l4.source})?`),Fq=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Bq=/(\d{4})-?W(\d\d)(?:-?(\d))?/,jq=/(\d{4})-?(\d{3})/,Vq=o4("weekYear","weekNumber","weekDay"),Uq=o4("year","ordinal"),Gq=/(\d{4})-(\d\d)-(\d\d)/,c4=RegExp(`${vI.source} ?(?:${a4.source}|(${n4.source}))?`),qq=RegExp(`(?: ${c4.source})?`);function sf(e,t,i){const r=e[t];return Zt(r)?i:tu(r)}function Hq(e,t){return[{year:sf(e,t),month:sf(e,t+1,1),day:sf(e,t+2,1)},null,t+3]}function Af(e,t){return[{hours:sf(e,t,0),minutes:sf(e,t+1,0),seconds:sf(e,t+2,0),milliseconds:gI(e[t+3])},null,t+4]}function Kg(e,t){const i=!e[t]&&!e[t+1],r=Ab(e[t+1],e[t+2]),s=i?null:Rs.instance(r);return[{},s,t+3]}function Yg(e,t){const i=e[t]?ia.create(e[t]):null;return[{},i,t+1]}const Wq=RegExp(`^T?${vI.source}$`),Zq=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Jq(e){const[t,i,r,s,a,u,l,y,w]=e,I=t[0]==="-",E=y&&y[0]==="-",A=(R,G=!1)=>R!==void 0&&(G||R&&I)?-R:R;return[{years:A(ih(i)),months:A(ih(r)),weeks:A(ih(s)),days:A(ih(a)),hours:A(ih(u)),minutes:A(ih(l)),seconds:A(ih(y),y==="-0"),milliseconds:A(gI(w),E)}]}const Kq={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function wI(e,t,i,r,s,a,u){const l={year:t.length===2?gS(tu(t)):tu(t),month:X5.indexOf(i)+1,day:tu(r),hour:tu(s),minute:tu(a)};return u&&(l.second=tu(u)),e&&(l.weekday=e.length>3?e4.indexOf(e)+1:t4.indexOf(e)+1),l}const Yq=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Xq(e){const[,t,i,r,s,a,u,l,y,w,I,E]=e,A=wI(t,s,r,i,a,u,l);let R;return y?R=Kq[y]:w?R=0:R=Ab(I,E),[A,new Rs(R)]}function Qq(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const eH=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,tH=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,iH=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function AA(e){const[,t,i,r,s,a,u,l]=e;return[wI(t,s,r,i,a,u,l),Rs.utcInstance]}function rH(e){const[,t,i,r,s,a,u,l]=e;return[wI(t,l,i,r,s,a,u),Rs.utcInstance]}const sH=If(Fq,bI),nH=If(Bq,bI),oH=If(jq,bI),aH=If(l4),u4=Ef(Hq,Af,Kg,Yg),lH=Ef(Vq,Af,Kg,Yg),cH=Ef(Uq,Af,Kg,Yg),uH=Ef(Af,Kg,Yg);function hH(e){return kf(e,[sH,u4],[nH,lH],[oH,cH],[aH,uH])}function dH(e){return kf(Qq(e),[Yq,Xq])}function pH(e){return kf(e,[eH,AA],[tH,AA],[iH,rH])}function fH(e){return kf(e,[Zq,Jq])}const mH=Ef(Af);function yH(e){return kf(e,[Wq,mH])}const gH=If(Gq,qq),_H=If(c4),vH=Ef(Af,Kg,Yg);function bH(e){return kf(e,[gH,u4],[_H,vH])}const PA="Invalid Duration",h4={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},wH={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...h4},oo=146097/400,fp=146097/4800,xH={years:{quarters:4,months:12,weeks:oo/7,days:oo,hours:oo*24,minutes:oo*24*60,seconds:oo*24*60*60,milliseconds:oo*24*60*60*1e3},quarters:{months:3,weeks:oo/28,days:oo/4,hours:oo*24/4,minutes:oo*24*60/4,seconds:oo*24*60*60/4,milliseconds:oo*24*60*60*1e3/4},months:{weeks:fp/7,days:fp,hours:fp*24,minutes:fp*24*60,seconds:fp*24*60*60,milliseconds:fp*24*60*60*1e3},...h4},Uh=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],SH=Uh.slice(0).reverse();function Ec(e,t,i=!1){const r={values:i?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new ui(r)}function d4(e,t){let i=t.milliseconds??0;for(const r of SH.slice(1))t[r]&&(i+=t[r]*e[r].milliseconds);return i}function CA(e,t){const i=d4(e,t)<0?-1:1;Uh.reduceRight((r,s)=>{if(Zt(t[s]))return r;if(r){const a=t[r]*i,u=e[s][r],l=Math.floor(a/u);t[s]+=l*i,t[r]-=l*u*i}return s},null),Uh.reduce((r,s)=>{if(Zt(t[s]))return r;if(r){const a=t[r]%1;t[r]-=a,t[s]+=a*e[r][s]}return s},null)}function TH(e){const t={};for(const[i,r]of Object.entries(e))r!==0&&(t[i]=r);return t}class ui{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;let r=i?xH:wH;t.matrix&&(r=t.matrix),this.values=t.values,this.loc=t.loc||Ri.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(t,i){return ui.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new wn(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new ui({values:$1(t,ui.normalizeUnit),loc:Ri.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(t){if(td(t))return ui.fromMillis(t);if(ui.isDuration(t))return t;if(typeof t=="object")return ui.fromObject(t);throw new wn(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=fH(t);return r?ui.fromObject(r,i):ui.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=yH(t);return r?ui.fromObject(r,i):ui.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new wn("need to specify a reason the Duration is invalid");const r=t instanceof Yo?t:new Yo(t,i);if(Ir.throwOnInvalid)throw new YG(r);return new ui({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new x5(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Ls.create(this.loc,r).formatDurationFromString(this,t):PA}toHuman(t={}){if(!this.isValid)return PA;const i=Uh.map(r=>{const s=this.values[r];return Zt(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=_I(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t,includeOffset:!1},Ft.fromMillis(i,{zone:"UTC"}).toISOTime(t))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?d4(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=ui.fromDurationLike(t),r={};for(const s of Uh)(yf(i.values,s)||yf(this.values,s))&&(r[s]=i.get(s)+this.get(s));return Ec(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=ui.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=Y5(t(this.values[r],r));return Ec(this,{values:i},!0)}get(t){return this[ui.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i={...this.values,...$1(t,ui.normalizeUnit)};return Ec(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const u={loc:this.loc.clone({locale:t,numberingSystem:i}),matrix:s,conversionAccuracy:r};return Ec(this,u)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return CA(this.matrix,t),Ec(this,{values:t},!0)}rescale(){if(!this.isValid)return this;const t=TH(this.normalize().shiftToAll().toObject());return Ec(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(u=>ui.normalizeUnit(u));const i={},r={},s=this.toObject();let a;for(const u of Uh)if(t.indexOf(u)>=0){a=u;let l=0;for(const w in r)l+=this.matrix[w][u]*r[w],r[w]=0;td(s[u])&&(l+=s[u]);const y=Math.trunc(l);i[u]=y,r[u]=(l*1e3-y*1e3)/1e3}else td(s[u])&&(r[u]=s[u]);for(const u in r)r[u]!==0&&(i[a]+=u===a?r[u]:r[u]/this.matrix[a][u]);return CA(this.matrix,i),Ec(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return Ec(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of Uh)if(!i(this.values[r],t.values[r]))return!1;return!0}}const mp="Invalid Interval";function MH(e,t){return!e||!e.isValid?pr.invalid("missing or invalid start"):!t||!t.isValid?pr.invalid("missing or invalid end"):t<e?pr.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class pr{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new wn("need to specify a reason the Interval is invalid");const r=t instanceof Yo?t:new Yo(t,i);if(Ir.throwOnInvalid)throw new KG(r);return new pr({invalid:r})}static fromDateTimes(t,i){const r=Zm(t),s=Zm(i),a=MH(r,s);return a??new pr({start:r,end:s})}static after(t,i){const r=ui.fromDurationLike(i),s=Zm(t);return pr.fromDateTimes(s,s.plus(r))}static before(t,i){const r=ui.fromDurationLike(i),s=Zm(t);return pr.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let a,u;try{a=Ft.fromISO(r,i),u=a.isValid}catch{u=!1}let l,y;try{l=Ft.fromISO(s,i),y=l.isValid}catch{y=!1}if(u&&y)return pr.fromDateTimes(a,l);if(u){const w=ui.fromISO(s,i);if(w.isValid)return pr.after(a,w)}else if(y){const w=ui.fromISO(r,i);if(w.isValid)return pr.before(l,w)}}return pr.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(t,i);let s;return i!=null&&i.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(t,i),Math.floor(s.diff(r,t).get(t))+(s.valueOf()!==this.end.valueOf())}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?pr.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(Zm).filter(u=>this.contains(u)).sort((u,l)=>u.toMillis()-l.toMillis()),r=[];let{s}=this,a=0;for(;s<this.e;){const u=i[a]||this.e,l=+u>+this.e?this.e:u;r.push(pr.fromDateTimes(s,l)),s=l,a+=1}return r}splitBy(t){const i=ui.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,a;const u=[];for(;r<this.e;){const l=this.start.plus(i.mapUnits(y=>y*s));a=+l>+this.e?this.e:l,u.push(pr.fromDateTimes(r,a)),r=a,s+=1}return u}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:pr.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return pr.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,a)=>s.s-a.s).reduce(([s,a],u)=>a?a.overlaps(u)||a.abutsStart(u)?[s,a.union(u)]:[s.concat([a]),u]:[s,u],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],a=t.map(y=>[{time:y.s,type:"s"},{time:y.e,type:"e"}]),u=Array.prototype.concat(...a),l=u.sort((y,w)=>y.time-w.time);for(const y of l)r+=y.type==="s"?1:-1,r===1?i=y.time:(i&&+i!=+y.time&&s.push(pr.fromDateTimes(i,y.time)),i=null);return pr.merge(s)}difference(...t){return pr.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:mp}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(t=A1,i={}){return this.isValid?Ls.create(this.s.loc.clone(i),t).formatInterval(this):mp}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:mp}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:mp}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:mp}toFormat(t,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:mp}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):ui.invalid(this.invalidReason)}mapEndpoints(t){return pr.fromDateTimes(t(this.s),t(this.e))}}class C_{static hasDST(t=Ir.defaultZone){const i=Ft.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return ia.isValidZone(t)}static normalizeZone(t){return au(t,Ir.defaultZone)}static getStartOfWeek({locale:t=null,locObj:i=null}={}){return(i||Ri.create(t)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:t=null,locObj:i=null}={}){return(i||Ri.create(t)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:t=null,locObj:i=null}={}){return(i||Ri.create(t)).getWeekendDays().slice()}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:a="gregory"}={}){return(s||Ri.create(i,r,a)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:a="gregory"}={}){return(s||Ri.create(i,r,a)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Ri.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Ri.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Ri.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return Ri.create(i,null,"gregory").eras(t)}static features(){return{relative:Z5(),localeWeek:J5()}}}function $A(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(ui.fromMillis(r).as("days"))}function IH(e,t,i){const r=[["years",(y,w)=>w.year-y.year],["quarters",(y,w)=>w.quarter-y.quarter+(w.year-y.year)*4],["months",(y,w)=>w.month-y.month+(w.year-y.year)*12],["weeks",(y,w)=>{const I=$A(y,w);return(I-I%7)/7}],["days",$A]],s={},a=e;let u,l;for(const[y,w]of r)i.indexOf(y)>=0&&(u=y,s[y]=w(e,t),l=a.plus(s),l>t?(s[y]--,e=a.plus(s),e>t&&(l=e,s[y]--,e=a.plus(s))):e=l);return[e,s,l,u]}function EH(e,t,i,r){let[s,a,u,l]=IH(e,t,i);const y=t-s,w=i.filter(E=>["hours","minutes","seconds","milliseconds"].indexOf(E)>=0);w.length===0&&(u<t&&(u=s.plus({[l]:1})),u!==s&&(a[l]=(a[l]||0)+y/(u-s)));const I=ui.fromObject(a,r);return w.length>0?ui.fromMillis(y,r).shiftTo(...w).plus(I):I}const xI={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},OA={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},kH=xI.hanidec.replace(/[\[|\]]/g,"").split("");function AH(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(xI.hanidec)!==-1)t+=kH.indexOf(e[i]);else for(const s in OA){const[a,u]=OA[s];r>=a&&r<=u&&(t+=r-a)}}return parseInt(t,10)}else return t}function Co({numberingSystem:e},t=""){return new RegExp(`${xI[e||"latn"]}${t}`)}const PH="missing Intl.DateTimeFormat.formatToParts support";function vi(e,t=i=>i){return{regex:e,deser:([i])=>t(AH(i))}}const CH=" ",p4=`[ ${CH}]`,f4=new RegExp(p4,"g");function $H(e){return e.replace(/\./g,"\\.?").replace(f4,p4)}function LA(e){return e.replace(/\./g,"").replace(f4," ").toLowerCase()}function $o(e,t){return e===null?null:{regex:RegExp(e.map($H).join("|")),deser:([i])=>e.findIndex(r=>LA(i)===LA(r))+t}}function RA(e,t){return{regex:e,deser:([,i,r])=>Ab(i,r),groups:t}}function $_(e){return{regex:e,deser:([t])=>t}}function OH(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function LH(e,t){const i=Co(t),r=Co(t,"{2}"),s=Co(t,"{3}"),a=Co(t,"{4}"),u=Co(t,"{6}"),l=Co(t,"{1,2}"),y=Co(t,"{1,3}"),w=Co(t,"{1,6}"),I=Co(t,"{1,9}"),E=Co(t,"{2,4}"),A=Co(t,"{4,6}"),R=Y=>({regex:RegExp(OH(Y.val)),deser:([ae])=>ae,literal:!0}),K=(Y=>{if(e.literal)return R(Y);switch(Y.val){case"G":return $o(t.eras("short"),0);case"GG":return $o(t.eras("long"),0);case"y":return vi(w);case"yy":return vi(E,gS);case"yyyy":return vi(a);case"yyyyy":return vi(A);case"yyyyyy":return vi(u);case"M":return vi(l);case"MM":return vi(r);case"MMM":return $o(t.months("short",!0),1);case"MMMM":return $o(t.months("long",!0),1);case"L":return vi(l);case"LL":return vi(r);case"LLL":return $o(t.months("short",!1),1);case"LLLL":return $o(t.months("long",!1),1);case"d":return vi(l);case"dd":return vi(r);case"o":return vi(y);case"ooo":return vi(s);case"HH":return vi(r);case"H":return vi(l);case"hh":return vi(r);case"h":return vi(l);case"mm":return vi(r);case"m":return vi(l);case"q":return vi(l);case"qq":return vi(r);case"s":return vi(l);case"ss":return vi(r);case"S":return vi(y);case"SSS":return vi(s);case"u":return $_(I);case"uu":return $_(l);case"uuu":return vi(i);case"a":return $o(t.meridiems(),0);case"kkkk":return vi(a);case"kk":return vi(E,gS);case"W":return vi(l);case"WW":return vi(r);case"E":case"c":return vi(i);case"EEE":return $o(t.weekdays("short",!1),1);case"EEEE":return $o(t.weekdays("long",!1),1);case"ccc":return $o(t.weekdays("short",!0),1);case"cccc":return $o(t.weekdays("long",!0),1);case"Z":case"ZZ":return RA(new RegExp(`([+-]${l.source})(?::(${r.source}))?`),2);case"ZZZ":return RA(new RegExp(`([+-]${l.source})(${r.source})?`),2);case"z":return $_(/[a-z_+-/]{1,256}?/i);case" ":return $_(/[^\S\n\r]/);default:return R(Y)}})(e)||{invalidReason:PH};return K.token=e,K}const RH={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function DH(e,t,i){const{type:r,value:s}=e;if(r==="literal"){const y=/^\s+$/.test(s);return{literal:!y,val:y?" ":s}}const a=t[r];let u=r;r==="hour"&&(t.hour12!=null?u=t.hour12?"hour12":"hour24":t.hourCycle!=null?t.hourCycle==="h11"||t.hourCycle==="h12"?u="hour12":u="hour24":u=i.hour12?"hour12":"hour24");let l=RH[u];if(typeof l=="object"&&(l=l[a]),l)return{literal:!1,val:l}}function zH(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function NH(e,t,i){const r=e.match(t);if(r){const s={};let a=1;for(const u in i)if(yf(i,u)){const l=i[u],y=l.groups?l.groups+1:1;!l.literal&&l.token&&(s[l.token.val[0]]=l.deser(r.slice(a,a+y))),a+=y}return[r,s]}else return[r,{}]}function FH(e){const t=a=>{switch(a){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Zt(e.z)||(i=ia.create(e.z)),Zt(e.Z)||(i||(i=new Rs(e.Z)),r=e.Z),Zt(e.q)||(e.M=(e.q-1)*3+1),Zt(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Zt(e.u)||(e.S=gI(e.u)),[Object.keys(e).reduce((a,u)=>{const l=t(u);return l&&(a[l]=e[u]),a},{}),i,r]}let Ex=null;function BH(){return Ex||(Ex=Ft.fromMillis(1555555555555)),Ex}function jH(e,t){if(e.literal)return e;const i=Ls.macroTokenToFormatOpts(e.val),r=g4(i,t);return r==null||r.includes(void 0)?e:r}function m4(e,t){return Array.prototype.concat(...e.map(i=>jH(i,t)))}function y4(e,t,i){const r=m4(Ls.parseFormat(i),e),s=r.map(u=>LH(u,e)),a=s.find(u=>u.invalidReason);if(a)return{input:t,tokens:r,invalidReason:a.invalidReason};{const[u,l]=zH(s),y=RegExp(u,"i"),[w,I]=NH(t,y,l),[E,A,R]=I?FH(I):[null,null,void 0];if(yf(I,"a")&&yf(I,"H"))throw new Gp("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:y,rawMatches:w,matches:I,result:E,zone:A,specificOffset:R}}}function VH(e,t,i){const{result:r,zone:s,specificOffset:a,invalidReason:u}=y4(e,t,i);return[r,s,a,u]}function g4(e,t){if(!e)return null;const r=Ls.create(t,e).dtFormatter(BH()),s=r.formatToParts(),a=r.resolvedOptions();return s.map(u=>DH(u,e,a))}const kx="Invalid DateTime",DA=864e13;function O_(e){return new Yo("unsupported zone",`the zone "${e.name}" is not supported`)}function Ax(e){return e.weekData===null&&(e.weekData=P1(e.c)),e.weekData}function Px(e){return e.localWeekData===null&&(e.localWeekData=P1(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function rh(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Ft({...i,...t,old:i})}function _4(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const a=i.offset(r);return s===a?[r,s]:[e-Math.min(s,a)*60*1e3,Math.max(s,a)]}function L_(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function yv(e,t,i){return _4(kb(e),t,i)}function zA(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,a={...e.c,year:r,month:s,day:Math.min(e.c.day,C1(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},u=ui.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),l=kb(a);let[y,w]=_4(l,i,e.zone);return u!==0&&(y+=u,w=e.zone.offset(y)),{ts:y,o:w}}function Wm(e,t,i,r,s,a){const{setZone:u,zone:l}=i;if(e&&Object.keys(e).length!==0||t){const y=t||l,w=Ft.fromObject(e,{...i,zone:y,specificOffset:a});return u?w:w.setZone(l)}else return Ft.invalid(new Yo("unparsable",`the input "${s}" can't be parsed as ${r}`))}function R_(e,t,i=!0){return e.isValid?Ls.create(Ri.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function Cx(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=Lr(e.c.year,i?6:4),t?(r+="-",r+=Lr(e.c.month),r+="-",r+=Lr(e.c.day)):(r+=Lr(e.c.month),r+=Lr(e.c.day)),r}function NA(e,t,i,r,s,a){let u=Lr(e.c.hour);return t?(u+=":",u+=Lr(e.c.minute),(e.c.millisecond!==0||e.c.second!==0||!i)&&(u+=":")):u+=Lr(e.c.minute),(e.c.millisecond!==0||e.c.second!==0||!i)&&(u+=Lr(e.c.second),(e.c.millisecond!==0||!r)&&(u+=".",u+=Lr(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!a?u+="Z":e.o<0?(u+="-",u+=Lr(Math.trunc(-e.o/60)),u+=":",u+=Lr(Math.trunc(-e.o%60))):(u+="+",u+=Lr(Math.trunc(e.o/60)),u+=":",u+=Lr(Math.trunc(e.o%60)))),a&&(u+="["+e.zone.ianaName+"]"),u}const v4={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},UH={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},GH={ordinal:1,hour:0,minute:0,second:0,millisecond:0},b4=["year","month","day","hour","minute","second","millisecond"],qH=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],HH=["year","ordinal","hour","minute","second","millisecond"];function WH(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new x5(e);return t}function FA(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return WH(e)}}function BA(e,t){const i=au(t.zone,Ir.defaultZone),r=Ri.fromObject(t),s=Ir.now();let a,u;if(Zt(e.year))a=s;else{for(const w of b4)Zt(e[w])&&(e[w]=v4[w]);const l=H5(e)||W5(e);if(l)return Ft.invalid(l);const y=i.offset(s);[a,u]=yv(e,y,i)}return new Ft({ts:a,zone:i,loc:r,o:u})}function jA(e,t,i){const r=Zt(i.round)?!0:i.round,s=(u,l)=>(u=_I(u,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(u,l)),a=u=>i.calendary?t.hasSame(e,u)?0:t.startOf(u).diff(e.startOf(u),u).get(u):t.diff(e,u).get(u);if(i.unit)return s(a(i.unit),i.unit);for(const u of i.units){const l=a(u);if(Math.abs(l)>=1)return s(l,u)}return s(e>t?-0:0,i.units[i.units.length-1])}function VA(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class Ft{constructor(t){const i=t.zone||Ir.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new Yo("invalid input"):null)||(i.isValid?null:O_(i));this.ts=Zt(t.ts)?Ir.now():t.ts;let s=null,a=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,a]=[t.old.c,t.old.o];else{const l=i.offset(this.ts);s=L_(this.ts,l),r=Number.isNaN(s.year)?new Yo("invalid input"):null,s=r?null:s,a=r?null:l}this._zone=i,this.loc=t.loc||Ri.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=a,this.isLuxonDateTime=!0}static now(){return new Ft({})}static local(){const[t,i]=VA(arguments),[r,s,a,u,l,y,w]=i;return BA({year:r,month:s,day:a,hour:u,minute:l,second:y,millisecond:w},t)}static utc(){const[t,i]=VA(arguments),[r,s,a,u,l,y,w]=i;return t.zone=Rs.utcInstance,BA({year:r,month:s,day:a,hour:u,minute:l,second:y,millisecond:w},t)}static fromJSDate(t,i={}){const r=xq(t)?t.valueOf():NaN;if(Number.isNaN(r))return Ft.invalid("invalid input");const s=au(i.zone,Ir.defaultZone);return s.isValid?new Ft({ts:r,zone:s,loc:Ri.fromObject(i)}):Ft.invalid(O_(s))}static fromMillis(t,i={}){if(td(t))return t<-DA||t>DA?Ft.invalid("Timestamp out of range"):new Ft({ts:t,zone:au(i.zone,Ir.defaultZone),loc:Ri.fromObject(i)});throw new wn(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(td(t))return new Ft({ts:t*1e3,zone:au(i.zone,Ir.defaultZone),loc:Ri.fromObject(i)});throw new wn("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=au(i.zone,Ir.defaultZone);if(!r.isValid)return Ft.invalid(O_(r));const s=Ri.fromObject(i),a=$1(t,FA),{minDaysInFirstWeek:u,startOfWeek:l}=MA(a,s),y=Ir.now(),w=Zt(i.specificOffset)?r.offset(y):i.specificOffset,I=!Zt(a.ordinal),E=!Zt(a.year),A=!Zt(a.month)||!Zt(a.day),R=E||A,G=a.weekYear||a.weekNumber;if((R||I)&&G)throw new Gp("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(A&&I)throw new Gp("Can't mix ordinal dates with month/day");const K=G||a.weekday&&!R;let Y,ae,Te=L_(y,w);K?(Y=qH,ae=UH,Te=P1(Te,u,l)):I?(Y=HH,ae=GH,Te=Ix(Te)):(Y=b4,ae=v4);let _e=!1;for(const ct of Y){const ut=a[ct];Zt(ut)?_e?a[ct]=ae[ct]:a[ct]=Te[ct]:_e=!0}const be=K?vq(a,u,l):I?bq(a):H5(a),ke=be||W5(a);if(ke)return Ft.invalid(ke);const Ae=K?SA(a,u,l):I?TA(a):a,[Ve,Ze]=yv(Ae,w,r),lt=new Ft({ts:Ve,zone:r,o:Ze,loc:s});return a.weekday&&R&&t.weekday!==lt.weekday?Ft.invalid("mismatched weekday",`you can't specify both a weekday of ${a.weekday} and a date of ${lt.toISO()}`):lt}static fromISO(t,i={}){const[r,s]=hH(t);return Wm(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=dH(t);return Wm(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=pH(t);return Wm(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(Zt(t)||Zt(i))throw new wn("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:a=null}=r,u=Ri.fromOpts({locale:s,numberingSystem:a,defaultToEN:!0}),[l,y,w,I]=VH(u,t,i);return I?Ft.invalid(I):Wm(l,y,r,`format ${i}`,t,w)}static fromString(t,i,r={}){return Ft.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=bH(t);return Wm(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new wn("need to specify a reason the DateTime is invalid");const r=t instanceof Yo?t:new Yo(t,i);if(Ir.throwOnInvalid)throw new JG(r);return new Ft({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,i={}){const r=g4(t,Ri.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(t,i={}){return m4(Ls.parseFormat(t),Ri.fromObject(i)).map(s=>s.val).join("")}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Ax(this).weekYear:NaN}get weekNumber(){return this.isValid?Ax(this).weekNumber:NaN}get weekday(){return this.isValid?Ax(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?Px(this).weekday:NaN}get localWeekNumber(){return this.isValid?Px(this).weekNumber:NaN}get localWeekYear(){return this.isValid?Px(this).weekYear:NaN}get ordinal(){return this.isValid?Ix(this.c).ordinal:NaN}get monthShort(){return this.isValid?C_.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?C_.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?C_.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?C_.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const t=864e5,i=6e4,r=kb(this.c),s=this.zone.offset(r-t),a=this.zone.offset(r+t),u=this.zone.offset(r-s*i),l=this.zone.offset(r-a*i);if(u===l)return[this];const y=r-u*i,w=r-l*i,I=L_(y,u),E=L_(w,l);return I.hour===E.hour&&I.minute===E.minute&&I.second===E.second&&I.millisecond===E.millisecond?[rh(this,{ts:y}),rh(this,{ts:w})]:[this]}get isInLeapYear(){return Jg(this.year)}get daysInMonth(){return C1(this.year,this.month)}get daysInYear(){return this.isValid?rf(this.year):NaN}get weeksInWeekYear(){return this.isValid?Ig(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?Ig(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=Ls.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(Rs.instance(t),i)}toLocal(){return this.setZone(Ir.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=au(t,Ir.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const a=t.offset(this.ts),u=this.toObject();[s]=yv(u,a,t)}return rh(this,{ts:s,zone:t})}else return Ft.invalid(O_(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return rh(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=$1(t,FA),{minDaysInFirstWeek:r,startOfWeek:s}=MA(i,this.loc),a=!Zt(i.weekYear)||!Zt(i.weekNumber)||!Zt(i.weekday),u=!Zt(i.ordinal),l=!Zt(i.year),y=!Zt(i.month)||!Zt(i.day),w=l||y,I=i.weekYear||i.weekNumber;if((w||u)&&I)throw new Gp("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(y&&u)throw new Gp("Can't mix ordinal dates with month/day");let E;a?E=SA({...P1(this.c,r,s),...i},r,s):Zt(i.ordinal)?(E={...this.toObject(),...i},Zt(i.day)&&(E.day=Math.min(C1(E.year,E.month),E.day))):E=TA({...Ix(this.c),...i});const[A,R]=yv(E,this.o,this.zone);return rh(this,{ts:A,o:R})}plus(t){if(!this.isValid)return this;const i=ui.fromDurationLike(t);return rh(this,zA(this,i))}minus(t){if(!this.isValid)return this;const i=ui.fromDurationLike(t).negate();return rh(this,zA(this,i))}startOf(t,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=ui.normalizeUnit(t);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const a=this.loc.getStartOfWeek(),{weekday:u}=this;u<a&&(r.weekNumber=this.weekNumber-1),r.weekday=a}else r.weekday=1;if(s==="quarters"){const a=Math.ceil(this.month/3);r.month=(a-1)*3+1}return this.set(r)}endOf(t,i){return this.isValid?this.plus({[t]:1}).startOf(t,i).minus(1):this}toFormat(t,i={}){return this.isValid?Ls.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):kx}toLocaleString(t=A1,i={}){return this.isValid?Ls.create(this.loc.clone(i),t).formatDateTime(this):kx}toLocaleParts(t={}){return this.isValid?Ls.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:a=!1}={}){if(!this.isValid)return null;const u=t==="extended";let l=Cx(this,u);return l+="T",l+=NA(this,u,i,r,s,a),l}toISODate({format:t="extended"}={}){return this.isValid?Cx(this,t==="extended"):null}toISOWeekDate(){return R_(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:a=!1,format:u="extended"}={}){return this.isValid?(s?"T":"")+NA(this,u==="extended",i,t,r,a):null}toRFC2822(){return R_(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return R_(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Cx(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),R_(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():kx}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i={...this.c};return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return ui.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},a=Sq(i).map(ui.normalizeUnit),u=t.valueOf()>this.valueOf(),l=u?this:t,y=u?t:this,w=EH(l,y,a,s);return u?w.negate():w}diffNow(t="milliseconds",i={}){return this.diff(Ft.now(),t,i)}until(t){return this.isValid?pr.fromDateTimes(this,t):this}hasSame(t,i,r){if(!this.isValid)return!1;const s=t.valueOf(),a=this.setZone(t.zone,{keepLocalTime:!0});return a.startOf(i,r)<=s&&s<=a.endOf(i,r)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||Ft.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],a=t.unit;return Array.isArray(t.unit)&&(s=t.unit,a=void 0),jA(i,this.plus(r),{...t,numeric:"always",units:s,unit:a})}toRelativeCalendar(t={}){return this.isValid?jA(t.base||Ft.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(Ft.isDateTime))throw new wn("min requires all arguments be DateTimes");return IA(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(Ft.isDateTime))throw new wn("max requires all arguments be DateTimes");return IA(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:a=null}=r,u=Ri.fromOpts({locale:s,numberingSystem:a,defaultToEN:!0});return y4(u,t,i)}static fromStringExplain(t,i,r={}){return Ft.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return A1}static get DATE_MED(){return S5}static get DATE_MED_WITH_WEEKDAY(){return XG}static get DATE_FULL(){return T5}static get DATE_HUGE(){return M5}static get TIME_SIMPLE(){return I5}static get TIME_WITH_SECONDS(){return E5}static get TIME_WITH_SHORT_OFFSET(){return k5}static get TIME_WITH_LONG_OFFSET(){return A5}static get TIME_24_SIMPLE(){return P5}static get TIME_24_WITH_SECONDS(){return C5}static get TIME_24_WITH_SHORT_OFFSET(){return $5}static get TIME_24_WITH_LONG_OFFSET(){return O5}static get DATETIME_SHORT(){return L5}static get DATETIME_SHORT_WITH_SECONDS(){return R5}static get DATETIME_MED(){return D5}static get DATETIME_MED_WITH_SECONDS(){return z5}static get DATETIME_MED_WITH_WEEKDAY(){return QG}static get DATETIME_FULL(){return N5}static get DATETIME_FULL_WITH_SECONDS(){return F5}static get DATETIME_HUGE(){return B5}static get DATETIME_HUGE_WITH_SECONDS(){return j5}}function Zm(e){if(Ft.isDateTime(e))return e;if(e&&e.valueOf&&td(e.valueOf()))return Ft.fromJSDate(e);if(e&&typeof e=="object")return Ft.fromObject(e);throw new wn(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const Ua="system",SI="unknown",Eg="UTC",ZH=Intl.DateTimeFormat().resolvedOptions().timeZone,JH="shortOffset";function KH(e){return"timeZoneIANA"in e}function YH(e){return e.startsWith("UTC")}function Oae(e,t=!1){return{json:{read:{source:e,reader:(i,r)=>r[e]?XH(r[e]):null},write:!!t&&{allowNull:!0,writer(i,r){r[e]=i?QH(i):null}}}}}function XH(e,t=Ua){return e?KH(e)?e.timeZoneIANA:eW(e,t):t}function QH(e){return{timeZoneIANA:e}}function eW(e,t=Ua){if(!e||!dA.has(e.timeZone))return t;const i=dA.get(e.timeZone);return YH(e.timeZone)||e.respectsDaylightSaving?i:tW(i)}function tW(e){const t=Ft.local().setZone(e),i=Math.min(t.set({month:1,day:1}).offset,t.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${Rs.instance(-i).formatOffset(0,"narrow")}`}function Lae(e,t,i,r,s){if(t&&s==="date")return{timeZone:Eg,timeZoneName:void 0};const a=r.timeStyle||r.hour,u=i===SI;return{timeZone:u?s==="timestamp-offset"?void 0:e??Eg:i,timeZoneName:u&&a?JH:void 0}}const iW={year:void 0,month:void 0,day:void 0,weekday:void 0},rW={hour:void 0,minute:void 0,second:void 0},w4={timeZone:Eg},ga={year:"numeric",month:"numeric",day:"numeric"},Jm={year:"numeric",month:"long",day:"numeric"},Km={year:"numeric",month:"short",day:"numeric"},Ym={year:"numeric",month:"long",weekday:"long",day:"numeric"},iu={hour:"numeric",minute:"numeric"},ph={...iu,second:"numeric"},x4={hourCycle:"h23"},Xm={...iu,...x4},Qm={...ph,...x4},S4={"short-date":ga,"short-date-short-time":{...ga,...iu},"short-date-short-time-24":{...ga,...Xm},"short-date-long-time":{...ga,...ph},"short-date-long-time-24":{...ga,...Qm},"short-date-le":ga,"short-date-le-short-time":{...ga,...iu},"short-date-le-short-time-24":{...ga,...Xm},"short-date-le-long-time":{...ga,...ph},"short-date-le-long-time-24":{...ga,...Qm},"long-month-day-year":Jm,"long-month-day-year-short-time":{...Jm,...iu},"long-month-day-year-short-time-24":{...Jm,...Xm},"long-month-day-year-long-time":{...Jm,...ph},"long-month-day-year-long-time-24":{...Jm,...Qm},"day-short-month-year":Km,"day-short-month-year-short-time":{...Km,...iu},"day-short-month-year-short-time-24":{...Km,...Xm},"day-short-month-year-long-time":{...Km,...ph},"day-short-month-year-long-time-24":{...Km,...Qm},"long-date":Ym,"long-date-short-time":{...Ym,...iu},"long-date-short-time-24":{...Ym,...Xm},"long-date-long-time":{...Ym,...ph},"long-date-long-time-24":{...Ym,...Qm},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":iu,"long-time":ph},sW=In()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),T4={ar:"ar-u-nu-latn-ca-gregory"};let _S=new WeakMap;const Cb=S4["short-date-short-time"];function nW(e){let t=_S.get(e);if(!t){const i=Wn(),r=T4[i]||i,s=MI(e.timeZone??Ua),a={...e,timeZone:s};t=new Intl.DateTimeFormat(r,a),_S.set(e,t)}return t}function Rae(e){return S4[e]}function TI(e,t=Cb){return nW(t).format(e)}function Dae(e,t=Cb){return TI(new Date(e),{...t,...w4,...rW})}function zae(e,t=Cb){return TI(new Date(`1970-01-01T${e}Z`),{...t,...w4,...iW})}function Nae(e,t=Cb){if(t.timeZone)return TI(new Date(e),t);const i=Ft.fromISO(e,{setZone:!0}),r=Wn(),s=T4[r]??r,a=i.offset===0?Eg:t.timeZone,u={...t,timeZone:a};return i.toLocaleString(u,{locale:s})}function MI(e){switch(e){case Ua:return ZH;case SI:return Eg;default:return e}}KM(()=>{_S=new WeakMap});const oW={ar:"ar-u-nu-latn"};let gv=new WeakMap,M4={};function aW(e){const t=e||M4;if(!gv.has(t)){const i=Wn(),r=oW[Wn()]||i;gv.set(t,new Intl.NumberFormat(r,e))}return gv.get(t)}function Fae(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Bae(e,t){return Object.is(e,-0)&&(e=0),aW(t).format(e)}KM(()=>{gv=new WeakMap,M4={}});async function lW(e,t,i,r){const s=t.exec(i);if(!s)throw new gt("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const a=s[1]?`${s[1]}/`:"",u=s[2],l=kV(r),y=`${a}${u}.json`,w=l?`${a}${u}_${l}.json`:y;let I;try{I=await UA(e(w))}catch(E){if(w===y)throw new gt("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:E});try{I=await UA(e(y))}catch(A){throw new gt("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:A})}}return I}async function UA(e){if(GA.fetchBundleAsset!=null)return GA.fetchBundleAsset(e);const t=await Qr(e,{responseType:"text"});return JSON.parse(t.data)}let cW=class{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?a=>new URL(a,new URL(r,window.location.href)).href:r instanceof URL?a=>new URL(a,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return lW(this.getAssetUrl,this.matcher,t,i)}};function uW(e){return new cW(e)}const GA={};EV(uW({pattern:"esri/",location:fi}));const hW={};function dW(e){var i;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:((i=e.packages)==null?void 0:i.concat())||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=hW.baseUrl),t}let pW=class{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}},_v=class{constructor(){this._dispatcher=new pW,this._workerPostMessage({type:Xr.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){s1(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){s1(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=Mg(t);if(i&&i.type===Xr.OPEN){const{modulePath:r,jobId:s}=i;let a=await bu.loadWorker(r);a||(a=await it(()=>import(r),[]));const u=bu.connect(a);this._workerPostMessage({type:Xr.OPENED,jobId:s,data:u})}}};const vS=()=>pt.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:fW}=Xr,mW='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let D_,z_;const qA="Failed to create Worker. Fallback to execute module in main thread";async function yW(){if(!Ce("esri-workers"))return HA(new _v);if(!D_&&!z_)try{const t=mW.split('"{CONFIGURATION}"').join(`'${gW()}'`);D_=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){z_=t||{}}let e;if(D_)try{e=new Worker(D_,{name:"esri-worker-"+_W++})}catch{vS().warn(qA,z_),e=new _v}else vS().warn(qA,z_),e=new _v;return HA(e)}async function HA(e){return new Promise(t=>{function i(s){const a=Mg(s);a&&a.type===fW&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),vS().warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new _v).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function gW(){let e;if(mi.default!=null){const s={...mi};delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(mi));e.assetsPath=mo(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?mo(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=Wn(),e.has={"esri-csp-restrictions":Ce("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":Ce("esri-2d-update-debug"),"esri-2d-log-updating":Ce("esri-2d-log-updating"),"featurelayer-pbf":Ce("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":Ce("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":Ce("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":Ce("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":Ce("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":Ce("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":Ce("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":Ce("featurelayer-snapshot-enabled"),"esri-atomics":Ce("esri-atomics"),"esri-shared-array-buffer":Ce("esri-shared-array-buffer"),"esri-tiles-debug":Ce("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":Ce("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":Ce("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=mo(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=mo(e.workers.workerPath):e.workers.workerPath=mo(fi("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=mi.workers.loaderConfig,i=dW({baseUrl:t==null?void 0:t.baseUrl,locale:Wn(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t==null?void 0:t.has},map:{...t==null?void 0:t.map},paths:{...t==null?void 0:t.paths},packages:(t==null?void 0:t.packages)||[]});return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:{buildDate:PO,fullVersion:NM,revision:CO}})}let _W=0;const{ABORT:WA,INVOKE:vW,OPEN:bW,OPENED:wW,RESPONSE:ey}=Xr;let xW=class I4{static async create(t){const i=await yW();return new I4(i,t)}constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),pt.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=b5();return new Promise((a,u)=>{const l={resolve:a,reject:u,abortHandle:wM(r,()=>{this._outJobs.delete(s),this._post({type:WA,jobId:s})})};this._outJobs.set(s,l),this._post({type:bW,jobId:s,modulePath:t})})}_onMessage(t){const i=Mg(t);if(i)switch(i.type){case wW:this._onOpenedMessage(i);break;case ey:this._onResponseMessage(i);break;case WA:this._onAbortMessage(i);break;case vW:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:a}=t,u=a?new AbortController:null,l=this._inJobs,y=ZG[i];let w;try{if(typeof y!="function")throw new TypeError(`${i} is not a function`);w=y.call(null,s,{signal:u?u.signal:null})}catch(I){return void this._post({type:ey,jobId:r,error:Tg(I)})}Tu(w)?(l.set(r,{controller:u,promise:w}),w.then(I=>{l.has(r)&&(l.delete(r),this._post({type:ey,jobId:r},I))},I=>{l.has(r)&&(l.delete(r),I||(I={message:"Error encountered at method"+i}),xo(I)||this._post({type:ey,jobId:r,error:Tg(I||{message:`Error encountered at method ${i}`})}))})):this._post({type:ey,jobId:r},w)}_onOpenedMessage(t){const{jobId:i,data:r}=t,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),er(s.abortHandle),s.resolve(r))}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,a=this._outJobs.get(i);a&&(this._outJobs.delete(i),er(a.abortHandle),r?a.reject(gt.fromJSON(JSON.parse(r))):a.resolve(s))}_post(t,i,r){return fI(this.worker,t,i,r)}};const ZA=Ce("host-browser")?Math.min(navigator.hardwareConcurrency-1,Ce("workers-pool-size")):0;let Gh=Ce("esri-mobile")?Math.min(ZA,3):ZA;Gh||(Gh=Ce("safari")&&Ce("mac")?7:2);let JA=0;const vv=[];function SW(){E4()}async function N_(e,t){const i=new WG,{registryTarget:r,...s}=t;return await i.open(e,s),r&&DG(r,i),i}async function Gae(e,t={}){if(typeof e!="string")throw new gt("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(Ce("host-webworker")&&!Ce("esri-workers")&&(i="local"),i==="local"){let r=await bu.loadWorker(e);r||(r=await it(()=>import(e),[])),mr(t.signal);const s=t.client||r;return N_([bu.connect(r)],{...t,client:s})}if(await E4(),mr(t.signal),i==="dedicated"){const r=JA++%Gh;return N_([await vv[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,Gh);if(r<Gh){const s=new Array(r);for(let a=0;a<r;++a){const u=JA++%Gh;s[a]=vv[u].open(e,t)}return N_(s,t)}}return N_(vv.map(r=>r.open(e,t)),t)}let F_=null;async function E4(){if(F_)return F_;new AbortController;const e=[];for(let t=0;t<Gh;t++){const i=xW.create(t).then(r=>(vv[t]=r,r));e.push(i)}return F_=Promise.all(e),F_}const kc=gr.radius,Oo=gr.eccentricitySquared,TW={a1:kc*Oo,a2:kc*Oo*kc*Oo,a3:kc*Oo*Oo/2,a4:kc*Oo*kc*Oo*2.5,a5:kc*Oo+kc*Oo*Oo/2,a6:1-Oo};1/294.9786982,1/298.257222101,gr.radius,gr.flattening,1/298.257222101,yu.radius,yu.flattening,1/192.0430107526882,Na.radius,Na.flattening,1/10.2079945799458,1/43.61604095563141,Na.radius;var fe;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(fe||(fe={}));const k4={[fe.WGS84]:{[fe.CGCS2000]:null,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:null,[fe.LON_LAT]:Ai,[fe.WGS84_COMPARABLE_LON_LAT]:Ai,[fe.SPHERICAL_ECEF]:qp,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:kg,[fe.PLATE_CARREE]:qh,[fe.WGS84]:Ai,[fe.WGS84_ECEF]:Zh},[fe.CGCS2000]:{[fe.CGCS2000]:Ai,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:null,[fe.LON_LAT]:Ai,[fe.WGS84_COMPARABLE_LON_LAT]:Ai,[fe.SPHERICAL_ECEF]:qp,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:null,[fe.PLATE_CARREE]:qh,[fe.WGS84]:null,[fe.WGS84_ECEF]:Zh},[fe.GCSMARS2000]:{[fe.CGCS2000]:null,[fe.GCSMARS2000]:Ai,[fe.GCSMOON2000]:null,[fe.LON_LAT]:Ai,[fe.WGS84_COMPARABLE_LON_LAT]:null,[fe.SPHERICAL_ECEF]:null,[fe.SPHERICAL_MARS_PCPF]:YA,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:null,[fe.PLATE_CARREE]:null,[fe.WGS84]:null,[fe.WGS84_ECEF]:null},[fe.GCSMOON2000]:{[fe.CGCS2000]:null,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:Ai,[fe.LON_LAT]:Ai,[fe.WGS84_COMPARABLE_LON_LAT]:null,[fe.SPHERICAL_ECEF]:null,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:KA,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:null,[fe.PLATE_CARREE]:null,[fe.WGS84]:null,[fe.WGS84_ECEF]:null},[fe.WEB_MERCATOR]:{[fe.CGCS2000]:null,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:null,[fe.LON_LAT]:tg,[fe.WGS84_COMPARABLE_LON_LAT]:tg,[fe.SPHERICAL_ECEF]:IW,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:Ai,[fe.PLATE_CARREE]:AW,[fe.WGS84]:tg,[fe.WGS84_ECEF]:EW},[fe.WGS84_ECEF]:{[fe.CGCS2000]:Jh,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:null,[fe.LON_LAT]:Jh,[fe.WGS84_COMPARABLE_LON_LAT]:Jh,[fe.SPHERICAL_ECEF]:NW,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:FW,[fe.PLATE_CARREE]:PW,[fe.WGS84]:Jh,[fe.WGS84_ECEF]:Ai},[fe.SPHERICAL_ECEF]:{[fe.CGCS2000]:Wh,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:null,[fe.LON_LAT]:Wh,[fe.WGS84_COMPARABLE_LON_LAT]:Wh,[fe.SPHERICAL_ECEF]:Ai,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:RW,[fe.PLATE_CARREE]:CW,[fe.WGS84]:Wh,[fe.WGS84_ECEF]:DW},[fe.SPHERICAL_MARS_PCPF]:{[fe.CGCS2000]:null,[fe.GCSMARS2000]:QA,[fe.GCSMOON2000]:null,[fe.LON_LAT]:QA,[fe.WGS84_COMPARABLE_LON_LAT]:null,[fe.SPHERICAL_ECEF]:null,[fe.SPHERICAL_MARS_PCPF]:Ai,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:null,[fe.PLATE_CARREE]:null,[fe.WGS84]:null,[fe.WGS84_ECEF]:null},[fe.SPHERICAL_MOON_PCPF]:{[fe.CGCS2000]:null,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:XA,[fe.LON_LAT]:XA,[fe.WGS84_COMPARABLE_LON_LAT]:null,[fe.SPHERICAL_ECEF]:null,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:Ai,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:null,[fe.PLATE_CARREE]:null,[fe.WGS84]:null,[fe.WGS84_ECEF]:null},[fe.UNKNOWN]:{[fe.CGCS2000]:null,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:null,[fe.LON_LAT]:null,[fe.WGS84_COMPARABLE_LON_LAT]:null,[fe.SPHERICAL_ECEF]:null,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:Ai,[fe.WEB_MERCATOR]:null,[fe.PLATE_CARREE]:null,[fe.WGS84]:null,[fe.WGS84_ECEF]:null},[fe.LON_LAT]:{[fe.CGCS2000]:Ai,[fe.GCSMARS2000]:Ai,[fe.GCSMOON2000]:Ai,[fe.LON_LAT]:Ai,[fe.WGS84_COMPARABLE_LON_LAT]:Ai,[fe.SPHERICAL_ECEF]:qp,[fe.SPHERICAL_MARS_PCPF]:YA,[fe.SPHERICAL_MOON_PCPF]:KA,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:kg,[fe.PLATE_CARREE]:qh,[fe.WGS84]:Ai,[fe.WGS84_ECEF]:Zh},[fe.WGS84_COMPARABLE_LON_LAT]:{[fe.CGCS2000]:null,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:null,[fe.LON_LAT]:Ai,[fe.WGS84_COMPARABLE_LON_LAT]:Ai,[fe.SPHERICAL_ECEF]:qp,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:null,[fe.PLATE_CARREE]:qh,[fe.WGS84]:Ai,[fe.WGS84_ECEF]:Zh},[fe.PLATE_CARREE]:{[fe.CGCS2000]:Hh,[fe.GCSMARS2000]:null,[fe.GCSMOON2000]:null,[fe.LON_LAT]:Hh,[fe.WGS84_COMPARABLE_LON_LAT]:Hh,[fe.SPHERICAL_ECEF]:$W,[fe.SPHERICAL_MARS_PCPF]:null,[fe.SPHERICAL_MOON_PCPF]:null,[fe.UNKNOWN]:null,[fe.WEB_MERCATOR]:OW,[fe.PLATE_CARREE]:Ai,[fe.WGS84]:Hh,[fe.WGS84_ECEF]:LW}};function MW(e){const t=bS(e,jW);return k4[t][fe.WGS84_COMPARABLE_LON_LAT]}function A4(e,t,i=P4()){return e==null||t==null?null:BW(e,t,i).projector}function bS(e,t){return e?t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=xd(e,1)),x1(e)?t.spatialReferenceId=fe.SPHERICAL_ECEF:bg(e)?t.spatialReferenceId=fe.WGS84:cd(e)?t.spatialReferenceId=fe.WEB_MERCATOR:Sj(e)?t.spatialReferenceId=fe.PLATE_CARREE:e.wkt===Ej.wkt?t.spatialReferenceId=fe.WGS84_ECEF:e.wkid===ld.CGCS2000?t.spatialReferenceId=fe.CGCS2000:e.wkt===WM.wkt?t.spatialReferenceId=fe.SPHERICAL_MARS_PCPF:e.wkt===ZM.wkt?t.spatialReferenceId=fe.SPHERICAL_MOON_PCPF:ZO(e)?t.spatialReferenceId=fe.GCSMARS2000:JO(e)?t.spatialReferenceId=fe.GCSMOON2000:t.spatialReferenceId=fe.UNKNOWN):fe.UNKNOWN}function Ai(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function tg(e,t,i,r){i[r]=_f*(e[t]/id),i[r+1]=_f*($4-2*Math.atan(Math.exp(-e[t+1]/id))),i[r+2]=e[t+2]}function IW(e,t,i,r){const s=e[t]/id,a=$4-2*Math.atan(Math.exp(-e[t+1]/id)),u=id+e[t+2],l=Math.cos(a)*u;i[r]=Math.cos(s)*l,i[r+1]=Math.sin(s)*l,i[r+2]=Math.sin(a)*u}function EW(e,t,i,r){tg(e,t,i,r),Zh(i,r,i,r)}function kW(e,t,i,r,s){const a=.4999999*$b,u=Va(gf*e[t+1],-a,a),l=Math.sin(u);i[r++]=gf*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+l)/(1-l)),i[r]=e[t+2]}function kg(e,t,i,r){kW(e,t,i,r,gr)}function qh(e,t,i,r){i[r]=e[t]*eP,i[r+1]=e[t+1]*eP,i[r+2]=e[t+2]}function Hh(e,t,i,r){i[r]=e[t]*tP,i[r+1]=e[t+1]*tP,i[r+2]=e[t+2]}function AW(e,t,i,r){tg(e,t,i,r),qh(i,r,i,r)}function PW(e,t,i,r){Jh(e,t,i,r),qh(i,r,i,r)}function CW(e,t,i,r){Wh(e,t,i,r),qh(i,r,i,r)}function $W(e,t,i,r){Hh(e,t,i,r),qp(i,r,i,r)}function OW(e,t,i,r){Hh(e,t,i,r),kg(i,r,i,r)}function LW(e,t,i,r){Hh(e,t,i,r),Zh(i,r,i,r)}function II(e,t,i,r,s){const a=s+e[t+2],u=gf*e[t+1],l=gf*e[t],y=Math.cos(u)*a;i[r]=Math.cos(l)*y,i[r+1]=Math.sin(l)*y,i[r+2]=Math.sin(u)*a}function KA(e,t,i,r){II(e,t,i,r,yu.radius)}function YA(e,t,i,r){II(e,t,i,r,Na.radius)}function qp(e,t,i,r){II(e,t,i,r,gr.radius)}function EI(e,t,i,r,s){const a=e[t],u=e[t+1],l=e[t+2],y=Math.sqrt(a*a+u*u+l*l),w=OL(l/(y===0?1:y)),I=Math.atan2(u,a);i[r++]=_f*I,i[r++]=_f*w,i[r]=y-s}function XA(e,t,i,r){EI(e,t,i,r,yu.radius)}function QA(e,t,i,r){EI(e,t,i,r,Na.radius)}function Wh(e,t,i,r){EI(e,t,i,r,gr.radius)}function RW(e,t,i,r){Wh(e,t,i,r),kg(i,r,i,r)}function DW(e,t,i,r){Wh(e,t,i,r),Zh(i,r,i,r)}function zW(e,t,i,r,s){const a=gf*e[t],u=gf*e[t+1],l=e[t+2],y=Math.sin(u),w=Math.cos(u),I=s.radius/Math.sqrt(1-s.eccentricitySquared*y*y);i[r++]=(I+l)*w*Math.cos(a),i[r++]=(I+l)*w*Math.sin(a),i[r++]=(I*(1-s.eccentricitySquared)+l)*y}function Zh(e,t,i,r){zW(e,t,i,r,gr)}function Jh(e,t,i,r){const s=TW,a=e[t],u=e[t+1],l=e[t+2];let y,w,I,E,A,R,G,K,Y,ae,Te,_e,be,ke,Ae,Ve,Ze,lt,ct,ut,nt;y=Math.abs(l),w=a*a+u*u,I=Math.sqrt(w),E=w+l*l,A=Math.sqrt(E),ut=Math.atan2(u,a),R=l*l/E,G=w/E,ke=s.a2/A,Ae=s.a3-s.a4/A,G>.3?(K=y/A*(1+G*(s.a1+ke+R*Ae)/A),ct=Math.asin(K),ae=K*K,Y=Math.sqrt(1-ae)):(Y=I/A*(1-R*(s.a5-ke-G*Ae)/A),ct=Math.acos(Y),ae=1-Y*Y,K=Math.sqrt(ae)),Te=1-gr.eccentricitySquared*ae,_e=gr.radius/Math.sqrt(Te),be=s.a6*_e,ke=I-_e*Y,Ae=y-be*K,Ze=Y*ke+K*Ae,Ve=Y*Ae-K*ke,lt=Ve/(be/Te+Ze),ct+=lt,nt=Ze+Ve*lt/2,l<0&&(ct=-ct),i[r++]=_f*ut,i[r++]=_f*ct,i[r]=nt}function NW(e,t,i,r){Jh(e,t,i,r),qp(i,r,i,r)}function FW(e,t,i,r){Jh(e,t,i,r),kg(i,r,i,r)}function BW(e,t,i){if(e==null||t==null||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=bS(e,i.source),s=bS(t,i.dest);return r===fe.UNKNOWN&&s===fe.UNKNOWN?ds(e,t)?i.projector=Ai:i.projector=null:i.projector=k4[r][s],i}function P4(){return{source:{spatialReference:null,spatialReferenceId:fe.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:fe.UNKNOWN,metersPerUnit:1},projector:Ai}}const jW={spatialReference:null,spatialReferenceId:fe.UNKNOWN},qae={spatialReference:null,spatialReferenceId:fe.UNKNOWN},C4=P4(),gf=CL(1),_f=$L(1),$b=Math.PI,$4=.5*$b,id=gr.radius,eP=id*$b/180,tP=180/(id*$b);function Xg(e,t,i,r,s,a,u=1){const l=A4(t,s,C4);if(l==null)return!1;if(l===Ai){if(e===r&&i===a)return!0;const w=i+3*u;for(let I=i,E=a;I<w;I++,E++)r[E]=e[I];return!0}const y=i+3*u;for(let w=i,I=a;w<y;w+=3,I+=3)l(e,w,r,I);return!0}const Hae=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Xg},Symbol.toStringTag,{value:"Module"}));function iP(e,t,i,r,s,a){return B_[0]=e,B_[1]=t,B_[2]=i,Xg(B_,r,0,s,a,0,1)}const B_=Eu();let j_=0,$x=class wS{static fromGE(t){const i=new wS;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}constructor(t){this.uid=j_++,t?(this._wkt=t.wkt!=null?t.wkt:null,this._wkid=t.wkid!=null?t.wkid:-1,this._isInverse=t.isInverse!=null&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=j_++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=j_++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=j_++}getInverse(){const t=new wS;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}},O1=class fy{static cacheKey(t,i){var r,s,a,u,l,y;return[((r=t.wkid)==null?void 0:r.toString())??"-1",((s=t.wkt)==null?void 0:s.toString())??"",((a=t.wkt2)==null?void 0:a.toString())??"",((u=i.wkid)==null?void 0:u.toString())??"-1",((l=i.wkt)==null?void 0:l.toString())??"",((y=i.wkt2)==null?void 0:y.toString())??""].join()}static fromGE(t){const i=new fy;let r="";for(const s of t.steps){const a=$x.fromGE(s);i.steps.push(a),r+=a.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(t){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,t==null?void 0:t.steps)for(const i of t.steps)i instanceof $x?this.steps.push(i):this.steps.push(new $x({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const t=new fy;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cachedProjection[fy.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const a of this.steps)r+=a.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[fy.cacheKey(t,i)];return s===void 0?null:s}};function VW(e,t,i){if(t==null||i==null||i.vcsWkid||ds(t,i)||gu(t)||gu(i))return null;const r=zk(t)/zk(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>UW(s,r);case"polyline":case"esriGeometryPolyline":return s=>qW(s,r);case"polygon":case"esriGeometryPolygon":return s=>GW(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>HW(s,r);case"extent":case"esriGeometryEnvelope":return s=>WW(s,r);default:return null}}function UW(e,t){(e==null?void 0:e.z)!=null&&(e.z*=t)}function GW(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function qW(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function HW(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function WW(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let Qo=null,wu=null,ig=null,bv={};const kI=new qg;function ku(){return!!Qo&&GM()}function O4(){return!!ku()||(Tt(kI),xu(),!1)}function L4(e,t){return!e||!t||Ga(e,t)||O4()}function ZW(e,t){return!Ga(e,t)&&!ku()}function xu(e){return ig==null&&(ig=Promise.all([VO(),it(()=>import("./geometryEngineBase-D5BHqdKx.js"),[]).then(t=>t.g),it(()=>import("./hydrated-bK5EzXB5.js"),[])])),ig.then(([,t,{hydratedAdapter:i}])=>{mr(e),wu=i,Qo=t.default,Qo._enableProjection(vj),kI.notify()})}function Td(e,t,i=null,r=null){return Array.isArray(e)?e.length===0?[]:xS(wu,e,e[0].spatialReference,t,i,r):xS(wu,[e],e.spatialReference,t,i,r)[0]}function xS(e,t,i,r,s=null,a=null){if(i==null||r==null)return t;if(Ga(i,r,s))return t.map(u=>wv(u,i,r));if(s==null&&x1(i))return t.map(u=>wv(u,i,si.WGS84)).map(u=>Ag(u,r));if(s==null&&x1(r))return t.map(u=>Ag(u,si.WGS84)).map(u=>wv(u,si.WGS84,r));if(s==null){const u=O1.cacheKey(i,r);bv[u]!==void 0?s=bv[u]:((s=D4(i,r,void 0))==null&&(s=new O1),bv[u]=s)}if(Qo==null||e==null)throw new Ob;return a!=null?Qo._project(e,t,i,r,s,a):Qo._project(e,t,i,r,s)}function JW(e,t){const i=R4([e],t);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function R4(e,t){if(!ku()){for(const i of e)if(i!=null&&!ds(i.spatialReference,t)&&Jo(i.spatialReference)&&Jo(t)&&!Ga(i.spatialReference,t))return Tt(kI),{pending:xu(),geometries:null}}return{pending:null,geometries:e.map(i=>i==null?null:ds(i.spatialReference,t)?i:Jo(i.spatialReference)&&Jo(t)?Ag(i,t):null)}}function D4(e,t,i=null){if(e==null||t==null)return null;if(Qo==null||wu==null)throw new Ob;const r=Qo._getTransformation(wu,e,t,i,i==null?void 0:i.spatialReference);return r!==null?O1.fromGE(r):null}function KW(e,t,i=null){if(Qo==null||wu==null)throw new Ob;const r=Qo._getTransformationBySuitability(wu,e,t,i,i==null?void 0:i.spatialReference);if(r!==null){const s=[];for(const a of r)s.push(O1.fromGE(a));return s}return[]}let Ob=class extends gt{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function YW(){Qo=null,wu=null,ig=null,bv={}}const XW={get loadPromise(){return ig}};function Ag(e,t){try{const i=Td(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=VW(i.type,e.spatialReference,t);return r!=null&&r(i),i}catch(i){if(!(i instanceof Ob))throw i;return null}}async function QW(e,t,i){const r=e.spatialReference;return r!=null&&t!=null&&await z4(r,t,null,i),Ag(e,t)}function Ga(e,t,i){return!i&&(!!ds(e,t)||Jo(e)&&Jo(t)&&!!A4(e,t,C4))}async function z4(e,t,i,r){if(ku())return yk(r);if(Array.isArray(e)){for(const{source:s,dest:a,geographicTransformation:u}of e)if(s&&a&&!Ga(s,a,u))return xu(r)}else if(e&&t&&!Ga(e,t,i))return xu(r);return yk(r)}function wv(e,t,i){return e?"x"in e?N4(e,t,new Ht,i,0):"xmin"in e?V4(e,t,new tr,i,0):"rings"in e?j4(e,t,new vu,i,0):"paths"in e?B4(e,t,new Ko,i,0):"points"in e?F4(e,t,new Sb,i,0):null:null}function eZ(e,t,i=t.spatialReference,r=0){return i!=null&&e.spatialReference!=null&&N4(e,e.spatialReference,t,i,r)!=null}function N4(e,t,i,r,s){$s[0]=e.x,$s[1]=e.y;const a=e.z;return $s[2]=a!==void 0?a:s,Xg($s,t,0,$s,r,0,1)?(i.x=$s[0],i.y=$s[1],i.spatialReference=r,a!==void 0||gu(r)?(i.z=$s[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function tZ(e,t,i=t.spatialReference,r=0){return e.spatialReference!=null&&i!=null&&F4(e,e.spatialReference,t,i,r)!=null}function F4(e,t,i,r,s){const{points:a,hasZ:u,hasM:l}=e,y=[],w=a.length,I=[];for(const A of a)I.push(A[0],A[1],u?A[2]:s);if(!Xg(I,t,0,I,r,0,w))return null;const E=u||gu(r);for(let A=0;A<w;++A){const R=3*A,G=I[R],K=I[R+1];E&&l?y.push([G,K,I[R+2],a[A][3]]):E?y.push([G,K,I[R+2]]):l?y.push([G,K,a[A][2]]):y.push([G,K])}return i.points=y,i.spatialReference=r,i.hasZ=u,i.hasM=l,i}function iZ(e,t,i=t.spatialReference,r=0){return e.spatialReference!=null&&i!=null&&B4(e,e.spatialReference,t,i,r)!=null}function B4(e,t,i,r,s){const{paths:a,hasZ:u,hasM:l}=e,y=[];if(!U4(a,u??!1,l??!1,t,y,r,s))return null;const w=u||gu(r);return i.paths=y,i.spatialReference=r,i.hasZ=w,i.hasM=l,i}function rZ(e,t,i=t.spatialReference,r=0){return e.spatialReference!=null&&i!=null&&j4(e,e.spatialReference,t,i,r)!=null}function j4(e,t,i,r,s){const{rings:a,hasZ:u,hasM:l}=e,y=[];if(!U4(a,u??!1,l??!1,t,y,r,s))return null;const w=u||gu(r);return i.rings=y,i.spatialReference=r,i.hasZ=w,i.hasM=l,i}function sZ(e,t,i=t.spatialReference,r=0){return e.spatialReference!=null&&i!=null&&V4(e,e.spatialReference,t,i,r)!=null}function V4(e,t,i,r,s){const{xmin:a,ymin:u,xmax:l,ymax:y,hasZ:w,hasM:I}=e,E=w?e.zmin:s;if(!iP(a,u,E,t,$s,r))return null;const A=w||gu(r);i.xmin=$s[0],i.ymin=$s[1],A&&(i.zmin=$s[2]);const R=w?e.zmax:s;return iP(l,y,R,t,$s,r)?(i.xmax=$s[0],i.ymax=$s[1],A&&(i.zmax=$s[2]),I&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null}function U4(e,t,i,r,s,a,u=0){const l=new Array;for(const I of e)for(const E of I)l.push(E[0],E[1],t?E[2]:u);if(!Xg(l,r,0,l,a,0,l.length/3))return!1;let y=0;s.length=0;const w=t||gu(a);for(const I of e){const E=new Array;for(const A of I)w&&i?E.push([l[y++],l[y++],l[y++],A[3]]):w?E.push([l[y++],l[y++],l[y++]]):i?(E.push([l[y++],l[y++],A[2]]),y++):(E.push([l[y++],l[y++]]),y++);s.push(E)}return!0}function nZ(e){return e!=null&&MW(e)!=null}const $s=Eu(),Zae=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:nZ,canProjectWithoutEngine:Ga,getTransformation:D4,getTransformations:KW,initializeProjection:z4,isLoaded:ku,isLoadedOrLoad:O4,isLoadedOrLoadFor:L4,load:xu,project:Td,projectExtent:sZ,projectMany:xS,projectMultipoint:tZ,projectOrLoad:JW,projectOrLoadMany:R4,projectPoint:eZ,projectPolygon:rZ,projectPolyline:iZ,projectWithZConversion:QW,projectWithoutEngine:wv,requiresLoad:ZW,test:XW,tryProjectWithZConversion:Ag,unload:YW},Symbol.toStringTag,{value:"Module"}));var SS;let Sa=SS=class extends wt{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new SS({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};v([M({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Sa.prototype,"cols",void 0),v([M({type:ar,json:{write:!0}})],Sa.prototype,"level",void 0),v([M({type:String,json:{write:!0}})],Sa.prototype,"levelValue",void 0),v([M({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Sa.prototype,"origin",void 0),v([M({type:Number,json:{write:!0}})],Sa.prototype,"resolution",void 0),v([M({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Sa.prototype,"rows",void 0),v([M({type:Number,json:{write:!0}})],Sa.prototype,"scale",void 0),Sa=SS=v([me("esri.layers.support.LOD")],Sa);const ru=Sa;let oZ=class{constructor(t,i,r,s,a=void 0){this.id=t,this.level=i,this.row=r,this.col=s,this.extent=a}};var Dc;const rP=new hs({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let cs=Dc=class extends wt{static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=si.WebMercator,numLODs:a=24}=e;if(!Jo(s)){const E=[];if(i)for(let A=0;A<i.length;A++){const R=i[A];E.push(new ru({level:A,scale:R,resolution:R}))}else{let A=5e-4;for(let R=a-1;R>=0;R--)E.unshift(new ru({level:R,scale:A,resolution:A})),A*=2}return new Dc({dpi:96,lods:E,origin:new Ht(0,0,s),size:[r,r],spatialReference:s})}const u=Mn(s),l=e.origin?new Ht({x:e.origin.x,y:e.origin.y,spatialReference:s}):new Ht(u?{x:u.origin[0],y:u.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),y=96,w=1/(xd(s)*39.37*y),I=[];if(i)for(let E=0;E<i.length;E++){const A=i[E],R=A*w;I.push(new ru({level:E,scale:A,resolution:R}))}else{let E=qM(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const A=Math.ceil(a/t);I.push(new ru({level:0,scale:E,resolution:E*w}));for(let R=1;R<A;R++){const G=E/2**t,K=G*w;I.push(new ru({level:R,scale:G,resolution:K})),E=G}}return new Dc({dpi:y,lods:I,origin:l,size:[r,r],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=Mn(e);return e.isWrappable&&!!i&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return Ht.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,i=0;const r=[],s=this._levelToLOD={};e&&(t=-1/0,i=1/0,e.forEach(a=>{r.push(a.scale),t=a.scale>t?a.scale:t,i=a.scale<i?a.scale:i,s[a.level]=a})),this._set("scales",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],a=t[r+1];if(s<=e)return r;if(a===e)return r+1;if(s>e&&a<e)return r+Math.log(s/e)/Math.log(s/a)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let a,u;if(typeof t=="number")a=t,u=i;else if(ds(t.spatialReference,this.spatialReference))a=t.x,u=t.y,r=i;else{const w=gb(t,this.spatialReference);if(w==null)return null;a=w.x,u=w.y,r=i}const l=s.resolution*this.size[0],y=s.resolution*this.size[1];return r||(r=new oZ(null,0,0,0,Sn())),r.level=e,r.row=Math.floor((this.origin.y-u)/y+.001),r.col=Math.floor((a-this.origin.x)/l+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=Dc.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===Dc.ExtrapolateOptions.POWER_OF_TWO){const u=this.lods[this.lods.length-1];u.level<e.level&&(i=u)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,a=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Sn()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*a,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+a}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const i=this.lodAt(t.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],a=r*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*a,e[2]=e[0]+s,e[3]=e[1]+a,e}lodAt(e){var t;return((t=this._levelToLOD)==null?void 0:t[e])??null}clone(){return Dc.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const a=this.lods[s],u=a.resolution*t;i.push(new ru({level:a.level,scale:a.scale,resolution:u}))}return new Dc({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};v([M({type:Number,json:{write:!0}})],cs.prototype,"compressionQuality",void 0),v([M({type:Number,json:{write:!0}})],cs.prototype,"dpi",void 0),v([M({type:String,json:{read:rP.read,write:rP.write,origins:{"web-scene":{read:!1,write:!1}}}})],cs.prototype,"format",void 0),v([M({readOnly:!0})],cs.prototype,"isWrappable",null),v([M({type:Ht,json:{write:!0}})],cs.prototype,"origin",void 0),v([yi("origin")],cs.prototype,"readOrigin",null),v([M({type:[ru],value:null,json:{write:!0}})],cs.prototype,"lods",null),v([M({readOnly:!0})],cs.prototype,"scales",void 0),v([M({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],cs.prototype,"size",void 0),v([yi("size",["rows","cols"])],cs.prototype,"readSize",null),v([ni("size",{cols:{type:ar},rows:{type:ar}})],cs.prototype,"writeSize",null),v([M({type:si,json:{write:!0}})],cs.prototype,"spatialReference",void 0),cs=Dc=v([me("esri.layers.support.TileInfo")],cs),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(cs||(cs={}));const aZ=cs,xv={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Ox={xsmall:544,small:768,medium:992,large:1200};function lZ(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function Lx(e,t){return t?xv[e].valueToClassName[t].split(" "):[]}const cZ=e=>{let t=class extends e{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Ox}initialize(){this.addHandles(qt(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),on))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=lZ(i);if(!r){const s=JSON.stringify(Ox,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:Ox,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=tn.acquire(),r=tn.acquire();let s,a=!1;for(s in xv){const u=this[s],l=xv[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});u!==l&&(a=!0,this[s]=l,Lx(s,u).forEach(y=>r.push(y)),Lx(s,l).forEach(y=>i.push(y)))}a&&(this._applyClassNameChanges(i,r),tn.release(i),tn.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(a=>s.classList.remove(a)),i.forEach(a=>s.classList.add(a)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in xv)Lx(r,this[r]).forEach(s=>i.classList.remove(s))}};return v([M()],t.prototype,"breakpoints",null),v([M()],t.prototype,"orientation",void 0),v([M()],t.prototype,"widthBreakpoint",void 0),v([M()],t.prototype,"heightBreakpoint",void 0),t=v([me("esri.views.BreakpointsOwner")],t),t};function AI(e){return typeof e=="string"?document.getElementById(e):e??null}function G4(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function sP(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function nP(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}let rd=class extends Pt{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(t,i,r={}){return this._installWatch(t,i,r,qt)}addWhen(t,i,r={}){return this._installWatch(t,i,r,md)}addOnCollectionChange(t,i,{initial:r=!1,final:s=!1}={}){const a=++this._handleId;return this.addHandles([yd(t,"after-changes",this._createSyncUpdatingCallback(),gd),yd(t,"change",i,{onListenerAdd:r?u=>i({added:u.toArray(),removed:[]}):void 0,onListenerRemove:s?u=>i({added:[],removed:u.toArray()}):void 0})],a),Ni(()=>this.removeHandles(a))}addPromise(t){if(t==null)return t;const i=++this._handleId;this.addHandles(Ni(()=>{this._pendingPromises.delete(t)&&(this._pendingPromises.size!==0||this.hasHandles(V_)||this._set("updating",!1))}),i),this._pendingPromises.add(t),this._set("updating",!0);const r=()=>this.removeHandles(i);return t.then(r,r),t}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(t,i,r={},s){const a=++this._handleId;r.sync||this._installSyncUpdatingWatch(t,a);const u=s(t,i,r);return this.addHandles(u,a),Ni(()=>this.removeHandles(a))}_installSyncUpdatingWatch(t,i){const r=this._createSyncUpdatingCallback(),s=qt(t,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(V_),++this._scheduleHandleId;const t=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(Ug(()=>{t===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(V_))}),V_)}}};v([M({readOnly:!0})],rd.prototype,"updating",void 0),rd=v([me("esri.core.support.UpdatingHandles")],rd);const V_=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var uZ=function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},zh={exports:{}},lr={},Pg={exports:{}},Md={};function q4(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function hZ(e,t,i){}function dZ(e,t,i){}var pZ=/javascript\s*\:/img;function fZ(e,t){return pZ.test(t)?"":t}Md.whiteList=q4();Md.getDefaultWhiteList=q4;Md.onAttr=hZ;Md.onIgnoreAttr=dZ;Md.safeAttrValue=fZ;var mZ={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},ty=mZ;function yZ(e,t){e=ty.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,a=0,u="";function l(){if(!r){var I=ty.trim(e.slice(s,a)),E=I.indexOf(":");if(E!==-1){var A=ty.trim(I.slice(0,E)),R=ty.trim(I.slice(E+1));if(A){var G=t(s,u.length,A,R,I);G&&(u+=G+"; ")}}}s=a+1}for(;a<i;a++){var y=e[a];if(y==="/"&&e[a+1]==="*"){var w=e.indexOf("*/",a+2);if(w===-1)break;a=w+1,s=a+1,r=!1}else y==="("?r=!0:y===")"?r=!1:y===";"?r||l():y===`
`&&l()}return ty.trim(u)}var gZ=yZ,U_=Md,_Z=gZ;function oP(e){return e==null}function vZ(e){var t={};for(var i in e)t[i]=e[i];return t}function H4(e){e=vZ(e||{}),e.whiteList=e.whiteList||U_.whiteList,e.onAttr=e.onAttr||U_.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||U_.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||U_.safeAttrValue,this.options=e}H4.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,a=i.onIgnoreAttr,u=i.safeAttrValue,l=_Z(e,function(y,w,I,E,A){var R=r[I],G=!1;if(R===!0?G=R:typeof R=="function"?G=R(E):R instanceof RegExp&&(G=R.test(E)),G!==!0&&(G=!1),E=u(I,E),!!E){var K={position:w,sourcePosition:y,source:A,isWhite:G};if(G){var Y=s(I,E,K);return oP(Y)?I+":"+E:Y}else{var Y=a(I,E,K);if(!oP(Y))return Y}}});return l};var bZ=H4;(function(e,t){var i=Md,r=bZ;function s(u,l){var y=new r(l);return y.process(u)}t=e.exports=s,t.FilterCSS=r;for(var a in i)t[a]=i[a]})(Pg,Pg.exports);var PI={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},wZ=Pg.exports.FilterCSS,xZ=Pg.exports.getDefaultWhiteList,L1=PI;function W4(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Z4=new wZ;function SZ(e,t,i){}function TZ(e,t,i){}function MZ(e,t,i){}function IZ(e,t,i){}function J4(e){return e.replace(kZ,"&lt;").replace(AZ,"&gt;")}function EZ(e,t,i,r){if(i=tR(i),t==="href"||t==="src"){if(i=L1.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(G_.lastIndex=0,G_.test(i))return""}else if(t==="style"){if(aP.lastIndex=0,aP.test(i)||(lP.lastIndex=0,lP.test(i)&&(G_.lastIndex=0,G_.test(i))))return"";r!==!1&&(r=r||Z4,i=r.process(i))}return i=iR(i),i}var kZ=/</g,AZ=/>/g,PZ=/"/g,CZ=/&quot;/g,$Z=/&#([a-zA-Z0-9]*);?/gim,OZ=/&colon;?/gim,LZ=/&newline;?/gim,G_=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,aP=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,lP=/u\s*r\s*l\s*\(.*/gi;function K4(e){return e.replace(PZ,"&quot;")}function Y4(e){return e.replace(CZ,'"')}function X4(e){return e.replace($Z,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Q4(e){return e.replace(OZ,":").replace(LZ," ")}function eR(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return L1.trim(t)}function tR(e){return e=Y4(e),e=X4(e),e=Q4(e),e=eR(e),e}function iR(e){return e=K4(e),e=J4(e),e}function RZ(){return""}function DZ(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(u){return i?!0:L1.indexOf(e,u)!==-1}var s=[],a=!1;return{onIgnoreTag:function(u,l,y){if(r(u))if(y.isClosing){var w="[/removed]",I=y.position+w.length;return s.push([a!==!1?a:y.position,I]),a=!1,w}else return a||(a=y.position),"[removed]";else return t(u,l,y)},remove:function(u){var l="",y=0;return L1.forEach(s,function(w){l+=u.slice(y,w[0]),y=w[1]}),l+=u.slice(y),l}}}function zZ(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function NZ(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}lr.whiteList=W4();lr.getDefaultWhiteList=W4;lr.onTag=SZ;lr.onIgnoreTag=TZ;lr.onTagAttr=MZ;lr.onIgnoreTagAttr=IZ;lr.safeAttrValue=EZ;lr.escapeHtml=J4;lr.escapeQuote=K4;lr.unescapeQuote=Y4;lr.escapeHtmlEntities=X4;lr.escapeDangerHtml5Entities=Q4;lr.clearNonPrintableCharacter=eR;lr.friendlyAttrValue=tR;lr.escapeAttrValue=iR;lr.onIgnoreTagStripAll=RZ;lr.StripTagBody=DZ;lr.stripCommentTag=zZ;lr.stripBlankChar=NZ;lr.cssFilter=Z4;lr.getDefaultCSSWhiteList=xZ;var Lb={},su=PI;function FZ(e){var t=su.spaceIndex(e),i;return t===-1?i=e.slice(1,-1):i=e.slice(1,t+1),i=su.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function BZ(e){return e.slice(0,2)==="</"}function jZ(e,t,i){var r="",s=0,a=!1,u=!1,l=0,y=e.length,w="",I="";e:for(l=0;l<y;l++){var E=e.charAt(l);if(a===!1){if(E==="<"){a=l;continue}}else if(u===!1){if(E==="<"){r+=i(e.slice(s,l)),a=l,s=l;continue}if(E===">"){r+=i(e.slice(s,a)),I=e.slice(a,l+1),w=FZ(I),r+=t(a,r.length,w,I,BZ(I)),s=l+1,a=!1;continue}if(E==='"'||E==="'")for(var A=1,R=e.charAt(l-A);R.trim()===""||R==="=";){if(R==="="){u=E;continue e}R=e.charAt(l-++A)}}else if(E===u){u=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var VZ=/[^a-zA-Z0-9\\_:.-]/gim;function UZ(e,t){var i=0,r=0,s=[],a=!1,u=e.length;function l(A,R){if(A=su.trim(A),A=A.replace(VZ,"").toLowerCase(),!(A.length<1)){var G=t(A,R||"");G&&s.push(G)}}for(var y=0;y<u;y++){var w=e.charAt(y),I,E;if(a===!1&&w==="="){a=e.slice(i,y),i=y+1,r=e.charAt(i)==='"'||e.charAt(i)==="'"?i:qZ(e,y+1);continue}if(a!==!1&&y===r){if(E=e.indexOf(w,y+1),E===-1)break;I=su.trim(e.slice(r+1,E)),l(a,I),a=!1,y=E,i=y+1;continue}if(/\s|\n|\t/.test(w))if(e=e.replace(/\s|\n|\t/g," "),a===!1)if(E=GZ(e,y),E===-1){I=su.trim(e.slice(i,y)),l(I),a=!1,i=y+1;continue}else{y=E-1;continue}else if(E=HZ(e,y-1),E===-1){I=su.trim(e.slice(i,y)),I=cP(I),l(a,I),a=!1,i=y+1;continue}else continue}return i<e.length&&(a===!1?l(e.slice(i)):l(a,cP(su.trim(e.slice(i))))),su.trim(s.join(" "))}function GZ(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function qZ(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="'"||i==='"'?t:-1}}function HZ(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function WZ(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function cP(e){return WZ(e)?e.substr(1,e.length-2):e}Lb.parseTag=jZ;Lb.parseAttr=UZ;var ZZ=Pg.exports.FilterCSS,Go=lr,rR=Lb,JZ=rR.parseTag,KZ=rR.parseAttr,Sv=PI;function q_(e){return e==null}function YZ(e){var t=Sv.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=Sv.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=Sv.trim(e.slice(0,-1))),{html:e,closing:i}}function XZ(e){var t={};for(var i in e)t[i]=e[i];return t}function QZ(e){var t={};for(var i in e)Array.isArray(e[i])?t[i.toLowerCase()]=e[i].map(function(r){return r.toLowerCase()}):t[i.toLowerCase()]=e[i];return t}function sR(e){e=XZ(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Go.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=QZ(e.whiteList||e.allowList):e.whiteList=Go.whiteList,e.onTag=e.onTag||Go.onTag,e.onTagAttr=e.onTagAttr||Go.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Go.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Go.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Go.safeAttrValue,e.escapeHtml=e.escapeHtml||Go.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new ZZ(e.css))}sR.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,a=i.onIgnoreTag,u=i.onTagAttr,l=i.onIgnoreTagAttr,y=i.safeAttrValue,w=i.escapeHtml,I=t.cssFilter;i.stripBlankChar&&(e=Go.stripBlankChar(e)),i.allowCommentTag||(e=Go.stripCommentTag(e));var E=!1;i.stripIgnoreTagBody&&(E=Go.StripTagBody(i.stripIgnoreTagBody,a),a=E.onIgnoreTag);var A=JZ(e,function(R,G,K,Y,ae){var Te={sourcePosition:R,position:G,isClosing:ae,isWhite:Object.prototype.hasOwnProperty.call(r,K)},_e=s(K,Y,Te);if(!q_(_e))return _e;if(Te.isWhite){if(Te.isClosing)return"</"+K+">";var be=YZ(Y),ke=r[K],Ae=KZ(be.html,function(Ve,Ze){var lt=Sv.indexOf(ke,Ve)!==-1,ct=u(K,Ve,Ze,lt);return q_(ct)?lt?(Ze=y(K,Ve,Ze,I),Ze?Ve+'="'+Ze+'"':Ve):(ct=l(K,Ve,Ze,lt),q_(ct)?void 0:ct):ct});return Y="<"+K,Ae&&(Y+=" "+Ae),be.closing&&(Y+=" /"),Y+=">",Y}else return _e=a(K,Y,Te),q_(_e)?w(Y):_e},w);return E&&(A=E.remove(A)),A};var eJ=sR;(function(e,t){var i=lr,r=Lb,s=eJ;function a(l,y){var w=new s(y);return w.process(l)}t=e.exports=a,t.filterXSS=a,t.FilterXSS=s,function(){for(var l in i)t[l]=i[l];for(var y in r)t[y]=r[y]}();function u(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}u()&&(self.filterXSS=e.exports)})(zh,zh.exports);var tJ=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(a,u,l,y){return a==="a"&&u==="href"||(a==="img"||a==="source")&&u==="src"?r.sanitizeUrl(l):zh.exports.safeAttrValue(a,u,l,y)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(a){a==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[a]=t[a]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new zh.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t>"u"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,a=this._trim(t.substring(0,t.indexOf(":"))),u=t==="/",l=/^#/.test(t),y=a&&this.allowedProtocols.indexOf(a.toLowerCase())>-1;return u||l||y?zh.exports.escapeAttrValue(t):!a&&!s?zh.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):zh.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype.encodeHTML=function(t){var i=this;return String(t).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},e.prototype.encodeAttrValue=function(t){var i=/^[a-zA-Z0-9]$/;return String(t).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(t.charCodeAt(s)).toString(16),";")})},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,a=void 0;if(Array.isArray(t))a=t.reduce(function(l,y){var w=r.validate(y,i);return w.isValid?l.concat([y]):(s=!0,l.concat([w.sanitized]))},[]);else if(uZ(t)){var u=Object.keys(t);a=u.reduce(function(l,y){var w=t[y],I=r.validate(w,i);return I.isValid?l[y]=w:(s=!0,l[y]=I.sanitized),l},{})}else return i.allowUndefined&&typeof t>"u"?void 0:null;return s?a:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const Rb=new Map;function nR(){Rb.clear()}function iJ(e){return Rb.get(e)}function rJ(e,t){Rb.set(e,t)}function Rx(e){Rb.delete(e)}const sJ=()=>pt.getLogger("esri.widgets.support.widgetUtils");function nJ(...e){const t=tn.acquire();for(let r=0;r<e.length;r++){const s=e[r],a=typeof s;if(a==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(a==="object")for(const u in s)s[u]&&t.push(u)}const i=t.join(" ");return tn.release(t),i}(()=>{const e=new Map,t=new ResizeObserver(r=>{var s;nR();for(const a of r)(s=e.get(a.target))==null||s(a)}),i=(r,s,a)=>(e.has(r)&&sJ().error("Already observing element",r),e.set(r,s),t.observe(r,a),Ni(()=>{t.unobserve(r),e.delete(r)}));return(r,s,a)=>{let u=null;return Fg([qt(()=>typeof r=="function"?r():r,l=>{u==null||u.remove(),l&&(u=i(l,s,a))},Zo),Ni(()=>u==null?void 0:u.remove())])}})();function oJ(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function Yae(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function Xae(e){const t="data-node-ref";this[e.getAttribute(t)]=e}const aJ=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],lJ=aJ.reduce((e,t)=>(e[t]=[],e),{}),cJ=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],oR=new tJ({whiteList:lJ,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(cJ.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function uJ(e){return e==="Enter"||e===" "}const aR="http://www.w3.org/",Db=`${aR}2000/svg`,lR=`${aR}1999/xlink`;let uP=[],CI=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},$I=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),cR=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},hJ=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if($I(e[r],t))return r}return-1},Dx=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let a=s.properties;if(!(a&&(a.key===void 0?a.bind:a.key))){for(let u=0;u<e.length;u++)if(u!==t){let l=e[u];if($I(l,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},dJ=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},TS=[],MS=!1,uR=e=>{(e.children||[]).forEach(uR),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},hP=()=>{MS=!1,TS.forEach(uR),TS.length=0},dP=e=>{TS.push(e),MS||(MS=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(hP,{timeout:16}):setTimeout(hP,16))},pP=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),dP(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),dP(e))},pJ=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),a=s.length;for(let u=0;u<a;u++){let l=s[u],y=t[l];if(l==="className")throw new Error('Property "className" is not supported, use "class".');if(l==="class")ES(e,y,!0);else if(l==="classes"){let w=Object.keys(y),I=w.length;for(let E=0;E<I;E++){let A=w[E];y[A]&&e.classList.add(A)}}else if(l==="styles"){let w=Object.keys(y),I=w.length;for(let E=0;E<I;E++){let A=w[E],R=y[A];R&&(cR(R),i.styleApplyer(e,A,R))}}else if(l!=="key"&&y!=null){let w=typeof y;w==="function"?(l.lastIndexOf("on",0)===0&&(r&&(y=r(l,y,e,t)),l==="oninput"&&function(){let I=y;y=function(E){I.apply(this,[E]),E.target["oninput-value"]=E.target.value}}()),e[l]=y):i.namespace===Db?l==="href"?e.setAttributeNS(lR,l,y):e.setAttribute(l,y):w==="string"&&l!=="value"?l==="innerHTML"?e[l]=oR.sanitize(y):IS(e)&&l in e?e[l]=y:e.setAttribute(l,y):e[l]=y}}};function IS(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let R1,fJ=(e,t,i)=>{if(t)for(let r of t)Hp(r,e,void 0,i)},hR=(e,t,i)=>{fJ(e,t.children,i),t.text&&(e.textContent=t.text),pJ(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},Hp=(e,t,i,r)=>{let s,a=0,u=e.vnodeSelector,l=t.ownerDocument;if(u==="")s=e.domNode=l.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let y=0;y<=u.length;++y){let w=u.charAt(y);if(y===u.length||w==="."||w==="#"){let I=u.charAt(a-1),E=u.slice(a,y);I==="."?s.classList.add(E):I==="#"?s.id=E:(E==="svg"&&(r=CI(r,{namespace:Db})),r.namespace!==void 0?s=e.domNode=l.createElementNS(r.namespace,E):(s=e.domNode=e.domNode||l.createElement(E),E==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),a=y+1}}hR(s,e,r)}},ES=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},mJ=(e,t,i,r)=>{if(!i)return;let s=!1,a=Object.keys(i),u=a.length;for(let l=0;l<u;l++){let y=a[l],w=i[y],I=t[y];if(y==="class")I!==w&&(ES(e,I,!1),ES(e,w,!0));else if(y==="classes"){let E=e.classList,A=Object.keys(w),R=A.length;for(let G=0;G<R;G++){let K=A[G],Y=!!w[K];Y!==!!I[K]&&(s=!0,Y?E.add(K):E.remove(K))}}else if(y==="styles"){let E=Object.keys(w),A=E.length;for(let R=0;R<A;R++){let G=E[R],K=w[G];K!==I[G]&&(s=!0,K?(cR(K),r.styleApplyer(e,G,K)):r.styleApplyer(e,G,""))}}else if(w||typeof I!="string"||(w=""),y!=="value"||IS(e)){if(w!==I){let E=typeof w;E==="function"&&r.eventHandlerInterceptor||(r.namespace===Db?y==="href"?e.setAttributeNS(lR,y,w):e.setAttribute(y,w):E==="string"?y==="innerHTML"?e[y]=oR.sanitize(w):y==="role"&&w===""?e.removeAttribute(y):IS(e)&&y in e?e[y]=w:e.setAttribute(y,w):e[y]!==w&&(e[y]=w),s=!0)}}else{let E=e[y];E!==w&&(e["oninput-value"]?E===e["oninput-value"]:w!==I)&&(e[y]=w,e["oninput-value"]=void 0),w!==I&&(s=!0)}}return s},yJ=(e,t,i,r,s)=>{if(i===r)return!1;r=r||uP;let a,u=(i=i||uP).length,l=r.length,y=0,w=0,I=!1;for(;w<l;){let E=y<u?i[y]:void 0,A=r[w];if(E!==void 0&&$I(E,A))I=R1(E,A,s)||I,y++;else{let R=hJ(i,A,y+1);if(R>=0){for(a=y;a<R;a++)pP(i[a]),Dx(i,a,e,"removed");I=R1(i[R],A,s)||I,y=R+1}else Hp(A,t,y<u?i[y].domNode:void 0,s),dJ(A),Dx(r,w,e,"added")}w++}if(u>y)for(a=y;a<u;a++)pP(i[a]),Dx(i,a,e,"removed");return I};R1=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let a=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let u=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(u,r),t.domNode=u,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=CI(i,{namespace:Db})),e.text!==t.text&&(a=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,a=yJ(t,r,e.children,t.children,i)||a,a=mJ(r,e.properties,t.properties,i)||a,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return a&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let iy=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,R1(r,i,t)},domNode:e.domNode});const gJ={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let Tp=e=>CI(gJ,e),hu={create:(e,t)=>(t=Tp(t),Hp(e,document.createElement("div"),void 0,t),iy(e,t)),append:(e,t,i)=>(i=Tp(i),Hp(t,e,void 0,i),iy(t,i)),insertBefore:(e,t,i)=>(i=Tp(i),Hp(t,e.parentNode,e,i),iy(t,i)),merge:(e,t,i)=>(i=Tp(i),t.domNode=e,hR(e,t,i),iy(t,i)),replace:(e,t,i)=>(i=Tp(i),Hp(t,e.parentNode,e,i),e.parentNode.removeChild(e),iy(t,i))},dR,_J=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};dR=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let vJ=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?dR(i.children,s=>s.domNode===r):void 0}),i},bJ=(e,t,i)=>{let r=function(s){i("domEvent",s);let a=t(),u=_J(s.currentTarget,a.domNode);u.reverse();let l,y=vJ(a.getLastRender(),u);return e.scheduleRender(),y&&(l=y.properties[`on${s.type}`].apply(y.properties.bind||this,arguments)),i("domEventProcessed",s),l};return(s,a,u,l)=>r},fP=e=>{let t,i,r=Tp(e),s=r.performanceLogger,a=!0,u=!1,l=[],y=[],w=(E,A,R)=>{let G,K=()=>G;r.eventHandlerInterceptor=bJ(t,K,s),G=E(A,R(),r),l.push(G),y.push(R)},I=()=>{if(i=void 0,a){a=!1,s("renderStart",void 0);for(let E=0;E<l.length;E++){let A=y[E]();s("rendered",void 0),l[E].update(A),s("patched",void 0)}s("renderDone",void 0),a=!0}};return t={renderNow:I,scheduleRender:()=>{i||u||(i=requestAnimationFrame(I))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),u=!0},resume:()=>{u=!1,a=!0,t.scheduleRender()},append:(E,A)=>{w(hu.append,E,A)},insertBefore:(E,A)=>{w(hu.insertBefore,E,A)},merge:(E,A)=>{w(hu.merge,E,A)},replace:(E,A)=>{w(hu.replace,E,A)},detach:E=>{for(let A=0;A<y.length;A++)if(y[A]===E)return y.splice(A,1),l.splice(A,1)[0];throw new Error("renderFunction was not found")}},t},zc=class extends Pt{constructor(){super(...arguments),this.items=new At,this._watchUpdatingTracking=new rd,this._callbacks=new Map,this._projector=fP(),this._hiddenProjector=fP()}get needsRender(){return this.items.length>0}get updating(){var t;return((t=this._watchUpdatingTracking)==null?void 0:t.updating)??!1}initialize(){const t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(t){this.items.add(t)}removeItem(t){this.items.remove(t)}destroy(){this.items.removeAll(),this._callbacks.forEach(t=>this._projector.detach(t)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(t){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const a=()=>(s=t.render(),s);r.append(i,a),r.renderNow();const u={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const l=s.domNode.getBoundingClientRect();u.left=l.left,u.top=l.top,u.right=l.right,u.bottom=l.bottom}for(r.detach(a);i.firstChild;)i.removeChild(i.firstChild);return u}overlaps(t,i){const r=this.computeBoundingRect(t),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(t=>t.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(t,i){const r=!!(i!=null&&i.disableDecorations);if(!this.items.some(a=>a.visible&&!(r&&a.isDecoration)))return;const s=t.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(a=>{r&&a.isDecoration||(s.save(),a.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};v([M({readOnly:!0})],zc.prototype,"surface",void 0),v([M({readOnly:!0})],zc.prototype,"items",void 0),v([M({readOnly:!0})],zc.prototype,"needsRender",null),v([M({readOnly:!0})],zc.prototype,"_watchUpdatingTracking",void 0),v([M({readOnly:!0})],zc.prototype,"updating",null),zc=v([me("esri.views.overlay.ViewOverlay")],zc);const mP=zc,zx=[0,0];function wJ(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return zx[0]=i.left+((t==null?void 0:t.pageXOffset)??0),zx[1]=i.top+((t==null?void 0:t.pageYOffset)??0),zx}function yP(e){e&&(G4(e),e.parentNode&&e.parentNode.removeChild(e))}function xJ(e){const t=document.createElement("div");return e.appendChild(t),t}const ry=16,H_=750,SJ=512,TJ=2,MJ=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:ry,time:H_},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([qt(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),qt(()=>this.navigating,r=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){const i=Ce("mac"),r=async()=>{i&&(await Mb(()=>this.ready),this.messagesCommon=await QM("esri/t9n/common").catch(()=>{}))};r(),this.addHandles([qt(()=>this.ui,(s,a)=>this._handleUIChange(s,a),on),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),JM(r),qt(()=>[this.surface,this.messagesCommon],()=>{var s,a,u;i&&((u=this.surface)==null||u.setAttribute("aria-label",((a=(s=this.messagesCommon)==null?void 0:s.ariaLabels)==null?void 0:a.navigationMacVoiceOver)??""))})])}destroy(){this.destroyed||(this.ui=Xi(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=AI(i);if(s||typeof i!="string"||pt.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(yP(this.root),this._set("root",null)),this.userContent&&(nP(this.userContent,r),yP(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const a=document.createElement("div");a.className="esri-view-user-storage",nP(s,a),s.appendChild(a),this._set("userContent",a);const u=document.createElement("div");u.className="esri-view-root",s.insertBefore(u,s.firstChild),this._set("root",u);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,u.appendChild(l),this._set("surface",l);const y=new mP;u.appendChild(y.surface),this._set("overlay",y),this.addHandles(qt(()=>y.needsRender,w=>{w&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=lf({render:()=>{var I;return(I=this.overlay)==null?void 0:I.render()}}):this._overlayRenderTaskHandle=er(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,r,s){const a=this.position;return i-=a?a[0]:0,r-=a?a[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const a=this.position;return i+=a?a[0]:0,r+=a?a[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(qt(()=>this.root,s=>{i.container=s?xJ(s):null},on),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=ry,i.time=H_,this.addHandles([Vg(window,"resize",()=>{i.freq=ry,i.time=H_}),lf({prepare:r=>{const s=this._measure(),a=this._freqInfo;if(a.time+=r.deltaTime,s&&(a.freq=ry,this._get("resizing")||this._set("resizing",!0)),a.time<a.freq)return;a.time=0;const u=this._position();a.freq=u||s?ry:Math.min(H_,a.freq*TJ),!s&&a.freq>=SJ&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const a=this.width,u=this.height;return r===a&&s===u?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:a,oldHeight:u,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&wJ(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return v([M()],t.prototype,"container",null),v([M({readOnly:!0})],t.prototype,"focused",null),v([M({readOnly:!0})],t.prototype,"height",void 0),v([M()],t.prototype,"messagesCommon",void 0),v([M({type:mP})],t.prototype,"overlay",void 0),v([M({readOnly:!0})],t.prototype,"position",void 0),v([M({readOnly:!0})],t.prototype,"resizing",void 0),v([M({readOnly:!0})],t.prototype,"root",void 0),v([M({value:null,readOnly:!0})],t.prototype,"size",null),v([M({readOnly:!0})],t.prototype,"surface",void 0),v([M({readOnly:!0})],t.prototype,"suspended",void 0),v([M()],t.prototype,"ui",void 0),v([M({readOnly:!0})],t.prototype,"userContent",void 0),v([M({readOnly:!0})],t.prototype,"width",void 0),v([M()],t.prototype,"widthBreakpoint",void 0),t=v([me("esri.views.DOMContainer")],t),t};let IJ=class{constructor(t,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in t){const s=t[r],a=new j$(s,void 0,void 0,2,2);this._properties[r]={pool:a,acquired:[]}}this._afterDispatchHandle=u9(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const t in this._properties){const i=this._properties[t];for(const r of i.acquired)vk(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(t){const i=this._owner._get(t),r=this._properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this._properties){const i=this._properties[t];let r=0;for(const s of i.acquired)vk(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}};const EJ=Ce("mac")?"Meta":"Ctrl",kJ=new Set(["Alt","Ctrl","Meta","Shift","Primary"]),AJ=e=>kJ.has(e);let PJ=class{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}};const gP=()=>pt.getLogger("esri.views.input.InputHandler");let Ur=class{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?gP().error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const a=typeof t=="string"?new PJ(t,s):t,u=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=I=>{const E=this._incoming[I.match.eventType];if(E){const A=E.indexOf(I);E.splice(A,1),u(),this._manager&&this._manager.updateDependencies()}},y=new CJ(a,r,{onPause:l,onRemove:l,onResume:I=>{const E=this._incoming[I.match.eventType];E&&!E.includes(I)&&(E.push(I),u(),this._manager&&this._manager.updateDependencies())}});let w=this._incoming[a.eventType];return w||(w=[],this._incoming[a.eventType]=w),w.push(y),u(),this._manager&&this._manager.updateDependencies(),y}registerOutgoing(t){if(this._outgoing[t])throw new Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new $J(t,{onEmit:(r,s,a,u)=>{var l;(l=this._manager)==null||l.emit(r.eventType,s,a,u)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){var i;(i=this._manager)==null||i.setPointerCapture(t,!0)}stopCapturingPointer(t){var i;(i=this._manager)==null||i.setPointerCapture(t,!1)}refreshHasPendingInputs(){var t;(t=this._manager)==null||t.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):gP().error("This InputHandler is not registered with an InputManager")}_handleEvent(t){var r;const i=this._incoming[t.type];if(i){for(const s of i)if(s.match.matches(t)&&((r=s.callback)==null||r.call(s,t),t.shouldStopPropagation()))break}}},CJ=class{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},$J=class{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},OJ=class extends Ur{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(t){const i=t.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=t;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},LJ=class{constructor(t,i){this._observable=new qg,this._value=t,this._equalityFunction=i}get value(){return Tt(this._observable),this._value}set value(t){this._equalityFunction(t,this._value)||(this._value=t,this._observable.notify())}mutate(t){t(this._value),this._observable.notify()}};function pR(e,t=b$){return new LJ(e,t)}let RJ=class extends Ur{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=pR(!1),this._onPointerAdd=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.add(t.native.pointerId),this._update())},this._onPointerRemove=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.delete(t.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},co=class extends Pt{constructor(t){super(t),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=EJ,this._latestPointerType="mouse",this._propertiesPool=new IJ({latestPointerLocation:NJ},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const t=Object.keys(this._nameToGroup);for(const i of t)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(t=>t.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(t,i,r=pu.INTERNAL){if(this._nameToGroup[t])return void pt.getLogger(this).error("There is already an InputHandler group registered under the name `"+t+"`");if(i.length===0)return void pt.getLogger(this).error("Can't register a group of zero handlers");const s={name:t,handlers:i.map(a=>({handler:a,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[t]=s;for(let a=s.handlers.length-1;a>=0;a--){const u=s.handlers[a];this._handlers.push(u),u.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(l,y,w,I,E)=>{this._emitInputEvent(u.priorityIndex+1,l,y,w,E,I)},setPointerCapture:(l,y)=>{this._setPointerCapture(s,u,l,y)},setEventCallback:l=>{u.eventCallback=l},setUninstallCallback:l=>{u.uninstallCallback=l},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(t){const i=this._nameToGroup[t];i?(i.handlers.forEach(r=>{var s;r.removed=!0,(s=r.uninstallCallback)==null||s.call(r)}),delete this._nameToGroup[t],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):pt.getLogger(this).error("There is no InputHandler group registered under the name `"+t+"`")}hasHandlers(t){return this._nameToGroup[t]!==void 0}isModifierKeyDown(t){return this._activeKeyModifiers&&this._activeKeyModifiers.has(t)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const t=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let a=s.handler.hasSideEffects;if(!a){for(const u of s.handler.outgoingEventTypes)if(t.has(u)){a=!0;break}}if(a)for(const u of s.handler.incomingEventMatches){t.add(u.eventType);for(const l of u.keyModifiers)AJ(l)||i.add(l)}s.active=a}this._sourceEvents=t,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(t,i,r){this._latestPointerType=t;const s=this._get("latestPointerLocation");if(s==null||s.x!==i||s.y!==r){const a=this._propertiesPool.get("latestPointerLocation");a.x=i,a.y=r,this._set("latestPointerLocation",a)}}_onEventReceived(t,i){if(t==="pointer-capture-lost"){const a=i;this._pointerCaptures.delete(a.native.pointerId)}this._updateKeyModifiers(t,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(t,i,r,s)}_updateKeyModifiers(t,i){if(!i)return;let r=!1;const s=()=>{if(!r){const l=new Set;this._activeKeyModifiers.forEach(y=>{l.add(y)}),this._activeKeyModifiers=l,r=!0}},a=(l,y)=>{y&&!this._activeKeyModifiers.has(l)?(s(),this._activeKeyModifiers.add(l)):!y&&this._activeKeyModifiers.has(l)&&(s(),this._activeKeyModifiers.delete(l))};if(t==="key-down"||t==="key-up"){const l=i.key;this._keyModifiers.has(l)&&a(l,t==="key-down")}const u=i.native;a("Alt",!(!u||!u.altKey)),a("Ctrl",!(!u||!u.ctrlKey)),a("Shift",!(!u||!u.shiftKey)),a("Meta",!(!u||!u.metaKey)),a("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new OJ((t,i,r)=>this._setLatestPointer(t,i,r)),this._multiTouchHandler=new RJ,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],pu.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,pu.INTERNAL)}_setPointerCapture(t,i,r,s){const a=t.name+"-"+i.priorityIndex,u=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,u),s?(u.add(a),u.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):u.has(a)&&(u.delete(a),u.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(t=>!t.removed),this.updateDependencies()}_emitInputEventFromSource(t,i,r,s){this._emitInputEvent(0,t,i,r,s)}_emitInputEvent(t,i,r,s,a,u){const l=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),y=a!==void 0&&a,w={event:new DJ(i,r,l,u||this._activeKeyModifiers,y),priorityIndex:t};this._currentPropagation?this._currentPropagation.events.push(w):this._doNewPropagation(w)}_doNewPropagation(t){this._currentPropagation={events:new k1,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:t.event.timestamp},this._currentPropagation.events.push(t),this._continuePropagation()}_continuePropagation(){var i,r,s;this._paused=!1;const t=this._currentPropagation;if(t){for(;t.events.length>0;){const{event:a,priorityIndex:u}=t.events.pop(),l=(i=a.data)==null?void 0:i.eventId;if(!(l!=null&&this._stoppedPropagationEventIds.has(l)))for(t.currentHandler=this._handlersPriority[u];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else{if(t.currentHandler.active&&!a.shouldStopPropagation()&&((s=(r=t.currentHandler).eventCallback)==null||s.call(r,a)),a.shouldStopPropagation()){l!=null&&this._stoppedPropagationEventIds.add(l);break}if(a.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:a,priorityIndex:t.currentHandler.priorityIndex+1})}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(t){const i=new k1;i.push(t);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(t,i){if(t.handler.hasSideEffects!==i.handler.hasSideEffects)return t.handler.hasSideEffects?1:-1;if(t.groupPriority!==i.groupPriority)return t.groupPriority>i.groupPriority?-1:1;for(const r of t.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const a=r.keyModifiers.filter(u=>s.keyModifiers.includes(u));if(a.length===r.keyModifiers.length!=(a.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return t.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(t){const i=[];for(const r of t){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const t=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{t(()=>{this._onEventReceived(i,r)})},disablePointerCapture:t}}};v([M({readOnly:!0})],co.prototype,"hasPendingInputs",null),v([M({constructOnly:!0})],co.prototype,"eventSource",void 0),v([M({constructOnly:!0})],co.prototype,"recognizers",void 0),v([M()],co.prototype,"_latestPointerType",void 0),v([M()],co.prototype,"latestPointerType",null),v([M()],co.prototype,"multiTouchActive",null),v([M({readOnly:!0})],co.prototype,"latestPointerLocation",void 0),v([M()],co.prototype,"_paused",void 0),v([M({readOnly:!0})],co.prototype,"updating",null),co=v([me("esri.views.input.InputManager")],co);let DJ=class{constructor(t,i,r,s,a){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=a,this._propagationState=nu.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=nu.STOPPED}shouldStopPropagation(){return(this._propagationState&nu.STOPPED)!=0}async(t){this._propagationState|=nu.PAUSED;const i=(r,s)=>{this._propagationState&=~nu.PAUSED;const a=this._resumeCallback;if(this._resumeCallback=null,a&&a(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&nu.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}};var nu;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(nu||(nu={}));const pu={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let zJ=class{};const NJ=zJ;function _a(e){return e!=null&&"open"in e&&"declaredClass"in e}function _P(e){return e!=null&&"declaredClass"in e&&"dockOptions"in e}const FJ=e=>{let t=class extends e{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([qt(()=>[this.ui,this.popup],([i,r],s)=>{const a="popup",u="manual";if(s){const[l,y]=s;l&&_a(y)&&(y.view=null,_P(y)&&l.remove(y,a))}i&&_a(r)&&(r.view=this,_P(r)&&i.add(r,{key:a,position:u,internal:!0}))},on),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(!_a(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(_a(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),_a(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)})))},pu.WIDGET)]),Mb(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{it(()=>import("./Popup-CZsZb5wD.js"),__vite__mapDeps([141,1,7,142,143,29,114,144,145,100,8,146,147,90,123,148,149,13,150,151,152,50,48,153,121,27,28,25,26,154,80,78,79,38,41,81,155,156,157,158,3,11,12,159,160,161,9,162,163,164,165,166,167,168,169,170,171,172,173,174,102,54,175,10,176,177,14,15,178,179,180,181,182,183,184,185,186,20,187,188]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(_a(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void pt.getLogger(this).error(new gt("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),_a(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!_a(this.popup))return this._popupSetupTask=VM(async r=>{const{default:s}=await it(()=>import("./Popup-CZsZb5wD.js"),__vite__mapDeps([141,1,7,142,143,29,114,144,145,100,8,146,147,90,123,148,149,13,150,151,152,50,48,153,121,27,28,25,26,154,80,78,79,38,41,81,155,156,157,158,3,11,12,159,160,161,9,162,163,164,165,166,167,168,169,170,171,172,173,174,102,54,175,10,176,177,14,15,178,179,180,181,182,183,184,185,186,20,187,188]));if(mr(r),!this.popup||_a(this.popup))return;const a=this.popup;delete a.open,delete a.close,this.popup=new s(a)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},s){const a=[],u=[];let l=!1;const y=V8(s,Ce("popup-view-fetch-timeout")??jJ),w=A=>{const R=new BJ(A);return u.push(R),a.push(R.promise),R},I=A=>{const R=u.at(-1);return R&&R.layerView===A&&!l?R:w(A)};for(const A of r)"graphic"in A?(I(A.layerView).graphics.push(A.graphic),l=!1):(a.push(A.layerView.fetchPopupFeaturesAtLocation(A.mapPoint,y)),l=!0);u.map(A=>A.resolve(y));const E=j8(a).then(A=>A.filter(R=>!!R).flat());return{pendingFeatures:a,allGraphicsPromise:E,location:i}}async _getPopupHits(i,r){const{hits:s,location:a}=await this.popupHitTest(i);mr(r);const u=[];for(const l of s)if("graphic"in l){if(this._isValidPopupGraphic(l.graphic,r)){const y=this._isValidPopupGraphicsLayerView(l.layerView)?l.layerView:void 0;u.push({graphic:l.graphic,layerView:y})}}else this._isValidPopupLocationLayerView(l.layerView)&&u.push({mapPoint:l.mapPoint,layerView:l.layerView});return{hits:u,location:a}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r!=null&&r.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return v([M({cast(i){return!i||_a(i)||typeof i=="object"&&(i.open=r=>(af(pt.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(af(pt.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],t.prototype,"popup",void 0),v([M()],t.prototype,"popupEnabled",void 0),t=v([me("esri.views.PopupView")],t),t};let BJ=class{constructor(t){this.layerView=t,this._resolver=wo(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(t){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let a;return i.fetchPopupFeaturesFromGraphics(r,t).catch(u=>(a=u,null)).then(u=>{u?s.resolve(u):s.reject(a)}),s.promise}};const jJ=5e3,vP={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function Nx(e,t,i,r=Ua){const s=new ia(MI(r)),a=Ft.fromJSDate(e,{zone:s}),u=i==="decades"||i==="centuries"?"year":fR(i);return i==="decades"&&(t*=10),i==="centuries"&&(t*=100),a.plus({[u]:t}).toJSDate()}function bP(e,t,i=Ua){const r=new ia(MI(i)),s=Ft.fromJSDate(e,{zone:r});if(t==="decades"||t==="centuries"){const u=s.startOf("year"),{year:l}=u,y=l-l%(t==="decades"?10:100);return u.set({year:y}).toJSDate()}const a=fR(t);return s.startOf(a).toJSDate()}function dle(e,t,i){return e===0?0:e*vP[t]/vP[i]}function fR(e){switch(e){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var zo;let Un=zo=class extends wt{static get allTime(){return wP}static get empty(){return VJ}constructor(e){super(e),this.end=null,this.start=null}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=(e==null?void 0:e.getTime())??null}get isAllTime(){return this.equals(zo.allTime)}get isEmpty(){return this.equals(zo.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=(e==null?void 0:e.getTime())??null}clone(){return new zo({end:this.end,start:this.start})}equals(e){var a,u,l,y;if(!e)return!1;const t=((a=this.start)==null?void 0:a.getTime())??this.start,i=((u=this.end)==null?void 0:u.getTime())??this.end,r=((l=e.start)==null?void 0:l.getTime())??e.start,s=((y=e.end)==null?void 0:y.getTime())??e.end;return t===r&&i===s}expandTo(e,t=Ua){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=bP(i,e,t));let r=this.end;if(r){const s=bP(r,e,t);r=r.getTime()===s.getTime()?s:Nx(s,1,e,t)}return new zo({start:i,end:r})}intersection(e){var l,y,w,I;if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return zo.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=((l=this.start)==null?void 0:l.getTime())??-1/0,i=((y=this.end)==null?void 0:y.getTime())??1/0,r=((w=e.start)==null?void 0:w.getTime())??-1/0,s=((I=e.end)==null?void 0:I.getTime())??1/0;let a,u;if(r>=t&&r<=i?a=r:t>=r&&t<=s&&(a=t),i>=r&&i<=s?u=i:s>=t&&s<=i&&(u=s),a!=null&&u!=null&&!isNaN(a)&&!isNaN(u)){const E=new zo;return E.start=a===-1/0?null:new Date(a),E.end=u===1/0?null:new Date(u),E}return zo.empty}offset(e,t,i=Ua){if(this.isEmpty||this.isAllTime)return this.clone();const r=new zo,{start:s,end:a}=this;return s!=null&&(r.start=Nx(s,e,t,i)),a!=null&&(r.end=Nx(a,e,t,i)),r}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return wP.clone();const t=this.start!=null&&e.start!=null?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=this.end!=null&&e.end!=null?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new zo({start:t,end:i})}};v([M({type:Date,json:{write:{allowNull:!0}}})],Un.prototype,"end",void 0),v([yi("end")],Un.prototype,"readEnd",null),v([ni("end")],Un.prototype,"writeEnd",null),v([M({readOnly:!0,json:{read:!1}})],Un.prototype,"isAllTime",null),v([M({readOnly:!0,json:{read:!1}})],Un.prototype,"isEmpty",null),v([M({type:Date,json:{write:{allowNull:!0}}})],Un.prototype,"start",void 0),v([yi("start")],Un.prototype,"readStart",null),v([ni("start")],Un.prototype,"writeStart",null),Un=zo=v([me("esri.TimeExtent")],Un);const wP=new Un,VJ=new Un({start:void 0,end:void 0}),mR=Un;let rg=class extends At{constructor(t){super(t),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(t){t!==this._get("owner")&&(this._releaseAll(),this._set("owner",t),this._ownAll())}_ownAll(){for(const t of this.items)this._own(t)}_releaseAll(){for(const t of this.items)this._release(t)}_createNewInstance(t){return this.itemType?new(At.ofType(this.itemType.Type))(t):new At(t)}};function xP(e,t){return{type:e,cast:NO,set(i){const r=ad(i,this._get(t),e);r.owner=this,this._set(t,r)}}}v([M()],rg.prototype,"owner",null),rg=v([me("esri.core.support.OwningCollection")],rg);var my;const D1=In()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),yR=D1.jsonValues.slice();JF(yR,"orthometric");const sg=In()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let No=my=class extends wt{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return D1.write(e,t,i)}readHeightModel(e,t,i){return D1.read(e)||(i!=null&&i.messages&&i.messages.push(UJ(e,{context:i})),null)}readHeightUnit(e,t,i){return sg.read(e)||(i!=null&&i.messages&&i.messages.push(SP(e,{context:i})),null)}readHeightUnitService(e,t,i){return eL(e)||sg.read(e)||(i!=null&&i.messages&&i.messages.push(SP(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new my({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=Nj(t);return new my({heightModel:e.heightModel,heightUnit:i??void 0,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new my;return t.read(e,{origin:"web-scene"}),t}};function SP(e,t){return new Gl("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function UJ(e,t){return new Gl("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}v([M({type:D1.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:yR,default:"ellipsoidal"}}}})],No.prototype,"heightModel",void 0),v([ni("web-scene","heightModel")],No.prototype,"writeHeightModel",null),v([yi(["web-scene","service"],"heightModel")],No.prototype,"readHeightModel",null),v([M({type:sg.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:sg.jsonValues,write:sg.write}}}})],No.prototype,"heightUnit",void 0),v([yi("web-scene","heightUnit")],No.prototype,"readHeightUnit",null),v([yi("service","heightUnit")],No.prototype,"readHeightUnitService",null),v([M({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],No.prototype,"vertCRS",void 0),v([yi("service","vertCRS",["vertCRS","ellipsoid","geoid"])],No.prototype,"readVertCRS",null),No=my=v([me("esri.geometry.HeightModelInfo")],No);const OI=No;let z1=class extends rg{constructor(t){super(t),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(pt.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(t){t.parent=this.owner}_release(t){t.parent=null}};z1=v([me("esri.support.AnalysesCollection")],z1);async function GJ(e,t){const{WhereClause:i}=await it(()=>import("./WhereClause-DDRM1Vd4.js").then(r=>r.W),__vite__mapDeps([46,47,48]));return i.create(e,t)}function mle(e,t){return e!=null&&e!==""?t!=null&&t!==""?`(${e}) AND (${t})`:e:t}function yle(e){return typeof e=="number"}function LI(e){return typeof e=="string"||e instanceof String}const qJ="yyyy-MM-dd",HJ="TT";var ng;(function(e){e.HM="HH:mm",e.HMS="HH:mm:ss",e.HMS_MS="HH:mm:ss.SSS"})(ng||(ng={}));const WJ=[ng.HMS_MS,ng.HMS,ng.HM,HJ];function TP(e){if(!e||!LI(e))return null;const t=Ft.fromFormat(e,qJ);return t.isValid?t:null}function MP(e){return e&&LI(e)?h8(WJ,t=>{const i=Ft.fromFormat(e,t);return i.isValid?i:null})??null:null}function IP(e){if(!e||!LI(e))return null;const t=Ft.fromISO(e);return t.isValid?t:null}var vf;(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(vf||(vf={}));const ZJ=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function JJ(e){return e!=null&&ZJ.has(e.type)}function gR(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function _R(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function vR(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function KJ(e,t){const i=e==null?void 0:e.domain;if(!i)return null;switch(i.type){case"range":{const{min:r,max:s}=YJ(e);if(r!=null&&+t<r||s!=null&&+t>s)return vf.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(i.codedValues==null||i.codedValues.every(r=>r==null||r.code!==t))return vf.INVALID_CODED_VALUE}return null}function YJ(e,t){const i=t??(e==null?void 0:e.domain);if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,a=JJ(e);return gR(e)||vR(e)||_R(e)?{...XJ(e,s,r),isInteger:a}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:a}}function XJ(e,t,i){var r,s,a,u,l,y;return gR(e)?{min:(r=TP(i))==null?void 0:r.toMillis(),max:(s=TP(t))==null?void 0:s.toMillis(),rawMin:i,rawMax:t}:vR(e)?{min:(a=MP(i))==null?void 0:a.toMillis(),max:(u=MP(t))==null?void 0:u.toMillis(),rawMin:i,rawMax:t}:_R(e)?{min:(l=IP(i))==null?void 0:l.toMillis(),max:(y=IP(t))==null?void 0:y.toMillis(),rawMin:i,rawMax:t}:{max:null,min:null}}const QJ=()=>pt.getLogger("esri.support.arcadeOnDemand");let Fx;function bR(){return Fx||(Fx=(async()=>{const e=await it(()=>import("./arcadeUtils-CDO_pvGa.js").then(t=>t.aK),__vite__mapDeps([189,47,48,190,52,40,38,41,50]));return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),Fx}const gle=(e,t,i)=>wR.create(e,t,i,null,["$feature","$view"],[]),_le=(e,t,i,r)=>wR.create(e,t,i,r,["$feature","$view"],[]);let wR=class xR{constructor(t,i,r,s,a,u,l){this.services=null,this.script=t,this.evaluate=s;const y=Array.isArray(u)?u:u==null?void 0:u.fields;this.fields=y??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=a,this._spatialReference=l,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,a,u){const{arcade:l,Feature:y,Dictionary:w}=await bR(),I=si.fromJSON(i);let E;try{E=l.parseScript(t,u)}catch(Ze){return QJ().error(new gt("arcade-bad-expression","Failed to parse arcade script",{script:t,error:Ze})),null}const A=a.reduce((Ze,lt)=>({...Ze,[lt]:null}),{});let R=null;s!=null&&(R=new w(s),R.immutable=!0,A.$config=null);const G=l.scriptUsesGeometryEngine(E),K=G&&l.enableGeometrySupport(),Y=l.scriptUsesFeatureSet(E)&&l.enableFeatureSetSupport(),ae=l.scriptIsAsync(E),Te=ae&&l.enableAsyncSupport(),_e={vars:A,spatialReference:I,useAsync:!!Te};await Promise.all([K,Y,Te]);const be=new Set;await l.loadDependentModules(be,E,null,ae,G);const ke=new w;ke.immutable=!1,ke.setField("scale",0);const Ae=l.compileScript(E,_e),Ve=(Ze,lt)=>{var ut;const ct=(ut=Ze.$view)==null?void 0:ut.timeZone;return"$view"in Ze&&Ze.$view&&(ke.setField("scale",typeof Ze.$view=="object"&&"scale"in Ze.$view?Ze.$view.scale:void 0),Ze.$view=ke),R&&(Ze.$config=R),Ae({vars:Ze,spatialReference:I,services:lt,timeZone:ct})};return new xR(t,l,E,Ve,new y,r,I)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const eK=/^([0-9_])/,tK=/[^a-z0-9_\u0080-\uffff]+/gi;function vle(e){return e==null?null:e.trim().replaceAll(tK,"_").replace(eK,"F$1")||null}const iK=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],rK=["field","normalizationField"];function ble(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(EP(iK,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)EP(rK,r,t)}}function EP(e,t,i){if(e)for(const r of e){const s=nb(r,t),a=s&&typeof s!="function"&&i.get(s);a&&Sf(r,a.name,t)}}function wle(e,t){var i;if(e!=null&&((i=t==null?void 0:t.fields)!=null&&i.length))if("startField"in e){const r=t.get(e.startField),s=t.get(e.endField);e.startField=(r==null?void 0:r.name)??null,e.endField=(s==null?void 0:s.name)??null}else{const r=t.get(e.startTimeField),s=t.get(e.endTimeField);e.startTimeField=(r==null?void 0:r.name)??null,e.endTimeField=(s==null?void 0:s.name)??null}}const Bx=new Set;function RI(e,t){return e&&t?(Bx.clear(),Cg(Bx,e,t),Array.from(Bx).sort()):[]}function Cg(e,t,i){var r;if(i)if((r=t==null?void 0:t.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)zb(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)s!=null&&e.add(s)}}function zb(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function xle(e,t){return t==null||e==null?[]:t.includes("*")?(e.fields??[]).map(i=>i.name):t}function Sle(e,t,i=1){if(!t||!e)return[];if(t.includes("*"))return["*"];const r=RI(e,t);return r.length/e.fields.length>=i?["*"]:r}async function _d(e,t,i){var a;if(!i)return;const{arcadeUtils:r}=await bR(),s=r.extractFieldNames(i,(a=t==null?void 0:t.fields)==null?void 0:a.map(u=>u.name));for(const u of s)zb(e,t,u)}async function SR(e,t,i){if(i&&i!=="1=1"){const r=await GJ(i,t);if(!r.isStandardized)throw new gt("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});Cg(e,t,r.fieldNames)}}function Tle({displayField:e,fields:t}){return e||(t!=null&&t.length?jx(t,"name-or-title")||jx(t,"unique-identifier")||jx(t,"type-or-category")||sK(t):null)}function sK(e){for(const t of e){if(!(t!=null&&t.name))continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function jx(e,t){for(const i of e)if(i!=null&&i.valueType&&i.valueType===t)return i.name;return null}async function Mle(e,t){var r;if(!t)return;const i=(r=t.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}function nK(e,t,i){i.onStatisticExpression?_d(e,t,i.onStatisticExpression.expression):e.add(i.onStatisticField)}async function Ile(e,t,i){if(!t||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(oK(e,t,s)),i.fields&&r.push(...i.fields.map(async a=>nK(e,t.fieldsIndex,a))),await Promise.all(r)}async function oK(e,t,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(a=>_d(e,t.fieldsIndex,a.expression)));const s=i==null?void 0:i.content;if(Array.isArray(s))for(const a of s)a.type==="expression"&&a.expressionInfo&&r.push(_d(e,t.fieldsIndex,a.expressionInfo.expression));await Promise.all(r)}async function Ele(e,t,i){t&&(t.timeInfo&&(i!=null&&i.timeExtent)&&Cg(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&Cg(e,t.fieldsIndex,[t.floorInfo.floorField]),(i==null?void 0:i.where)!=null&&await SR(e,t.fieldsIndex,i.where))}async function kle(e,t,i){t&&i&&await Promise.all(i.map(r=>aK(e,t,r)))}async function aK(e,t,i){t&&i&&(i.valueExpression?await _d(e,t.fieldsIndex,i.valueExpression):i.field&&zb(e,t.fieldsIndex,i.field))}function Ale(e){return e?RI(e.fieldsIndex,TR(e)):[]}function lK(e){if(!e)return[];const t=e.geometryFieldsInfo;return t?RI(e.fieldsIndex,[t.shapeAreaField,t.shapeLengthField]):[]}const cK=new Set(["oid","global-id","guid"]),uK=new Set(["oid","global-id"]),hK=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function dK(e){const t=new Set;MR(e).forEach(r=>t.add(r)),lK(e).forEach(r=>t.add(r.toLowerCase()));const i=e&&"infoFor3D"in e?e.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>t.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>t.add(r.toLowerCase()))),Array.from(t)}function TR(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;if(!t)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:a}=t;return[i,r,s,a].filter(Boolean)}function MR(e){return TR(e).map(t=>t.toLowerCase())}function Ple(e,t){var i;return e.editable&&!cK.has(e.type)&&!MR(t).includes(((i=e.name)==null?void 0:i.toLowerCase())??"")}function Cle(e,t){var r;const i=((r=e.name)==null?void 0:r.toLowerCase())??"";return!((t==null?void 0:t.objectIdField)!=null&&i===t.objectIdField.toLowerCase()||(t==null?void 0:t.globalIdField)!=null&&i===t.globalIdField.toLowerCase()||dK(t).includes(i)||uK.has(e.type)||hK.some(s=>s.test(i)))}async function $le(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i!=null&&i.length&&await Promise.all(i.map(s=>pK(e,r,s)))}async function pK(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await _d(e,t,r.expression);else{const a=r.expression.match(/{[^}]*}/g);a&&a.forEach(u=>{zb(e,t,u.slice(1,-1))})}await SR(e,t,s)}function Ole(e){const t=e.defaultValue;return t!==void 0&&kR(e,t)?t:e.nullable?null:void 0}function Lle(e){const t=typeof e=="string"?{type:e}:e;return IK(t)?255:t.type==="esriFieldTypeDate"||t.type==="date"?8:void 0}function IR(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function fK(e){return e===null||IR(e)}function mK(e){return e===null||Number.isInteger(e)}function ER(e){return e!=null&&typeof e=="string"}function yK(e){return e===null||ER(e)}function gK(){return!0}function kR(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=e.nullable?mK:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?fK:IR;break;case"string":case"esriFieldTypeString":i=e.nullable?yK:ER;break;default:i=gK}return arguments.length===1?i:i(t)}const _K=["integer","small-integer","big-integer"],vK=["single","double"],bK=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],wK=["esriFieldTypeSingle","esriFieldTypeDouble"],xK=new Set([..._K,...bK]),SK=new Set([...vK,...wK]),TK=K$(xK,SK);function MK(e){return e!=null&&TK.has(e.type)}function IK(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function Rle(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}function Dle(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function zle(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function Nle(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function Fle(e){return e!=null&&(e.type==="oid"||e.type==="esriFieldTypeOID")}function Ble(e){return e!=null&&(e.type==="global-id"||e.type==="esriFieldTypeGlobalID")}function jle(e,t){return EK(e,t)===null}var N1,F1;function Vle(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function EK(e,t){return e==null||e.nullable&&t===null?null:MK(e)&&!kK(e.type,Number(t))?N1.OUT_OF_RANGE:kR(e,t)?e.domain?KJ(e,t):null:F1.INVALID_TYPE}function kK(e,t){const i=typeof e=="string"?AR(e):e;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(t)&&t>=r&&t<=s:t>=r&&t<=s}function AR(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return AK;case"esriFieldTypeInteger":case"integer":return PK;case"esriFieldTypeBigInteger":case"big-integer":return CK;case"esriFieldTypeSingle":case"single":return $K;case"esriFieldTypeDouble":case"double":return OK}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(N1||(N1={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(F1||(F1={}));const AK={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},PK={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},CK={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},$K={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},OK={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Ule(e,t,i){switch(e){case vf.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case vf.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case F1.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case N1.OUT_OF_RANGE:{const{min:r,max:s}=AR(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function Gle(e,t){return!LK(e,t,null)}function LK(e,t,i){if(!(t!=null&&t.attributes)||!e){if(i!=null)for(const a of e??[])i.add(a);return!0}const r=new Set(Object.keys(t.attributes));let s=!1;for(const a of e)if(!r.has(a)){if(s=!0,i==null)break;i.add(a)}return s}function qle(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let Tv=class extends wt{constructor(t){super(t),this.type=null}};v([M({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],Tv.prototype,"type",void 0),Tv=v([me("esri.popup.content.Content")],Tv);const Au=Tv;var kS;let fh=kS=class extends Au{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new kS({description:this.description,displayType:this.displayType,title:this.title})}};v([M({type:String,json:{write:!0}})],fh.prototype,"description",void 0),v([M({type:["auto","preview","list"],json:{write:!0}})],fh.prototype,"displayType",void 0),v([M({type:String,json:{write:!0}})],fh.prototype,"title",void 0),v([M({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],fh.prototype,"type",void 0),fh=kS=v([me("esri.popup.content.AttachmentsContent")],fh);const B1=fh;var AS;let mh=AS=class extends Au{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new AS({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Ge(this.outFields):null})}};v([M()],mh.prototype,"creator",void 0),v([M()],mh.prototype,"destroyer",void 0),v([M()],mh.prototype,"outFields",void 0),v([M({type:["custom"],readOnly:!0})],mh.prototype,"type",void 0),mh=AS=v([me("esri.popup.content.CustomContent")],mh);const RK=mh;var PS;let Mp=PS=class extends wt{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new PS({title:this.title,expression:this.expression})}};v([M({type:String,json:{write:!0}})],Mp.prototype,"title",void 0),v([M({type:String,json:{write:!0}})],Mp.prototype,"expression",void 0),v([M({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Mp.prototype,"returnType",void 0),Mp=PS=v([me("esri.popup.ElementExpressionInfo")],Mp);const DK=Mp;var CS;let yy=CS=class extends Au{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new CS({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};v([M({type:DK,json:{write:!0}})],yy.prototype,"expressionInfo",void 0),v([M({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],yy.prototype,"type",void 0),yy=CS=v([me("esri.popup.content.ExpressionContent")],yy);const DI=yy;let Ip=class extends Za(wt){constructor(t){super(t),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};v([Ot(sW)],Ip.prototype,"dateFormat",void 0),v([M({type:Boolean,json:{write:!0}})],Ip.prototype,"digitSeparator",void 0),v([M({type:ar,json:{write:!0}})],Ip.prototype,"places",void 0),Ip=v([me("esri.popup.support.FieldInfoFormat")],Ip);const zK=Ip;var $S;let Fo=$S=class extends wt{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new $S({fieldName:this.fieldName,format:this.format?Ge(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};v([M({type:String,json:{write:!0}})],Fo.prototype,"fieldName",void 0),v([M({type:zK,json:{write:!0}})],Fo.prototype,"format",void 0),v([M({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Fo.prototype,"isEditable",void 0),v([M({type:String,json:{write:!0}})],Fo.prototype,"label",void 0),v([Ot(new hs({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Fo.prototype,"stringFieldOption",void 0),v([M({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Fo.prototype,"statisticType",void 0),v([M({type:String,json:{write:!0}})],Fo.prototype,"tooltip",void 0),v([M({type:Boolean,json:{write:!0}})],Fo.prototype,"visible",void 0),Fo=$S=v([me("esri.popup.FieldInfo")],Fo);const PR=Fo;var OS;let El=OS=class extends Au{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new OS(Ge({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};v([M({type:Object,json:{write:!0}})],El.prototype,"attributes",void 0),v([M({type:String,json:{write:!0}})],El.prototype,"description",void 0),v([M({type:[PR]})],El.prototype,"fieldInfos",void 0),v([ni("fieldInfos")],El.prototype,"writeFieldInfos",null),v([M({type:String,json:{write:!0}})],El.prototype,"title",void 0),v([M({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],El.prototype,"type",void 0),El=OS=v([me("esri.popup.content.FieldsContent")],El);const j1=El;let yh=class extends wt{constructor(t){super(t),this.altText=null,this.caption="",this.title="",this.type=null}};v([M({type:String,json:{write:!0}})],yh.prototype,"altText",void 0),v([M({type:String,json:{write:!0}})],yh.prototype,"caption",void 0),v([M({type:String,json:{write:!0}})],yh.prototype,"title",void 0),v([M({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],yh.prototype,"type",void 0),yh=v([me("esri.popup.content.mixins.MediaInfo")],yh);const zI=yh;var LS;let gh=LS=class extends Pt{constructor(e){super(e),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new LS({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};v([M()],gh.prototype,"color",void 0),v([M()],gh.prototype,"fieldName",void 0),v([M()],gh.prototype,"tooltip",void 0),v([M()],gh.prototype,"value",void 0),gh=LS=v([me("esri.popup.content.support.ChartMediaInfoValueSeries")],gh);const NK=gh;var RS;let Nc=RS=class extends wt{constructor(e){super(e),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new RS({colors:Ge(this.colors),fields:Ge(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};v([M({type:[oi],json:{type:[[ar]],write:!0}})],Nc.prototype,"colors",void 0),v([M({type:[String],json:{write:!0}})],Nc.prototype,"fields",void 0),v([M({type:String,json:{write:!0}})],Nc.prototype,"normalizeField",void 0),v([M({type:[NK],json:{read:!1}})],Nc.prototype,"series",void 0),v([M({type:String,json:{write:!0}})],Nc.prototype,"tooltipField",void 0),Nc=RS=v([me("esri.popup.content.support.ChartMediaInfoValue")],Nc);const FK=Nc;let gy=class extends zI{constructor(t){super(t),this.type=null,this.value=null}};v([M({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],gy.prototype,"type",void 0),v([M({type:FK,json:{write:!0}})],gy.prototype,"value",void 0),gy=v([me("esri.popup.content.mixins.ChartMediaInfo")],gy);const Nb=gy,Fb=In()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var DS;let Mv=DS=class extends Nb{constructor(e){super(e),this.type="bar-chart"}clone(){return new DS({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};v([M({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:Fb.write}})],Mv.prototype,"type",void 0),Mv=DS=v([me("esri.popup.content.BarChartMediaInfo")],Mv);const CR=Mv;var zS;let Iv=zS=class extends Nb{constructor(e){super(e),this.type="column-chart"}clone(){return new zS({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};v([M({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:Fb.write}})],Iv.prototype,"type",void 0),Iv=zS=v([me("esri.popup.content.ColumnChartMediaInfo")],Iv);const $R=Iv;var NS;let _y=NS=class extends wt{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new NS({linkURL:this.linkURL,sourceURL:this.sourceURL})}};v([M({type:String,json:{write:!0}})],_y.prototype,"linkURL",void 0),v([M({type:String,json:{write:!0}})],_y.prototype,"sourceURL",void 0),_y=NS=v([me("esri.popup.content.support.ImageMediaInfoValue")],_y);const BK=_y;var FS;let Ep=FS=class extends zI{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new FS({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};v([M({type:Number,json:{write:!0}})],Ep.prototype,"refreshInterval",void 0),v([M({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Ep.prototype,"type",void 0),v([M({type:BK,json:{write:!0}})],Ep.prototype,"value",void 0),Ep=FS=v([me("esri.popup.content.ImageMediaInfo")],Ep);const OR=Ep;var BS;let Ev=BS=class extends Nb{constructor(e){super(e),this.type="line-chart"}clone(){return new BS({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};v([M({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:Fb.write}})],Ev.prototype,"type",void 0),Ev=BS=v([me("esri.popup.content.LineChartMediaInfo")],Ev);const LR=Ev;var jS;let kv=jS=class extends Nb{constructor(e){super(e),this.type="pie-chart"}clone(){return new jS({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};v([M({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:Fb.write}})],kv.prototype,"type",void 0),kv=jS=v([me("esri.popup.content.PieChartMediaInfo")],kv);const RR=kv,DR={base:zI,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":CR,"column-chart":$R,"line-chart":LR,"pie-chart":RR,image:OR}};var VS;let Bo=VS=class extends Au{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?OR.fromJSON(t):t.type==="barchart"?CR.fromJSON(t):t.type==="columnchart"?$R.fromJSON(t):t.type==="linechart"?LR.fromJSON(t):t.type==="piechart"?RR.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new VS(Ge({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};v([M()],Bo.prototype,"activeMediaInfoIndex",void 0),v([M({type:Object,json:{write:!0}})],Bo.prototype,"attributes",void 0),v([M({type:String,json:{write:!0}})],Bo.prototype,"description",void 0),v([M({types:[DR]})],Bo.prototype,"mediaInfos",void 0),v([yi("mediaInfos")],Bo.prototype,"readMediaInfos",null),v([ni("mediaInfos")],Bo.prototype,"writeMediaInfos",null),v([M({type:String,json:{write:!0}})],Bo.prototype,"title",void 0),v([M({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Bo.prototype,"type",void 0),Bo=VS=v([me("esri.popup.content.MediaContent")],Bo);const V1=Bo;var US;let vy=US=class extends wt{constructor(e){super(e),this.field=null,this.order=null}clone(){return new US({field:this.field,order:this.order})}};v([M({type:String,json:{write:!0}})],vy.prototype,"field",void 0),v([M({type:["asc","desc"],json:{write:!0}})],vy.prototype,"order",void 0),vy=US=v([me("esri.popup.support.RelatedRecordsInfoFieldOrder")],vy);const zR=vy;let Ta=class extends Za(Au){constructor(t){super(t),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};v([M({type:String,json:{write:!0}})],Ta.prototype,"description",void 0),v([M({type:Number,json:{type:ar,write:!0}})],Ta.prototype,"displayCount",void 0),v([M({type:["list"],json:{write:!0}})],Ta.prototype,"displayType",void 0),v([M({type:[zR],json:{write:!0}})],Ta.prototype,"orderByFields",void 0),v([M({type:Number,json:{type:ar,write:!0}})],Ta.prototype,"relationshipId",void 0),v([M({type:String,json:{write:!0}})],Ta.prototype,"title",void 0),v([M({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Ta.prototype,"type",void 0),Ta=v([me("esri.popup.content.RelationshipContent")],Ta);const U1=Ta;var GS;let by=GS=class extends Au{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new GS({text:this.text})}};v([M({type:String,json:{write:!0}})],by.prototype,"text",void 0),v([M({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],by.prototype,"type",void 0),by=GS=v([me("esri.popup.content.TextContent")],by);const G1=by,jK={base:null,key:"type",typeMap:{attachment:B1,media:V1,text:G1,expression:DI,field:j1,relationship:U1}};var qS;let _h=qS=class extends wt{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new qS({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};v([M({type:String,json:{write:!0}})],_h.prototype,"name",void 0),v([M({type:String,json:{write:!0}})],_h.prototype,"title",void 0),v([M({type:String,json:{write:!0}})],_h.prototype,"expression",void 0),v([M({type:["string","number"],json:{write:!0}})],_h.prototype,"returnType",void 0),_h=qS=v([me("esri.popup.ExpressionInfo")],_h);const VK=_h;var HS;let wy=HS=class extends wt{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new HS({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};v([M({type:Boolean,json:{write:!0}})],wy.prototype,"returnTopmostRaster",void 0),v([M({type:Boolean,json:{write:!0}})],wy.prototype,"showNoDataRecords",void 0),wy=HS=v([me("esri.popup.LayerOptions")],wy);const UK=wy;var WS;let xy=WS=class extends wt{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new WS({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Ge(this.orderByFields):null})}};v([M({type:Boolean,json:{write:!0}})],xy.prototype,"showRelatedRecords",void 0),v([M({type:[zR],json:{write:!0}})],xy.prototype,"orderByFields",void 0),xy=WS=v([me("esri.popup.RelatedRecordsInfo")],xy);const GK=xy;var ZS;let uo=ZS=class extends cI(Pt){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new ZS({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};v([M()],uo.prototype,"active",void 0),v([M()],uo.prototype,"className",void 0),v([M()],uo.prototype,"disabled",void 0),v([M()],uo.prototype,"icon",void 0),v([M()],uo.prototype,"id",void 0),v([M()],uo.prototype,"indicator",void 0),v([M()],uo.prototype,"title",void 0),v([M()],uo.prototype,"type",void 0),v([M()],uo.prototype,"visible",void 0),uo=ZS=v([me("esri.support.actions.ActionBase")],uo);const NI=uo;var JS;let Av=JS=class extends NI{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new JS({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};v([M()],Av.prototype,"image",void 0),Av=JS=v([me("esri.support.Action.ActionButton")],Av);const qK=Av;var KS;let Sy=KS=class extends NI{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new KS({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};v([M()],Sy.prototype,"image",void 0),v([M()],Sy.prototype,"value",void 0),Sy=KS=v([me("esri.support.Action.ActionToggle")],Sy);const HK=Sy,sy="relationships/",kP="expression/",WK=At.ofType({key:"type",defaultKeyValue:"button",base:NI,typeMap:{button:qK,toggle:HK}}),ZK={base:Au,key:"type",typeMap:{media:V1,custom:RK,text:G1,attachments:B1,fields:j1,expression:DI,relationship:U1}},JK=new Set(["attachments","fields","media","text","expression","relationship"]);let jr=class extends Za(wt){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(t){return Array.isArray(t)?t.map(i=>Ul(ZK,i)):typeof t=="string"||typeof t=="function"||t instanceof HTMLElement||Tu(t)?t:(pt.getLogger(this).error("content error","unsupported content value",{value:t}),null)}readContent(t,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(t,i,r,s){typeof t!="string"?Array.isArray(t)&&(i.popupElements=t.filter(a=>JK.has(a.type)).map(a=>a==null?void 0:a.toJSON(s)),i.popupElements.forEach(a=>{a.type==="attachments"?this._writeAttachmentContent(i):a.type==="media"?this._writeMediaContent(a,i):a.type==="text"?this._writeTextContent(a,i):a.type==="relationship"&&this._writeRelationshipContent(a,i)})):i.description=t}writeFieldInfos(t,i,r,s){const{content:a}=this,u=Array.isArray(a)?a:null;if(t){const l=u?u.filter(w=>w.type==="fields"):[],y=l.length&&l.every(w=>{var I;return(I=w.fieldInfos)==null?void 0:I.length});i.fieldInfos=t.filter(Boolean).map(w=>{const I=w.toJSON(s);return y&&(I.visible=!1),I})}if(u)for(const l of u)l.type==="fields"&&this._writeFieldsContent(l,i)}writeLayerOptions(t,i,r,s){i[r]=!t||t.showNoDataRecords===null&&t.returnTopmostRaster===null?null:t.toJSON(s)}writeTitle(t,i){i.title=t||""}async collectRequiredFields(t,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(t,i,[...r,...this._getContentExpressionInfos(this.content,r)]),Cg(t,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(t){const i=new Set;return await this.collectRequiredFields(i,t),[...i].sort()}_writeFieldsContent(t,i){if(!Array.isArray(t.fieldInfos)||!t.fieldInfos.length)return;const r=Ge(t.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const a=i.fieldInfos.find(u=>u.fieldName.toLowerCase()===s.fieldName.toLowerCase());a?a.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(t){t.showAttachments||(t.showAttachments=!0)}_writeRelationshipContent(t,i){var a,u;const r=((a=t.orderByFields)==null?void 0:a.map(l=>this._toFieldOrderJSON(l,t.relationshipId)))||[],s=[...((u=i.relatedRecordsInfo)==null?void 0:u.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(t,i){!i.description&&t.text&&(i.description=t.text)}_writeMediaContent(t,i){if(!Array.isArray(t.mediaInfos)||!t.mediaInfos.length)return;const r=Ge(t.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(t,i,r){const s={description:!1,mediaInfos:!1};return r.map(a=>a.type==="media"?(a.mediaInfos||!i||s.mediaInfos||(a.mediaInfos=i,s.mediaInfos=!0),V1.fromJSON(a)):a.type==="text"?(a.text||!t||s.description||(a.text=t,s.description=!0),G1.fromJSON(a)):a.type==="attachments"?B1.fromJSON(a):a.type==="fields"?j1.fromJSON(a):a.type==="expression"?DI.fromJSON(a):a.type==="relationship"?U1.fromJSON(a):void 0).filter(Boolean)}_toRelationshipContent(t){const{field:i,order:r}=t;if(!(i!=null&&i.startsWith(sy)))return null;const s=i.replace(sy,"").split("/");if(s.length!==2)return null;const a=parseInt(s[0],10),u=s[1];return typeof a=="number"&&u?U1.fromJSON({relationshipId:a,orderByFields:[{field:u,order:r}]}):null}_toFieldOrderJSON(t,i){const{order:r,field:s}=t;return{field:`${sy}${i}/${s}`,order:r}}_readPopupInfo({description:t,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const a=[];t?a.push(new G1({text:t})):a.push(new j1),Array.isArray(i)&&i.length&&a.push(V1.fromJSON({mediaInfos:i})),r&&a.push(B1.fromJSON({displayType:"auto"}));const{showRelatedRecords:u,orderByFields:l}=s;return u&&(l!=null&&l.length)&&l.forEach(y=>{const w=this._toRelationshipContent(y);w&&a.push(w)}),a.length?a:t}_getContentElementFields(t){const i=t==null?void 0:t.type;if(i==="attachments")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)];if(i==="custom")return t.outFields||[];if(i==="fields")return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...this._getFieldInfoFields(t.fieldInfos??this.fieldInfos)];if(i==="media"){const r=t.mediaInfos||[];return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...r.reduce((s,a)=>[...s,...this._getMediaInfoFields(a)],[])]}return i==="text"?this._extractFieldNames(t.text):[]}_getMediaInfoFields(t){const{caption:i,title:r,value:s}=t,a=s||{},{fields:u,normalizeField:l,tooltipField:y,sourceURL:w,linkURL:I}=a,E=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(w),...this._extractFieldNames(I),...u??[]];return l&&E.push(l),y&&E.push(y),E}_getContentExpressionInfos(t,i){return Array.isArray(t)?t.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(t){return typeof t=="string"?this._extractFieldNames(t):Array.isArray(t)?t.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(t,i,r){r&&await Promise.all(r.map(s=>_d(t,i,s.expression)))}_getFieldInfoFields(t){return t?t.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(sy)&&!i.startsWith(kP)):[]}_getActionsFields(t){return t?t.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(t){const{className:i,title:r,type:s}=t,a=s==="button"||s==="toggle"?t.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(a)]}_getTitleFields(t){return typeof t=="string"?this._extractFieldNames(t):[]}_extractFieldNames(t){if(!t||typeof t!="string")return[];const i=/{[^}]*}/g,r=t.match(i);if(!r)return[];const s=/\{(\w+):.+\}/,a=r.filter(u=>!(u.indexOf(`{${sy}`)===0||u.indexOf(`{${kP}`)===0)).map(u=>u.replace(s,"{$1}"));return a?a.map(u=>u.slice(1,-1)):[]}};v([M({type:WK})],jr.prototype,"actions",void 0),v([M()],jr.prototype,"content",void 0),v([es("content")],jr.prototype,"castContent",null),v([yi("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],jr.prototype,"readContent",null),v([ni("content",{popupElements:{type:At.ofType(jK)},showAttachments:{type:Boolean},mediaInfos:{type:At.ofType(DR)},description:{type:String},relatedRecordsInfo:{type:GK}})],jr.prototype,"writeContent",null),v([M({type:[VK],json:{write:!0}})],jr.prototype,"expressionInfos",void 0),v([M({type:[PR]})],jr.prototype,"fieldInfos",void 0),v([ni("fieldInfos")],jr.prototype,"writeFieldInfos",null),v([M({type:UK})],jr.prototype,"layerOptions",void 0),v([ni("layerOptions")],jr.prototype,"writeLayerOptions",null),v([M({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],jr.prototype,"lastEditInfoEnabled",void 0),v([M()],jr.prototype,"outFields",void 0),v([M()],jr.prototype,"overwriteActions",void 0),v([M()],jr.prototype,"returnGeometry",void 0),v([M({json:{type:String}})],jr.prototype,"title",void 0),v([ni("title")],jr.prototype,"writeTitle",null),jr=v([me("esri.PopupTemplate")],jr);const KK=jr,AP=new hs({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let YK=0,kp=class extends wt{constructor(t){super(t),this.id="sym"+YK++,this.type=null,this.color=new oi([0,0,0,1])}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}async collectRequiredFields(t,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};v([M({type:AP.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:AP.write}}})],kp.prototype,"type",void 0),v([M({type:oi,json:{write:{allowNull:!0}}})],kp.prototype,"color",void 0),v([yi("color")],kp.prototype,"readColor",null),kp=v([me("esri.symbols.Symbol")],kp);const Jn=kp;var YS;let Fc=YS=class extends Jn{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){Object.assign(t,e)}async collectRequiredFields(e,t){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const s=r.map(a=>{const u=a.valueExpressionInfo;return u?_d(e,t,u.expression):null});await Promise.all(s)}}}clone(){return new YS({data:Ge(this.data)})}hash(){return T$(JSON.stringify(this.data)).toString()}};v([M({json:{write:!1}})],Fc.prototype,"color",void 0),v([M({json:{write:!0}})],Fc.prototype,"data",void 0),v([yi("data",["symbol"])],Fc.prototype,"readData",null),v([ni("data",{})],Fc.prototype,"writeData",null),v([Ot({CIMSymbolReference:"cim"},{readOnly:!0})],Fc.prototype,"type",void 0),Fc=YS=v([me("esri.symbols.CIMSymbol")],Fc);const Bb=Fc;let Ap=class extends wt{constructor(t){super(t),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(t,i,r){t||(i[r]=t)}};v([M({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],Ap.prototype,"enabled",void 0),v([ni("enabled")],Ap.prototype,"writeEnabled",null),v([M({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],Ap.prototype,"type",void 0),Ap=v([me("esri.symbols.Symbol3DLayer")],Ap);const Ja=Ap;function XK(e,t){const i=t.transparency!=null?DL(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new oi([r[0]||0,r[1]||0,r[2]||0,i]):null}function QK(e,t){t.color=e.toJSON().slice(0,3);const i=RL(e.a);i!==0&&(t.transparency=i)}const Pu={type:oi,json:{type:[ar],default:null,read:{source:["color","transparency"],reader:XK},write:{target:{color:{type:[ar]},transparency:{type:ar}},writer:QK}}},qa={type:Number,cast:Qi,json:{write:!0}};let vh=class extends wt{constructor(t){super(t),this.color=new oi([0,0,0,1]),this.extensionLength=0,this.size=fd(1)}clone(){}cloneProperties(){return{color:Ge(this.color),size:this.size,extensionLength:this.extensionLength}}};v([M({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],vh.prototype,"type",void 0),v([M(Pu)],vh.prototype,"color",void 0),v([M({...qa,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],vh.prototype,"extensionLength",void 0),v([M(qa)],vh.prototype,"size",void 0),vh=v([me("esri.symbols.edges.Edges3D")],vh);const FI=vh;var XS;let Pv=XS=class extends FI{constructor(e){super(e),this.type="sketch"}clone(){return new XS(this.cloneProperties())}};v([Ot({sketch:"sketch"},{readOnly:!0})],Pv.prototype,"type",void 0),Pv=XS=v([me("esri.symbols.edges.SketchEdges3D")],Pv);const eY=Pv;var QS;let Cv=QS=class extends FI{constructor(e){super(e),this.type="solid"}clone(){return new QS(this.cloneProperties())}};v([Ot({solid:"solid"},{readOnly:!0})],Cv.prototype,"type",void 0),Cv=QS=v([me("esri.symbols.support.SolidEdges3D")],Cv);const tY=Cv,NR={types:{key:"type",base:FI,typeMap:{solid:tY,sketch:eY}},json:{write:!0}};var eT;let bo=eT=class extends wt{constructor(e){super(e),this.color=null}clone(){const e={color:this.color!=null?this.color.clone():null};return new eT(e)}};v([M(Pu)],bo.prototype,"color",void 0),bo=eT=v([me("esri.symbols.support.Symbol3DMaterial")],bo);var tT;let Bc=tT=class extends Ja{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new tT({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};v([Ot({Extrude:"extrude"},{readOnly:!0})],Bc.prototype,"type",void 0),v([M({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Bc.prototype,"size",void 0),v([M({type:bo,json:{write:!0}})],Bc.prototype,"material",void 0),v([M({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Bc.prototype,"castShadows",void 0),v([M(NR)],Bc.prototype,"edges",void 0),Bc=tT=v([me("esri.symbols.ExtrudeSymbol3DLayer")],Bc);const FR=Bc;let Ty=class extends Jn{constructor(t){super(t),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};v([Ot({esriSLS:"simple-line"},{readOnly:!0})],Ty.prototype,"type",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],Ty.prototype,"width",void 0),Ty=v([me("esri.symbols.LineSymbol")],Ty);const iY=Ty,rY=["begin","end","begin-end"],BR=["arrow","circle","square","diamond","cross","x"];var iT;let Ma=iT=class extends wt{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new iT({color:Ge(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};v([M({type:["begin","end","begin-end"],json:{write:!0}})],Ma.prototype,"placement",void 0),v([Ot({"line-marker":"line-marker"},{readOnly:!0}),M({json:{origins:{"web-map":{write:!1}}}})],Ma.prototype,"type",void 0),v([M({type:BR})],Ma.prototype,"style",void 0),v([ni("style")],Ma.prototype,"writeStyle",null),v([M({type:oi,value:null,json:{write:{allowNull:!0}}})],Ma.prototype,"color",null),v([yi("color")],Ma.prototype,"readColor",null),v([ni("color")],Ma.prototype,"writeColor",null),Ma=iT=v([me("esri.symbols.LineSymbolMarker")],Ma);const sY=Ma;var rT;const Vx=new hs({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let kl=rT=class extends iY{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,a){if(e&&typeof e!="string")return e;const u={};return e!=null&&(u.style=e),t!=null&&(u.color=t),i!=null&&(u.width=Qi(i)),r!=null&&(u.cap=r),s!=null&&(u.join=s),a!=null&&(u.miterLimit=Qi(a)),u}clone(){var e;return new rT({color:Ge(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};v([Ot({esriSLS:"simple-line"},{readOnly:!0})],kl.prototype,"type",void 0),v([M({type:Vx.apiValues,json:{read:Vx.read,write:Vx.write}})],kl.prototype,"style",void 0),v([M({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null?void 0:i.origin)==null})}}})],kl.prototype,"cap",void 0),v([M({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null?void 0:i.origin)==null})}}})],kl.prototype,"join",void 0),v([M({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":sY}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],kl.prototype,"marker",void 0),v([M({type:Number,json:{read:!1,write:!1}})],kl.prototype,"miterLimit",void 0),kl=rT=v([me("esri.symbols.SimpleLineSymbol")],kl);const Pf=kl;let My=class extends Jn{constructor(t){super(t),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};v([M({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Pf}},json:{default:null,write:!0}})],My.prototype,"outline",void 0),v([M({type:["simple-fill","picture-fill"],readOnly:!0})],My.prototype,"type",void 0),My=v([me("esri.symbols.FillSymbol")],My);const jR=My;let $v=class extends wt{constructor(t){super(t)}clone(){}};v([M({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],$v.prototype,"type",void 0),$v=v([me("esri.symbols.patterns.LinePattern3D")],$v);const VR=$v,nY=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var sT;const oY=In()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let Iy=sT=class extends VR{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new sT(e)}};v([M({type:["style"]})],Iy.prototype,"type",void 0),v([Ot(oY),M({type:nY})],Iy.prototype,"style",void 0),Iy=sT=v([me("esri.symbols.patterns.LineStylePattern3D")],Iy);const BI=Iy;let Ov=class extends wt{constructor(t){super(t)}clone(){}};v([M({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Ov.prototype,"type",void 0),Ov=v([me("esri.symbols.patterns.Pattern3D")],Ov);const UR=Ov,aY=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var nT;let Ey=nT=class extends UR{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new nT(e)}};v([M({type:["style"]})],Ey.prototype,"type",void 0),v([M({type:aY,json:{read:!0,write:!0}})],Ey.prototype,"style",void 0),Ey=nT=v([me("esri.symbols.patterns.StylePattern3D")],Ey);const GR=Ey,lY={types:{key:"type",base:UR,typeMap:{style:GR}},json:{write:!0}},qR={types:{key:"type",base:VR,typeMap:{style:BI}},json:{write:!0}},og=new oi("white");new oi("black");const cY=new oi([255,255,255,0]);function uY(e){return e.r===0&&e.g===0&&e.b===0}var oT;let ag=oT=class extends bo{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new oT(e)}};v([Ot({multiply:"multiply",replace:"replace",tint:"tint"})],ag.prototype,"colorMixMode",void 0),ag=oT=v([me("esri.symbols.support.Symbol3DFillMaterial")],ag);function jI(e=mY){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function VI(e,t,i,r,s,a,u=jI()){return u[0]=e,u[1]=t,u[2]=i,u[3]=r,u[4]=s,u[5]=a,u}function nce(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new tr(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function oce(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function ace(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function lce(e,t,i=0,r=t.length/3){let s=e[0],a=e[1],u=e[2],l=e[3],y=e[4],w=e[5];for(let I=0;I<r;I++)s=Math.min(s,t[i+3*I]),a=Math.min(a,t[i+3*I+1]),u=Math.min(u,t[i+3*I+2]),l=Math.max(l,t[i+3*I]),y=Math.max(y,t[i+3*I+1]),w=Math.max(w,t[i+3*I+2]);e[0]=s,e[1]=a,e[2]=u,e[3]=l,e[4]=y,e[5]=w}function hY(e){return e[0]>=e[3]?0:e[3]-e[0]}function dY(e){return e[1]>=e[4]?0:e[4]-e[1]}function pY(e){return e[2]>=e[5]?0:e[5]-e[2]}function cce(e,t=[0,0,0]){return t[0]=hY(e),t[1]=dY(e),t[2]=pY(e),t}function uce(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function hce(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function fY(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function dce(e){return e?fY(e,CP):jI(CP)}function pce(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function fce(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=Number.NEGATIVE_INFINITY,e[3]=r,e[4]=s,e[5]=Number.POSITIVE_INFINITY,e}function PP(e){return e.length===6}function mce(e,t,i){if(e==null||t==null)return e===t;if(!PP(e)||!PP(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const CP=[1/0,1/0,1/0,-1/0,-1/0,-1/0],mY=[0,0,0,0,0,0];jI();const yY=VI(-.5,-.5,-.5,.5,.5,.5),gY=VI(-.5,-.5,0,.5,.5,1),_Y=VI(-.5,-.5,0,.5,.5,.5);function yce(e){switch(e){case"sphere":case"cube":case"diamond":return yY;case"cylinder":case"cone":case"inverted-cone":return gY;case"tetrahedron":return _Y;default:return}}const UI=["butt","square","round"],vY=[...UI,"none"],HR=["miter","bevel","round"];var aT;let bh=aT=class extends wt{constructor(e){super(e),this.color=new oi([0,0,0,1]),this.size=fd(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new aT(e)}};v([M(Pu)],bh.prototype,"color",void 0),v([M(qa)],bh.prototype,"size",void 0),v([M(qR)],bh.prototype,"pattern",void 0),v([M({type:UI,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],bh.prototype,"patternCap",void 0),bh=aT=v([me("esri.symbols.support.Symbol3DOutline")],bh);var Lv;let Al=Lv=class extends Ja{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new Lv(e)}static fromSimpleFillSymbol(e){var r,s,a;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new BI({style:e.outline.style}):null,i={size:((r=e.outline)==null?void 0:r.width)??0,color:(((s=e.outline)==null?void 0:s.color)??og).clone(),pattern:t};return t&&((a=e.outline)!=null&&a.cap)&&(i.patternCap=e.outline.cap),new Lv({material:new ag({color:(e.color??cY).clone()}),pattern:e.style&&e.style!=="solid"?new GR({style:e.style}):null,outline:i})}};v([Ot({Fill:"fill"},{readOnly:!0})],Al.prototype,"type",void 0),v([M({type:ag,json:{write:!0}})],Al.prototype,"material",void 0),v([M(lY)],Al.prototype,"pattern",void 0),v([M({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Al.prototype,"castShadows",void 0),v([M({type:bh,json:{write:!0}})],Al.prototype,"outline",void 0),v([M(NR)],Al.prototype,"edges",void 0),Al=Lv=v([me("esri.symbols.FillSymbol3DLayer")],Al);const Qg=Al,bY=["none","underline","line-through"],wY=["normal","italic","oblique"],xY=["normal","lighter","bold","bolder"],WR={type:Number,cast:e=>{const t=Wo(e);return t===0?1:Va(t,.1,4)},nonNullable:!0},SY=["left","right","center"],TY=["baseline","top","middle","bottom"],ZR={type:SY,nonNullable:!0},JR={type:TY,nonNullable:!0},gce=8;var lT;let Pl=lT=class extends wt{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Qi(e)}clone(){return new lT({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};v([M({type:bY,json:{default:"none",write:!0}})],Pl.prototype,"decoration",void 0),v([M({type:String,json:{write:!0}})],Pl.prototype,"family",void 0),v([M({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],Pl.prototype,"size",void 0),v([es("size")],Pl.prototype,"castSize",null),v([M({type:wY,json:{default:"normal",write:!0}})],Pl.prototype,"style",void 0),v([M({type:xY,json:{default:"normal",write:!0}})],Pl.prototype,"weight",void 0),Pl=lT=v([me("esri.symbols.Font")],Pl);const jb=Pl;var cT;const MY=In()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let wh=cT=class extends wt{constructor(e){super(e)}readHref(e,t,i){return e?Hg(e,i):t.dataURI}writeHref(e,t,i,r){e&&(wd(e)?t.dataURI=e:(t.href=vb(e,r),Hn(t.href)&&(t.href=du(t.href))))}clone(){return new cT({href:this.href,primitive:this.primitive})}};v([M({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],wh.prototype,"href",void 0),v([yi("href")],wh.prototype,"readHref",null),v([ni("href",{href:{type:String},dataURI:{type:String}})],wh.prototype,"writeHref",null),v([Ot(MY)],wh.prototype,"primitive",void 0),wh=cT=v([me("esri.symbols.support.IconSymbol3DLayerResource")],wh);var uT;let Wp=uT=class extends Pt{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new uT({x:this.x,y:this.y})}};v([M({type:Number})],Wp.prototype,"x",void 0),v([M({type:Number})],Wp.prototype,"y",void 0),Wp=uT=v([me("esri.symbols.support.Symbol3DAnchorPosition2D")],Wp);var hT;let ky=hT=class extends wt{constructor(e){super(e),this.color=new oi([0,0,0,1]),this.size=fd(1)}clone(){const e={color:this.color!=null?this.color.clone():null,size:this.size};return new hT(e)}};v([M(Pu)],ky.prototype,"color",void 0),v([M(qa)],ky.prototype,"size",void 0),ky=hT=v([me("esri.symbols.support.Symbol3DIconOutline")],ky);var Pp;const KR="esri.symbols.IconSymbol3DLayer";let Ia=Pp=class extends Ja{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new Pp({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||og,i=$P(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||og).clone()}:null;return new Pp({size:e.size,resource:{primitive:EY(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||uY(e.color)?og:e.color,i=$P(e);return new Pp({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new Pp({resource:{href:IO({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function $P(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=OP(e.xoffset),s=OP(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function OP(e){return isFinite(e)?e:0}v([M({type:bo,json:{write:!0}})],Ia.prototype,"material",void 0),v([M({type:wh,json:{write:!0}})],Ia.prototype,"resource",void 0),v([Ot({Icon:"icon"},{readOnly:!0})],Ia.prototype,"type",void 0),v([M(qa)],Ia.prototype,"size",void 0),v([Ot({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),M({json:{default:"center"}})],Ia.prototype,"anchor",void 0),v([M({type:Wp,json:{type:[Number],read:{reader:e=>new Wp({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ia.prototype,"anchorPosition",void 0),v([M({type:ky,json:{write:!0}})],Ia.prototype,"outline",void 0),Ia=Pp=v([me(KR)],Ia);const IY={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function EY(e){return IY[e]||(pt.getLogger(KR).warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Kh=Ia;let xh=class extends Za(wt){constructor(t){super(t),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(t){return t!=null&&t.placement===this.placement&&t.style===this.style&&(this.color==null&&t.color==null||this.color!=null&&t.color!=null&&this.color.toJSON()===t.color.toJSON())}};v([M({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],xh.prototype,"type",void 0),v([M({type:rY,json:{default:"begin-end",write:!0}})],xh.prototype,"placement",void 0),v([M({type:BR,json:{default:"arrow",write:!0}})],xh.prototype,"style",void 0),v([M({type:oi,json:{type:[ar],default:null,write:!0}})],xh.prototype,"color",void 0),xh=v([me("esri.symbols.LineStyleMarker3D")],xh);const dT=xh;var Rv;let Ea=Rv=class extends Ja{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=fd(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new Rv(e)}static fromSimpleLineSymbol(e){var i;const t={enabled:!0,size:e.width??fd(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new BI({style:e.style}):null,material:new bo({color:(e.color||og).clone()}),marker:e.marker?new dT({placement:e.marker.placement,style:e.marker.style,color:((i=e.marker.color)==null?void 0:i.clone())??null}):null};return new Rv(t)}};v([M({type:bo,json:{write:!0}})],Ea.prototype,"material",void 0),v([Ot({Line:"line"},{readOnly:!0})],Ea.prototype,"type",void 0),v([M({type:HR,json:{write:!0,default:"miter"}})],Ea.prototype,"join",void 0),v([M({type:UI,json:{write:!0,default:"butt"}})],Ea.prototype,"cap",void 0),v([M(qa)],Ea.prototype,"size",void 0),v([M(qR)],Ea.prototype,"pattern",void 0),v([M({types:{key:"type",base:dT,typeMap:{style:dT}},json:{write:!0}})],Ea.prototype,"marker",void 0),Ea=Rv=v([me("esri.symbols.LineSymbol3DLayer")],Ea);const e0=Ea;var pT;const kY=In()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let Ay=pT=class extends wt{clone(){return new pT({href:this.href,primitive:this.primitive})}};v([M({type:String,json:{read:YM,write:df}})],Ay.prototype,"href",void 0),v([Ot(kY)],Ay.prototype,"primitive",void 0),Ay=pT=v([me("esri.symbols.support.ObjectSymbol3DLayerResource")],Ay);var fT;let Nh=fT=class extends Pt{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new fT({x:this.x,y:this.y,z:this.z})}};v([M({type:Number})],Nh.prototype,"x",void 0),v([M({type:Number})],Nh.prototype,"y",void 0),v([M({type:Number})],Nh.prototype,"z",void 0),Nh=fT=v([me("esri.symbols.support.Symbol3DAnchorPosition3D")],Nh);var mT;let ks=mT=class extends Ja{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var e,t,i;return new mT({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(e=this.anchorPosition)==null?void 0:e.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((t=this.material)==null?void 0:t.clone())??null,castShadows:this.castShadows,resource:(i=this.resource)==null?void 0:i.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};v([M({type:bo,json:{write:!0}})],ks.prototype,"material",void 0),v([M({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ks.prototype,"castShadows",void 0),v([M({type:Ay,json:{write:!0}})],ks.prototype,"resource",void 0),v([Ot({Object:"object"},{readOnly:!0})],ks.prototype,"type",void 0),v([M({type:Number,json:{write:!0}})],ks.prototype,"width",void 0),v([M({type:Number,json:{write:!0}})],ks.prototype,"height",void 0),v([M({type:Number,json:{write:!0}})],ks.prototype,"depth",void 0),v([Ot({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),M({json:{default:"origin"}})],ks.prototype,"anchor",void 0),v([M({type:Nh,json:{type:[Number],read:{reader:e=>new Nh({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ks.prototype,"anchorPosition",void 0),v([M({type:Number,json:{write:!0}})],ks.prototype,"heading",void 0),v([M({type:Number,json:{write:!0}})],ks.prototype,"tilt",void 0),v([M({type:Number,json:{write:!0}})],ks.prototype,"roll",void 0),v([M({readOnly:!0})],ks.prototype,"isPrimitive",null),ks=mT=v([me("esri.symbols.ObjectSymbol3DLayer")],ks);const GI=ks;var yT;let Ys=yT=class extends Ja{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e??(t.height==null&&t.size!=null?t.size:void 0)}readHeight(e,t){return e??(t.width==null&&t.size!=null?t.size:void 0)}clone(){return new yT({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};v([M({type:bo,json:{write:!0}})],Ys.prototype,"material",void 0),v([M({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ys.prototype,"castShadows",void 0),v([Ot({Path:"path"},{readOnly:!0})],Ys.prototype,"type",void 0),v([M({type:["circle","quad"],json:{write:!0,default:"circle"}})],Ys.prototype,"profile",void 0),v([M({type:HR,json:{write:!0,default:"miter"}})],Ys.prototype,"join",void 0),v([M({type:vY,json:{write:!0,default:"butt"}})],Ys.prototype,"cap",void 0),v([M({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Ys.prototype,"width",void 0),v([yi("width",["width","size","height"])],Ys.prototype,"readWidth",null),v([M({type:Number,json:{write:!0}})],Ys.prototype,"height",void 0),v([yi("height",["height","size","width"])],Ys.prototype,"readHeight",null),v([M({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Ys.prototype,"anchor",void 0),v([M({type:["heading","all"],json:{write:!0,default:"all"}})],Ys.prototype,"profileRotation",void 0),Ys=yT=v([me("esri.symbols.PathSymbol3DLayer")],Ys);const qI=Ys;var gT;let Zp=gT=class extends wt{constructor(){super(...arguments),this.color=new oi([0,0,0,1]),this.size=0}clone(){const e={color:Ge(this.color),size:this.size};return new gT(e)}};v([M(Pu)],Zp.prototype,"color",void 0),v([M(qa)],Zp.prototype,"size",void 0),Zp=gT=v([me("esri.symbols.support.Symbol3DHalo")],Zp);let lg=class extends Za(wt){constructor(t){super(t),this.color=null}};v([M(Pu)],lg.prototype,"color",void 0),lg=v([me("esri.symbols.support.Symbol3DTextBackground")],lg);var Dv;let gn=Dv=class extends Ja{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){e!=null&&this._userSize!=null&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s={...r,textSymbol3D:!0};t.font=e.write({},s),delete t.font.size}get size(){var e;return this._userSize!=null?this._userSize:((e=this.font)==null?void 0:e.size)!=null?this.font.size:9}set size(e){this._userSize=e,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new Dv({enabled:this.enabled,font:this.font&&Ge(this.font),halo:this.halo&&Ge(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Ge(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new Dv({font:e.font!=null?e.font.clone():new jb,halo:AY(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new bo({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new lg({color:e.backgroundColor.clone()}):null})}};function AY(e,t){return e&&t!=null&&t>0?new Zp({color:Ge(e),size:t}):null}v([M({type:jb,json:{write:!0}})],gn.prototype,"font",null),v([ni("font")],gn.prototype,"writeFont",null),v([M({type:Zp,json:{write:!0}})],gn.prototype,"halo",void 0),v([M({...ZR,json:{default:"center",write:!0}})],gn.prototype,"horizontalAlignment",void 0),v([M({...WR,json:{default:1,write:!0}})],gn.prototype,"lineHeight",void 0),v([M({type:bo,json:{write:!0}})],gn.prototype,"material",void 0),v([M({type:lg,json:{write:!0}})],gn.prototype,"background",void 0),v([M(qa)],gn.prototype,"size",null),v([M({type:String,json:{write:!0}})],gn.prototype,"text",void 0),v([Ot({Text:"text"},{readOnly:!0})],gn.prototype,"type",void 0),v([M({...JR,json:{default:"baseline",write:!0}})],gn.prototype,"verticalAlignment",void 0),gn=Dv=v([me("esri.symbols.TextSymbol3DLayer")],gn);const Cf=gn;var _T;let jc=_T=class extends Ja{constructor(e){super(e),this.color=vT.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new _T({color:Ge(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};v([M({type:oi,nonNullable:!0,json:{type:[ar],write:(e,t,i)=>t[i]=e.toArray(oi.AlphaMode.UNLESS_OPAQUE),default:()=>vT.clone(),defaultEquals:e=>e.toCss(!0)===vT.toCss(!0)}})],jc.prototype,"color",void 0),v([Ot({Water:"water"},{readOnly:!0})],jc.prototype,"type",void 0),v([M({type:["small","medium","large"],json:{write:!0,default:"medium"}})],jc.prototype,"waterbodySize",void 0),v([M({type:Number,json:{write:!0,default:null}})],jc.prototype,"waveDirection",void 0),v([M({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],jc.prototype,"waveStrength",void 0),jc=_T=v([me("esri.symbols.WaterSymbol3DLayer")],jc);const vT=new oi([0,119,190]),YR=jc;var bT;let Sh=bT=class extends Pt{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new bT({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};v([M({type:String})],Sh.prototype,"name",void 0),v([M({type:String})],Sh.prototype,"styleUrl",void 0),v([M({type:String})],Sh.prototype,"styleName",void 0),v([M({type:_u})],Sh.prototype,"portal",void 0),Sh=bT=v([me("esri.symbols.support.StyleOrigin")],Sh);const wT=Sh;var xT;let cg=xT=class extends Pt{constructor(){super(...arguments),this.url=""}clone(){return new xT({url:this.url})}};v([M({type:String})],cg.prototype,"url",void 0),cg=xT=v([me("esri.symbols.support.Thumbnail")],cg);const XR={icon:Kh,object:GI,line:e0,path:qI,fill:Qg,extrude:FR,text:Cf,water:YR},PY=At.ofType({base:Ja,key:"type",typeMap:XR,errorContext:"symbol-layer"});let ka=class extends Jn{constructor(t){super(t),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i==null?void 0:i.type,s=r||At;this._set("symbolLayers",new s)}get color(){return null}set color(t){this.constructed&&pt.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(t){ad(t,this._get("symbolLayers"))}readStyleOrigin(t,i,r){if(t.styleUrl&&t.name){const s=Hg(t.styleUrl,r);return new wT({styleUrl:s,name:t.name})}if(t.styleName&&t.name)return new wT({portal:(r==null?void 0:r.portal)||_u.getDefault(),styleName:t.styleName,name:t.name});r!=null&&r.messages&&r.messages.push(new Gl("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:t}))}writeStyleOrigin(t,i,r,s){if(t.styleUrl&&t.name){let a=vb(t.styleUrl,s);Hn(a)&&(a=du(a)),i.styleOrigin={styleUrl:a,name:t.name}}else t.styleName&&t.name&&(t.portal&&(s!=null&&s.portal)&&!SB(t.portal.restUrl,s.portal.restUrl)?s!=null&&s.messages&&s.messages.push(new Gl("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:t.styleName,name:t.name})}normalizeCtorArgs(t){return t instanceof Ja||t&&XR[t.type]?{symbolLayers:[t]}:Array.isArray(t)?{symbolLayers:t}:t}};v([M({json:{read:!1,write:!1}})],ka.prototype,"color",null),v([M({type:PY,nonNullable:!0,json:{write:!0}}),es(NO)],ka.prototype,"symbolLayers",null),v([M({type:wT})],ka.prototype,"styleOrigin",void 0),v([yi("styleOrigin")],ka.prototype,"readStyleOrigin",null),v([ni("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],ka.prototype,"writeStyleOrigin",null),v([M({type:cg,json:{read:!1}})],ka.prototype,"thumbnail",void 0),v([M({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],ka.prototype,"type",void 0),ka=v([me("esri.symbols.Symbol3D")],ka);const t0=ka;let Py=class extends wt{constructor(t){super(t),this.visible=!0}clone(){}};v([M({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],Py.prototype,"type",void 0),v([M({readOnly:!0})],Py.prototype,"visible",void 0),Py=v([me("esri.symbols.callouts.Callout3D")],Py);const QR=Py;var ST;let zv=ST=class extends wt{constructor(e){super(e),this.color=new oi("white")}clone(){return new ST({color:Ge(this.color)})}};v([M(Pu)],zv.prototype,"color",void 0),zv=ST=v([me("esri.symbols.callouts.LineCallout3DBorder")],zv);const CY=zv;var TT;let Vc=TT=class extends QR{constructor(e){super(e),this.type="line",this.color=new oi([0,0,0,1]),this.size=fd(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new TT({color:Ge(this.color),size:this.size,border:Ge(this.border)})}};v([Ot({line:"line"})],Vc.prototype,"type",void 0),v([M(Pu)],Vc.prototype,"color",void 0),v([M(qa)],Vc.prototype,"size",void 0),v([M({type:CY,json:{write:!0}})],Vc.prototype,"border",void 0),v([M({readOnly:!0})],Vc.prototype,"visible",null),Vc=TT=v([me("esri.symbols.callouts.LineCallout3D")],Vc);const eD=Vc;function HI(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength!=null&&t.maxWorldLength<=0)}function tD(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!HI(e)}const iD={types:{key:"type",base:QR,typeMap:{line:eD}},json:{write:!0}};var MT;let Cp=MT=class extends wt{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new MT({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};v([M(qa)],Cp.prototype,"screenLength",void 0),v([M({type:Number,nonNullable:!0,json:{write:!0,default:0}})],Cp.prototype,"minWorldLength",void 0),v([M({type:Number,json:{write:!0}})],Cp.prototype,"maxWorldLength",void 0),Cp=MT=v([me("esri.symbols.support.Symbol3DVerticalOffset")],Cp);const WI=Cp;var Nv;const rD=At.ofType({base:null,key:"type",typeMap:{text:Cf}});let Uc=Nv=class extends t0{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new rD,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return tD(this)}hasVisibleVerticalOffset(){return HI(this)}clone(){return new Nv({styleOrigin:Ge(this.styleOrigin),symbolLayers:Ge(this.symbolLayers),thumbnail:Ge(this.thumbnail),callout:Ge(this.callout),verticalOffset:Ge(this.verticalOffset)})}static fromTextSymbol(e){return new Nv({symbolLayers:new At([Cf.fromTextSymbol(e)])})}};v([M({type:WI,json:{write:!0}})],Uc.prototype,"verticalOffset",void 0),v([M(iD)],Uc.prototype,"callout",void 0),v([M({json:{read:!1,write:!1}})],Uc.prototype,"styleOrigin",void 0),v([M({type:rD})],Uc.prototype,"symbolLayers",void 0),v([Ot({LabelSymbol3D:"label-3d"},{readOnly:!0})],Uc.prototype,"type",void 0),Uc=Nv=v([me("esri.symbols.LabelSymbol3D")],Uc);const ZI=Uc;var Fv;const sD=At.ofType({base:null,key:"type",typeMap:{line:e0,path:qI}}),$Y=At.ofType({base:null,key:"type",typeMap:{line:e0,path:qI}});let Cy=Fv=class extends t0{constructor(e){super(e),this.symbolLayers=new sD,this.type="line-3d"}clone(){return new Fv({styleOrigin:Ge(this.styleOrigin),symbolLayers:Ge(this.symbolLayers),thumbnail:Ge(this.thumbnail)})}static fromSimpleLineSymbol(e){return new Fv({symbolLayers:new At([e0.fromSimpleLineSymbol(e)])})}};v([M({type:sD,json:{type:$Y}})],Cy.prototype,"symbolLayers",void 0),v([Ot({LineSymbol3D:"line-3d"},{readOnly:!0})],Cy.prototype,"type",void 0),Cy=Fv=v([me("esri.symbols.LineSymbol3D")],Cy);const JI=Cy;let Gc=class extends Jn{constructor(t){super(t),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};v([M({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Gc.prototype,"angle",void 0),v([M({type:["simple-marker","picture-marker"],readOnly:!0})],Gc.prototype,"type",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],Gc.prototype,"xoffset",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],Gc.prototype,"yoffset",void 0),v([M({type:Number,cast:e=>e==="auto"?e:Qi(e),json:{write:!0}})],Gc.prototype,"size",void 0),Gc=v([me("esri.symbols.MarkerSymbol")],Gc);const nD=Gc;var Bv;const oD=At.ofType({base:null,key:"type",typeMap:{fill:Qg}});let $y=Bv=class extends t0{constructor(e){super(e),this.symbolLayers=new oD,this.type="mesh-3d"}clone(){return new Bv({styleOrigin:Ge(this.styleOrigin),symbolLayers:Ge(this.symbolLayers),thumbnail:Ge(this.thumbnail)})}static fromSimpleFillSymbol(e){return new Bv({symbolLayers:new At([Qg.fromSimpleFillSymbol(e)])})}};v([M({type:oD})],$y.prototype,"symbolLayers",void 0),v([Ot({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],$y.prototype,"type",void 0),$y=Bv=v([me("esri.symbols.MeshSymbol3D")],$y);const KI=$y;function OY(e,t,i){return t.imageData?IO({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):aD(t.url,i)}function aD(e,t){if(!Hn(e)){const i=RY(t);if(i)return fb(i,"images",e)}return Hg(e,t)}function LY(e,t,i,r){if(wd(e)){const s=vg(e);if(!s)return;t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&df(i.url,t,"url",r)}else df(e,t,"url",r)}const lD={json:{read:{source:["imageData","url"],reader:OY},write:{writer(e,t,i,r){LY(e,t,this.source,r)}}}},cD={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=aD(t.url,i)),r}}}};function RY(e){var s,a;if(!e)return null;const{origin:t,layer:i}=e;if(t!=="service"&&t!=="portal-item")return null;const r=i==null?void 0:i.type;return r==="feature"||r==="stream"?(s=i.parsedUrl)==null?void 0:s.path:r==="map-image"||r==="tile"?(a=e.url)==null?void 0:a.path:null}var IT;let ho=IT=class extends jR{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=Qi(i)),r!=null&&(s.height=Qi(r)),s}clone(){const e=new IT({color:Ge(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",Ge(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};v([Ot({esriPFS:"picture-fill"},{readOnly:!0})],ho.prototype,"type",void 0),v([M(lD)],ho.prototype,"url",void 0),v([M({type:Number,json:{write:!0}})],ho.prototype,"xscale",void 0),v([M({type:Number,json:{write:!0}})],ho.prototype,"yscale",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],ho.prototype,"width",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],ho.prototype,"height",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],ho.prototype,"xoffset",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],ho.prototype,"yoffset",void 0),v([M(cD)],ho.prototype,"source",void 0),ho=IT=v([me("esri.symbols.PictureFillSymbol")],ho);const uD=ho;var ET;let jo=ET=class extends nD{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=Qi(t)),i!=null&&(r.height=Qi(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new ET({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",Ge(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};v([M({json:{write:!1}})],jo.prototype,"color",void 0),v([Ot({esriPMS:"picture-marker"},{readOnly:!0})],jo.prototype,"type",void 0),v([M(lD)],jo.prototype,"url",void 0),v([M(cD)],jo.prototype,"source",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],jo.prototype,"height",void 0),v([yi("height",["height","size"])],jo.prototype,"readHeight",null),v([M({type:Number,cast:Qi,json:{write:!0}})],jo.prototype,"width",void 0),v([M({json:{write:!1}})],jo.prototype,"size",void 0),jo=ET=v([me("esri.symbols.PictureMarkerSymbol")],jo);const YI=jo;var Th;const hD=At.ofType({base:null,key:"type",typeMap:{icon:Kh,object:GI,text:Cf}});let Mh=Th=class extends t0{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new hD,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return tD(this)}hasVisibleVerticalOffset(){return HI(this)}clone(){return new Th({verticalOffset:Ge(this.verticalOffset),callout:Ge(this.callout),styleOrigin:Ge(this.styleOrigin),symbolLayers:Ge(this.symbolLayers),thumbnail:Ge(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new Th({symbolLayers:new At([Kh.fromSimpleMarkerSymbol(e)])})}static fromPictureMarkerSymbol(e){return new Th({symbolLayers:new At([Kh.fromPictureMarkerSymbol(e)])})}static fromCIMSymbol(e){var r,s;if(((s=(r=e.data)==null?void 0:r.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const i=e.data.symbol;return new Th(i!=null&&i.callout?{symbolLayers:new At([Kh.fromCIMSymbol(e)]),callout:new eD({size:.5,color:new oi([0,0,0])}),verticalOffset:new WI({screenLength:40})}:{symbolLayers:new At([Kh.fromCIMSymbol(e)])})}static fromTextSymbol(e){return new Th({symbolLayers:new At([Cf.fromTextSymbol(e)])})}};v([M({type:WI,json:{write:!0}})],Mh.prototype,"verticalOffset",void 0),v([M(iD)],Mh.prototype,"callout",void 0),v([M({type:hD,json:{origins:{"web-scene":{write:!0}}}})],Mh.prototype,"symbolLayers",void 0),v([Ot({PointSymbol3D:"point-3d"},{readOnly:!0})],Mh.prototype,"type",void 0),Mh=Th=v([me("esri.symbols.PointSymbol3D")],Mh);const XI=Mh;var Oy;const dD=At.ofType({base:null,key:"type",typeMap:{extrude:FR,fill:Qg,icon:Kh,line:e0,object:GI,text:Cf,water:YR}});let Ly=Oy=class extends t0{constructor(e){super(e),this.symbolLayers=new dD,this.type="polygon-3d"}initialize(){const e=t=>{t.type==="line"&&af(pt.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),t.type==="text"&&af(pt.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const t of this.symbolLayers)e(t);this.addHandles(yd(()=>this.symbolLayers,"after-add",({item:t})=>e(t),gd))}clone(){return new Oy({styleOrigin:Ge(this.styleOrigin),symbolLayers:Ge(this.symbolLayers),thumbnail:Ge(this.thumbnail)})}static fromJSON(e){var i;const t=new Oy;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.at(0).type==="fill"&&t.symbolLayers.at(1).type==="line"){const r=t.symbolLayers.at(0),s=t.symbolLayers.at(1);!s.enabled||(i=e.symbolLayers)!=null&&i[1]&&e.symbolLayers[1].enable===!1||(r.outline={size:s.size,color:s.material!=null?s.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new Oy({symbolLayers:new At([Qg.fromSimpleFillSymbol(e)])})}};v([M({type:dD,json:{write:!0}})],Ly.prototype,"symbolLayers",void 0),v([Ot({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],Ly.prototype,"type",void 0),Ly=Oy=v([me("esri.symbols.PolygonSymbol3D")],Ly);const QI=Ly;var kT;const Ux=new hs({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Ih=kT=class extends jR{constructor(...e){super(...e),this.color=new oi([0,0,0,.25]),this.outline=new Pf,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new kT({color:Ge(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};v([M()],Ih.prototype,"color",void 0),v([M()],Ih.prototype,"outline",void 0),v([Ot({esriSFS:"simple-fill"},{readOnly:!0})],Ih.prototype,"type",void 0),v([M({type:Ux.apiValues,json:{read:Ux.read,write:Ux.write}})],Ih.prototype,"style",void 0),Ih=kT=v([me("esri.symbols.SimpleFillSymbol")],Ih);const pD=Ih;var AT;const Gx=new hs({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Aa=AT=class extends nD{constructor(...e){super(...e),this.color=new oi([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Pf}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=Qi(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new AT({angle:this.angle,color:Ge(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};v([M()],Aa.prototype,"color",void 0),v([ni("color")],Aa.prototype,"writeColor",null),v([Ot({esriSMS:"simple-marker"},{readOnly:!0})],Aa.prototype,"type",void 0),v([M()],Aa.prototype,"size",void 0),v([M({type:Gx.apiValues,json:{read:Gx.read,write:Gx.write}})],Aa.prototype,"style",void 0),v([M({type:String,json:{write:!0}})],Aa.prototype,"path",null),v([M({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Pf}},json:{default:null,write:!0}})],Aa.prototype,"outline",void 0),Aa=AT=v([me("esri.symbols.SimpleMarkerSymbol")],Aa);const eE=Aa;var PT;let Hi=PT=class extends Jn{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new jb,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return Qi(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new PT({angle:this.angle,backgroundColor:Ge(this.backgroundColor),borderLineColor:Ge(this.borderLineColor),borderLineSize:this.borderLineSize,color:Ge(this.color),font:this.font&&this.font.clone(),haloColor:Ge(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e,t,i;return`${(e=this.backgroundColor)==null?void 0:e.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${(i=this.haloColor)==null?void 0:i.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};v([M({type:oi,json:{write:!0}})],Hi.prototype,"backgroundColor",void 0),v([M({type:oi,json:{write:!0}})],Hi.prototype,"borderLineColor",void 0),v([M({type:Number,json:{write:!0},cast:Qi})],Hi.prototype,"borderLineSize",void 0),v([M({type:jb,json:{write:!0}})],Hi.prototype,"font",void 0),v([M({...ZR,json:{write:!0}})],Hi.prototype,"horizontalAlignment",void 0),v([M({type:Boolean,json:{write:!0}})],Hi.prototype,"kerning",void 0),v([M({type:oi,json:{write:!0}})],Hi.prototype,"haloColor",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],Hi.prototype,"haloSize",void 0),v([M({type:Boolean,json:{write:!0}})],Hi.prototype,"rightToLeft",void 0),v([M({type:Boolean,json:{write:!0}})],Hi.prototype,"rotated",void 0),v([M({type:String,json:{write:!0}})],Hi.prototype,"text",void 0),v([Ot({esriTS:"text"},{readOnly:!0})],Hi.prototype,"type",void 0),v([M({...JR,json:{write:!0}})],Hi.prototype,"verticalAlignment",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],Hi.prototype,"xoffset",void 0),v([M({type:Number,cast:Qi,json:{write:!0}})],Hi.prototype,"yoffset",void 0),v([M({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Hi.prototype,"angle",void 0),v([M({type:Number,json:{write:!0}})],Hi.prototype,"width",void 0),v([M({type:Number})],Hi.prototype,"lineWidth",void 0),v([ni("lineWidth")],Hi.prototype,"writeLineWidth",null),v([es("lineWidth")],Hi.prototype,"castLineWidth",null),v([M(WR)],Hi.prototype,"lineHeight",void 0),v([ni("lineHeight")],Hi.prototype,"writeLineHeight",null),Hi=PT=v([me("esri.symbols.TextSymbol")],Hi);const Vb=Hi;var CT;let Vo=CT=class extends Jn{constructor(e){super(e),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=this.portal!=null?this.portal:_u.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t==null?void 0:t.portal,super.read(e,t)}clone(){return new CT({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=t!=null?t.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const l=r&&i.get(r);if(l)return l.clone()}const{resolveWebStyleSymbol:s}=await it(()=>import("./webStyleSymbolUtils-CZabqWGU.js"),__vite__mapDeps([191,192,150,151]));mr(t);const a=s(this,{portal:this.portal},e,t);a.catch(l=>{pt.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",l)});const u=await a;return e==="webRef"&&u.type==="point-3d"||e==="cimRef"&&u.type==="cim"?(i!=null&&i.set(r,u.clone()),u):null}};v([M({json:{write:!1}})],Vo.prototype,"color",void 0),v([M({type:String,json:{write:!0}})],Vo.prototype,"styleName",void 0),v([M({type:_u,json:{write:!1}})],Vo.prototype,"portal",void 0),v([M({type:String,json:{read:YM,write:df}})],Vo.prototype,"styleUrl",void 0),v([M({type:cg,json:{read:!1}})],Vo.prototype,"thumbnail",void 0),v([M({type:String,json:{write:!0}})],Vo.prototype,"name",void 0),v([Ot({styleSymbolReference:"web-style"},{readOnly:!0})],Vo.prototype,"type",void 0),v([M()],Vo.prototype,"_fetchCacheKey",null),Vo=CT=v([me("esri.symbols.WebStyleSymbol")],Vo);const Ub=Vo;function Sce(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Tce(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const tE={base:Jn,key:"type",typeMap:{"simple-fill":pD,"picture-fill":uD,"picture-marker":YI,"simple-line":Pf,"simple-marker":eE,text:Vb,"label-3d":ZI,"line-3d":JI,"mesh-3d":KI,"point-3d":XI,"polygon-3d":QI,"web-style":Ub,cim:Bb},errorContext:"symbol"},Mce={base:Jn,key:"type",typeMap:{"picture-marker":YI,"simple-marker":eE,text:Vb,"web-style":Ub,cim:Bb},errorContext:"symbol"},Ice=MM({types:tE}),Ece={base:Jn,key:"type",typeMap:{"simple-fill":pD,"picture-fill":uD,"picture-marker":YI,"simple-line":Pf,"simple-marker":eE,text:Vb,"line-3d":JI,"mesh-3d":KI,"point-3d":XI,"polygon-3d":QI,"web-style":Ub,cim:Bb},errorContext:"symbol"},kce={base:Jn,key:"type",typeMap:{text:Vb,"label-3d":ZI},errorContext:"symbol"},Ace={base:Jn,key:"type",typeMap:{"line-3d":JI,"mesh-3d":KI,"point-3d":XI,"polygon-3d":QI,"web-style":Ub,cim:Bb},errorContext:"symbol"},Pce={base:Jn,key:"type",typeMap:{"label-3d":ZI},errorContext:"symbol"},Cce=Ul(tE);var $T;function DY(e){if(!e)return null;const t={};for(const i in e){const r=mf(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function zY(e){if(e==null)return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let Xs=$T=class extends Za(wt){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Zy(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}cloneShallow(){return new $T({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[t,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(e&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(e){var t;return(t=this.attributes)==null?void 0:t[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var e;return{aggregateGeometries:zY(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:L2(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((e=this.popupTemplate)==null?void 0:e.toJSON())??null}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(e={}){const{geometry:t}=this;if((t==null?void 0:t.type)==="mesh"){const i={origin:t.origin,transform:t.transform};this._notifyLayer("origin-transform",i,i,e.action)}}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="origin-transform"&&(s.action=r),e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};v([M({value:null,json:{read:DY}})],Xs.prototype,"aggregateGeometries",null),v([M({value:null})],Xs.prototype,"attributes",null),v([M({value:null,types:Tb,json:{read:mf}})],Xs.prototype,"geometry",null),v([M({type:Boolean})],Xs.prototype,"isAggregate",void 0),v([M({clonable:"reference"})],Xs.prototype,"layer",void 0),v([M({clonable:"reference"})],Xs.prototype,"origin",void 0),v([M({type:KK})],Xs.prototype,"popupTemplate",void 0),v([M({clonable:"reference"})],Xs.prototype,"sourceLayer",void 0),v([M({value:null,types:tE})],Xs.prototype,"symbol",null),v([M({type:Boolean,value:!0})],Xs.prototype,"visible",null),Xs=$T=v([me("esri.Graphic")],Xs),function(e){e.generateUID=Zy}(Xs||(Xs={}));const OT=Xs;let ug=class extends rg{_own(t){t.layer&&"remove"in t.layer&&t.layer!==this.owner&&t.layer.remove(t),t.layer=this.owner}_release(t){t.layer===this.owner&&(t.layer=null)}};v([DO({Type:OT,ensureType:an(OT)})],ug.prototype,"itemType",void 0),ug=v([me("esri.support.GraphicsCollection")],ug);let qc=class extends Pt{constructor(t){super(t),this.view=null,this.baseLayerViews=new At,this.referenceLayerViews=new At,this._loadingHandle=qt(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},on)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const t of this.baseLayerViews)t.destroy();this.baseLayerViews.length=0;for(const t of this.referenceLayerViews)t.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r;if(this.view&&this.view.suspended)return!1;const t=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap;return!!t&&!!t.loaded&&(this.baseLayerViews.some(s=>s.updating)||this.referenceLayerViews.some(s=>s.updating))}};v([M({constructOnly:!0})],qc.prototype,"view",void 0),v([M({readOnly:!0})],qc.prototype,"baseLayerViews",void 0),v([M({readOnly:!0})],qc.prototype,"referenceLayerViews",void 0),v([M({readOnly:!0})],qc.prototype,"suspended",null),v([M({type:Boolean,readOnly:!0})],qc.prototype,"updating",null),qc=v([me("esri.views.BasemapView")],qc);function NY(e){return"tryRecycleWith"in e}let FY=class{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=wo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,vo(this._controller.signal,()=>{const s=new gt("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}tryRecycle(t){if(!this.done||!this.layerView||!NY(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<t.length;s++){const a=t[s];if(a.type!==i)continue;const u=this.layerView.tryRecycleWith(a,{signal:r});if(u){t.splice(s,1),this.layer=a;const l=this.layerView,y=l.view;return this.promise=Promise.race([u.then(()=>(mr(this._controller.signal),a.emit("layerview-destroy",{view:y,layerView:l}),y.emit("layerview-destroy",{view:y,layerView:l}),a.emit("layerview-create",{view:y,layerView:l}),y.emit("layerview-create",{view:y,layerView:l}),l)),new Promise((w,I)=>vo(this._controller.signal,()=>I(Er())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:t}=this;if(t){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,a;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let u,l;if(await i.load({signal:t}),i.prefetchResources&&await i.prefetchResources({signal:t}),jY(i))u=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new gt("layer:view-not-supported","No layerview implementation was found");const I=await this.layerViewImporter.importLayerView(i);mr(t),u="default"in I?new I.default({layer:i,view:r}):new I({layer:i,view:r})}const y=()=>{l=er(l),u.destroyed||u.destroy(),u.layer=null,u.parent=null,u.view=null,this.done=!0};l=vo(t,y),mr(t);try{await u.when()}catch(I){throw y(),I}if(!((a=(s=this._map)==null?void 0:s.allLayers)==null?void 0:a.includes(i)))return y(),void this._deferred.reject(new gt("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=u,i.emit("layerview-create",{view:r,layerView:u}),r.emit("layerview-create",{layer:i,layerView:u}),this.done=!0,this._deferred.resolve(u)}catch(u){i.emit("layerview-create-error",{view:r,error:u}),r.emit("layerview-create-error",{layer:i,error:u}),this.done=!0,this._deferred.reject(new gt("layerview:create-error","layerview creation failed",{layer:i,error:u}))}}},po=class extends Pt{constructor(t){super(t),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new rd,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const s of i)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=wo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(Ug(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var y,w,I;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],a=this.view.ready,u=E=>{if(E!=null){for(const A of E)if(A){r.add(A);const R=this._layerLayerViewInfoMap.get(A);R&&a?R.start():R||this._recyclingInfoMap.has(A)||s.push(A),"layers"in A&&A.layers&&u(A.layers)}}};for(const E of this._rootCollectionNames)u(Da(this,E));for(const[E,A]of this._layerLayerViewInfoMap)if(!r.has(E)){this._layerLayerViewInfoMap.delete(A.layer);const R=A.tryRecycle(s);R?(this.notifyChange("updating"),this._recyclingInfoMap.set(A.layer,A),R.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(A.layer),this._layerLayerViewInfoMap.set(A.layer,A),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(A.layer),A.destroy(),this._reschedule()})):A.destroy()}for(const[E,A]of this._recyclingInfoMap)r.has(E)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(A.layer),A.destroy());for(const E of s)this._createLayerView(E);this._refreshCollections();const l=[(y=i==null?void 0:i.ground)==null?void 0:y.layers,(w=i==null?void 0:i.basemap)==null?void 0:w.baseLayers,(I=i==null?void 0:i.basemap)==null?void 0:I.referenceLayers,i==null?void 0:i.layers].filter(E=>!!E);r.forEach(E=>"layers"in E&&l.push(E.layers)),this.addHandles(l.map(E=>this._watchUpdatingTracking.addOnCollectionChange(()=>E,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([yd(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),qt(()=>{const t=this.view,i=t==null?void 0:t.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,t==null?void 0:t.ready]},()=>this._reschedule(),Zo)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),xx(this._recyclingInfoMap),xx(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Er()),this._workPromise=null)}get _layersToLayerViews(){const t=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&t.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(t)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||ub(this._layerLayerViewInfoMap,t=>!t.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let t=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++t;return t}clear(){this.destroyed||(xx(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(t){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(t)){if(this._recyclingInfoMap.has(t))return this._recyclingInfoMap.get(t).promise;throw new gt("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:t})}return this._layerLayerViewInfoMap.get(t).promise}_refreshCollections(){for(const[t,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Da(this,t),Da(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(t,i,r){if(!t||!i)return void(i&&i.removeAll());let s=0;for(const a of t){const u=this._layerLayerViewInfoMap.get(a);if(!(u!=null&&u.layerView))continue;const l=u.layerView;l.layer=a,l.parent=r,i.at(s)!==l&&i.splice(s,0,l),a.layers&&this._populateLayerViewsOwners(a.layers,l.layerViews,l),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(t){t.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t);const i=new FY(t,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(xo(r)||r.name==="cancelled:layerview-create")||pt.getLogger(this).error(`Failed to create layerview for layer title:'${t.title??"no title"}', id:'${t.id??"no id"}' of type '${t.type}'.`,{layer:t,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(t,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};v([M()],po.prototype,"_workPromise",void 0),v([M({readOnly:!0})],po.prototype,"_watchUpdatingTracking",void 0),v([M({readOnly:!0})],po.prototype,"_layersToLayerViews",null),v([M({readOnly:!0})],po.prototype,"_rootCollectionNames",null),v([M()],po.prototype,"layerViewImporter",void 0),v([M()],po.prototype,"supportsGround",void 0),v([M({readOnly:!0})],po.prototype,"updating",null),v([M({readOnly:!0})],po.prototype,"updatingRemaining",null),v([M({constructOnly:!0})],po.prototype,"view",void 0),po=v([me("esri.views.LayerViewManager")],po);const BY=po;function jY(e){return"createLayerView"in e&&e.createLayerView!=null}let Bn=class extends Pt{constructor(t){super(t),this.factor=1.5,this.offset=nn(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};v([M({type:Number})],Bn.prototype,"factor",void 0),v([M({nonNullable:!0})],Bn.prototype,"offset",void 0),v([M()],Bn.prototype,"position",void 0),v([M({type:Number,range:{min:0}})],Bn.prototype,"size",void 0),v([M()],Bn.prototype,"maskUrl",void 0),v([M()],Bn.prototype,"maskEnabled",void 0),v([M()],Bn.prototype,"overlayUrl",void 0),v([M()],Bn.prototype,"overlayEnabled",void 0),v([M({readOnly:!0})],Bn.prototype,"version",null),v([M({type:Boolean})],Bn.prototype,"visible",void 0),Bn=v([me("esri.views.Magnifier")],Bn);const fD=Bn;let jv=class{constructor(t){this._observable=new qg,this._map=new Map(t)}get size(){return Tt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(t){const i=this._map.delete(t);return i&&this._observable.notify(),i}entries(){return Tt(this._observable),this._map.entries()}forEach(t,i){Tt(this._observable),this._map.forEach((r,s)=>t.call(i,r,s,this),i)}get(t){return Tt(this._observable),this._map.get(t)}has(t){return Tt(this._observable),this._map.has(t)}keys(){return Tt(this._observable),this._map.keys()}set(t,i){return this._map.set(t,i),this._observable.notify(),this}values(){return Tt(this._observable),this._map.values()}[Symbol.iterator](){return Tt(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var LT;let Ry=LT=class extends wt{constructor(e){super(e),this.name=null,this.code=null}clone(){return new LT({name:this.name,code:this.code})}};v([M({type:String,json:{write:!0}})],Ry.prototype,"name",void 0),v([M({type:[String,Number],json:{write:!0}})],Ry.prototype,"code",void 0),Ry=LT=v([me("esri.layers.support.CodedValue")],Ry);const VY=new hs({inherited:"inherited",codedValue:"coded-value",range:"range"});let Dy=class extends wt{constructor(t){super(t),this.name=null,this.type=null}};v([M({type:String,json:{write:!0}})],Dy.prototype,"name",void 0),v([Ot(VY)],Dy.prototype,"type",void 0),Dy=v([me("esri.layers.support.Domain")],Dy);const Gb=Dy;var RT;let zy=RT=class extends Gb{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new RT({codedValues:Ge(this.codedValues),name:this.name})}};v([M({type:[Ry],json:{write:!0}})],zy.prototype,"codedValues",void 0),v([Ot({codedValue:"coded-value"})],zy.prototype,"type",void 0),zy=RT=v([me("esri.layers.support.CodedValueDomain")],zy);const mD=zy;var DT;let Vv=DT=class extends Gb{constructor(e){super(e),this.type="inherited"}clone(){return new DT}};v([Ot({inherited:"inherited"})],Vv.prototype,"type",void 0),Vv=DT=v([me("esri.layers.support.InheritedDomain")],Vv);const yD=Vv;var zT;let $p=zT=class extends Gb{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new zT({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};v([M({json:{type:[Number],read:{source:"range",reader:(e,t)=>{var i;return(i=t.range)==null?void 0:i[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],$p.prototype,"maxValue",void 0),v([M({json:{type:[Number],read:{source:"range",reader:(e,t)=>{var i;return(i=t.range)==null?void 0:i[0]}},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],$p.prototype,"minValue",void 0),v([Ot({range:"range"})],$p.prototype,"type",void 0),$p=zT=v([me("esri.layers.support.RangeDomain")],$p);const gD=$p,UY={key:"type",base:Gb,typeMap:{range:gD,"coded-value":mD,inherited:yD}};function GY(e){if(!(e!=null&&e.type))return null;switch(e.type){case"range":return gD.fromJSON(e);case"codedValue":return mD.fromJSON(e);case"inherited":return yD.fromJSON(e)}return null}const qY=new hs({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var NT;const HY=new hs({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let As=NT=class extends wt{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:t}){let i=null;try{i=t?JSON.parse(t):null}catch{}return(i==null?void 0:i.value)??null}readValueType(e,{description:t}){let i=null;try{i=t?JSON.parse(t):null}catch{}return i?HY.fromJSON(i.fieldValueType):null}clone(){var e;return new NT({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((e=this.domain)==null?void 0:e.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};v([M({type:String,json:{write:!0}})],As.prototype,"alias",void 0),v([M({type:[String,Number],json:{write:{allowNull:!0}}})],As.prototype,"defaultValue",void 0),v([M()],As.prototype,"description",void 0),v([yi("description")],As.prototype,"readDescription",null),v([M({types:UY,json:{read:{reader:GY},write:!0}})],As.prototype,"domain",void 0),v([M({type:Boolean,json:{write:!0}})],As.prototype,"editable",void 0),v([M({type:ar,json:{write:{overridePolicy:e=>({enabled:Number.isFinite(e)})}}})],As.prototype,"length",void 0),v([M({type:String,json:{write:!0}})],As.prototype,"name",void 0),v([M({type:Boolean,json:{write:!0}})],As.prototype,"nullable",void 0),v([Ot(qY)],As.prototype,"type",void 0),v([M()],As.prototype,"valueType",void 0),v([yi("valueType",["description"])],As.prototype,"readValueType",null),v([M({type:Boolean,json:{read:!1}})],As.prototype,"visible",void 0),As=NT=v([me("esri.layers.support.Field")],As);const WY=As;var FT;let Op=FT=class extends wt{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new FT({mapLayerId:e,gdbVersion:t})}};v([Ot({mapLayer:"map-layer"})],Op.prototype,"type",void 0),v([M({type:ar,json:{write:!0}})],Op.prototype,"mapLayerId",void 0),v([M({type:String,json:{write:!0}})],Op.prototype,"gdbVersion",void 0),Op=FT=v([me("esri.layers.support.source.MapLayerSource")],Op);var BT;let Cl=BT=class extends wt{constructor(e){super(e),this.type="query-table"}clone(){const{workspaceId:e,query:t,oidFields:i,spatialReference:r,geometryType:s}=this,a={workspaceId:e,query:t,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:s};return new BT(a)}};v([Ot({queryTable:"query-table"})],Cl.prototype,"type",void 0),v([M({type:String,json:{write:!0}})],Cl.prototype,"workspaceId",void 0),v([M({type:String,json:{write:!0}})],Cl.prototype,"query",void 0),v([M({type:String,json:{write:!0}})],Cl.prototype,"oidFields",void 0),v([M({type:si,json:{write:!0}})],Cl.prototype,"spatialReference",void 0),v([Ot(MG)],Cl.prototype,"geometryType",void 0),Cl=BT=v([me("esri.layers.support.source.QueryTableDataSource")],Cl);var jT;let Lp=jT=class extends wt{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new jT({workspaceId:e,dataSourceName:t})}};v([Ot({raster:"raster"})],Lp.prototype,"type",void 0),v([M({type:String,json:{write:!0}})],Lp.prototype,"dataSourceName",void 0),v([M({type:String,json:{write:!0}})],Lp.prototype,"workspaceId",void 0),Lp=jT=v([me("esri.layers.support.source.RasterDataSource")],Lp);var VT;let Eh=VT=class extends wt{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new VT({workspaceId:e,gdbVersion:t,dataSourceName:i})}};v([Ot({table:"table"})],Eh.prototype,"type",void 0),v([M({type:String,json:{write:!0}})],Eh.prototype,"workspaceId",void 0),v([M({type:String,json:{write:!0}})],Eh.prototype,"gdbVersion",void 0),v([M({type:String,json:{write:!0}})],Eh.prototype,"dataSourceName",void 0),Eh=VT=v([me("esri.layers.support.source.TableDataSource")],Eh);var UT,GT;const ZY=In()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let jn=UT=class extends wt{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return LP()(e,t,i)}castLeftTableSource(e){return Ul(qT(),e)}readRightTableSource(e,t,i){return LP()(e,t,i)}castRightTableSource(e){return Ul(qT(),e)}clone(){const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,a={leftTableKey:e,rightTableKey:t,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:s};return new UT(a)}};v([Ot({joinTable:"join-table"})],jn.prototype,"type",void 0),v([M({type:String,json:{write:!0}})],jn.prototype,"leftTableKey",void 0),v([M({type:String,json:{write:!0}})],jn.prototype,"rightTableKey",void 0),v([M({json:{write:!0}})],jn.prototype,"leftTableSource",void 0),v([yi("leftTableSource")],jn.prototype,"readLeftTableSource",null),v([es("leftTableSource")],jn.prototype,"castLeftTableSource",null),v([M({json:{write:!0}})],jn.prototype,"rightTableSource",void 0),v([yi("rightTableSource")],jn.prototype,"readRightTableSource",null),v([es("rightTableSource")],jn.prototype,"castRightTableSource",null),v([Ot(ZY)],jn.prototype,"joinType",void 0),jn=UT=v([me("esri.layers.support.source.JoinTableDataSource")],jn);let qx=null;function LP(){return qx||(qx=MM({types:qT()})),qx}let Hx=null;function qT(){return Hx||(Hx={key:"type",base:null,typeMap:{"data-layer":Ll,"map-layer":Op}}),Hx}const JY={key:"type",base:null,typeMap:{"join-table":jn,"query-table":Cl,raster:Lp,table:Eh}};let Ll=GT=class extends wt{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new GT({fields:e,dataSource:t})}};v([Ot({dataLayer:"data-layer"})],Ll.prototype,"type",void 0),v([M({type:[WY],json:{write:!0}})],Ll.prototype,"fields",void 0),v([M({types:JY,json:{write:!0}})],Ll.prototype,"dataSource",void 0),Ll=GT=v([me("esri.layers.support.source.DataLayerSource")],Ll),Ll.from=an(Ll);let kh=class extends Za(wt){constructor(t){super(t),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};v([M({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],kh.prototype,"onFields",void 0),v([M({type:String,json:{write:!0}})],kh.prototype,"operator",void 0),v([M({type:String,json:{write:!0}})],kh.prototype,"searchTerm",void 0),v([M({type:String,json:{write:!0}})],kh.prototype,"searchType",void 0),kh=v([me("esri.rest.support.FullTextSearch")],kh);const KY=kh;var HT;const RP=new hs({upperLeft:"upper-left",lowerLeft:"lower-left"});let Ah=HT=class extends wt{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new HT(Ge({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};v([M({type:tr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Ah.prototype,"extent",void 0),v([M({type:["view","edit"],json:{write:!0}})],Ah.prototype,"mode",void 0),v([M({type:String,json:{read:RP.read,write:RP.write}})],Ah.prototype,"originPosition",void 0),v([M({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Ah.prototype,"tolerance",void 0),Ah=HT=v([me("esri.rest.support.QuantizationParameters")],Ah);const _D=Ah,YY=new hs({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var WT;const DP=new hs({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Uo=WT=class extends wt{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=Ge(e))}clone(){return new WT({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Ge(this.statisticParameters)})}};v([M({type:Number,json:{write:!0}})],Uo.prototype,"maxPointCount",void 0),v([M({type:Number,json:{write:!0}})],Uo.prototype,"maxRecordCount",void 0),v([M({type:Number,json:{write:!0}})],Uo.prototype,"maxVertexCount",void 0),v([M({type:String,json:{write:!0}})],Uo.prototype,"onStatisticField",void 0),v([M({type:String,json:{write:!0}})],Uo.prototype,"outStatisticFieldName",void 0),v([M({type:String,json:{read:{source:"statisticType",reader:DP.read},write:{target:"statisticType",writer:DP.write}}})],Uo.prototype,"statisticType",void 0),v([M({type:Object})],Uo.prototype,"statisticParameters",void 0),v([ni("statisticParameters")],Uo.prototype,"writeStatisticParameters",null),Uo=WT=v([me("esri.rest.support.StatisticDefinition")],Uo);const XY=Uo;var Uv;const QY=new hs({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Mt=Uv=class extends wt{static from(e){return hb(Uv,e)}constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(a=>a instanceof Date?a.getTime():a):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new Uv(Ge({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Mt.MAX_MAX_RECORD_COUNT_FACTOR=5,v([M({json:{write:!0}})],Mt.prototype,"aggregateIds",void 0),v([M({type:Boolean,json:{write:!0}})],Mt.prototype,"cacheHint",void 0),v([M({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"compactGeometryEnabled",void 0),v([M({json:{write:!0}})],Mt.prototype,"datumTransformation",void 0),v([es("datumTransformation")],Mt.prototype,"castDatumTransformation",null),v([M({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"defaultSpatialReferenceEnabled",void 0),v([M({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Mt.prototype,"distance",void 0),v([M({type:Ll,json:{write:!0}})],Mt.prototype,"dynamicDataSource",void 0),v([M({type:String,json:{write:!0}})],Mt.prototype,"formatOf3DObjects",void 0),v([M({type:[KY],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Mt.prototype,"fullText",void 0),v([M({type:String,json:{write:!0}})],Mt.prototype,"gdbVersion",void 0),v([M({types:Tb,json:{read:mf,write:!0}})],Mt.prototype,"geometry",void 0),v([M({type:Number,json:{write:!0}})],Mt.prototype,"geometryPrecision",void 0),v([M({type:[String],json:{write:!0}})],Mt.prototype,"groupByFieldsForStatistics",void 0),v([M({type:String,json:{write:!0}})],Mt.prototype,"having",void 0),v([M({type:Date})],Mt.prototype,"historicMoment",void 0),v([ni("historicMoment")],Mt.prototype,"writeHistoricMoment",null),v([M({type:Number,json:{write:!0}})],Mt.prototype,"maxAllowableOffset",void 0),v([M({type:Number,cast:e=>e<1?1:e>Mt.MAX_MAX_RECORD_COUNT_FACTOR?Mt.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Mt.prototype,"maxRecordCountFactor",void 0),v([M({type:["xyFootprint"],json:{write:!0}})],Mt.prototype,"multipatchOption",void 0),v([M({type:Number,json:{read:{source:"resultRecordCount"}}})],Mt.prototype,"num",void 0),v([M({json:{write:!0}})],Mt.prototype,"objectIds",void 0),v([M({type:[String],json:{write:!0}})],Mt.prototype,"orderByFields",void 0),v([M({type:[String],json:{write:!0}})],Mt.prototype,"outFields",void 0),v([M({type:si,json:{name:"outSR",write:!0}})],Mt.prototype,"outSpatialReference",void 0),v([M({type:[XY],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Mt.prototype,"outStatistics",void 0),v([M({json:{write:!0}})],Mt.prototype,"parameterValues",void 0),v([ni("parameterValues")],Mt.prototype,"writeParameterValues",null),v([M({type:Ht,json:{write:!0}})],Mt.prototype,"pixelSize",void 0),v([M({type:_D,json:{write:!0}})],Mt.prototype,"quantizationParameters",void 0),v([M({type:[Object],json:{write:!0}})],Mt.prototype,"rangeValues",void 0),v([M({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Mt.prototype,"relationParameter",void 0),v([M({type:String,json:{write:!0}})],Mt.prototype,"resultType",void 0),v([M({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnCentroid",void 0),v([M({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnDistinctValues",void 0),v([M({type:Boolean,json:{default:!0,write:!0}})],Mt.prototype,"returnExceededLimitFeatures",void 0),v([M({type:Boolean,json:{write:!0}})],Mt.prototype,"returnGeometry",void 0),v([M({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnQueryGeometry",void 0),v([M({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnM",void 0),v([M({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mt.prototype,"returnZ",void 0),v([M({type:si,json:{write:!0}})],Mt.prototype,"sourceSpatialReference",void 0),v([Ot(YY,{ignoreUnknown:!1,name:"spatialRel"})],Mt.prototype,"spatialRelationship",void 0),v([M({type:Number,json:{read:{source:"resultOffset"}}})],Mt.prototype,"start",void 0),v([ni("start"),ni("num")],Mt.prototype,"writeStart",null),v([M({type:String,json:{write:!0}})],Mt.prototype,"sqlFormat",void 0),v([M({type:String,json:{write:!0}})],Mt.prototype,"text",void 0),v([M({type:mR,json:{write:!0}})],Mt.prototype,"timeExtent",void 0),v([M({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"timeReferenceUnknownClient",void 0),v([Ot(QY,{ignoreUnknown:!1}),M({json:{write:{overridePolicy(e){return{enabled:!!e&&this.distance!=null&&this.distance>0}}}}})],Mt.prototype,"units",void 0),v([M({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start!=null&&this.start>0}}}}})],Mt.prototype,"where",void 0),v([ni("where")],Mt.prototype,"writeWhere",null),Mt=Uv=v([me("esri.rest.support.Query")],Mt);const zP=Mt;let $l=class extends Mu.EventedAccessor{constructor(t){super(t),this._selectionMap=new jv,this._trashCan=[],this._layerEditHandles=new At,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([qt(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),yd(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const s of i.removed)r.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const t=new At;this.view.when().then(()=>{this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(W_(i)&&!LV(i)||pp(i))&&t.add(i)}),this._set("sources",t)})}destroy(){this._layerEditHandles.drain(er)}get selections(){return Array.from(this._selectionMap.entries()).map(t=>{const[i,r]=t;return{layer:i,selection:[...r.selection]}})}get count(){let t=0;for(const i of this._selectionMap.values())t+=i.selection.length;return t}get hasSelection(){return this.count>0}get sources(){return this._get("sources")}set sources(t){this._set("sources",t)}async getSelectedFeatures(t,i={},r="layerView"){const{view:s,selections:a}=this,u=(t!==void 0?a.filter(l=>t.includes(l.layer)):a).filter(l=>l.selection.length>0).map(async l=>{const{layer:y,selection:w}=l,I=pp(y)?y.parent:y;if(I==null||!NP(I))return null;if(r==="layer")return FP(I,w,i);const E=await s.whenLayerView(I);return FP(E,w,i)});return(await Promise.all(u)).filter(l=>l!==null)}updateSelection(t){const i=new Map;for(const[a,u]of this._selectionMap)i.set(a,[...u.selection]);let r=!1;const s=t.current.concat(t.added);for(const a of s){const u=a.sourceLayer,l=a.getObjectId();if(this.sources.includes(u)&&(W_(u)||pp(u))&&l!==null){const y=tO(i,u,()=>[]);y.includes(l)||(y.push(l),r=!0)}}for(const a of t.removed){const u=a.sourceLayer,l=a.getObjectId();if(this.sources.includes(u)&&(W_(u)||pp(u))&&l!==null){const y=i.get(u),w=y==null?void 0:y.indexOf(l);w!==void 0&&w>=0&&(y==null||y.splice(w,1),r=!0)}}if(r){const{_selectionMap:a,_trashCan:u}=this,l=[];for(const[y,w]of i){const I=a.get(y);I!==void 0&&u.push(I),a.set(y,{selection:w}),l.push({layer:y,selection:w,...ek(I!==void 0?I.selection:[],w)})}this._onSelectionChange(l)}}setSelection(t,i){this._setSelection(t,i)}getSelection(t){const i=this._selectionMap.get(t);return i==null?void 0:i.selection}appendToSelection(t,i){const r=this._selectionMap.get(t),s=r!==void 0?[...r.selection]:[];for(const a of i)s.includes(a)||s.push(a);this._setSelection(t,s)}removeFromSelection(t,i){const r=this._selectionMap.get(t);if(!r)return;const s=[];for(const a of r.selection)i.includes(a)||s.push(a);this._setSelection(t,s)}toggleInSelection(t,i){const r=this._selectionMap.get(t);if(!r||r.selection.length===0)return void this._setSelection(t,i);const s=new Set(r.selection),a=new Set(i),u=t9(s,a);this._setSelection(t,Array.from(u))}clear(){const t=this._selectionMap.values();this._trashCan.push(...t);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(t){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:t})}_refreshVisualization(){var u;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const l=this._trashCan.pop();(u=l==null?void 0:l.highlightHandle)==null||u.remove()}const{sources:t,view:i,_selectionMap:r,showHighlight:s}=this,a=this._vizTaskId;for(const l of t){const y=r.get(l),w=pp(l)?l.parent:l;w!=null&&NP(w)&&i.whenLayerView(w).then(I=>{var E;(E=y==null?void 0:y.highlightHandle)==null||E.remove(),y!==void 0&&s&&a===this._vizTaskId&&"highlight"in I&&typeof I.highlight=="function"&&y.selection.length>0&&(y.highlightHandle=I.highlight(y.selection,"selection"))})}}_refreshListeners(){this._layerEditHandles.drain(er);for(const t of this.sources){const i=pp(t)?t.parent:t;if(i!=null&&W_(i)){const r=i.on("edits",s=>{this._handleEditChanges(s,t)});this._layerEditHandles.push(r)}}}_handleEditChanges(t,i){if(t.deletedFeatures!==void 0&&t.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=t.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(pg);this.removeFromSelection(i,r)}}_setSelection(t,i){if(!this.sources.includes(t))throw new Error(`Cannot set selection on layer ${t.title} because it is not in 'sources'`);const r=this._selectionMap.get(t);if(r===void 0||!tX(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(t,{selection:[...i]});const s={layer:t,selection:[...i],...ek(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};v([M({readOnly:!0,nonNullable:!0})],$l.prototype,"selections",null),v([M({readOnly:!0,nonNullable:!0})],$l.prototype,"count",null),v([M({constructOnly:!0,nonNullable:!0})],$l.prototype,"view",void 0),v([M({readOnly:!0,nonNullable:!0})],$l.prototype,"hasSelection",null),v([M()],$l.prototype,"showHighlight",void 0),v([M()],$l.prototype,"sources",null),$l=v([me("esri.views.SelectionManager")],$l);const W_=e=>e.createQuery!==void 0&&e.on!==void 0,eX=e=>e.layer!==void 0,NP=e=>(e==null?void 0:e.when)!==void 0,tX=(e,t)=>{if(e==null&&t==null)return!0;if(e!=null&&t==null||e==null&&t!=null)return!1;if(e!=null&&t!=null&&e.selection!=null&&t.selection!=null){const i=[...e.selection],r=[...t.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},FP=async(e,t,i={})=>{let r;if(eX(e)){const s=e;r=s===void 0?null:await s.queryFeatures(new zP({...i,objectIds:t})).then(a=>({data:a,layer:e.layer}))}else{const s=e;r=s===void 0?null:await s.queryFeatures(new zP({...i,objectIds:t})).then(a=>({data:a,layer:s}))}return r},iX=$l;let Ny=class extends Za(Pt){constructor(t){super(t),this.accentColor=new oi([255,127,0]),this.textColor=new oi([255,255,255])}};v([M({type:oi,nonNullable:!0})],Ny.prototype,"accentColor",void 0),v([M({type:oi,nonNullable:!0})],Ny.prototype,"textColor",void 0),Ny=v([me("esri.views.Theme")],Ny);const ZT=Ny;var BP;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(BP||(BP={}));const vD=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],bD={};function wD(e){return!!bD[e]}function rX(e){for(const t of e)if(!wD(t))return!1;return!0}vD.forEach(e=>{bD[e]=!0});let sX=class{constructor(t){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this._handlers.forEach(({handler:i,priority:r},s)=>{var a;return(a=this.inputManager)==null?void 0:a.installHandlers(s,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((t,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(t,i,r,s){const a=Array.isArray(t)?t:t.split(",");if(!rX(a))return a.some(wD)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let u,l;Array.isArray(i)?l=i:(u=i,l=[]),typeof r=="function"?u=r:s=r,s=s??pu.DEFAULT;const y=this._createUniqueGroupName(),w=new nX(this.view,a,l,u);this._handlers.set(y,{handler:w,priority:s});for(const I of a){const E=this._handlerCounts.get(I)||0;this._handlerCounts.set(I,E+1)}return this.inputManager&&this.inputManager.installHandlers(y,[w],s),Ni(()=>this._removeHandler(y,a))}hasHandler(t){return!!this._handlerCounts.get(t)}_removeHandler(t,i){if(this._handlers.has(t)){this._handlers.delete(t);for(const r of i){const s=this._handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},nX=class extends Ur{constructor(t,i,r,s){super(!0),this._latestDragStart=void 0,this.view=t;for(const a of i)switch(a){case"click":this.registerIncoming("click",r,u=>s(this._wrapClick(u)));break;case"double-click":this.registerIncoming("double-click",r,u=>s(this._wrapDoubleClick(u)));break;case"immediate-click":this.registerIncoming("immediate-click",r,u=>s(this._wrapImmediateClick(u)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,u=>s(this._wrapImmediateDoubleClick(u)));break;case"hold":this.registerIncoming("hold",r,u=>s(this._wrapHold(u)));break;case"drag":this.registerIncoming("drag",r,u=>{const l=this._wrapDrag(u);l&&s(l)});break;case"key-down":this.registerIncoming("key-down",r,u=>s(this._wrapKeyDown(u)));break;case"key-up":this.registerIncoming("key-up",r,u=>s(this._wrapKeyUp(u)));break;case"pointer-down":this.registerIncoming("pointer-down",r,u=>s(this._wrapPointer(u,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,u=>s(this._wrapPointer(u,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,u=>s(this._wrapPointer(u,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,u=>s(this._wrapPointerDrag(u)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,u=>s(this._wrapMouseWheel(u)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,u=>s(this._wrapPointer(u,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,u=>s(this._wrapPointer(u,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,u=>{s(this._wrapGamepad(u))});break;case"focus":this.registerIncoming("focus",r,u=>{s(this._wrapFocus(u))});break;case"blur":this.registerIncoming("blur",r,u=>{s(this._wrapBlur(u))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:a,y:u,native:l,eventId:y}=t.data,{cancelable:w,timestamp:I}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:a,y:u,native:l,timestamp:I,screenPoint:nn(a,u),mapPoint:this._getMapPoint(a,u),eventId:y,cancelable:w,stopPropagation:()=>t.stopPropagation(),async:E=>t.async(E),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:a,y:u,native:l,eventId:y}=t.data,{cancelable:w,timestamp:I}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:a,y:u,native:l,timestamp:I,mapPoint:this._getMapPoint(a,u),eventId:y,cancelable:w,stopPropagation:()=>t.stopPropagation(),async:E=>t.async(E),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:a,y:u,native:l,eventId:y}=t.data,w=l.pointerId,{cancelable:I,timestamp:E}=t;return{type:"immediate-click",pointerId:w,pointerType:i,button:r,buttons:s,x:a,y:u,native:l,timestamp:E,mapPoint:this._getMapPoint(a,u),eventId:y,cancelable:I,stopPropagation:()=>t.stopPropagation(),async:A=>t.async(A),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:a,y:u,native:l,eventId:y}=t.data,w=l.pointerId,{cancelable:I,timestamp:E}=t;return{type:"immediate-double-click",pointerId:w,pointerType:i,button:r,buttons:s,x:a,y:u,native:l,timestamp:E,mapPoint:this._getMapPoint(a,u),eventId:y,cancelable:I,stopPropagation:()=>t.stopPropagation(),async:A=>t.async(A),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:a,y:u,native:l}=t.data,{cancelable:y,timestamp:w}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:a,y:u,native:l,timestamp:w,mapPoint:this._getMapPoint(a,u),cancelable:y,stopPropagation:()=>t.stopPropagation(),async:I=>t.async(I),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(nn(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:a,pointerType:u,button:l}=i;if(a==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const y=i.pointer.native,w=i.buttons,{cancelable:I,timestamp:E}=t,A={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return a==="end"&&(this._latestDragStart=void 0),{type:"drag",action:a,x:r,y:s,origin:A,pointerType:u,button:l,buttons:w,radius:i.radius,angle:$L(i.angle),native:y,timestamp:E,cancelable:I,stopPropagation:()=>t.stopPropagation(),async:R=>t.async(R),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:a,timestamp:u}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:u,cancelable:a,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:a}=t;return{type:"key-up",key:i,native:r,timestamp:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:a,buttons:u,native:l,eventId:y}=t.data,w=l.pointerId,I=l.pointerType,{cancelable:E,timestamp:A}=t;return{type:i,x:r,y:s,pointerId:w,pointerType:I,button:a,buttons:u,native:l,timestamp:A,eventId:y,cancelable:E,stopPropagation:()=>t.stopPropagation(),async:R=>t.async(R),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:a,eventId:u}=t.data.currentEvent,{button:l}=t.data.startEvent,y=t.data.startEvent.native.pointerId,w=t.data.startEvent.native.pointerType,I=t.data.action,E={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:A,timestamp:R}=t;return{type:"pointer-drag",x:i,y:r,pointerId:y,pointerType:w,button:l,buttons:s,action:I,origin:E,native:a,timestamp:R,eventId:u,cancelable:A,stopPropagation:()=>t.stopPropagation(),async:G=>t.async(G),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:a,y:u,deltaY:l,native:y}=r;return{type:"mouse-wheel",x:a,y:u,deltaY:l,native:y,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:w=>t.async(w),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:a,timestamp:u}=t,{buttons:l,axes:y}=r;return{type:"gamepad",device:s,timestamp:u,action:i,buttons:l,axes:y,cancelable:a,stopPropagation:()=>t.stopPropagation(),async:w=>t.async(w),preventDefault:()=>t.preventDefault()}}};var $g,jP,VP;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})($g||($g={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(jP||(jP={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(VP||(VP={}));function oX(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return pt.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function JT(e){return e.visible&&e.getEditableFlag!=null&&e.getEditableFlag($g.USER)&&e.getEditableFlag($g.MANAGER)}function Pa(e){return nn(e.x,e.y)}function xD(e,t){var r;const i=(r=e instanceof HTMLElement?e:e.surface)==null?void 0:r.getBoundingClientRect();return i?nn(t.clientX-i.left,t.clientY-i.top):nn(0,0)}function SD(e,t){return t instanceof Event?xD(e,t):Pa(t)}function TD(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let aX=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":UP(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!GP(t))break;const s=Pa(t),a=this._intersect(s,t.pointerType,i.forEachTool);if(a==null)break;const u=a.manipulator,l=a.tool;u==null||l==null||!u.interactive||u.grabbable&&u.grabbableForEvent(t)||!u.grabbing||u.dragging||this._releaseManipulatorBeforeDragging(u,t,i),u!=null&&l!=null&&u.interactive&&u.grabbable&&u.grabbableForEvent(t)&&!u.grabbing&&(this._grabbedManipulators.set(t.pointerId,{manipulator:u,tool:l,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(a.tool)),u.grabbing=!0,u.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(t.pointerId)||this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!GP(t))break;const s=this._grabbedManipulators.get(t.pointerId),a=s==null?void 0:s.manipulator,u=s==null?void 0:s.tool;if(a==null||u==null)break;const l=Pa(t);l.x=Va(l.x,0,i.view.width),l.y=Va(l.y,0,i.view.height);const y=s.start,w=this._draggedManipulators.get(t.pointerId);switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,w?a.events.emit("drag",{action:"update",start:y,screenPoint:l}):a.events.emit("drag",{action:"start",start:y,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{tool:u,manipulator:a,start:y}));break;case"end":a.dragging=!1,w&&a.events.emit("drag",{action:"end",start:y,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=Pa(t),a=this._intersect(s,t.pointerType,i.forEachTool);if(lX(t)||i.forEachTool(w=>{if((a==null||a.tool!==w||w.automaticManipulatorSelection)&&w.manipulators){let I=!1;w.manipulators.forEach(({manipulator:E})=>{E.selected&&(E.selected=!1,I=!0)}),I&&w.onManipulatorSelectionChanged&&w.onManipulatorSelectionChanged()}}),a==null)break;const{manipulator:u,tool:l}=a;if(!u.interactive)break;u.selectable&&l.automaticManipulatorSelection&&(u.selected=!u.selected,l.onManipulatorSelectionChanged&&l.onManipulatorSelectionChanged());const y=t.native.shiftKey;u.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:y,stopPropagation:r}),Wx(u,r);break}case"click":{const s=Pa(t),a=this._intersect(s,t.pointerType,i.forEachTool),u=a==null?void 0:a.manipulator;if(u==null||!u.interactive)break;const l=t.native.shiftKey;u.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l}),r();break}case"double-click":{const s=Pa(t),a=this._intersect(s,t.pointerType,i.forEachTool),u=a!=null?a.manipulator:null;if(u==null||!u.interactive)break;const l=t.native.shiftKey;u.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:r}),Wx(u,r);break}case"immediate-double-click":{const s=Pa(t),a=this._intersect(s,t.pointerType,i.forEachTool),u=a!=null?a.manipulator:null;if(u==null||!u.interactive)break;const l=t.native.shiftKey;u.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:r}),Wx(u,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Pa(i)}),this._grabbedManipulators.forEach(({manipulator:s},a)=>{s===t&&this._grabbedManipulators.delete(a)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(t,i){var s;const r=(s=this._grabbedManipulators.get(t.pointerId))==null?void 0:s.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Pa(t)}),this._grabbedManipulators.delete(t.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_cursorFromMap(t){let i=null;return ub(t,({manipulator:r})=>!(r==null||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(t){this._updateCursor(),this._updateFocusedManipulatorTools(t)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),t(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const a=this._grabbedManipulators.values(),u=u8(a,({tool:l})=>l===s);s.firstGrabbedManipulator=u!=null?u.manipulator:null})}clearPointers(t,{forEachTool:i,setActiveTool:r},s=!0,a){const u=(l,y)=>l===t&&(a==null||a===y);this._grabbedManipulators.forEach(({tool:l,manipulator:y,pointerType:w},I)=>{u(l,y)&&(this._grabbedManipulators.delete(I),y.grabbing=!1,y.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:w}))}),this._draggedManipulators.forEach(({tool:l,manipulator:y},w)=>{u(l,y)&&(this._draggedManipulators.delete(w),y.dragging=!1,y.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:l,manipulator:y},w)=>{u(l,y)&&(this._hoveredManipulators.delete(w),y.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}_intersect(t,i,r){let s=null;return r(a=>{if(a.manipulators==null||!JT(a))return!1;const u=a.manipulators.intersect(t,i);return u!=null&&(s={tool:a,manipulator:u},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(nn(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!UP(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Pa(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){var l;let a=this._intersect(t,r,s);const u=(l=this._hoveredManipulators.get(i))==null?void 0:l.manipulator;a==null||a.manipulator.interactive||(a=null),a!=null&&u===a.manipulator||(u!=null&&(u.hovering=!1),a!=null?(a.manipulator.hovering=!0,this._hoveredManipulators.set(i,a)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(t){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(t(null),this._revertToNullActiveTool=!1)}};function UP(e){return e==="mouse"}function GP(e){return e.pointerType!=="mouse"||e.button===0}function lX(e){return!!e.native.shiftKey}function Wx(e,t){e!=null&&e.consumesClicks&&t()}const qP="attached",Zx="tools",HP=1e3;let Ca=class extends Pt{constructor(t){super(t),this._updatingHandles=new rd,this._clock=Tf,this._manipulatorState=new aX,this.tools=new At,this.cursor=null,this._interacting=!1,this._interactingTimeout=HP,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(vD,t=>{this._handleInputEvent(t)},pu.TOOL),...oX(this.tools),this.tools.on("before-add",({item:t})=>{this._updateToolEditableFlag(t)}),this.tools.on("before-remove",({item:t})=>{this._manipulatorState.clearPointers(t,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(t=>t.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:t=>{this.activeTool=t},view:this.view}}set activeTool(t){if(t!=null&&!this.view.ready)return void pt.getLogger(this).error("Cannot set active tool while view is not ready.");if(t===this.activeTool)return;const i=this.activeTool;this._set("activeTool",t),i!=null&&i.deactivate(),t!=null&&t.activate(),this._removeIncompleteTools(t);for(const r of this.tools){this._updateToolEditableFlag(r);const s=JT(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(t=>t.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=er(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var t;this.view.type==="3d"?this.addHandles([qt(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(t=this.view.elevationProvider)==null?void 0:t.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i)))],qP):this.addHandles(qt(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(qP),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(t){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>t(r,i))})}_handleInputEvent(t){let i=!1;const r={...t,stopPropagation:()=>{i=!0,t.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&t.type==="key-down"&&t.key==="Escape"&&this.activeTool&&(t.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),t.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(Zx),this._forEachTool(t=>{if(t instanceof Pt){const i=qt(()=>[t.cursor,t.visible,t.editable],()=>{JT(t)||this._manipulatorState.clearPointers(t,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,Zx)}t.manipulators&&this.addHandles([t.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(t,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),t.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],Zx)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(t){var i;(i=t.setEditableFlag)==null||i.call(t,$g.MANAGER,this.activeTool==null||t===this.activeTool)}_updateCursor(){let t=this._manipulatorState.cursor;t==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(t=i.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(t){this.tools.filter(i=>(t==null||i!==t)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){const t=this;return{setClock:i=>this._clock=i,set interactingTimeoutEnabled(i){t._interactingTimeout=i?HP:0},get interactingTimeoutEnabled(){return t._interactingTimeout!==0}}}};v([M({constructOnly:!0,nonNullable:!0})],Ca.prototype,"view",void 0),v([M({value:null})],Ca.prototype,"activeTool",null),v([M({readOnly:!0,type:At})],Ca.prototype,"tools",void 0),v([M({readOnly:!0})],Ca.prototype,"cursor",void 0),v([M({readOnly:!0})],Ca.prototype,"updating",null),v([M()],Ca.prototype,"_interacting",void 0),v([M({readOnly:!0})],Ca.prototype,"interacting",null),Ca=v([me("esri.views.ToolViewManager")],Ca);let Rp=class extends Pt{constructor(t){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",t.mapping==="standard"?this._detectedDeviceType="standard":cX.test(t.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=t.index}get native(){const t=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<t.length?t[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return uX[this.deviceType]}};v([M({nonNullable:!0,readOnly:!0})],Rp.prototype,"nativeIndex",void 0),v([M({type:String,readOnly:!0})],Rp.prototype,"deviceType",null),v([M({type:Number,readOnly:!0})],Rp.prototype,"axisThreshold",null),Rp=v([me("esri.views.input.gamepad.GamepadInputDevice")],Rp);const cX=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),uX={standard:.15,spacemouse:.025,unknown:0},iE=Rp;let Fy=class extends Pt{constructor(...t){super(...t),this.devices=new At,this.enabledFocusMode="document"}};v([M({type:At.ofType(iE),readOnly:!0})],Fy.prototype,"devices",void 0),v([M({type:["document","view","none"]})],Fy.prototype,"enabledFocusMode",void 0),Fy=v([me("esri.views.input.gamepad.GamepadSettings")],Fy);const hX=Fy;let Gv=class extends Pt{constructor(){super(...arguments),this.gamepad=new hX}};v([M({readOnly:!0})],Gv.prototype,"gamepad",void 0),Gv=v([me("esri.views.input.Input")],Gv);const dX=Gv;let Hc=class extends Pt{constructor(t){super(t),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};v([M({type:Boolean,nonNullable:!0})],Hc.prototype,"enabled",void 0),v([M({type:iE})],Hc.prototype,"device",void 0),v([M({type:["pan","zoom"],nonNullable:!0})],Hc.prototype,"mode",void 0),v([M({type:["forward-down","forward-up"],nonNullable:!0})],Hc.prototype,"tiltDirection",void 0),v([M({type:Number,nonNullable:!0})],Hc.prototype,"velocityFactor",void 0),Hc=v([me("esri.views.navigation.gamepad.GamepadSettings")],Hc);const MD=Hc;let Ph=class extends Pt{constructor(t){super(t),this.browserTouchPanEnabled=!0,this.gamepad=new MD,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};v([M({type:Boolean})],Ph.prototype,"browserTouchPanEnabled",void 0),v([M({type:MD,nonNullable:!0})],Ph.prototype,"gamepad",void 0),v([M({type:Boolean})],Ph.prototype,"momentumEnabled",void 0),v([M({type:Boolean})],Ph.prototype,"mouseWheelZoomEnabled",void 0),Ph=v([me("esri.views.navigation.Navigation")],Ph);const ID=Ph,ED={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer"},kD=Object.values(ED),AD=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${kD.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),pX=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${kD.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),fX=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function Yce(e){return!!AD.test(e)}function rE(e){if(e==null)return null;const t=ln(e),i=(t==null?void 0:t.path.match(AD))||(t==null?void 0:t.path.match(pX));if(!i)return null;const[,r,s,a,u]=i,l=s.indexOf("/");return{title:PD(l!==-1?s.slice(l+1):s),serverType:ED[a.toLowerCase()],sublayer:u!=null&&u!==""?parseInt(u,10):null,url:{path:r}}}function mX(e){const t=ln(e).path.match(fX);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function PD(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function Xce(e,t){const i=[];if(e){const r=rE(e);r!=null&&r.title&&i.push(r.title)}if(t){const r=PD(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function Qce(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",a=(e=e.toLowerCase()).includes(t),u=e.includes(i)||e.includes(r)||e.includes(s);return a&&u}function eue(e,t){return e&&EO(kO(e,t))}function tue(e){let{url:t}=e;if(!t)return{url:t};t=kO(t,e.logger);const i=ln(t),r=rE(i.path);let s;if(r!=null)r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const a=mX(i.path);a!=null&&(t=a.serviceUrl,s=a.sublayerId)}return{url:EO(t),layerId:s}}function iue(e,t,i,r,s){df(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=fb(r.url,i,e.layerId.toString()))}function rue(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),a=t.includes("/wmsserver");return i&&(r||s||a)}var WP;function yX(e){var r;if(e.type==="integrated-mesh-3dtiles")return null;const t=e.url?rE(e.url):void 0;return!(((r=e.spatialReference)==null?void 0:r.vcsWkid)==null&&t!=null&&t.serverType==="ImageServer")&&CD(e)&&e.heightModelInfo?e.heightModelInfo:gX(e)?OI.deriveUnitFromSR(vX,e.spatialReference):null}function CD(e){return"heightModelInfo"in e}function $D(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function gX(e){return $D(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):OD(e)}function _X(e){return e.layers!=null||OD(e)||$D(e)||CD(e)}function OD(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(WP||(WP={}));const vX=new OI({heightModel:"gravity-related-height"});var q1;(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(q1||(q1={}));let KT,Jx=null;async function bX(e){Jx||(Jx=it(()=>import("./geometryServiceUtils-JF1gbGur.js"),__vite__mapDeps([193,194])).then(t=>KT=t)),await Jx,mr(e)}async function LD(e,t,i,r){if(!e)return null;const s=e.spatialReference;return ku()||Ga(s,t)?Td(e,t):KT?KT.projectGeometry(e,t,i,r):(await Promise.race([bX(r),xu(r)]),LD(e,t,i,r))}let ki=class extends Pt{constructor(t){super(t),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=fg(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,s,a,u;const t=(r=this.map)==null?void 0:r.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:t==null?void 0:t.basemap,layers:(s=t==null?void 0:t.basemap)==null?void 0:s.baseLayers},{layers:t==null?void 0:t.layers},{parent:t==null?void 0:t.ground,layers:(a=t==null?void 0:t.ground)==null?void 0:a.layers},{parent:t==null?void 0:t.basemap,layers:(u=t==null?void 0:t.basemap)==null?void 0:u.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:t,updating:i}=this._allLayers;let r=null;for(const a of t){const u=this._getSupportedSpatialReferences(a);if(u.length>0){const l=this._narrowDownSpatialReferenceCandidates(r,u);l!=null&&(r=l)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:s!=null?s.spatialReference:null,viewingMode:s!=null?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,s,a,u,l,y,w;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:t,updating:i}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(l=(u=(a=this.map)==null?void 0:a.call(this))==null?void 0:u.basemap)==null?void 0:l.baseLayers},{layers:(w=(y=this.map)==null?void 0:y.call(this))==null?void 0:w.layers}]);if(t&&t.length>0&&"tileInfo"in t[0]){const I=t[0].tileInfo;return{tileInfo:I&&I.spatialReference.equals(this.spatialReference)?I:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var r,s,a;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:t,updating:i}=this._allLayers;for(const u of t)if(_X(u)){const l=yX(u);if(l)return{heightModelInfo:l,vcsWkid:(s=u.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(a=u.spatialReference)==null?void 0:a.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const t=this._allLayers,i=t.updating,r=[];for(const s of t.layers){const a="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),u=this.requiresExtentInSpatialReference?null:a[0],l=a.find(y=>y.spatialReference.equals(this.spatialReference))??u;if(l)return{candidates:[{extent:l,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const y of a)r.push({extent:y,layer:s})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:t,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(t==null||t.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(t),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=fg(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:VM(async a=>{try{const u=await LD(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,a);this._projectExtentTask={...this._projectExtentTask,task:null,output:u}}catch{if(Vl(a))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(t,i){if(t==null)return i;const r=[],s=(a,u)=>a!=null?u!=null?a===u&&a:a:u;for(const a of t)for(const u of i){if(!a.spatialReference.equals(u.spatialReference))continue;const l=s(a.viewingMode,u.viewingMode);if(l!==!1){r.push({spatialReference:a.spatialReference,viewingMode:l});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(t){const i=this.defaultSpatialReference;return t==null||t.length<1?i!=null?{spatialReference:i,viewingMode:null}:null:(i!=null&&t.length>1&&t.some(({spatialReference:r})=>r.equals(i))&&(t=t.filter(({spatialReference:r})=>r.equals(i))),t.length>1&&t.some(({viewingMode:r})=>r!==q1.Local)&&(t=t.filter(({viewingMode:r})=>r!==q1.Local)),t[0])}_getSupportedSpatialReferences(t){const i="supportedSpatialReferences"in t&&t.supportedSpatialReferences||(t.spatialReference?[t.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const a=this.getSpatialReferenceSupport({spatialReference:s,layer:t});if(a!=null){const u=a.constraints!=null?a.constraints:[{spatialReference:s,viewingMode:null}];for(const{spatialReference:l,viewingMode:y}of u)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!l.equals(this.userSpatialReference)||r.push({spatialReference:l,viewingMode:y})}}return r}_pickExtentCandidate(t){const i=this.spatialReference;return t.find(({extent:r})=>i.equals(r.spatialReference))||t[0]}_collectLayers(t){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const i=new wX;for(const s of t)if(this._collectCollection(s,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(t,i){if(t.layers){switch(this._loadMaybe(t.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of t.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(t){return t&&"loadStatus"in t&&t.loadStatus!=null?t.loadStatus==="not-loaded"?(t.load().catch(i=>{xo(i)||console.log(i)}),"loading"):t.loadStatus:"loaded"}};v([M()],ki.prototype,"required",void 0),v([M({constructOnly:!0})],ki.prototype,"map",void 0),v([M({constructOnly:!0})],ki.prototype,"getSpatialReferenceSupport",void 0),v([M()],ki.prototype,"defaultSpatialReference",void 0),v([M()],ki.prototype,"userSpatialReference",void 0),v([M()],ki.prototype,"sourcePreloadCount",void 0),v([M()],ki.prototype,"priorityCollection",void 0),v([M()],ki.prototype,"requiresExtentInSpatialReference",void 0),v([M()],ki.prototype,"suspended",void 0),v([M({readOnly:!0})],ki.prototype,"ready",null),v([M({readOnly:!0})],ki.prototype,"heightModelInfoReady",null),v([M({readOnly:!0})],ki.prototype,"spatialReference",null),v([M({readOnly:!0})],ki.prototype,"extent",null),v([M({readOnly:!0})],ki.prototype,"heightModelInfo",null),v([M({readOnly:!0})],ki.prototype,"vcsWkid",null),v([M({readOnly:!0})],ki.prototype,"latestVcsWkid",null),v([M({readOnly:!0})],ki.prototype,"viewingMode",null),v([M({readOnly:!0})],ki.prototype,"tileInfo",null),v([M({readOnly:!0})],ki.prototype,"mapCollections",null),v([M({readOnly:!0})],ki.prototype,"_allLayers",null),v([M({readOnly:!0})],ki.prototype,"_spatialReferenceTask",null),v([M({readOnly:!0})],ki.prototype,"_tileInfoTask",null),v([M({readOnly:!0})],ki.prototype,"_heightModelInfoTask",null),v([M({readOnly:!0})],ki.prototype,"_extentCandidatesTask",null),v([M()],ki.prototype,"_extentTask",null),v([M()],ki.prototype,"_projectExtentTask",void 0),ki=v([me("esri.views.support.DefaultsFromMap")],ki);let wX=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var By;let vt=By=class extends Mu.EventedMixin(FM(Pt)){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.handles=new vM,this.updatingHandles=new rd,this.allLayerViews=new Sg({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:SX}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new ug,this.analyses=new z1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new At,this.magnifier=new fD,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new dX,this.navigation=new ID,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new sX(this),this.persistableViewModels=new At,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(qt(()=>this.preconditionsReady,t=>{var r,s;const i=this.ready;if(t?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,By.views.add(this)):(this._lockedSpatialReference=null,By.views.remove(this)),this.notifyChange("spatialReference"),!t&&i)(r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(s=this.layerViewManager)==null||s.clear(),this._teardown();else if(t&&!i){try{this._startup()}catch(a){return void queueMicrotask(()=>{console.error("View._startup failed",a),this.fatalError=new gt("startup-error",null,a)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},gd))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,Mb(()=>this.ready)))),this.basemapView=new qc({view:this}),this.layerViewManager=new BY({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Ca({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new iX({view:this}),this.addHandles([qt(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},Zo),qt(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},gd),qt(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},Zo)])}_setupSpatialReferenceLogger(){let e=null;this.addHandles([qt(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(t&&!this.spatialReference&&i){if(e!=null)return;const s=Ni(()=>e=fg(e));e=VM(async a=>{try{await W$(this.spatialReferenceWarningDelay,null,a)}catch{return}finally{e=null}pt.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var e,t;this.destroyed||(By.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Xi(this.graphics),this.analyses=Xi(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Xi(this.analysisViewManager),this.toolViewManager=Xi(this.toolViewManager),this.layerViewManager=Xi(this.layerViewManager),this.selectionManager=Xi(this.selectionManager),this.basemapView=Xi(this.basemapView),(e=this.groundView)==null||e.destroy(),(t=this.layerViews)==null||t.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Xi(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return pt.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var e;return(e=this.toolViewManager)==null?void 0:e.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new ki({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||mu.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(e){e!==this._get("map")&&(e!=null&&e.destroyed&&(pt.getLogger(this).warn("#map","The provided map is already destroyed",{map:e}),e=null),mu.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",e))}get spatialReference(){var t,i;const e=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(e&&((i=(t=this.defaultsFromMap)==null?void 0:t.required)!=null&&i.heightModelInfo)){const r=e.clone();return r.vcsWkid=this.defaultsFromMap.vcsWkid,r.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,r}return e}set spatialReference(e){const t=!ds(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Ua}set timeZone(e){const t=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=e,e===Ua||e===SI||t.has(e.toLowerCase())||i.has(e.toLowerCase())||pt.getLogger(this).warn("#timeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}get tools(){var e;return(e=this.toolViewManager)==null?void 0:e.tools}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){var e;return((e=this.toolViewManager)==null?void 0:e.cursor)??this._cursor??"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new ZT}whenLayerView(e){var t;return((t=this.layerViewManager)==null?void 0:t.whenLayerView(e))??Promise.reject()}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(e){throw new gt("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return this.getSpatialReferenceSupport({spatialReference:e})!=null}when(e,t){return this.isResolved()&&!this.ready&&pt.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(md(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};vt.views=new At,v([M()],vt.prototype,"_userSpatialReference",void 0),v([M()],vt.prototype,"activeTool",null),v([M({readOnly:!0})],vt.prototype,"allLayerViews",void 0),v([M()],vt.prototype,"groundView",void 0),v([M()],vt.prototype,"animation",null),v([M()],vt.prototype,"basemapView",void 0),v([M()],vt.prototype,"center",null),v([M({readOnly:!0})],vt.prototype,"_defaultsFromMapSettings",null),v([M()],vt.prototype,"defaultsFromMap",null),v([M()],vt.prototype,"fatalError",void 0),v([M({type:tr})],vt.prototype,"extent",null),v([M(xP(ug,"graphics"))],vt.prototype,"graphics",void 0),v([M(xP(z1,"analyses"))],vt.prototype,"analyses",void 0),v([M({readOnly:!0,type:OI})],vt.prototype,"heightModelInfo",null),v([M({readOnly:!0})],vt.prototype,"interacting",null),v([M({readOnly:!0})],vt.prototype,"navigating",null),v([M({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],vt.prototype,"preconditionsReady",null),v([M({readOnly:!0})],vt.prototype,"typeSpecificPreconditionsReady",void 0),v([M({type:At,readOnly:!0})],vt.prototype,"layerViews",void 0),v([M()],vt.prototype,"resolution",null),v([M({type:fD})],vt.prototype,"magnifier",void 0),v([M({value:null,type:f5})],vt.prototype,"map",null),v([M()],vt.prototype,"padding",void 0),v([M({readOnly:!0})],vt.prototype,"ready",void 0),v([M({type:si})],vt.prototype,"spatialReference",null),v([M()],vt.prototype,"spatialReferenceWarningDelay",void 0),v([M()],vt.prototype,"stationary",null),v([M({readOnly:!0})],vt.prototype,"supportsGround",void 0),v([M({type:mR})],vt.prototype,"timeExtent",void 0),v([M({type:String,nonNullable:!0})],vt.prototype,"timeZone",null),v([M()],vt.prototype,"tools",null),v([M()],vt.prototype,"toolViewManager",void 0),v([M({readOnly:!0})],vt.prototype,"type",void 0),v([M({type:Number})],vt.prototype,"scale",void 0),v([M({readOnly:!0})],vt.prototype,"updating",void 0),v([M({readOnly:!0})],vt.prototype,"initialExtentRequired",void 0),v([M({readOnly:!0})],vt.prototype,"initialExtent",null),v([M()],vt.prototype,"cursor",null),v([M({readOnly:!0})],vt.prototype,"input",void 0),v([M({type:ID,nonNullable:!0})],vt.prototype,"navigation",void 0),v([M()],vt.prototype,"layerViewManager",void 0),v([M()],vt.prototype,"analysisViewManager",void 0),v([M()],vt.prototype,"selectionManager",void 0),v([M()],vt.prototype,"width",void 0),v([M()],vt.prototype,"height",void 0),v([M({readOnly:!0})],vt.prototype,"resizing",void 0),v([M({value:null,readOnly:!0})],vt.prototype,"size",null),v([M({readOnly:!0})],vt.prototype,"suspended",void 0),v([M({readOnly:!0})],vt.prototype,"viewEvents",void 0),v([M({readOnly:!0})],vt.prototype,"persistableViewModels",void 0),v([M()],vt.prototype,"_isValid",void 0),v([M()],vt.prototype,"_readyCycleForced",void 0),v([M()],vt.prototype,"_lockedSpatialReference",void 0),v([M()],vt.prototype,"_userTimeZone",void 0),v([M()],vt.prototype,"_lockedTimeZone",void 0),v([M({type:ZT})],vt.prototype,"theme",void 0),v([M({readOnly:!0,type:ZT})],vt.prototype,"effectiveTheme",null),vt=By=v([me("esri.views.View")],vt);const xX=vt;function SX(e){return e.layerViews}let Wc=class extends g1{constructor(t){super(t),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=wo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var t;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(t=this._resolver)==null||t.reject(new gt("ViewAnimation stopped")))}finish(){var t;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(t=this._resolver)==null||t.resolve())}update(t,i){i||(i=Tu(t)?"waiting-for-target":"running"),this._set("target",t),this._set("state",i)}};v([M({readOnly:!0})],Wc.prototype,"done",null),v([M({readOnly:!0,type:String})],Wc.prototype,"state",void 0),v([M()],Wc.prototype,"target",void 0),Wc=v([me("esri.views.ViewAnimation")],Wc),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Wc||(Wc={}));const YT=Wc;function Fh(e,t,i,r){const s=3*e,a=3*(i-e)-s,u=1-s-a,l=3*t,y=3*(r-t)-l,w=1-l-y;function I(G){return((u*G+a)*G+s)*G}function E(G){return((w*G+y)*G+l)*G}function A(G){return(3*u*G+2*a)*G+s}function R(G,K){let Y,ae,Te,_e,be,ke;for(Te=G,ke=0;ke<8;ke++){if(_e=I(Te)-G,Math.abs(_e)<K)return Te;if(be=A(Te),Math.abs(be)<1e-6)break;Te-=_e/be}if(Y=0,ae=1,Te=G,Te<Y)return Y;if(Te>ae)return ae;for(;Y<ae;){if(_e=I(Te),Math.abs(_e-G)<K)return Te;G>_e?Y=Te:ae=Te,Te=.5*(ae-Y)+Y}return Te}return function(G,K=1e-6){return E(R(G,K))}}const TX=/^cubic-bezier\((.*)\)/,fo={};function MX(e){let t=fo[e]||null;if(!t){const i=TX.exec(e);if(i){const r=i[1].split(",").map(s=>parseFloat(s.trim()));r.length!==4||r.some(s=>isNaN(s))||(t=Fh.apply(Fh,r))}}return t}fo.ease=Fh(.25,.1,.25,1),fo.linear=Fh(0,0,1,1),fo.easeIn=fo["ease-in"]=Fh(.42,0,1,1),fo.easeOut=fo["ease-out"]=Fh(0,0,.58,1),fo.easeInOut=fo["ease-in-out"]=Fh(.42,0,.58,1);function IX(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function EX(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function kX(e,t,i,r,s,a,u){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=a,e[5]=u,e}function sE(e,t){const i=t[0],r=t[1],s=t[2],a=t[3],u=t[4],l=t[5];let y=i*a-r*s;return y?(y=1/y,e[0]=a*y,e[1]=-r*y,e[2]=-s*y,e[3]=i*y,e[4]=(s*l-a*u)*y,e[5]=(r*u-i*l)*y,e):null}function AX(e){return e[0]*e[3]-e[1]*e[2]}function RD(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],y=t[5],w=i[0],I=i[1],E=i[2],A=i[3],R=i[4],G=i[5];return e[0]=r*w+a*I,e[1]=s*w+u*I,e[2]=r*E+a*A,e[3]=s*E+u*A,e[4]=r*R+a*G+l,e[5]=s*R+u*G+y,e}function qb(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],y=t[5],w=Math.sin(i),I=Math.cos(i);return e[0]=r*I+a*w,e[1]=s*I+u*w,e[2]=r*-w+a*I,e[3]=s*-w+u*I,e[4]=l,e[5]=y,e}function nE(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],y=t[5],w=i[0],I=i[1];return e[0]=r*w,e[1]=s*w,e[2]=a*I,e[3]=u*I,e[4]=l,e[5]=y,e}function Og(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],y=t[5],w=i[0],I=i[1];return e[0]=r,e[1]=s,e[2]=a,e[3]=u,e[4]=r*w+a*I+l,e[5]=s*w+u*I+y,e}function DD(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function zD(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function oE(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function PX(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function CX(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function $X(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function ND(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function OX(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function LX(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function RX(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function DX(e,t){const i=e[0],r=e[1],s=e[2],a=e[3],u=e[4],l=e[5],y=t[0],w=t[1],I=t[2],E=t[3],A=t[4],R=t[5],G=sa();return Math.abs(i-y)<=G*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-w)<=G*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(s-I)<=G*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(a-E)<=G*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(u-A)<=G*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-R)<=G*Math.max(1,Math.abs(l),Math.abs(R))}const zX=RD,NX=ND;Object.freeze(Object.defineProperty({__proto__:null,add:$X,copy:IX,determinant:AX,equals:DX,exactEquals:RX,frob:CX,fromRotation:DD,fromScaling:zD,fromTranslation:oE,identity:EX,invert:sE,mul:zX,multiply:RD,multiplyScalar:OX,multiplyScalarAndAdd:LX,rotate:qb,scale:nE,set:kX,str:PX,sub:NX,subtract:ND,translate:Og},Symbol.toStringTag,{value:"Module"}));function Bl(){return[1,0,0,1,0,0]}function FX(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function BX(e,t,i,r,s,a){return[e,t,i,r,s,a]}function jX(e,t){return new Float64Array(e,t,6)}const VX=Bl();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:VX,clone:FX,create:Bl,createView:jX,fromValues:BX},Symbol.toStringTag,{value:"Module"}));function Lg(e,t){return e[0]=t[0],e[1]=t[1],e}function Yr(e,t,i){return e[0]=t,e[1]=i,e}function FD(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function Rg(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function BD(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function jD(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function UX(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function GX(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function qX(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function HX(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function WX(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function i0(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function ZX(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function Hb(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function H1(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function W1(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function VD(e){const t=e[0],i=e[1];return t*t+i*i}function UD(e,t){return e[0]=-t[0],e[1]=-t[1],e}function JX(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function XT(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function GD(e,t){return e[0]*t[0]+e[1]*t[1]}function qD(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function KX(e,t,i,r){const s=t[0],a=t[1];return e[0]=s+r*(i[0]-s),e[1]=a+r*(i[1]-a),e}function YX(e,t){t=t||1;const i=2*tI()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function XX(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function Ho(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function QX(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function eQ(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function tQ(e,t,i,r){const s=t[0]-i[0],a=t[1]-i[1],u=Math.sin(r),l=Math.cos(r);return e[0]=s*l-a*u+i[0],e[1]=s*u+a*l+i[1],e}function iQ(e,t){const i=e[0],r=e[1],s=t[0],a=t[1];let u=i*i+r*r;u>0&&(u=1/Math.sqrt(u));let l=s*s+a*a;l>0&&(l=1/Math.sqrt(l));const y=(i*s+r*a)*u*l;return y>1?0:y<-1?Math.PI:Math.acos(y)}function rQ(e){return"vec2("+e[0]+", "+e[1]+")"}function sQ(e,t){return e[0]===t[0]&&e[1]===t[1]}function nQ(e,t){const i=e[0],r=e[1],s=t[0],a=t[1],u=sa();return Math.abs(i-s)<=u*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))}function oQ(e,t,i,r,s){let a=t[0]-i[0],u=t[1]-i[1];const l=(r[0]*a+r[1]*u)*(s-1);return a=r[0]*l,u=r[1]*l,e[0]=t[0]+a,e[1]=t[1]+u,e}const aQ=W1,aE=Rg,lQ=BD,cQ=jD,uQ=Hb,hQ=H1,dQ=VD;Object.freeze(Object.defineProperty({__proto__:null,add:FD,angle:iQ,ceil:UX,copy:Lg,cross:qD,dist:uQ,distance:Hb,div:cQ,divide:jD,dot:GD,equals:nQ,exactEquals:sQ,floor:GX,inverse:JX,len:aQ,length:W1,lerp:KX,max:HX,min:qX,mul:lQ,multiply:BD,negate:UD,normalize:XT,projectAndScale:oQ,random:YX,rotate:tQ,round:WX,scale:i0,scaleAndAdd:ZX,set:Yr,sqrDist:hQ,sqrLen:dQ,squaredDistance:H1,squaredLength:VD,str:rQ,sub:aE,subtract:Rg,transformMat2:XX,transformMat2d:Ho,transformMat3:QX,transformMat4:eQ},Symbol.toStringTag,{value:"Module"}));function yr(){return[0,0]}function pQ(e){return[e[0],e[1]]}function r0(e,t){return[e,t]}function fQ(e,t=yr()){const i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function mQ(e,t){return new Float64Array(e,t,2)}function HD(){return yr()}function WD(){return r0(1,1)}function ZD(){return r0(1,0)}function JD(){return r0(0,1)}const yQ=HD(),gQ=WD(),_Q=ZD(),vQ=JD();Object.freeze(Object.defineProperty({__proto__:null,ONES:gQ,UNIT_X:_Q,UNIT_Y:vQ,ZEROS:yQ,clone:pQ,create:yr,createView:mQ,fromArray:fQ,fromValues:r0,ones:WD,unitX:ZD,unitY:JD,zeros:HD},Symbol.toStringTag,{value:"Module"}));const Z_={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Ko({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:si.WebMercator}),minus180Line:new Ko({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:si.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Ko({paths:[[[180,-180],[180,180]]],spatialReference:si.WGS84}),minus180Line:new Ko({paths:[[[-180,-180],[-180,180]]],spatialReference:si.WGS84})}};function Yh(e,t){return Math.ceil((e-t)/(2*t))}function KD(e,t){const i=hg(e);for(const r of i)for(const s of r)s[0]+=t;return e}function hg(e){return aI(e)?e.rings:e.paths}function aue(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function bQ(e){return typeof e=="string"?ln(e):Ge(e)}function wQ(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const a=e[s];if(a!=null&&typeof a!="function")if(Array.isArray(a))r[s]=a.map(u=>wQ({item:u},t,i).item);else if(typeof a=="object")if(a.toJSON){const u=a.toJSON(i==null?void 0:i[s]);r[s]=t?u:JSON.stringify(u)}else r[s]=t?a:JSON.stringify(a);else r[s]=a}return r}async function xQ(e,t,i,r){const s=bQ(e),a=t[0].spatialReference,u={...r,responseType:"json",query:{...s.query,f:"json",sr:WO(a),target:JSON.stringify({geometryType:lI(t[0]),geometries:t}),cutter:JSON.stringify(i)}},l=await Qr(s.path+"/cut",u),{cutIndexes:y,geometries:w=[]}=l.data;return{cutIndexes:y,geometries:w.map(I=>{const E=mf(I);return E.spatialReference=a,E})}}function SQ(e){return{geometryType:lI(e[0]),geometries:e.map(t=>t.toJSON())}}function TQ(e,t,i){const r=EG(t);return e.map(s=>{const a=r.fromJSON(s);return a.spatialReference=i,a})}async function MQ(e,t,i){const r=typeof e=="string"?ln(e):e,s=t[0].spatialReference,a=lI(t[0]),u={...i,query:{...r.query,f:"json",sr:WO(s),geometries:JSON.stringify(SQ(t))}},{data:l}=await Qr(r.path+"/simplify",u);return TQ(l.geometries,a,s)}const YD=()=>pt.getLogger("esri.geometry.support.normalizeUtils");function IQ(e){return e.type==="polygon"}function EQ(e){return e[0].type==="polygon"}function kQ(e){return e[0].type==="polyline"}function ZP(e){const t=[];let i=0,r=0;for(let s=0;s<e.length;s++){const a=e[s];let u=null;for(let l=0;l<a.length;l++)u=a[l],t.push(u),l===0?(i=u[0],r=i):(i=Math.min(i,u[0]),r=Math.max(r,u[0]));u&&t.push([(i+r)/2,0])}return t}function AQ(e,t){if(!(e instanceof Ko||e instanceof vu)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw YD().error(s),new gt(s)}const i=hg(e),r=[];for(const s of i){const a=[];r.push(a),a.push([s[0][0],s[0][1]]);for(let u=0;u<s.length-1;u++){const l=s[u][0],y=s[u][1],w=s[u+1][0],I=s[u+1][1],E=Math.sqrt((w-l)*(w-l)+(I-y)*(I-y)),A=(I-y)/E,R=(w-l)/E,G=E/t;if(G>1){for(let Te=1;Te<=G-1;Te++){const _e=Te*t,be=R*_e+l,ke=A*_e+y;a.push([be,ke])}const K=(E+Math.floor(G-1)*t)/2,Y=R*K+l,ae=A*K+y;a.push([Y,ae])}a.push([w,I])}}return IQ(e)?new vu({rings:r,spatialReference:e.spatialReference}):new Ko({paths:r,spatialReference:e.spatialReference})}function JP(e,t,i){if(t){const r=AQ(e,1e6);e=cy(r,!0)}return i&&(e=KD(e,i)),e}function KP(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=Yh(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=Yh(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=Yh(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=Yh(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function PQ(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],a=t.geometries[r],u=hg(a);for(let l=0;l<u.length;l++){const y=u[l];y.some(w=>{if(w[0]<180)return!0;{let I=0;for(let A=0;A<y.length;A++){const R=y[A][0];I=R>I?R:I}I=Number(I.toFixed(9));const E=-360*Yh(I,180);for(let A=0;A<y.length;A++){const R=a.getPoint(l,A);a.setPoint(l,A,R.clone().offset(E,0))}return!0}})}if(s===i){if(EQ(e))for(const l of hg(a))e[s]=e[s].addRing(l);else if(kQ(e))for(const l of hg(a))e[s]=e[s].addPath(l)}else i=s,e[s]=a}return e}async function CQ(e,t,i){if(!Array.isArray(e))return CQ([e],t);t&&typeof t!="string"&&YD().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:(t==null?void 0:t.url)??mi.geometryServiceUrl;let s,a,u,l,y,w,I,E,A=0;const R=[],G=[];for(const be of e)if(be!=null)if(s||(s=be.spatialReference,a=Mn(s),u=s.isWebMercator,w=u?102100:4326,l=Z_[w].maxX,y=Z_[w].minX,I=Z_[w].plus180Line,E=Z_[w].minus180Line),a)if(be.type==="mesh")G.push(be);else if(be.type==="point")G.push(KP(be.clone(),l,y));else if(be.type==="multipoint"){const ke=be.clone();ke.points=ke.points.map(Ae=>KP(Ae,l,y)),G.push(ke)}else if(be.type==="extent"){const ke=be.clone()._normalize(!1,!1,a);G.push(ke.rings?new vu(ke):ke)}else if(be.extent){const ke=be.extent,Ae=Yh(ke.xmin,y)*(2*l);let Ve=Ae===0?be.clone():KD(be.clone(),Ae);ke.offset(Ae,0),ke.intersects(I)&&ke.xmax!==l?(A=ke.xmax>A?ke.xmax:A,Ve=JP(Ve,u),R.push(Ve),G.push("cut")):ke.intersects(E)&&ke.xmin!==y?(A=ke.xmax*(2*l)>A?ke.xmax*(2*l):A,Ve=JP(Ve,u,360),R.push(Ve),G.push("cut")):G.push(Ve)}else G.push(be.clone());else G.push(be);else G.push(be);let K=Yh(A,l),Y=-90;const ae=K,Te=new Ko;for(;K>0;){const be=360*K-180;Te.addPath([[be,Y],[be,-1*Y]]),Y*=-1,K--}if(R.length>0&&ae>0){const be=PQ(R,await xQ(r,R,Te,i)),ke=[],Ae=[];for(let lt=0;lt<G.length;lt++){const ct=G[lt];if(ct!=="cut")Ae.push(ct);else{const ut=be.shift(),nt=e[lt];nt!=null&&nt.type==="polygon"&&nt.rings&&nt.rings.length>1&&ut.rings.length>=nt.rings.length?(ke.push(ut),Ae.push("simplify")):Ae.push(u?ed(ut):ut)}}if(!ke.length)return Ae;const Ve=await MQ(r,ke,i),Ze=[];for(let lt=0;lt<Ae.length;lt++){const ct=Ae[lt];ct!=="simplify"?Ze.push(ct):Ze.push(u?ed(Ve.shift()):Ve.shift())}return Ze}const _e=[];for(let be=0;be<G.length;be++){const ke=G[be];if(ke!=="cut")_e.push(ke);else{const Ae=R.shift();_e.push(u===!0?ed(Ae):Ae)}}return _e}function $Q(e){if(!e)return null;const t=e.extent;if(!t)return null;const i=e.spatialReference&&Mn(e.spatialReference);if(!i)return t;const[r,s]=i.valid,a=2*s,{width:u}=t;let l,{xmin:y,xmax:w}=t;if([y,w]=[w,y],e.type==="extent"||u===0||u<=s||u>a||y<r||w>s)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;l=ZP(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;l=ZP(e.paths);break;case"multipoint":l=e.points}const I=t.clone();for(let E=0;E<l.length;E++){let A=l[E][0];A<0?(A+=s,w=Math.max(A,w)):(A-=s,y=Math.min(A,y))}return I.xmin=y,I.xmax=w,I.width<u?(I.xmin-=s,I.xmax-=s,I):t}function XD(e,t,i){const r=Mn(i);if(r==null)return e;const[s,a]=r.valid,u=2*a;let l=0,y=0;t>a?l=Math.ceil(Math.abs(t-a)/u):t<s&&(l=-Math.ceil(Math.abs(t-s)/u)),e>a?y=Math.ceil(Math.abs(e-a)/u):e<s&&(y=-Math.ceil(Math.abs(e-s)/u));let w=e+(l-y)*u;const I=w-t;return I>a?w-=u:I<s&&(w+=u),w}function lue(e,t){const i=Mn(t);if(i){const[r,s]=i.valid,a=s-r;if(e<r)for(;e<r;)e+=a;if(e>s)for(;e>s;)e-=a}return e}const QD=96,ez=39.37,OQ=180/Math.PI;function tz(e){return e.wkid?e:e.spatialReference||si.WGS84}function lE(e,t){return t.type?Yr(e,t.x,t.y):Lg(e,t)}function iz(e){return xd(e)}function nf(e,t,i=0){let r=e.width,s=e.height;if(i!==0){const l=CL(i),y=Math.abs(Math.cos(l)),w=Math.abs(Math.sin(l));r=e.width*y+e.height*w,s=e.width*w+e.height*y}const a=Math.max(1,t[0]),u=Math.max(1,t[1]);return Math.max(r/a,s/u)*VQ(e.spatialReference)}async function jy(e,t,i,r){var l,y;let s,a;if(!e||Array.isArray(e)&&!e.length)return null;if(At.isCollection(e)&&(e=e.toArray()),Array.isArray(e)&&e.length&&typeof e[0]=="object"){const w=e.every(A=>"attributes"in A),I=e.some(A=>!A.geometry);let E=e;if(w&&I&&t&&t.allLayerViews){const A=new Map;for(const Y of e){const ae=Y.layer,Te=A.get(ae)||[],_e=Y.attributes[ae.objectIdField];_e!=null&&Te.push(_e),A.set(ae,Te)}const R=[];A.forEach((Y,ae)=>{const Te=t.allLayerViews.find(_e=>_e.layer.id===ae.id);if(Te&&"queryFeatures"in Te){const _e=ae.createQuery();_e.objectIds=Y,_e.returnGeometry=!0,R.push(Te.queryFeatures(_e))}});const G=await Promise.all(R),K=[];for(const Y of G)if(Y&&Y.features&&Y.features.length)for(const ae of Y.features)ae.geometry!=null&&K.push(ae.geometry);E=K}for(const A of E)r=await jy(A,t,i,r);return r}if(Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number")s=new Ht(e);else if(e instanceof Iu)s=e;else if("geometry"in e){if(e.geometry)s=e.geometry;else if(e.layer){const w=e.layer,I=t.allLayerViews.find(E=>E.layer.id===w.id);if(I&&"queryFeatures"in I){const E=w.createQuery();E.objectIds=[e.attributes[w.objectIdField]],E.returnGeometry=!0;const A=await I.queryFeatures(E);s=(y=(l=A==null?void 0:A.features)==null?void 0:l[0])==null?void 0:y.geometry}}}if(s==null)return null;switch(s.type){case"point":a=new tr({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":a=$Q(s);break;default:a=s.extent}if(!a)return null;ku()||Ga(a.spatialReference,i)||await xu();const u=Td(a,i);return u?r=r?r.union(u):u:null}function LQ(e){var t;if(e&&(!Array.isArray(e)||typeof e[0]!="number")&&(typeof e=="object"||Array.isArray(e)&&typeof e[0]=="object")){if("layer"in e&&((t=e.layer)==null?void 0:t.minScale)!=null&&e.layer.maxScale!=null){const i=e.layer;return{min:i.minScale,max:i.maxScale}}if(Array.isArray(e)&&e.length&&e.every(i=>"layer"in i)){let i=0,r=0;for(const s of e){const a=s.layer;a!=null&&a.minScale&&a.maxScale&&(i=a.minScale<i?a.minScale:i,r=a.maxScale>r?a.maxScale:r)}return i&&r?{min:i,max:r}:null}}}function Kx(e,t){return ds(tz(e),t)?e:Td(e,t)}async function RQ(e,t){var Y;if(!e||!t)return new Fa({targetGeometry:new Ht,scale:0,rotation:0});let i=t.spatialReference;const{constraints:r,padding:s,viewpoint:a,size:u}=t,l=[s?u[0]-s.left-s.right:u[0],s?u[1]-s.top-s.bottom:u[1]];let y=null;e instanceof Fa?y=e:e.viewpoint?y=e.viewpoint:e.target&&e.target.declaredClass==="esri.Viewpoint"&&(y=e.target);let w=null;y!=null&&y.targetGeometry?w=y.targetGeometry:e instanceof tr?w=e:(e||e&&("center"in e||"extent"in e||"target"in e))&&(w=await jy(e.center,t,i)||await jy(e.extent,t,i)||await jy(e.target,t,i)||await jy(e,t,i)),!w&&(a!=null&&a.targetGeometry)?w=a.targetGeometry:!w&&t.extent&&(w=t.extent),i||(i=tz(t.spatialReference||t.extent||w)),ku()||ds(w.spatialReference,i)||Ga(w.spatialReference,i)||await xu();const I=Kx(w,i),E="center"in I?I.center:I;t.pickClosestTarget!==!1&&E.type==="point"&&((Y=a.targetGeometry)==null?void 0:Y.type)==="point"&&(E.x=XD(E.x,a.targetGeometry.x,E.spatialReference));let A=0;y?A=y.rotation:e.hasOwnProperty("rotation")?A=e.rotation:a&&(A=a.rotation);let R=0;if((y==null?void 0:y.targetGeometry)!=null&&y.targetGeometry.type==="point")R=y.scale;else if("scale"in e&&e.scale)R=e.scale;else if("zoom"in e&&e.zoom!==-1&&r&&r.effectiveLODs)R=r.zoomToScale(e.zoom);else if(Array.isArray(w)||w.type==="point"||w.type==="extent"&&w.width===0&&w.height===0){const ae=Kx(t.extent,i);R=ae!=null?nf(ae,l,A):t.extent?nf(t.extent,l,A):a.scale}else R=nf(Kx(w.extent,i),l,A);const G=LQ(e.target??e);G&&(G.min&&G.min<R?R=G.min:G.max&&G.max>R&&(R=G.max));let K=new Fa({targetGeometry:E,scale:R,rotation:A});return r&&(K=r.fit(K),r.constrainByGeometry(K),r.rotationEnabled||(K.rotation=a.rotation)),K}function na(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function DQ(e,t,i){return i?Yr(e,.5*(t[0]-i.right+i.left),.5*(t[1]-i.bottom+i.top)):i0(e,t,.5)}const zQ=function(){const e=yr();return function(t,i,r){const s=i.targetGeometry;lE(e,s);const a=.5*$f(i);return t.xmin=e[0]-a*r[0],t.ymin=e[1]-a*r[1],t.xmax=e[0]+a*r[0],t.ymax=e[1]+a*r[1],t.spatialReference=s.spatialReference,t}}();function NQ(e,t,i,r,s){var a;return QT(e,t,i.center),e.scale=nf(i,r),(a=s==null?void 0:s.constraints)==null||a.constrain(e),e}function FQ(e,t,i,r){return hE(e,t,i,r),sE(e,e)}const rz=function(){const e=yr();return function(t,i,r){return aE(t,UQ(t,i),DQ(e,i,r))}}(),BQ=function(){const e=Bl(),t=yr();return function(i,r,s,a){const u=$f(r),l=cE(r);return Yr(t,u,u),zD(e,t),qb(e,e,l),Og(e,e,rz(t,s,a)),Og(e,e,[0,a.top-a.bottom]),Yr(i,e[4],e[5])}}();function $f(e){return e.scale*jQ(e.targetGeometry)}function jQ(e){return e!=null&&Jo(e.spatialReference)?1/(iz(e.spatialReference)*ez*QD):1}function cE(e){return iI(e.rotation)||0}function VQ(e){return Jo(e)?iz(e)*ez*QD:1}function UQ(e,t){return i0(e,t,.5)}const uE=function(){const e=yr(),t=yr(),i=yr();return function(r,s,a,u,l,y){return UD(e,s),i0(t,a,.5*y),Yr(i,1/u*y,-1/u*y),oE(r,t),l&&qb(r,r,l),nE(r,r,i),Og(r,r,e),r}}(),hE=function(){const e=yr();return function(t,i,r,s){const a=$f(i),u=cE(i);return lE(e,i.targetGeometry),uE(t,e,r,a,u,s)}}(),GQ=function(){const e=yr();return function(t,i,r,s){const a=$f(i);return lE(e,i.targetGeometry),uE(t,e,r,a,0,s)}}();function qQ(e){const t=Mn(e);return t?t.valid[1]-t.valid[0]:0}function HQ(e,t){return Math.round(qQ(e)/t)}const WQ=function(){const e=yr(),t=yr(),i=[0,0,0];return function(r,s,a){Rg(e,r,s),XT(e,e),Rg(t,r,a),XT(t,t),qD(i,e,t);let u=Math.acos(GD(e,t)/(W1(e)*W1(t)))*OQ;return i[2]<0&&(u=-u),isNaN(u)&&(u=0),u}}(),ZQ=function(){const e=yr();return function(t,i,r,s){const a=t.targetGeometry;return na(t,i),BQ(e,i,r,s),a.x+=e[0],a.y+=e[1],t}}(),QT=function(e,t,i){na(e,t);const r=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,e},JQ=function(){const e=yr();return function(t,i,r,s,a){a||(a="center"),aE(e,r,s),i0(e,e,.5);const u=e[0],l=e[1];switch(a){case"center":Yr(e,0,0);break;case"left":Yr(e,-u,0);break;case"top":Yr(e,0,l);break;case"right":Yr(e,u,0);break;case"bottom":Yr(e,0,-l);break;case"top-left":Yr(e,-u,l);break;case"bottom-left":Yr(e,-u,-l);break;case"top-right":Yr(e,u,l);break;case"bottom-right":Yr(e,u,-l)}return Wb(t,i,e),t}}();function cue(e,t,i){return na(e,t),e.rotation+=i,e}function KQ(e,t,i){return na(e,t),e.rotation=i,e}const YQ=function(){const e=yr();return function(t,i,r,s,a){return na(t,i),isNaN(r)||r===0||(nz(e,s,i,a),t.scale=i.scale*r,oz(e,e,t,a),Wb(t,t,Yr(e,e[0]-s[0],s[1]-e[1]))),t}}();function YP(e,t,i){return na(e,t),e.scale=i,e}const sz=function(){const e=yr();return function(t,i,r,s,a,u){return na(t,i),isNaN(r)||r===0||(nz(e,a,i,u),t.scale=i.scale*r,t.rotation+=s,oz(e,e,t,u),Wb(t,t,Yr(e,e[0]-a[0],a[1]-e[1]))),t}}(),uue=function(){const e=yr(),t=yr();return function(i,r,s,a,u,l,y){return rz(t,l,y),FD(e,u,t),a?sz(i,r,s,a,e,l):YQ(i,r,s,e,l)}}(),nz=function(){const e=Bl();return function(t,i,r,s){return Ho(t,i,FQ(e,r,s,1))}}(),oz=function(){const e=Bl();return function(t,i,r,s){return Ho(t,i,hE(e,r,s,1))}}(),Wb=function(){const e=yr(),t=Bl();return function(i,r,s){na(i,r);const a=$f(r),u=i.targetGeometry;return DD(t,cE(r)),nE(t,t,r0(a,a)),Ho(e,s,t),u.x+=e[0],u.y+=e[1],i}}();let XQ=class{constructor(t,i,r,s){const a=t.targetGeometry,u=i.targetGeometry;s?typeof s=="string"&&(s=MX(s)||fo.ease):s=fo.ease,this.easing=s,this.duration=r,this.sCenterX=a.x,this.sCenterY=a.y,this.sScale=t.scale,this.sRotation=t.rotation,this.tCenterX=u.x,this.tCenterY=u.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(t,i){const r=this.easing(i);let s,a,u,l;i>=1?(s=this.tCenterX,a=this.tCenterY,u=this.tRotation,l=this.tScale):(s=this.sCenterX+r*this.dCenterX,a=this.sCenterY+r*this.dCenterY,u=this.sRotation+r*this.dRotation,l=this.sScale+r*this.dScale),t.targetGeometry.x=s,t.targetGeometry.y=a,t.scale=l,t.rotation=u}},Zc=class extends Pt{constructor(t){super(t),this._animation=null,this.updateFunction=null,this.duration=200,this.transition=null,this.easing=fo.ease,this.view=null,this.viewpoint=new Fa({targetGeometry:new Ht,scale:0,rotation:0}),this._updateTask=lf({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask=er(this._updateTask)}get animation(){return this._animation}set animation(t){this._animation=t,this.view&&(this.view.animation=t)}animate(t,i,r){this.stop();const s=this.viewpoint;na(s,i),this.transition=new XQ(this.viewpoint,t.target,(r==null?void 0:r.duration)||this.duration,(r==null?void 0:r.easing)||this.easing);const a=()=>{var u,l;this.animation===t&&this._updateTask&&(t.state==="finished"&&((u=this.transition)==null||u.applyRatio(this.viewpoint,1),(l=this.view)!=null&&l.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return t.when(a,a),this._startTime=performance.now(),this._updateTask.resume(),this.animation=t,t}animateContinous(t,i){this.stop(),this.updateFunction=i,this.viewpoint=t;const r=new YT({target:t.clone()}),s=()=>{this.animation===r&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return r.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=r,r}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(t){var r,s;const i=this.animation;if(i&&i.state!==YT.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,t.deltaTime);else{const a=this.transition,u=(performance.now()-this._startTime)/a.duration,l=u>=1;a.applyRatio(this.viewpoint,u),l&&((r=this.animation)==null||r.finish())}(s=this.view)!=null&&s.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};v([M()],Zc.prototype,"duration",void 0),v([M()],Zc.prototype,"transition",void 0),v([M()],Zc.prototype,"easing",void 0),v([M()],Zc.prototype,"view",void 0),v([M()],Zc.prototype,"viewpoint",void 0),Zc=v([me("esri.views.2d.AnimationManager")],Zc);const QQ=Zc;let eee=class{constructor(t){this.view=t,this._stationaryHandle=null,this._frameTaskHandle=null,this._updateParameters=null,this._updateRequested=!1,this.stationary=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters&&(this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions)},this.update=()=>{var u,l;if(this._updateRequested=!1,(u=this.view)==null?void 0:u.destroyed)return;const{allLayerViews:i,graphicsView:r,labelManager:s,state:{id:a}}=this.view;i.forEach(this._updateLayerView,this),s!=null&&(s.lastUpdateId!==a&&(s.viewChange(),s.lastUpdateId=a),s.updateRequested&&s.processUpdate(this._updateParameters)),r!=null&&(r.lastUpdateId!==a&&(r.viewChange(),r.lastUpdateId=a),r.updateRequested&&r.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||((l=this._frameTaskHandle)==null||l.pause())}}destroy(){this.stop()}start(){if(this._frameTaskHandle)return;const t=this.view;this.stationary=t.stationary,this._updateParameters={state:t.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:t.renderingOptions},this._stationaryHandle=qt(()=>t.stationary,i=>{this.stationary=i,this.requestFrame()}),this._frameTaskHandle=lf(this),this.requestUpdate()}stop(){var t;this._frameTaskHandle&&(this._updateRequested=!1,(t=this._stationaryHandle)==null||t.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(t){var s;if(!t.attached)return void this.requestUpdate();const i=this.view.state,r=t.lastUpdateId;r!=null&&(this.stationary||t.moving)||(t.moving=!0,t.moveStart()),r!==i.id&&t.viewChange(),this.stationary&&t.moving&&(t.moving=!1,t.moveEnd()),t.lastUpdateId=i.id,t.updateRequested&&t.processUpdate(this._updateParameters),"layerViews"in t&&((s=t.layerViews)==null||s.forEach(this._updateLayerView,this))}},qv=class extends Pt{constructor(t){super(t),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(t,i){if(!t)return void pt.getLogger(this).error("#goTo()","target cannot be null or undefined");const r=new YT;this.view.animation=r,await Mb(()=>this.view.ready,i);const s={animate:!0,...i},{extent:a,spatialReference:u,size:l,viewpoint:y,constraints:w,padding:I,allLayerViews:E}=this.view,A=RQ(t,{extent:a,spatialReference:u,size:l,viewpoint:y,constraints:w,padding:I,allLayerViews:E,pickClosestTarget:(i==null?void 0:i.pickClosestTarget)??!0});return r==null||r.update(A),this._gotoTask={},s.animate?this._gotoAnimated(A,s):this._gotoImmediate(A,s)}_gotoImmediate(t,i){const r=this._gotoTask,s=this.view.animation,a=t.then(u=>{if(mr(i),r!==this._gotoTask)throw new gt("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=s.target=u,s.finish()});return this._cancellableGoTo(r,s,a,i)}_gotoAnimated(t,i){const r=this._gotoTask,s=this.view.animation;if(!s)return Promise.resolve();const a=t.then(u=>{if(mr(i),r!==this._gotoTask)throw new gt("view:goto-interrupted","Goto was interrupted");return s.update(u),this.view.animationManager.animate(s,this.view.viewpoint,i),s.when().then(()=>{},()=>{})});return this._cancellableGoTo(r,s,a,i)}_cancellableGoTo(t,i,r,s){const a=()=>t===this._gotoTask;return B8(r,s).finally(()=>{a()&&(i.done||i.stop())})}};v([M({constructOnly:!0})],qv.prototype,"view",void 0),qv=v([me("esri.views.2d.GoToManager")],qv);function ji(){return Promise.all([it(()=>import("./webglDeps-BvTYyNSJ.js"),__vite__mapDeps([195,95,94,64,196,197])),it(()=>import("./mapViewDeps-Bg8apit_.js"),__vite__mapDeps([198,121,27,28,96,97,93,89,98,99,38,100,101,92,64,94,95,65,102,54,103,59,104,105,153,25,199,200,201,145,202,197,138,137,40,41,136,195,196,203,109,204,91,50,48,47,44,35,90,205,206,207,208,209,210,79,211,212,13,213,214,215,216,217,218,112,219]))])}const ny=()=>ji().then(()=>it(()=>import("./TileLayerView2D-CkxHllMB.js"),__vite__mapDeps([220,121,27,28,99,96,97,93,89,98,38,100,101,92,64,94,95,65,102,54,103,59,104,105,153,25,200,201,145,202,197,138,137,40,41,136,203,109,204,91,50,48,47,44,35,90,79,212,13,206,207,213,214,112,221,222,218,223,224,225,216,217,226,227,228,229,230]))),yp=()=>ji().then(()=>it(()=>import("./FeatureLayerView2D-DJqbqzGZ.js").then(e=>e.F),__vite__mapDeps([231,90,201,145,104,89,64,94,167,163,155,223,224,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,106,13,148,177,185,174,150,26,199,200,212,232,11,12,228,230,226]))),XP={"base-dynamic":()=>ji().then(()=>it(()=>import("./BaseDynamicLayerView2D-DWZdnn8v.js"),__vite__mapDeps([233,234,202,89,92,64,93,94,95,65,197,201,145,104,138,137,98,40,38,41,223,224,235,222,226]))),"base-tile":ny,"bing-maps":ny,catalog:()=>ji().then(()=>it(()=>import("./CatalogLayerView2D-Ct60OCT9.js"),__vite__mapDeps([236,223,224,201,145,104,89,64,94]))),"catalog-dynamic-group":()=>ji().then(()=>it(()=>import("./CatalogDynamicGroupLayerView2D-BqNV9dWw.js"),__vite__mapDeps([237,223,224,201,145,104,89,64,94]))),"catalog-footprint":()=>ji().then(()=>it(()=>import("./CatalogFootprintLayerView2D-CVyvWNU2.js"),__vite__mapDeps([238,231,90,201,145,104,89,64,94,167,163,155,223,224,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,106,13,148,177,185,174,150,26,199,200,212,232,11,12,228,230,226]))),csv:yp,"geo-rss":()=>ji().then(()=>it(()=>import("./GeoRSSLayerView2D-DpE0RRpT.js"),__vite__mapDeps([239,146,147,114,90,123,148,149,13,150,151,8,152,50,48,153,121,27,28,100,25,26,155,223,224,201,145,104,89,64,94,215,216,217,96,97,93,98,99,38,101,92,95,65,102,54,103,59,105,218,202,197,138,137,40,41,212,112,213,91,47,44,35,214]))),feature:yp,geojson:yp,graphics:()=>ji().then(()=>it(()=>import("./GraphicsLayerView2D-tJKPycaH.js"),__vite__mapDeps([240,104,223,224,201,145,89,64,94,215,216,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,212,13,112,213,50,48,153,121,25,91,47,44,35,90,214,232]))),group:()=>ji().then(()=>it(()=>import("./GroupLayerView2D-CoPxDvnt.js"),__vite__mapDeps([241,223,224,201,145,104,89,64,94]))),imagery:()=>ji().then(()=>it(()=>import("./ImageryLayerView2D-D58dE6aL.js"),__vite__mapDeps([242,243,95,94,64,197,65,119,202,89,92,93,201,145,104,138,137,98,40,38,41,223,224,213,50,48,96,97,99,100,101,102,54,103,59,27,28,105,153,121,25,91,47,44,35,90,212,13,214,225,216,217,218,112,234,222,235,124,11,12,230,226]))),"imagery-tile":()=>ji().then(()=>it(()=>import("./ImageryTileLayerView2D-BTIjYmD2.js"),__vite__mapDeps([244,245,243,95,94,64,197,65,119,202,89,92,93,201,145,104,138,137,98,40,38,41,223,224,246,218,247,124,11,12,13,230,226]))),kml:()=>ji().then(()=>it(()=>import("./KMLLayerView2D-qJrR4BIp.js"),__vite__mapDeps([248,249,146,147,114,90,123,148,149,13,150,151,8,152,50,48,153,121,27,28,100,25,26,155,222,201,145,104,89,64,94,234,202,92,93,95,65,197,138,137,98,40,38,41,223,224,215,216,217,96,97,99,101,102,54,103,59,105,218,212,112,213,91,47,44,35,214,124,205,195,196,206,207,204,200,208,246]))),"knowledge-graph":()=>ji().then(()=>it(()=>import("./KnowledgeGraphLayerView2D-CXUJYMGN.js"),__vite__mapDeps([250,223,224,201,145,104,89,64,94]))),"link-chart":()=>ji().then(()=>it(()=>import("./KnowledgeGraphLayerView2D-CXUJYMGN.js"),__vite__mapDeps([250,223,224,201,145,104,89,64,94]))),"knowledge-graph-sublayer":yp,"map-image":()=>ji().then(()=>it(()=>import("./MapImageLayerView2D-BpMKB7WC.js"),__vite__mapDeps([251,234,202,89,92,64,93,94,95,65,197,201,145,104,138,137,98,40,38,41,223,224,213,50,48,96,97,99,100,101,102,54,103,59,27,28,105,153,121,25,91,47,44,35,90,212,13,214,225,216,217,218,112,235,222,11,12,252,228,229,226,227,230]))),"map-notes":()=>ji().then(()=>it(()=>import("./MapNotesLayerView2D-BXdeElIo.js"),__vite__mapDeps([253,104,223,224,201,145,89,64,94,215,216,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,212,13,112,213,50,48,153,121,25,91,47,44,35,90,214]))),media:()=>ji().then(()=>it(()=>import("./MediaLayerView2D-B_io_3KN.js"),__vite__mapDeps([254,147,114,90,123,148,149,13,150,151,146,8,152,50,48,153,121,27,28,100,25,26,255,214,71,99,96,97,93,89,98,38,101,92,64,94,95,65,102,54,103,59,104,105,200,201,145,202,197,138,137,40,41,136,203,109,204,91,47,44,35,79,212,206,207,213,112,211,223,224]))),"ogc-feature":()=>ji().then(()=>it(()=>import("./OGCFeatureLayerView2D-BSeTOH8E.js"),__vite__mapDeps([256,231,90,201,145,104,89,64,94,167,163,155,223,224,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,106,13,148,177,185,174,150,26,199,200,212,232,11,12,228,230,226]))),"open-street-map":ny,"oriented-imagery":yp,route:()=>ji().then(()=>it(()=>import("./RouteLayerView2D-b7L9TV5e.js"),__vite__mapDeps([257,258,104,223,224,201,145,89,64,94,215,216,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,212,13,112,213,50,48,153,121,25,91,47,44,35,90,214]))),stream:()=>ji().then(()=>it(()=>import("./StreamLayerView2D-27n69ySr.js"),__vite__mapDeps([259,155,231,90,201,145,104,89,64,94,167,163,223,224,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,106,13,148,177,185,174,150,26,199,200,212,232,11,12,228,230,226]))),"subtype-group":()=>ji().then(()=>it(()=>import("./SubtypeGroupLayerView2D-B2FEnv5T.js"),__vite__mapDeps([260,231,90,201,145,104,89,64,94,167,163,155,223,224,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,106,13,148,177,185,174,150,26,199,200,212,232,11,12,228,230,226]))),tile:ny,"vector-tile":()=>ji().then(()=>it(()=>import("./VectorTileLayerView2D-Oo0yumRg.js"),__vite__mapDeps([261,90,136,101,64,94,79,210,200,105,8,99,95,197,137,202,89,92,93,65,201,145,104,138,98,40,38,41,218,43,139,140,121,27,28,223,224]))),video:()=>ji().then(()=>it(()=>import("./VideoLayerView2D-Cij3Ubuw.js"),__vite__mapDeps([262,263,162,163,145,179,12,13,223,224,201,104,89,64,94,215,216,217,96,97,93,98,99,38,100,101,92,95,65,102,54,103,59,27,28,105,218,202,197,138,137,40,41,212,112,213,50,48,153,121,25,91,47,44,35,90,214]))),wcs:()=>ji().then(()=>it(()=>import("./ImageryTileLayerView2D-BTIjYmD2.js"),__vite__mapDeps([244,245,243,95,94,64,197,65,119,202,89,92,93,201,145,104,138,137,98,40,38,41,223,224,246,218,247,124,11,12,13,230,226]))),"web-tile":ny,wfs:yp,wms:()=>ji().then(()=>it(()=>import("./WMSLayerView2D-4tFZbKVL.js"),__vite__mapDeps([264,234,202,89,92,64,93,94,95,65,197,201,145,104,138,137,98,40,38,41,223,224,235,222,226,11,12,13,265]))),wmts:()=>ji().then(()=>it(()=>import("./WMTSLayerView2D-e2cTOOUj.js"),__vite__mapDeps([266,221,222,201,145,104,89,64,94,202,92,93,95,65,197,138,137,98,40,38,41,218,223,224,226]))),"line-of-sight":null,"base-elevation":null,"building-scene":null,dimension:null,elevation:null,"integrated-mesh":null,"integrated-mesh-3dtiles":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};function tee(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new gt(`${i}:view-not-supported`,`${t} is not supported in 2D`)}const QP={hasLayerViewModule:e=>XP[e.type]!=null,importLayerView:e=>{const t=XP[e.type];if(t==null)throw tee(e);return t(e)}};function iee(e,t){const{spatialReference:i}=t,r=[t.x,t.y];let s=Number.POSITIVE_INFINITY,a=0,u=0;const l=[0,0],y=e.type==="extent"?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:e.rings;for(const w of y)for(let I=0;I<w.length-1;I++){iG(l,r,w,I);const E=Hb(r,l);E<s&&(s=E,a=l[0],u=l[1])}return{coordinate:new Ht({x:a,y:u,spatialReference:i}),distance:s}}var eM;let Bh=eM=class extends uI(Pt){constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){if(this.geometry==null||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return Td(this.geometry,this.spatialReference)}catch(e){return pt.getLogger(this).error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:e}),null}return this.geometry}constrain(e,t){if(this.normalizedGeometry==null)return e;const i=e.targetGeometry;if(this.normalizedGeometry.type==="extent"?_b(this.normalizedGeometry,i):nL(this.normalizedGeometry,i))return e;const{coordinate:r}=iee(this.normalizedGeometry,i);return r&&(e.targetGeometry=r),e}clone(){var e,t;return new eM({geometry:(e=this.geometry)==null?void 0:e.clone(),spatialReference:(t=this.spatialReference)==null?void 0:t.clone()})}};v([M({constructOnly:!0})],Bh.prototype,"geometry",void 0),v([M({readOnly:!0})],Bh.prototype,"normalizedGeometry",null),v([M({constructOnly:!0})],Bh.prototype,"spatialReference",void 0),Bh=eM=v([me("esri.views.2d.constraints.GeometryConstraint")],Bh);var tM;let Vy=tM=class extends uI(Pt){constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t&&(this.rotationEnabled||(e.rotation=t.rotation)),e}clone(){return new tM({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};v([M()],Vy.prototype,"enabled",void 0),v([M()],Vy.prototype,"rotationEnabled",void 0),Vy=tM=v([me("esri.views.2d.constraints.RotationConstraint")],Vy);const az=Vy;var iM;let _n=iM=class extends uI(Pt){constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:r,minZoom:s,maxZoom:a}=this,u=-1,l=-1,y=!1,w=!1;if(i!==0&&r!==0&&i<r&&([i,r]=[r,i]),!(t!=null&&t.length))return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);t=t.map(I=>I.clone()),t.sort((I,E)=>E.scale-I.scale),t.forEach((I,E)=>I.level=E);for(const I of t)!y&&i>0&&i>=I.scale&&(u=I.level,y=!0),!w&&r>0&&r>=I.scale&&(l=e?e.level:-1,w=!0),e=I;s===-1&&(s=i===0?0:u),a===-1&&(a=r===0?t.length-1:l),s=Math.max(s,0),s=Math.min(s,t.length-1),a=Math.max(a,0),a=Math.min(a,t.length-1),s>a&&([s,a]=[a,s]),i=t[s].scale,r=t[a].scale,t.splice(0,s),t.splice(a-s+1,t.length),t.forEach((I,E)=>{this._lodByScale[I.scale]=I,this._scales[E]=I.scale}),this._set("effectiveLODs",t),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",a),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(e,t){if(t&&e.scale===t.scale)return e;const i=this.effectiveMinScale,r=this.effectiveMaxScale,s=e.targetGeometry,a=t&&t.targetGeometry,u=r!==0&&e.scale<r,l=i!==0&&e.scale>i;if(u||l){const y=l?i:r;if(t&&a){const w=(y-t.scale)/(e.scale-t.scale);s.x=a.x+(s.x-a.x)*w,s.y=a.y+(s.y-a.y)*w}e.scale=y}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);const t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);const t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];const i=Math.round(e-.5),r=Math.round(e);return t[r]+(r-e)*(t[i]-t[r])}scaleToZoom(e){if(!this.effectiveLODs)return-1;const t=this._scales;let i,r;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let s=0;s<t.length-1;s++){if(i=t[s],r=t[s+1],r===e)return s+this.effectiveMinZoom+1;if(i>e&&r<e)return s+this.effectiveMinZoom+1-(e-r)/(i-r)}return-1}snapToClosestScale(e){if(!this.effectiveLODs)return e;const t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new iM({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t,this._scales[0])),this._lodByScale[e].scale}};v([M({readOnly:!0})],_n.prototype,"effectiveLODs",void 0),v([M({readOnly:!0})],_n.prototype,"effectiveMinZoom",void 0),v([M({readOnly:!0})],_n.prototype,"effectiveMaxZoom",void 0),v([M({readOnly:!0})],_n.prototype,"effectiveMinScale",void 0),v([M({readOnly:!0})],_n.prototype,"effectiveMaxScale",void 0),v([M()],_n.prototype,"lods",void 0),v([M()],_n.prototype,"minZoom",void 0),v([M()],_n.prototype,"maxZoom",void 0),v([M()],_n.prototype,"minScale",void 0),v([M()],_n.prototype,"maxScale",void 0),v([M()],_n.prototype,"snapToZoom",void 0),_n=iM=v([me("esri.views.2d.constraints.ZoomConstraint")],_n);const lz=_n,ree={base:null,key:"type",typeMap:{extent:tr,polygon:vu}};let dr=class extends Pt{constructor(t){super(t),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0,this.customConstraints=new At}destroy(){this.view=null}get effectiveLODs(){return this._zoom.effectiveLODs}get effectiveMinScale(){return this._zoom.effectiveMinScale}get effectiveMaxScale(){return this._zoom.effectiveMaxScale}get effectiveMinZoom(){return this._zoom.effectiveMinZoom}get effectiveMaxZoom(){return this._zoom.effectiveMaxZoom}set geometry(t){t?this._set("geometry",t):this._set("geometry",null)}get version(){var t,i,r;return`${(t=this._zoom)==null?void 0:t.uid}/${(i=this._rotation)==null?void 0:i.uid}/${(r=this._geometry)==null?void 0:r.uid}`}get _geometry(){var i,r;const t=this._get("_geometry");return t&&this.geometry===t.geometry&&((i=this.view)==null?void 0:i.constraintsInfo.spatialReference)===t.spatialReference?t:new Bh({geometry:this.geometry,spatialReference:(r=this.view)==null?void 0:r.constraintsInfo.spatialReference})}get _rotation(){return new az({rotationEnabled:this.rotationEnabled})}get _zoom(){var y;const t=this._get("_zoom"),i=this.lods||((y=this.view)==null?void 0:y.constraintsInfo.lods),r=this.minZoom,s=this.maxZoom,a=this.minScale,u=this.maxScale,l=this.snapToZoom;return t&&t.lods===i&&t.minZoom===r&&t.maxZoom===s&&t.minScale===a&&t.maxScale===u&&t.snapToZoom===l?t:new lz({lods:i,minZoom:r,maxZoom:s,minScale:a,maxScale:u,snapToZoom:l})}canZoomInTo(t){const i=this.effectiveMaxScale;return i===0||t>=i}canZoomOutTo(t){const i=this.effectiveMinScale;return i===0||t<=i}constrain(t,i){return this._zoom.constrain(t,i),this._rotation.constrain(t,i),this._geometry.constrain(t,i),this.customConstraints.forEach(r=>r.constrain(t,i)),t}constrainByGeometry(t){return this._geometry.constrain(t),this.customConstraints.forEach(i=>{var r;return(r=i.applyPanConstraint)==null?void 0:r.call(i,t)}),t}fit(t){return this._zoom.fit(t)}zoomToScale(t){return this._zoom.zoomToScale(t)}scaleToZoom(t){return this._zoom.scaleToZoom(t)}snapScale(t){return this._zoom.snapToClosestScale(t)}snapToNextScale(t){return this._zoom.snapToNextScale(t)}snapToPreviousScale(t){return this._zoom.snapToPreviousScale(t)}};v([M({readOnly:!0})],dr.prototype,"effectiveLODs",null),v([M({readOnly:!0})],dr.prototype,"effectiveMinScale",null),v([M({readOnly:!0})],dr.prototype,"effectiveMaxScale",null),v([M({readOnly:!0})],dr.prototype,"effectiveMinZoom",null),v([M({readOnly:!0})],dr.prototype,"effectiveMaxZoom",null),v([M({types:ree,value:null})],dr.prototype,"geometry",null),v([M({type:[ru]})],dr.prototype,"lods",void 0),v([M()],dr.prototype,"minScale",void 0),v([M()],dr.prototype,"maxScale",void 0),v([M()],dr.prototype,"minZoom",void 0),v([M()],dr.prototype,"maxZoom",void 0),v([M()],dr.prototype,"rotationEnabled",void 0),v([M()],dr.prototype,"snapToZoom",void 0),v([M({type:At})],dr.prototype,"customConstraints",void 0),v([M()],dr.prototype,"view",void 0),v([M({readOnly:!0})],dr.prototype,"version",null),v([M({type:Bh,readOnly:!0})],dr.prototype,"_geometry",null),v([M({type:az})],dr.prototype,"_rotation",null),v([M({readOnly:!0,type:lz})],dr.prototype,"_zoom",null),dr=v([me("esri.views.2d.MapViewConstraints")],dr);const cz=dr;let Su=class Ch{static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}constructor(t,i,r,s){this.set(t,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return i>=0&&this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}containsChild(t){const i=t.level-this.level;return i>0&&this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new Ch(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[a,u,l,y]=t.split("/");this.level=parseFloat(a),this.row=parseFloat(u),this.col=parseFloat(l),this.world=parseFloat(y)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Ch(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(t,i){return`${this.level}/${this.row+i}/${this.col+t}/${this.world}`}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new Ch(t,i,r,s),new Ch(t,i,r+1,s),new Ch(t,i+1,r,s),new Ch(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}};Su.pool=new bd(Su,null,null,25,50);function Ac(e,t){return[e,t]}function sh(e,t,i){return e[0]=t,e[1]=i,e}function see(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}const Lo=new Su("0/0/0/0");let nee=class uz{static create(t,i,r=null){const s=Mn(t.spatialReference),a=i.origin||Ac(t.origin.x,t.origin.y),u=Ac(t.size[0]*i.resolution,t.size[1]*i.resolution),l=Ac(-1/0,-1/0),y=Ac(1/0,1/0),w=Ac(1/0,1/0);r!=null&&(sh(l,Math.max(0,Math.floor((r.xmin-a[0])/u[0])),Math.max(0,Math.floor((a[1]-r.ymax)/u[1]))),sh(y,Math.max(0,Math.floor((r.xmax-a[0])/u[0])),Math.max(0,Math.floor((a[1]-r.ymin)/u[1]))),sh(w,y[0]-l[0]+1,y[1]-l[1]+1));const{cols:I,rows:E}=i;let A,R,G,K;return!r&&I&&E&&(sh(l,I[0],E[0]),sh(y,I[1],E[1]),sh(w,I[1]-I[0]+1,E[1]-E[0]+1)),t.isWrappable?(A=Ac(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/t.size[0]),w[1]),R=Ac(Math.floor((s.origin[0]-a[0])/u[0]),l[1]),G=Ac(A[0]+R[0]-1,y[1]),K=!0):(R=l,G=y,A=w,K=!1),new uz(i.level,i.resolution,i.scale,a,l,y,w,u,R,G,A,K)}constructor(t,i,r,s,a,u,l,y,w,I,E,A){this.level=t,this.resolution=i,this.scale=r,this.origin=s,this.first=a,this.last=u,this.size=l,this.norm=y,this.worldStart=w,this.worldEnd=I,this.worldSize=E,this.wrap=A}normalizeCol(t){if(!this.wrap)return t;const i=this.worldSize[0];return t<0?i-1-Math.abs((t+1)%i):t%i}denormalizeCol(t,i){return this.wrap?this.worldSize[0]*i+t:t}getWorldForColumn(t){return this.wrap?Math.floor(t/this.worldSize[0]):0}getFirstColumnForWorld(t){return t*this.worldSize[0]+this.first[0]}getLastColumnForWorld(t){return t*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(t){return(t-this.origin[0])/this.norm[0]}getXForColumn(t){return this.origin[0]+t*this.norm[0]}getRowForY(t){return(this.origin[1]-t)/this.norm[1]}getYForRow(t){return this.origin[1]-t*this.norm[1]}getTileBounds(t,i,r=!1){Lo.set(i);const s=r?Lo.col:this.denormalizeCol(Lo.col,Lo.world),a=Lo.row;return see(t,this.getXForColumn(s),this.getYForRow(a+1),this.getXForColumn(s+1),this.getYForRow(a)),t}getTileCoords(t,i,r=!1){Lo.set(i);const s=r?Lo.col:this.denormalizeCol(Lo.col,Lo.world);return Array.isArray(t)?sh(t,this.getXForColumn(s),this.getYForRow(Lo.row)):(t.x=this.getXForColumn(s),t.y=this.getYForRow(Lo.row)),t}},Dg=class{constructor(){this.spans=[]}acquire(t){this.lodInfo=t}release(){this.lodInfo=null,this.spans.length=0}*keys(){const t=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let a=r;a<=s;a++){const u=t.getWorldForColumn(a);yield new Su(t.level,i,t.normalizeCol(a),u)}}forEach(t,i){const{spans:r,lodInfo:s}=this,{level:a}=s;if(r.length!==0)for(const{row:u,colFrom:l,colTo:y}of r)for(let w=l;w<=y;w++)t.call(i,a,u,s.normalizeCol(w),s.getWorldForColumn(w))}};Dg.pool=new bd(Dg);let Yx=class{constructor(t,i,r){this.row=t,this.colFrom=i,this.colTo=r}};const qi=new Su("0/0/0/0");let oee=class hz{static create(t,i){t[1]>i[1]&&([t,i]=[i,t]);const[r,s]=t,[a,u]=i,l=a-r,y=u-s,w=y!==0?l/y:0,I=(Math.ceil(s)-s)*w,E=(Math.floor(s)-s)*w;return new hz(r,Math.floor(s),Math.ceil(u),w,l<0?I:E,l<0?E:I,l<0?a:r,l<0?r:a)}constructor(t,i,r,s,a,u,l,y){this.x=t,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=a,this.rightAdjust=u,this.leftBound=l,this.rightBound=y}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const zn=[[0,0],[0,0],[0,0],[0,0]],aee=1e-6;let lee=class{constructor(t,i=null,r=t.lods[0].level,s=t.lods[t.lods.length-1].level){this.tileInfo=t,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const a=t.lods.filter(l=>l.level>=r&&l.level<=s);this.minScale=a[0].scale,this.maxScale=a[a.length-1].scale;const u=this._lodInfos=a.map(l=>nee.create(t,l,i));a.forEach((l,y)=>{this._infoByLevel[l.level]=u[y],this._infoByScale[l.scale]=u[y],this.scales[y]=l.scale},this),this._wrap=t.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(t){return this._infoByLevel[typeof t=="number"?t:t.level]}getTileBounds(t,i,r=!1){qi.set(i);const s=this._infoByLevel[qi.level];return s?s.getTileBounds(t,qi,r):t}getTileCoords(t,i,r=!1){qi.set(i);const s=this._infoByLevel[qi.level];return s?s.getTileCoords(t,qi,r):t}getTileCoverage(t,i=192,r=!0,s="closest"){if(!r&&(t.scale>this.minScale||t.scale<this.maxScale))return null;const a=s==="closest"?this.getClosestInfoForScale(t.scale):this.getSmallestInfoForScale(t.scale),u=Dg.pool.acquire(a),l=this._wrap;let y,w,I,E=1/0,A=-1/0;const R=u.spans;zn[0][0]=zn[0][1]=zn[1][1]=zn[3][0]=-i,zn[1][0]=zn[2][0]=t.size[0]+i,zn[2][1]=zn[3][1]=t.size[1]+i;for(const ae of zn)t.toMap(ae,ae),ae[0]=a.getColumnForX(ae[0]),ae[1]=a.getRowForY(ae[1]);const G=[];let K=3;for(let ae=0;ae<4;ae++){if(zn[ae][1]===zn[K][1]){K=ae;continue}const Te=oee.create(zn[ae],zn[K]);E=Math.min(Te.ymin,E),A=Math.max(Te.ymax,A),G[Te.ymin]===void 0&&(G[Te.ymin]=[]),G[Te.ymin].push(Te),K=ae}if(E==null||A==null||A-E>100)return null;let Y=[];for(y=E;y<A;){G[y]!=null&&(Y=Y.concat(G[y])),w=1/0,I=-1/0;for(let ae=Y.length-1;ae>=0;ae--){const Te=Y[ae];w=Math.min(w,Te.getLeftCol()),I=Math.max(I,Te.getRightCol())}if(w=Math.floor(w),I=Math.floor(I),y>=a.first[1]&&y<=a.last[1])if(l)if(a.size[0]<a.worldSize[0]){const ae=Math.floor(I/a.worldSize[0]);for(let Te=Math.floor(w/a.worldSize[0]);Te<=ae;Te++)R.push(new Yx(y,Math.max(a.getFirstColumnForWorld(Te),w),Math.min(a.getLastColumnForWorld(Te),I)))}else R.push(new Yx(y,w,I));else w>a.last[0]||I<a.first[0]||(w=Math.max(w,a.first[0]),I=Math.min(I,a.last[0]),R.push(new Yx(y,w,I)));y+=1;for(let ae=Y.length-1;ae>=0;ae--){const Te=Y[ae];Te.ymax>=y?Te.incrRow():Y.splice(ae,1)}}return u}getTileParentId(t){qi.set(t);const i=this._infoByLevel[qi.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(qi,this._lodInfos[r],qi),qi.id)}getTileResolution(t){const i=this._infoByLevel[typeof t=="object"?t.level:t];return i?i.resolution:-1}getTileScale(t){const i=this._infoByLevel[t.level];return i?i.scale:-1}intersects(t,i){qi.set(i);const r=this._infoByLevel[qi.level],s=t.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(qi,s,qi);const u=s.denormalizeCol(qi.col,qi.world);for(const l of t.spans)if(l.row===qi.row&&l.colFrom<=u&&l.colTo>=u)return!0}if(s.resolution<r.resolution){const[u,l,y,w]=t.spans.reduce((K,Y)=>(K[0]=Math.min(K[0],Y.row),K[1]=Math.max(K[1],Y.row),K[2]=Math.min(K[2],Y.colFrom),K[3]=Math.max(K[3],Y.colTo),K),[1/0,-1/0,1/0,-1/0]),I=r.denormalizeCol(qi.col,qi.world),E=s.getColumnForX(r.getXForColumn(I)),A=s.getRowForY(r.getYForRow(qi.row)),R=s.getColumnForX(r.getXForColumn(I+1))-1,G=s.getRowForY(r.getYForRow(qi.row+1))-1;return!(E>w||R<y||A>l||G<u)}const a=s.denormalizeCol(qi.col,qi.world);return t.spans.some(u=>u.row===qi.row&&u.colFrom<=a&&u.colTo>=a)}normalizeBounds(t,i,r){if(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],this._wrap){const s=Mn(this.tileInfo.spatialReference),a=-r*(s.valid[1]-s.valid[0]);t[0]+=a,t[2]+=a}return t}getSmallestInfoForScale(t){const i=this.scales;if(this._infoByScale[t])return this._infoByScale[t];if(t>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(t>i[r]+aee)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(t){const i=this.scales;return this._infoByScale[t]||(t=i.reduce((r,s)=>Math.abs(s-t)<Math.abs(r-t)?s:r,i[0])),this._infoByScale[t]}scaleToLevel(t){const i=this.scales;if(this._infoByScale[t])return this._infoByScale[t].level;for(let r=i.length-1;r>=0;r--)if(t<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-t)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(t){return this.tileInfo.scaleToZoom(t)}_getTileIdAtLOD(t,i,r){const s=this._infoByLevel[r.level];return t.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(t.level=i.level,t.col=Math.floor(r.col*s.resolution/i.resolution+.01),t.row=Math.floor(r.row*s.resolution/i.resolution+.01)),t)}},cee=class{constructor(t,i){this.item=t,this.controller=i,this.promise=null}},uee=class{constructor(t){this._schedule=null,this._task=null,this._deferreds=new jv,this._controllers=new jv,this._processingItems=new jv,this._pausedSignal=pR(!1),this.concurrency=1,t.concurrency&&(this.concurrency=t.concurrency),this._queue=new k1(t.peeker),this.process=t.process;const i=t.scheduler;t.priority&&i&&(this._task=i.registerTask(t.priority,this))}destroy(){this.clear(),this._schedule=er(this._schedule),this._task=er(this._task)}get updating(){var t;return!!((t=this._task)!=null&&t.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(t){const i=this._controllers.get(t);i&&i.abort()}clear(){this._queue.clear();const t=[];this._controllers.forEach(i=>t.push(i)),this._controllers.clear(),t.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(t){this._deferreds.forEach((i,r)=>t(r))}get(t){const i=this._deferreds.get(t);return i?i.promise:void 0}isOngoing(t){return this._processingItems.has(t)}has(t){return this._deferreds.has(t)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(t,i){const r=this.get(t);if(r)return r;const s=new AbortController;let a=null;i&&(a=vo(i,()=>s.abort()));const u=()=>{const I=this._processingItems.get(t);I&&I.controller.abort(),l(),w.reject(Er())},l=()=>{y.remove(),a!=null&&a.remove(),this._removeItem(t),this._queue.remove(t),this._scheduleNext()},y=wM(s.signal,u),w=wo();return this._deferreds.set(t,w),this._controllers.set(t,s),w.promise.then(l,l),this._queue.push(t),this._scheduleNext(),w.promise}last(){return this._queue.last()}lastPromise(){const t=this.last();return t?this.get(t):null}peek(){return this._queue.peek()}popLast(){var i;const t=this._queue.popLast();return t&&((i=this._deferreds.get(t))==null||i.reject(Er("Removed from queue")),this._removeItem(t)),t}reset(){const t=[];this._processingItems.forEach(i=>t.push(i)),this._processingItems.clear();for(const i of t)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const t=[];for(;this._queue.length;)t.push(this._queue.pop());return this.clear(),t}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(t){for(;!t.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),t.madeProgress()}_removeItem(t){this._deferreds.delete(t),this._controllers.delete(t),this._processingItems.delete(t)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=Ug(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(t,i){this._canProcessFulfillment(t)&&(this._scheduleNext(),this._deferreds.get(t.item).resolve(i))}_processError(t,i){this._canProcessFulfillment(t)&&(this._scheduleNext(),this._deferreds.get(t.item).reject(i))}_canProcessFulfillment(t){return!!this._deferreds.get(t.item)&&this._processingItems.get(t.item)===t}_process(t){if(t==null)return;let i;const r=new AbortController,s=new cee(t,r);this._processingItems.set(t,s);try{i=this.process(t,r.signal)}catch(a){this._processError(s,a)}Tu(i)?(s.promise=i,i.then(a=>this._processResult(s,a),a=>this._processError(s,a))):this._processResult(s,i)}get test(){return{update:t=>this.runTask(t)}}};function hee(e,t){return e.length=0,t.forEach(i=>e.push(i)),e}const Xx=new Set,J_=[],gp=new Map,eC=[0,0];let Jc=class extends Pt{constructor(t){super(t),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:t,process:i,strategy:r}=this;this._queue=new uee({concurrency:t,process:(s,a)=>{const u=this._keyToItem.get(s);return i(u,{signal:a})},peeker:r==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=Xi(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(t){const i=typeof t=="string"?t:t.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(t){return typeof t=="string"?this._keyToItem.has(t):this._keyToItem.has(t.id)}isOngoing(t){const i=typeof t=="string"?t:t.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(t){const i=t.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,t),r.then(s,s),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(t){if(!this.state)return t.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;t.forEach(I=>{const E=this._keyToItem.get(I),A=this.tileInfoView.getTileScale(E.key);gp.has(A)||(gp.set(A,[]),r=Math.max(A,r),s=Math.min(A,s)),gp.get(A).push(E.key),Xx.add(A)});let a=this.state.scale;gp.has(a)||(hee(J_,Xx),J_.sort((I,E)=>I-E),a=J_.reduce((I,E)=>Math.abs(E-a)<Math.abs(I-a)?E:I,J_[0])),a=Math.min(a,r),a=Math.max(a,s);const u=gp.get(a),l=i.getClosestInfoForScale(a),y=l.getColumnForX(this.state.center[0]),w=l.getRowForY(this.state.center[1]);return u.sort((I,E)=>{const A=l.denormalizeCol(I.col,I.world),R=l.denormalizeCol(E.col,E.world);return Math.sqrt((y-A)*(y-A)+(w-I.row)*(w-I.row))-Math.sqrt((y-R)*(y-R)+(w-E.row)*(w-E.row))}),Xx.clear(),gp.clear(),u[0].id}_peekByCenterFirst(t){if(!this.state)return t.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,a=Number.POSITIVE_INFINITY;return t.forEach(u=>{const l=this._keyToItem.get(u);i.getTileCoords(eC,l.key);const y=Hb(eC,r);y<a&&(a=y,s=l.key)}),s.id}};v([M({constructOnly:!0})],Jc.prototype,"concurrency",void 0),v([M({constructOnly:!0})],Jc.prototype,"process",void 0),v([M()],Jc.prototype,"state",void 0),v([M({constructOnly:!0})],Jc.prototype,"strategy",void 0),v([M({constructOnly:!0})],Jc.prototype,"tileInfoView",void 0),Jc=v([me("esri.views.2d.tiling.TileQueue")],Jc);const xue=Jc;let dee=class{constructor(t,i,r){this.maxSize=t,this._tileInfoView=i,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear(),this._tileKeysPerLevel=[]}has(t){return this._tilePerId.has(t)}get(t){return this._tilePerId.get(t)}pop(t){const i=this._tilePerId.get(t);if(!i)return;const r=i.key.level,s=this._tileKeysPerLevel[r];tC(this._tilePerId,t);for(let a=0;a<s.length;a++)if(s[a].id===t){s.splice(a,1);break}return i.visible=!0,i}add(t){t.visible=!1;const i=t.key,r=i.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,t);const s=i.level;this._tileKeysPerLevel[s]||(this._tileKeysPerLevel[s]=[]),this._tileKeysPerLevel[s].push(i)}prune(t,i,r){let s=this._tilePerId.size;if(s<=this.maxSize)return;let a=this._tileKeysPerLevel.length-1;for(;s>this.maxSize&&a>=0;)a!==t&&(s=this._pruneAroundCenterTile(s,i,r,a)),a--;s>this.maxSize&&(s=this._pruneAroundCenterTile(s,i,r,t))}_pruneAroundCenterTile(t,i,r,s){const a=this._tileKeysPerLevel[s];if(!a||a.length===0)return t;const{size:u,origin:l}=this._tileInfoView.tileInfo,y=r*u[0],w=r*u[1],I=[0,0],E=[0,0];for(a.sort((A,R)=>(I[0]=l.x+y*(A.col+.5),I[1]=l.y-w*(A.row+.5),E[0]=l.x+y*(R.col+.5),E[1]=l.y-w*(R.row+.5),H1(I,i)-H1(E,i)));a.length>0;){const A=a.pop();if(this._removeTile(A.id),--t===this.maxSize)break}return t}_removeTile(t){const i=this._tilePerId.get(t);this._removedFunc&&i&&this._removedFunc(i),tC(this._tilePerId,t)}};function tC(e,t){e.delete(t)}const nh=new Su(0,0,0,0),bl=new Map,oh=[],Qx=[];let Tue=class{constructor(t){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,t.resampling!=null&&(this.resampling=t.resampling),t.cachePolicy&&(this.cachePolicy=t.cachePolicy),t.coveragePolicy&&(this.coveragePolicy=t.coveragePolicy),t.buffer!=null&&(this.buffer=t.buffer),t.cacheSize&&(this._tileCache=new dee(t.cacheSize,this.tileInfoView,i=>{this.releaseTile(i)}))}destroy(){this.tileIndex.clear()}update(t){var ae,Te;const{resampling:i,tileIndex:r}=this,{scale:s,center:a,resolution:u}=t.state,{minScale:l,maxScale:y}=this.tileInfoView,w=!t.stationary&&s>this._previousScale;if(this._previousScale=s,!i&&(s>l||s<y))return this.tiles.length=0,void this.clear();const I=this.tileInfoView.getTileCoverage(t.state,this.buffer,this.resampling,this.coveragePolicy);if(!I)return this.tiles.length=0,void this.clear();const{spans:E,lodInfo:A}=I,{level:R}=A;this.tiles.length=0,r.forEach(_e=>_e.visible=!0);let G=0,K=0;if(E.length>0)for(const{row:_e,colFrom:be,colTo:ke}of E)for(let Ae=be;Ae<=ke;Ae++){G++;const Ve=nh.set(R,_e,A.normalizeCol(Ae),A.getWorldForColumn(Ae)).id;let Ze=r.get(Ve);if(Ze)Ze.isReady?(bl.set(Ve,Ze),K++):w||this._addParentTile(Ve,bl);else{if((ae=this._tileCache)!=null&&ae.has(Ve)){if(Ze=this._tileCache.pop(Ve),this.tileIndex.set(Ve,Ze),Ze.isReady){bl.set(Ve,Ze),K++;continue}}else Ze=this.acquireTile(nh),this.tileIndex.set(Ve,Ze);w||this._addParentTile(Ve,bl)}}const Y=K===G;for(const[_e,be]of r){if(bl.has(_e))continue;nh.set(_e);const ke=this.tileInfoView.intersects(I,nh),Ae=this.cachePolicy==="purge"?nh.level!==R:nh.level>R;!ke||!w&&Y?!Ae&&ke||oh.push(be):be.isReady?Ae&&this.cachePolicy==="purge"&&this._hasReadyAncestor(nh,R)?oh.push(be):Qx.push(be):Ae&&oh.push(be)}for(const _e of Qx)_e.isReady&&bl.set(_e.key.id,_e);for(const _e of oh)this._tileCache?this._tileCache.add(_e):this.releaseTile(_e),r.delete(_e.key.id);for(const _e of bl.values())this.tiles.push(_e);for(const _e of r.values())bl.has(_e.key.id)||(_e.visible=!1);(Te=this._tileCache)==null||Te.prune(R,a,u),Dg.pool.release(I),Qx.length=0,oh.length=0,bl.clear()}clear(){const{tileIndex:t}=this;for(const i of t.values())this.releaseTile(i);t.clear()}refresh(t){var i;for(const r of this.tileIndex.values())this.tiles.includes(r)?t(r):oh.push(r);for(const r of oh)this.releaseTile(r),this.tileIndex.delete(r.key.id);(i=this._tileCache)==null||i.clear()}updateCacheSize(t){this._tileCache&&(this._tileCache.maxSize=t)}_addParentTile(t,i){var a;let r=t,s=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(s=this.tileIndex.get(r),s==null?void 0:s.isReady){i.has(s.key.id)||i.set(s.key.id,s);break}}else if((a=this._tileCache)!=null&&a.has(r)&&(s=this._tileCache.pop(r),this.tileIndex.set(r,s),s==null?void 0:s.isReady)){i.has(s.key.id)||i.set(s.key.id,s);break}}_hasReadyAncestor(t,i){const r=Sn();this.tileInfoView.getTileBounds(r,t,!0);for(const s of this.tileIndex.values())if(s.isReady&&s.key.level>=i&&s.key.level<t.level){const a=Sn();if(this.tileInfoView.getTileBounds(a,s.key,!0),fG(a,r))return!0}return!1}};function dz(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function pee(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function fee(e,t,i,r,s,a){const u=new Float32Array(6);return u[0]=e,u[1]=t,u[2]=i,u[3]=r,u[4]=s,u[5]=a,u}function mee(e,t){return new Float32Array(e,t,6)}function pz(e,t,i,r){const s=t[r],a=t[r+1];e[r]=i[0]*s+i[2]*a+i[4],e[r+1]=i[1]*s+i[3]*a+i[5]}function yee(e,t,i,r=0,s=0,a=2){const u=s||t.length/a;for(let l=r;l<u;l++)pz(e,t,i,l*a)}Object.freeze(Object.defineProperty({__proto__:null,clone:pee,create:dz,createView:mee,fromValues:fee,transform:pz,transformMany:yee},Symbol.toStringTag,{value:"Module"}));function gee(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function _ee(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function fz(e,t,i,r,s,a,u,l,y,w){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=a,e[5]=u,e[6]=l,e[7]=y,e[8]=w,e}function mz(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function vee(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function bee(e,t){const i=t[0],r=t[1],s=t[2],a=t[3],u=t[4],l=t[5],y=t[6],w=t[7],I=t[8],E=I*u-l*w,A=-I*a+l*y,R=w*a-u*y;let G=i*E+r*A+s*R;return G?(G=1/G,e[0]=E*G,e[1]=(-I*r+s*w)*G,e[2]=(l*r-s*u)*G,e[3]=A*G,e[4]=(I*i-s*y)*G,e[5]=(-l*i+s*a)*G,e[6]=R*G,e[7]=(-w*i+r*y)*G,e[8]=(u*i-r*a)*G,e):null}function wee(e,t){const i=t[0],r=t[1],s=t[2],a=t[3],u=t[4],l=t[5],y=t[6],w=t[7],I=t[8];return e[0]=u*I-l*w,e[1]=s*w-r*I,e[2]=r*l-s*u,e[3]=l*y-a*I,e[4]=i*I-s*y,e[5]=s*a-i*l,e[6]=a*w-u*y,e[7]=r*y-i*w,e[8]=i*u-r*a,e}function xee(e){const t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=e[6],y=e[7],w=e[8];return t*(w*a-u*y)+i*(-w*s+u*l)+r*(y*s-a*l)}function dE(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],y=t[5],w=t[6],I=t[7],E=t[8],A=i[0],R=i[1],G=i[2],K=i[3],Y=i[4],ae=i[5],Te=i[6],_e=i[7],be=i[8];return e[0]=A*r+R*u+G*w,e[1]=A*s+R*l+G*I,e[2]=A*a+R*y+G*E,e[3]=K*r+Y*u+ae*w,e[4]=K*s+Y*l+ae*I,e[5]=K*a+Y*y+ae*E,e[6]=Te*r+_e*u+be*w,e[7]=Te*s+_e*l+be*I,e[8]=Te*a+_e*y+be*E,e}function rM(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],y=t[5],w=t[6],I=t[7],E=t[8],A=i[0],R=i[1];return e[0]=r,e[1]=s,e[2]=a,e[3]=u,e[4]=l,e[5]=y,e[6]=A*r+R*u+w,e[7]=A*s+R*l+I,e[8]=A*a+R*y+E,e}function yz(e,t,i){const r=t[0],s=t[1],a=t[2],u=t[3],l=t[4],y=t[5],w=t[6],I=t[7],E=t[8],A=Math.sin(i),R=Math.cos(i);return e[0]=R*r+A*u,e[1]=R*s+A*l,e[2]=R*a+A*y,e[3]=R*u-A*r,e[4]=R*l-A*s,e[5]=R*y-A*a,e[6]=w,e[7]=I,e[8]=E,e}function See(e,t,i){const r=i[0],s=i[1],a=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=a*t[6],e[7]=a*t[7],e[8]=a*t[8],e}function Tee(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function Mee(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Iee(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Eee(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function kee(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Aee(e,t){const i=t[0],r=t[1],s=t[2],a=t[3],u=i+i,l=r+r,y=s+s,w=i*u,I=r*u,E=r*l,A=s*u,R=s*l,G=s*y,K=a*u,Y=a*l,ae=a*y;return e[0]=1-E-G,e[3]=I-ae,e[6]=A+Y,e[1]=I+ae,e[4]=1-w-G,e[7]=R-K,e[2]=A-Y,e[5]=R+K,e[8]=1-w-E,e}function Pee(e,t){const i=t[0],r=t[1],s=t[2],a=t[4],u=t[5],l=t[6],y=t[8],w=t[9],I=t[10],E=I*u-l*w,A=-I*a+l*y,R=w*a-u*y,G=i*E+r*A+s*R;if(!G)return null;const K=1/G;return e[0]=E*K,e[1]=(-I*r+s*w)*K,e[2]=(l*r-s*u)*K,e[3]=A*K,e[4]=(I*i-s*y)*K,e[5]=(-l*i+s*a)*K,e[6]=R*K,e[7]=(-w*i+r*y)*K,e[8]=(u*i-r*a)*K,e}function Cee(e,t){const i=t[0],r=t[1],s=t[2],a=t[3],u=t[4],l=t[5],y=t[6],w=t[7],I=t[8],E=t[9],A=t[10],R=t[11],G=t[12],K=t[13],Y=t[14],ae=t[15],Te=i*l-r*u,_e=i*y-s*u,be=i*w-a*u,ke=r*y-s*l,Ae=r*w-a*l,Ve=s*w-a*y,Ze=I*K-E*G,lt=I*Y-A*G,ct=I*ae-R*G,ut=E*Y-A*K,nt=E*ae-R*K,It=A*ae-R*Y;let ht=Te*It-_e*nt+be*ut+ke*ct-Ae*lt+Ve*Ze;return ht?(ht=1/ht,e[0]=(l*It-y*nt+w*ut)*ht,e[1]=(y*ct-u*It-w*lt)*ht,e[2]=(u*nt-l*ct+w*Ze)*ht,e[3]=(s*nt-r*It-a*ut)*ht,e[4]=(i*It-s*ct+a*lt)*ht,e[5]=(r*ct-i*nt-a*Ze)*ht,e[6]=(K*Ve-Y*Ae+ae*ke)*ht,e[7]=(Y*be-G*Ve-ae*_e)*ht,e[8]=(G*Ae-K*be+ae*Te)*ht,e):null}function $ee(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Oee(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Lee(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function Ree(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function gz(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function Dee(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function zee(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function Nee(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Fee(e,t){const i=e[0],r=e[1],s=e[2],a=e[3],u=e[4],l=e[5],y=e[6],w=e[7],I=e[8],E=t[0],A=t[1],R=t[2],G=t[3],K=t[4],Y=t[5],ae=t[6],Te=t[7],_e=t[8],be=sa();return Math.abs(i-E)<=be*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(r-A)<=be*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(s-R)<=be*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(a-G)<=be*Math.max(1,Math.abs(a),Math.abs(G))&&Math.abs(u-K)<=be*Math.max(1,Math.abs(u),Math.abs(K))&&Math.abs(l-Y)<=be*Math.max(1,Math.abs(l),Math.abs(Y))&&Math.abs(y-ae)<=be*Math.max(1,Math.abs(y),Math.abs(ae))&&Math.abs(w-Te)<=be*Math.max(1,Math.abs(w),Math.abs(Te))&&Math.abs(I-_e)<=be*Math.max(1,Math.abs(I),Math.abs(_e))}function Bee(e){const t=sa(),i=e[0],r=e[1],s=e[2],a=e[3],u=e[4],l=e[5],y=e[6],w=e[7],I=e[8];return Math.abs(1-(i*i+a*a+y*y))<=t&&Math.abs(1-(r*r+u*u+w*w))<=t&&Math.abs(1-(s*s+l*l+I*I))<=t}const jee=dE,Vee=gz;Object.freeze(Object.defineProperty({__proto__:null,add:Ree,adjoint:wee,copy:_ee,determinant:xee,equals:Fee,exactEquals:Nee,frob:Lee,fromMat2d:kee,fromMat4:gee,fromQuat:Aee,fromRotation:Iee,fromScaling:Eee,fromTranslation:Mee,identity:mz,invert:bee,isOrthoNormal:Bee,mul:jee,multiply:dE,multiplyScalar:Dee,multiplyScalarAndAdd:zee,normalFromMat4:Cee,normalFromMat4Legacy:Pee,projection:$ee,rotate:yz,scale:See,scaleByVec2:Tee,set:fz,str:Oee,sub:Vee,subtract:gz,translate:rM,transpose:vee},Symbol.toStringTag,{value:"Module"}));function Hv(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function Uee(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Gee(e,t,i,r,s,a,u,l,y){const w=new Float32Array(9);return w[0]=e,w[1]=t,w[2]=i,w[3]=r,w[4]=s,w[5]=a,w[6]=u,w[7]=l,w[8]=y,w}function qee(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Uee,create:Hv,createView:qee,fromValues:Gee},Symbol.toStringTag,{value:"Module"}));function _z(){return new Float32Array(2)}function Hee(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function bf(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function Wee(e,t){return new Float32Array(e,t,2)}function vz(){return _z()}function bz(){return bf(1,1)}function wz(){return bf(1,0)}function xz(){return bf(0,1)}const Zee=vz(),Jee=bz(),Kee=wz(),Yee=xz();Object.freeze(Object.defineProperty({__proto__:null,ONES:Jee,UNIT_X:Kee,UNIT_Y:Yee,ZEROS:Zee,clone:Hee,create:_z,createView:Wee,fromValues:bf,ones:bz,unitX:wz,unitY:xz,zeros:vz},Symbol.toStringTag,{value:"Module"}));function Xee(e){return e instanceof Float32Array&&e.length>=2}function Qee(e){return Array.isArray(e)&&e.length>=2}function K_(e){return Xee(e)||Qee(e)}var sM;const Is=[0,0];let Kc=sM=class extends wt{constructor(e){super(e),this._viewpoint2D={center:yr(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new tr,this.id=0,this.inverseTransform=Bl(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=Bl(),this.transformNoRotation=Bl(),this.displayMat3=Hv(),this.displayViewMat3=Hv(),this.viewMat3=Hv(),this.viewMat2d=dz(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=na(i,e.viewpoint),this._set("size",Lg(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new sM({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return K_(t)?Ho(e,t,this.inverseTransform):(Is[0]=t,Is[1]=i,Ho(e,Is,this.inverseTransform))}toScreen(e,t,i){return K_(t)?Ho(e,t,this.transform):(Is[0]=t,Is[1]=i,Ho(e,Is,this.transform))}toScreenNoRotation(e,t,i){return K_(t)?Ho(e,t,this.transformNoRotation):(Is[0]=t,Is[1]=i,Ho(e,Is,this.transformNoRotation))}toScreenClosest(e,t,i){K_(t)?(Is[0]=t[0],Is[1]=t[1]):(Is[0]=t,Is[1]=i);const[r]=Is,{center:s,extent:a,spatialReference:u,transform:l}=this;return(r<a.xmin||r>a.xmax)&&(Is[0]=XD(r,s[0],u)),Ho(e,Is,l)}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return uE(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,a=this._get("size"),u=new Fa({targetGeometry:new Ht(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",u),!a||!t||!i)return;this.resolution=$f(u),this.rotation=r,this.scale=i,this.spatialReference=t,Lg(this.center,e);const l=a[0]!==0?2/a[0]:0,y=a[1]!==0?-2/a[1]:0;fz(this.displayMat3,l,0,0,0,y,0,-1,1,1);const w=mz(this.viewMat3),I=bf(a[0]/2,a[1]/2),E=bf(-a[0]/2,-a[1]/2),A=iI(r);rM(w,w,I),yz(w,w,A),rM(w,w,E),dE(this.displayViewMat3,this.displayMat3,w);const R=oE(this.viewMat2d,I);return qb(R,R,A),Og(R,R,E),zQ(this.extent,u,a),hE(this.transform,u,a,s),sE(this.inverseTransform,this.transform),GQ(this.transformNoRotation,u,a,s),this.worldScreenWidth=HQ(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};v([M({readOnly:!0})],Kc.prototype,"id",void 0),v([M({value:1,json:{write:!0}})],Kc.prototype,"pixelRatio",null),v([M({json:{write:!0}})],Kc.prototype,"size",null),v([M()],Kc.prototype,"spatialReference",void 0),v([M({type:Fa,json:{write:!0}})],Kc.prototype,"viewpoint",null),Kc=sM=v([me("esri.views.2d.ViewState")],Kc);const iC=Kc;var nM,oM;let Dl=nM=class extends Pt{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}clone(){return new nM({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}};v([M()],Dl.prototype,"left",void 0),v([M()],Dl.prototype,"top",void 0),v([M()],Dl.prototype,"right",void 0),v([M()],Dl.prototype,"bottom",void 0),Dl=nM=v([me("esri.views.2d.PaddedViewState.Padding")],Dl);let Dp=oM=class extends iC{constructor(...e){super(...e),this.paddedViewState=new iC,this._updateContent=(()=>{const t=yr();return()=>{const i=this._get("size"),r=this._get("padding");if(!i||!r)return;const s=this.paddedViewState;Yr(t,r.left+r.right,r.top+r.bottom),Rg(t,i,t),Lg(s.size,t);const a=s.viewpoint;a&&(this.viewpoint=a)}})(),this.addHandles(qt(()=>[this.size,this.padding],()=>this._updateContent(),gd)),this.padding=new Dl,this.size=[0,0]}set padding(e){this._set("padding",e||new Dl)}set viewpoint(e){if(e){const t=e.clone();this.paddedViewState.viewpoint=e,ZQ(t,e,this._get("size"),this._get("padding"));const i=this._viewpoint2D,r=t.targetGeometry;i.center[0]=r.x,i.center[1]=r.y,i.rotation=t.rotation,i.scale=t.scale,i.spatialReference=r.spatialReference,this._update()}}clone(){return new oM({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}};v([M()],Dp.prototype,"paddedViewState",void 0),v([M({type:Dl})],Dp.prototype,"padding",null),v([M()],Dp.prototype,"viewpoint",null),Dp=oM=v([me("esri.views.2d.PaddedViewState")],Dp);const ete=Dp;let Qs=class extends Pt{constructor(t){super(t),this.constraints=null,this.ready=!1,this.resizeAlign="center",this.addHandles([qt(()=>{var i;return(i=this.constraints)==null?void 0:i.version},i=>{this.constraints&&i&&this.ready&&(this.state.viewpoint=this.constraints.fit(this.state.paddedViewState.viewpoint))},gd)])}get center(){if(!this.ready)return this._get("center");const{center:t,spatialReference:i}=this.state.paddedViewState;return this.state.commitProperty("id"),new Ht({x:t[0],y:t[1],spatialReference:i})}set center(t){if(t==null)return;if(!this.ready)return void this._set("center",t);let i;try{i=this._project(t,this.state.spatialReference)}catch(s){return void pt.getLogger(this).error(new gt("mapview:invalid-center","could not project the value in the view's spatial reference",{input:t,error:s}))}const r=this.viewpoint;QT(r,r,i),this.viewpoint=r}get extent(){return this.ready?(this.state.commitProperty("id"),this.state.paddedViewState.extent.clone()):this._get("extent")}set extent(t){if(t==null)return;if(!t.width||!t.height)return void pt.getLogger(this).error(new gt("mapview:invalid-extent","invalid extent size"));if(!this.ready)return this._set("extent",t),this._set("center",void 0),this._set("viewpoint",void 0),this._set("scale",void 0),void this._set("zoom",void 0);let i;try{i=this._project(t,this.state.spatialReference)}catch(s){return void pt.getLogger(this).error(new gt("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:s}))}const r=this.viewpoint;NQ(r,r,i,this.state.size,{constraints:this.constraints}),this.viewpoint=r}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(t){this.ready?(this.state.padding=t,this._set("padding",this.state.padding)):this._set("padding",t)}get resolution(){return this.ready?(this.state.commitProperty("id"),this.state.resolution):0}get rotation(){return this.ready?(this.state.commitProperty("id"),this.state.rotation):this._get("rotation")}set rotation(t){if(isNaN(t))return;if(!this.ready)return void this._set("rotation",t);const i=this.viewpoint;KQ(i,i,t),this.viewpoint=i}get scale(){return this.ready?(this.state.commitProperty("id"),this.state.scale):this._get("scale")}set scale(t){if(!t||isNaN(t))return;if(!this.ready){this._set("scale",t),this._set("zoom",void 0);const r=this._get("extent");return void(r&&(this._set("extent",void 0),this._set("center",r.center)))}const i=this.viewpoint;YP(i,i,t),this.viewpoint=i}get viewpoint(){return this.ready?this.state.paddedViewState.viewpoint.clone():this._get("viewpoint")}set viewpoint(t){var a;if(t==null)return;if(!this.ready)return this._set("viewpoint",t),this._set("extent",void 0),this._set("center",void 0),this._set("zoom",void 0),void this._set("scale",void 0);let i,r;try{i=this._project(t,this.state.spatialReference),!t.scale||isNaN(t.scale)?r=new gt("mapview:invalid-viewpoint",`invalid scale value of ${t.scale}`):t.targetGeometry==null&&(r=new gt("mapview:invalid-viewpoint","geometry not defined"))}catch(u){r=new gt("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:u})}if(r)return void pt.getLogger(this).error(r);this._scaleBeforeChangingSpatialReference=null;const s=new Fa({targetGeometry:new Ht,scale:0,rotation:0});na(s,i),(a=this.constraints)==null||a.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this._set("viewpoint",s)}get zoom(){var t;return this.ready?((t=this.constraints)==null?void 0:t.scaleToZoom(this.scale))??-1:this._get("zoom")}set zoom(t){var s,a;if(!(t>=0))return;if(!this.ready){this._set("zoom",t),this._set("scale",void 0);const u=this._get("extent");return void(u&&(this._set("extent",void 0),this._set("center",u.center)))}const i=((s=this.constraints)==null?void 0:s.zoomToScale(t))??0;if(!i)return void this._set("zoom",-1);const r=this.viewpoint;YP(r,r,i),this.viewpoint=r,this._set("zoom",((a=this.constraints)==null?void 0:a.scaleToZoom(this.scale))??-1)}getUserStartupOptions(t){if(!t[0]&&!t[1])return{center:void 0,rotation:void 0,scale:void 0};const{padding:i,constraints:r}=this,s=this._get("center"),a=this._get("extent"),u=this._get("scale"),l=this._get("rotation"),y=this._get("viewpoint"),w=this._get("zoom"),I=w!=null&&r!=null&&r.zoomToScale(w)||void 0;let E,A,R;const G=y==null?void 0:y.rotation,K=y==null?void 0:y.targetGeometry;(K==null?void 0:K.type)==="extent"?E=K:(K==null?void 0:K.type)==="point"&&(A=K,R=y==null?void 0:y.scale);const Y=a??E;return{center:s??A??(Y==null?void 0:Y.center),rotation:l??G,scale:(u??I??R??(Y&&nf(Y,[t[0]-i.left-i.right,t[1]-i.top-i.bottom])))||void 0}}startup(t,i,r,s){var u;const a=t.targetGeometry;try{this._project(t,r)}catch(l){pt.getLogger(this).warn(new Gl("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:a.toJSON(),spatialReference:r,error:l})),t.targetGeometry=s||new Ht({x:0,y:0,spatialReference:r})}(u=this.constraints)==null||u.fit(t),this._set("state",new ete({padding:this.padding,size:i,viewpoint:t})),this._set("ready",!0)}teardown(){this._set("ready",!1);const{center:[t,i],spatialReference:r,rotation:s,scale:a}=this.state.paddedViewState,u=new Ht({x:t,y:i,spatialReference:r});this._set("viewpoint",null),this._set("extent",null),this._set("center",u),this._set("zoom",-1),this._set("rotation",s),this._set("scale",a),this._set("state",null)}changeSpatialReference(t){var y;const i=this.state.paddedViewState.clone();if(this._scaleBeforeChangingSpatialReference==null)this._scaleBeforeChangingSpatialReference=i.scale;else{const w=i.viewpoint.clone();w.scale=this._scaleBeforeChangingSpatialReference,i.viewpoint=w}const r=i.clone(),[s,a]=i.center;let u=null;try{u=this._project(new Ht({x:s,y:a,spatialReference:i.spatialReference}),t)}catch(w){GM()||pt.getLogger(this).warn(new Gl("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:u==null?void 0:u.toJSON(),spatialReference:t,error:w}))}u||(u=new Ht({x:0,y:0,spatialReference:t}));const l=QT(new Fa({targetGeometry:new Ht,scale:0,rotation:0}),i.viewpoint,u);r.viewpoint=l;try{const I=[i.size[0]/2,i.size[1]/2],E=[I[0]+20,I[1]],A=i.toMap([0,0],E),{x:R,y:G}=this._project(new Ht({x:A[0],y:A[1],spatialReference:i.spatialReference}),t);A[0]=R,A[1]=G,r.toScreen(A,A);const K=WQ(I,A,E),Y=Math.hypot(A[0]-I[0],A[1]-I[1])/20;!Number.isFinite(Y)||Math.abs(Y)>4?(l.rotation=0,l.targetGeometry=new Ht({x:0,y:0,spatialReference:t})):(l.scale*=Y,l.scale>Ce("mapview-srswitch-adjust-rotation-scale-threshold")?l.rotation=0:l.rotation+=Number.isFinite(K)?K:0)}catch{}(y=this._get("constraints"))==null||y.constrain(l,void 0),this._get("state").viewpoint=l}resize(t,i){var u;if(!this.ready)return;const r=this.state;let s=this.state.paddedViewState.viewpoint;const a=this.state.paddedViewState.size.concat();r.size=[t,i],JQ(s,s,a,this.state.paddedViewState.size,this.resizeAlign),s=((u=this.constraints)==null?void 0:u.constrain(s,void 0))??s,this.state.viewpoint=s}toMap(t){if(!this.ready)return null;const i=[0,0],[r,s]=this.state.toMap(i,[t.x,t.y]),a=this.state.spatialReference;return new Ht({x:r,y:s,spatialReference:a})}toScreen(t,i){if(!this.ready)return null;const r=this._project(t,this.state.spatialReference),s=[r.x,r.y];return(i==null?void 0:i.pickClosestTarget)===!1?this.state.toScreen(s,s):this.state.toScreenClosest(s,s),nn(s[0],s[1])}_project(t,i){var a;const r=(t==null?void 0:t.targetGeometry)||t;if(!i)return t;if(!r)return null;if(i.imageCoordinateSystem||(a=r.spatialReference)!=null&&a.imageCoordinateSystem||ds(i,r.spatialReference))return t;const s=Td(r,i);if(!s)throw new gt("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:r,spatialReference:i});return tte(t)?(t.targetGeometry=s,t):s}};function tte(e){return(e==null?void 0:e.declaredClass)==="esri.Viewpoint"}v([M({type:Ht})],Qs.prototype,"center",null),v([M()],Qs.prototype,"constraints",void 0),v([M({type:tr})],Qs.prototype,"extent",null),v([M({value:{top:0,right:0,bottom:0,left:0},cast:e=>({top:0,right:0,bottom:0,left:0,...e})})],Qs.prototype,"padding",null),v([M()],Qs.prototype,"ready",void 0),v([M()],Qs.prototype,"resizeAlign",void 0),v([M({readOnly:!0})],Qs.prototype,"resolution",null),v([M({type:Number})],Qs.prototype,"rotation",null),v([M({type:Number})],Qs.prototype,"scale",null),v([M({readOnly:!0})],Qs.prototype,"state",void 0),v([M({type:Fa})],Qs.prototype,"viewpoint",null),v([M()],Qs.prototype,"zoom",null),Qs=v([me("esri.views.2d.ViewStateManager")],Qs);function pE(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}let rC=class extends Ur{constructor(t,i){super(!0),this._view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r,i))}_handleDoubleClick(t,i){pE(t.data,"primary")&&(t.stopPropagation(),i?this._view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this._view.mapViewNavigation.zoomIn([t.data.x,t.data.y]))}},ite=class extends Ur{constructor(t,i,r){super(!0),this.view=t,this.pointerType=i,this.registerIncoming("double-tap-drag",r,s=>this._handleDoubleTapDrag(s))}_handleDoubleTapDrag(t){const{data:i}=t,{pointerType:r}=i;if(r!==this.pointerType)return;t.stopPropagation();const{action:s,delta:a}=i,{view:u}=this,{mapViewNavigation:l}=u;switch(s){case"begin":{const{scale:y}=u;this._startScale=y,this._currentScale=y,this._previousDelta=a,l.begin();break}case"update":{if(this._previousDelta.y===a.y)return;this._previousDelta=a;const y=1.015**a.y,w=this._startScale*y,I=w/this._currentScale;l.setViewpointImmediate(I),this._currentScale=w;break}case"end":{const{constraints:y}=u,{effectiveLODs:w,snapToZoom:I}=y;if(!I||!w)return void l.end();const E=y.snapScale(this._currentScale),A=(a.y>0?Math.max(E,y.snapToPreviousScale(this._startScale)):Math.min(E,y.snapToNextScale(this._startScale)))/this._currentScale;l.zoom(A);break}}}},Zb=class{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){var i,r;this._startEvent=t,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}},rte=class extends Ur{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s)),this.registerIncoming("pointer-down",()=>this.stopMomentumNavigation())}onInstall(t){super.onInstall(t),this._dragEventSeparator=new Zb({start:(i,r)=>{this.view.mapViewNavigation.pan.begin(this.view,r.data),r.stopPropagation()},update:(i,r)=>{this.view.mapViewNavigation.pan.update(this.view,r.data),r.stopPropagation()},end:(i,r)=>{this.view.mapViewNavigation.pan.end(this.view,r.data),r.stopPropagation()},condition:(i,r)=>i===1&&pE(r.data,this.pointerAction)})}_handleDrag(t){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this._dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}},ste=class extends Ur{constructor(t,i,r){super(!0),this._view=t,this.pointerAction=i;const s=this._view.mapViewNavigation;this._dragEventSeparator=new Zb({start:(a,u)=>{s.rotate.begin(this._view,u.data),u.stopPropagation()},update:(a,u)=>{s.rotate.update(this._view,u.data),u.stopPropagation()},end:(a,u)=>{s.rotate.end(),u.stopPropagation()},condition:(a,u)=>a===1&&pE(u.data,this.pointerAction)}),this.registerIncoming("drag",r,a=>this._dragEventSeparator.handle(a))}};function Ro(e){let t=e*e;return e<0&&(t*=-1),t}function nte(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function ote(e,t,i){const r=i,s=e.state,a=e.device,u=t.tiltDirection==="forward-down"?1:-1,l=1;return a.deviceType==="standard"?(r.translation[0]=Ro(s.axes[0]),r.translation[1]=Ro(s.axes[1]),r.translation[2]=Ro(s.buttons[7])-Ro(s.buttons[6]),r.heading=Ro(s.axes[2]),r.tilt=Ro(s.axes[3])):a.deviceType==="spacemouse"&&(r.translation[0]=1.2*Ro(s.axes[0]),r.translation[1]=1.2*Ro(s.axes[1]),r.translation[2]=2*-Ro(s.axes[2]),r.heading=1.2*Ro(s.axes[5]),r.tilt=1.2*Ro(s.axes[3])),r.tilt*=u,IL(r.translation,r.translation,l),r}function ate(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let lte=class extends Ur{constructor(t){super(!0),this._view=t,this._frameTask=null,this._watchHandles=new vM,this._currentDevice=null,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._handle=this.registerIncoming("gamepad",i=>this._handleGamePadEvent(i)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([qt(()=>{var i;return(i=this._view.navigation.gamepad)==null?void 0:i.enabled},i=>{i?(this._handle.resume(),this._frameTask||(this._frameTask=lf({update:r=>this._frameUpdate(r.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))},on)])}onUninstall(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),super.onUninstall()}_handleGamePadEvent(t){const i=this._view.navigation.gamepad.device;i&&t.data.device!==i||this._currentDevice&&this._currentDevice!==t.data.device||(t.data.action==="end"?(this._currentDevice=null,nte(this._transformation)):(this._currentDevice=t.data.device,ote(t.data,this._view.navigation.gamepad,this._transformation)))}_frameUpdate(t){const i=this._transformation;if(ate(i))return;const r=this._view.viewpoint.clone(),s=this._view.navigation.gamepad.velocityFactor,a=ute*s*t;Wb(r,r,[i.translation[0]*a,-i.translation[1]*a]);const u=1+i.translation[2]*hte*t,l=this._view.constraints.rotationEnabled?-i.heading*cte*t:0,y=this._view.size,w=[y[0]/2,y[1]];sz(r,r,u,l,w,y);const I=this._view.constraints.constrain(r,this._view.viewpoint);this._view.viewpoint=I}};const cte=.06,ute=.7,hte=6e-4;function Sz(e){const t=()=>e(document.visibilityState==="visible");return document.addEventListener("visibilitychange",t),{remove:()=>document.addEventListener("visibilitychange",t)}}let dte=class extends Ur{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._isSticky=!1,this._pressedKeys=new Set,this._timeout=void 0,this._currentDirection=void 0,this._stickyKeyDuration=200,this._handleKey=s=>{const a=this._keyMap[s.data.key];if(s.modifiers.has("Meta")||s.modifiers.has("Ctrl"))return void this._stopMovement();if(a==null)return;s.stopPropagation(),s.preventDefault();const u=s.type==="key-down";if(this._pressedKeys[u?"add":"delete"](a),u){if(this._direction===a)return;this._direction=a,this._isSticky=!1,this._setTimeout(()=>{this._isSticky&&this._handlePopKey()})}else{const l=this._timeout===void 0,y=this._pressedKeys.size>0;l||y?this._handlePopKey():this._isSticky=!0}},this._handlePopKey=()=>{this._direction=Array.from(this._pressedKeys).pop(),this._direction==null&&this._stopMovement()},this._stopMovement=()=>{this._isSticky=!1,this._direction=void 0,this._pressedKeys.clear(),this._setTimeout(void 0)},this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",r,this._handleKey),this.registerIncoming("key-up",r,this._handleKey),this.registerIncoming("blur",r,this._stopMovement),this._visibilityHandle=Sz(s=>s?null:this._stopMovement())}onUninstall(){var t;this._stopMovement(),(t=this._visibilityHandle)==null||t.remove()}get _direction(){return this._currentDirection}set _direction(t){const i=this._currentDirection!=null;if(t!=null){if(i||this.view.mapViewNavigation.begin(),this._currentDirection!==t)switch(t){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}}else i&&this.view.mapViewNavigation.stop();this._currentDirection=t}_setTimeout(t){clearTimeout(this._timeout),this._timeout=t===void 0?void 0:setTimeout(()=>{this._timeout=void 0,t()},this._stickyKeyDuration)}},pte=class extends Ur{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),this.registerIncoming("key-up",r,s=>this._handleKeyUp(s)),this.registerIncoming("blur",r,()=>this._handleStop()),this._visibilityHandle=Sz(s=>s?null:this._handleStop())}onUninstall(){var t;(t=this._visibilityHandle)==null||t.remove(),this._handleStop()}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleStop(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,i){const r=t.modifiers;if(r.size>0&&!r.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection[t.data.key];if(this._pressed=s!=null,this._pressed){if(t.preventDefault(),i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}};var Jp;(function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"})(Jp||(Jp={}));let fte=class extends Ur{constructor(t,i,r){super(!0),this.view=t,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",r,s=>this._handleKeyDown(s)),i.zoomIn.forEach(s=>this._keysToZoomAction[s]=Jp.IN),i.zoomOut.forEach(s=>this._keysToZoomAction[s]=Jp.OUT)}_handleKeyDown(t){this._handleKey(t)}_handleKey(t){const i=t.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:r}=t.data;if(!(r in this._keysToZoomAction))return;const s=this._keysToZoomAction[r],{mapViewNavigation:a}=this.view;let u=null;switch(s){case Jp.IN:u=a.zoomIn();break;case Jp.OUT:u=a.zoomOut();break;default:return}a.begin(),u.then(()=>a.end()),t.stopPropagation()}};const mte=.6;let yte=class extends Ur{constructor(t,i){super(!0),this._view=t,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this._view.navigation.mouseWheelZoomEnabled||(t.preventDefault(),t.stopPropagation(),!this._canZoom))return;const i=this._view.mapViewNavigation,{x:r,y:s,deltaY:a}=t.data,u=1/mte**(1/60*a),l=i.zoom(u,[r,s]);l&&(this._canZoom=!1,l.catch(()=>{}).then(()=>{this._canZoom=!0,i.end()}))}},gte=class extends Ur{constructor(t){super(!0),this.view=t,this.registerIncoming("drag",r=>this._handleDrag(r)),this.registerIncoming("pointer-down",()=>this._stopMomentumNavigation());const i=this.view.mapViewNavigation;this._dragEventSeparator=new Zb({start:(r,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(r,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(r,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:r=>r>=2})}_handleDrag(t){this._dragEventSeparator.handle(t)}_stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}};function sC(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value||1:0),axes:t.axes.map(i=>bte(i,e.axisThreshold))}:{buttons:[],axes:[]}}function _te(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function vte(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function bte(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}let wte=class{constructor(t,i){this._element=t,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=a=>{this._connectGamepad(a.gamepad)},this._onDisconnectGamepad=a=>{const u=a.gamepad,l=u.index,y=this._inputDevices[l];y&&(this._emitGamepadEvent(u,sC(y),!1),this._inputDevices.splice(l,1),this._latestUpdate.splice(l,1),this._input.gamepad.devices.remove(y),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(a=>this._connectGamepad(a)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){const i=new iE(t);i.deviceType!=="unknown"&&(this._inputDevices[t.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=lf({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const a=this._inputDevices[s.index];if(!a)return;const u=this._latestUpdate[s.index],l=sC(a),y=r||vte(l);u&&(u.timestamp===s.timestamp||!u.active&&y||_te(u.state,l))||this._emitGamepadEvent(s,l,!y)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this._latestUpdate[t.index],a=s&&s.active;if(!a&&!r)return;const u=!a&&r?"start":a&&r?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[t.index],state:i,action:u})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}};const nC=Ce("edge"),xte=Ce("chrome"),Ste=Ce("ff"),Tte=Ce("safari"),oC="esri-view-surface",_p={touchNone:`${oC}--touch-none`,touchPan:`${oC}--touch-pan`};let Tz=class Mz{constructor(t,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new wte(t,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource=Xi(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener(e2[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&e2[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(e2[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(t==null?void 0:t.has("gamepad"))??!1}setPointerCapture(t,i){i?this._setPointerCatpureSafe(t.pointerId):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?_p.touchNone:_p.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?_p.touchPan:_p.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(_p.touchNone),this._element.classList.remove(_p.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(t){try{this._element.setPointerCapture(t),this._activePointerCaptures.add(t)}catch{}}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=xD(this._element,t);return Mz.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const{key:r}=i;r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:nC&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}nC?r*=.7:xte||Tte?r*=.6:Ste&&(r*=1.375);const s=100,a=Math.abs(r);a>s&&(r=r/a*200/(1+Math.exp(-.02*(a-s))));const u=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,u)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}};Tz.test={disableSubpixelCoordinates:!1};const e2={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Mte=class extends Ur{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}};const us={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function Z1(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function Ite(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function Ete(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:nn()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[_e,be]=e,[ke,Ae]=[be.x-_e.x,be.y-_e.y];return t.radius=Math.sqrt(ke*ke+Ae*Ae)/2,t.center.x=(_e.x+be.x)/2,t.center.y=(_e.y+be.y)/2,t}let i=0,r=0;for(let _e=0;_e<e.length;_e++)i+=e[_e].x,r+=e[_e].y;i/=e.length,r/=e.length;const s=e.map(_e=>_e.x-i),a=e.map(_e=>_e.y-r);let u=0,l=0,y=0,w=0,I=0,E=0,A=0;for(let _e=0;_e<s.length;_e++){const be=s[_e],ke=a[_e],Ae=be*be,Ve=ke*ke;u+=Ae,l+=Ve,y+=be*ke,w+=Ae*be,I+=Ve*ke,E+=be*Ve,A+=ke*Ae}const R=.5*(w+E),G=.5*(I+A),K=u*l-y*y,Y=(R*l-G*y)/K,ae=(u*G-y*R)/K,Te=nn(Y+i,ae+r);return{radius:Math.sqrt(Y*Y+ae*ae+(u+l)/e.length),center:Te}}function sd(e){const{native:t}=e,{pointerId:i,button:r,pointerType:s}=t;return s==="mouse"?`${i}:${r}`:`${s}`}let kte=class extends Ur{constructor(t=us.maximumDoubleClickDelay,i=us.maximumDoubleClickDistance,r=us.maximumDoubleTouchDelay,s=us.maximumDoubleTouchDistance,a=Tf){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=a,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=nn(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new Zb({start:(u,l)=>this._dragStart(u,l),update:(u,l)=>this._dragUpdate(l),end:(u,l)=>this._dragEnd(l)}),this.registerIncoming("drag",u=>this._dragEventSeparator.handle(u)),this.registerIncoming("pointer-down",u=>this._handlePointerDown(u)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(t=>{t.doubleTapTimeout=er(t.doubleTapTimeout)})}get hasPendingInputs(){return ub(this._pointerState,t=>t.doubleTapTimeout!=null)}_clearPointerDown(t){const i=this._pointerState.get(t);i&&(i.doubleTapTimeout=er(i.doubleTapTimeout),this._pointerState.delete(t),this.refreshHasPendingInputs())}_createDoubleTapDragData(t,i,r){const{button:s,buttons:a,pointer:u,pointers:l,pointerType:y,timestamp:w}=r;return{action:t,delta:i,button:s,buttons:a,pointer:u,pointers:l,pointerType:y,timestamp:w}}_dragStart(t,i){if(!this._doubleTapDragReady||t!==1)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:r,modifiers:s}=i,{center:a}=r;this._dragStartCenter=a;const u=this._createDoubleTapDragData("begin",nn(0,0),r);this._doubleTapDrag.emit(u,void 0,s),i.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=t,{center:s}=i,a=nn(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),u=this._createDoubleTapDragData("update",a,i);this._doubleTapDrag.emit(u,void 0,r),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;const{data:i,modifiers:r}=t,{center:s}=i,a=nn(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),u=this._createDoubleTapDragData("end",a,i);this._doubleTapDrag.emit(u,void 0,r),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){const{data:i}=t,r=sd(i),s=this._pointerState.get(r),{pointerType:a}=i.native;if(s){const u=a==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;this._clearPointerDown(r),Z1(s.event.data,i)>u?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(t){const{data:i}=t,{pointerType:r}=i.native,s=sd(i),a=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,u=this._clock.setTimeout(()=>this._clearPointerDown(s),a);this._pointerState.set(s,{event:t,doubleTapTimeout:u}),this.refreshHasPendingInputs()}},Ate=class extends Ur{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:Pte(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=Y_(this._activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const a=Wv(s,Iz(this._activePointerMap));s.initialAngle=a,s.lastAngle=a,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this._activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=Y_(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=Y_(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=Wv(r,i)-t,r.lastAngle=Wv(r,i)-t})}_emitEvent(t,i,r){const s=Y_(this._activePointerMap);this._drag.emit(this._createPayload(t,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function Iz(e){const t=[];return e.forEach(i=>{t.push(nn(i.event.x,i.event.y))}),Ete(t)}function Y_(e){const t=Iz(e);let i=0;return e.forEach(r=>{let s=Wv(r,t),a=s-r.lastAngle;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;s=r.lastAngle+a,r.lastAngle=s;const u=s-r.initialAngle;i+=u}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function Pte(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function Wv(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var aC;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(aC||(aC={}));let Cte=class extends Ur{constructor(t=us.maximumDoubleClickDelay,i=us.maximumDoubleClickDistance,r=us.maximumDoubleTouchDelay,s=us.maximumDoubleTouchDistance,a=Tf){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=a,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=sd(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(t){const i=t.data,r=sd(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const a=s.immediateDoubleClick,u=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;a?(a.timeoutHandle.remove(),Z1(a,t.data)>u?this._startImmediateDoubleClick(t,s):(this._immediateDoubleClick.emit(t.data,void 0,a.modifiers),this._removeState(i))):Z1(s,t.data)>u?this._removeState(i):this._startImmediateDoubleClick(t,s)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_removeState(t){const i=sd(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}},$te=class extends Ur{constructor(t=us.maximumClickDelay,i=us.movementUntilMouseDrag,r=us.movementUntilPenDrag,s=us.movementUntilTouchDrag,a=us.holdDelay,u=Tf){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=a,this._clock=u,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",l=>{this._handlePointerLoss(l,"pointer-up")}),this.registerIncoming("pointer-capture-lost",l=>{this._handlePointerLoss(l,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",l=>{this._handlePointerLoss(l,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=er(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const u=this._pointerState.get(r);if(u){if(!u.isDragging){const l=u.previousEvent;this._pointerHold.emit(l,void 0,t.modifiers),u.holdEmitted=!0}u.holdTimeout=null}},this._holdDelay));const a={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,a),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):Ite(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,a=this._pointerState.get(s);a&&(a.holdTimeout!=null&&(a.holdTimeout.remove(),a.holdTimeout=null),a.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",a,i==="pointer-up"?r:a.previousEvent),void 0,a.modifiers):i==="pointer-up"&&a.downButton===r.native.button&&t.timestamp-a.startTimestamp<=this._maximumClickDelay&&!a.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}},Ote=class extends Ur{constructor(t=us.maximumDoubleClickDelay,i=us.maximumDoubleClickDistance,r=us.maximumDoubleTouchDelay,s=us.maximumDoubleTouchDistance,a=Tf){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=a,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=er(t.doubleClickTimer))}get hasPendingInputs(){return ub(this._pointerState,t=>t.doubleClickTimer!=null)}_clearDoubleClickTimer(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimer=er(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_getPointerId(t){const{pointerId:i,pointerType:r,button:s}=t.native;return r==="mouse"?`${i}:${s}`:`${r}`}_handleImmediateClick(t){const i=t.data,{pointerType:r}=i.native,s=this._getPointerId(i);if(!this._pointerState.has(s))return void this._startClick(t);const a=this._pointerState.get(s),{data:u,modifiers:l}=a.event,y=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;Z1(u,i)>y?(this._clearDoubleClickTimer(s,!0),this._startClick(t)):(this._clearDoubleClickTimer(s,!1),a.pointerDownCount===2&&this._doubleClick.emit(u,void 0,l))}_handlePointerDown(t){const i=sd(t.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(t){const{data:i}=t,{native:{pointerType:r}}=i,s=sd(i),a=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,u=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),a);this._pointerState.set(s,{event:t,doubleClickTimer:u,pointerDownCount:1}),this.refreshHasPendingInputs()}};const X_={counter:"Ctrl",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}};let $h=class extends Pt{initialize(){const t=()=>{var i;return(i=this.view)==null?void 0:i.ready};this.addHandles([md(()=>!t(),()=>this._disconnect()),md(t,()=>this._connect())])}destroy(){this._disconnect()}get latestPointerType(){var t;return(t=this._inputManager)==null?void 0:t.latestPointerType}get latestPointerLocation(){var t;return(t=this._inputManager)==null?void 0:t.latestPointerLocation}get multiTouchActive(){var t;return((t=this._inputManager)==null?void 0:t.multiTouchActive)??!1}isModifierKeyDown(t){var i;return((i=this._inputManager)==null?void 0:i.isModifierKeyDown(t))??!1}_disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Xi(this._inputManager)}_connect(){const t=this.view.surface,i=new Tz(t,this.view.input),r=[new Cte,new $te,new Ote,new Ate(this.view.navigation),new kte],s=new co({eventSource:i,recognizers:r});s.installHandlers("prevent-context-menu",[new Mte],pu.INTERNAL),s.installHandlers("navigation",[new gte(this.view),new lte(this.view),new yte(this.view),new rC(this.view),new rC(this.view,[X_.counter]),new rte(this.view,"primary"),new dte(this.view,X_.pan),new fte(this.view,X_.zoom),new pte(this.view,X_.rotate),new ste(this.view,"secondary"),new ite(this.view,"touch")],pu.INTERNAL),this.view.viewEvents.connect(s),this._source=i,this._inputManager=s,qt(()=>{var a,u;return(u=(a=this.view)==null?void 0:a.navigation)==null?void 0:u.browserTouchPanEnabled},a=>{this._source&&(this._source.browserTouchPanningEnabled=!a)},on)}get test(){return{inputManager:this._inputManager}}};v([M()],$h.prototype,"view",void 0),v([M()],$h.prototype,"latestPointerType",null),v([M()],$h.prototype,"latestPointerLocation",null),v([M()],$h.prototype,"multiTouchActive",null),$h=v([me("esri.views.2d.input.MapViewInputManager")],$h);const Lte=$h;var Hue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rte(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lC,cC,uC,Ez={exports:{}};lC=Ez,cC=function(){function e(s,a,u,l,y){t(s,a,u||0,l||s.length-1,y||r)}function t(s,a,u,l,y){for(;l>u;){if(l-u>600){var w=l-u+1,I=a-u+1,E=Math.log(w),A=.5*Math.exp(2*E/3),R=.5*Math.sqrt(E*A*(w-A)/w)*(I-w/2<0?-1:1);t(s,a,Math.max(u,Math.floor(a-I*A/w+R)),Math.min(l,Math.floor(a+(w-I)*A/w+R)),y)}var G=s[a],K=u,Y=l;for(i(s,u,a),y(s[l],G)>0&&i(s,u,l);K<Y;){for(i(s,K,Y),K++,Y--;y(s[K],G)<0;)K++;for(;y(s[Y],G)>0;)Y--}y(s[u],G)===0?i(s,u,Y):i(s,++Y,l),Y<=a&&(u=Y+1),a<=Y&&(l=Y-1)}}function i(s,a,u){var l=s[a];s[a]=s[u],s[u]=l}function r(s,a){return s<a?-1:s>a?1:0}return e},(uC=cC())!==void 0&&(lC.exports=uC);const Dte=Rte(Ez.exports);function J1(e,t){if(!(this instanceof J1))return new J1(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&(typeof t=="function"?this.toBBox=t:this._initFormat(t)),this.clear()}function zte(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function vp(e,t){Uy(e,0,e.children.length,t,e)}function Uy(e,t,i,r,s){s||(s=zp(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var a,u=t;u<i;u++)a=e.children[u],Gy(s,e.leaf?r(a):a);return s}function Gy(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function hC(e,t){return e.minX-t.minX}function dC(e,t){return e.minY-t.minY}function t2(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Q_(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Nte(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function Fte(e,t){var i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),s=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,s-i)*Math.max(0,a-r)}function i2(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function ev(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function zp(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function pC(e,t,i,r,s){for(var a,u=[t,i];u.length;)(i=u.pop())-(t=u.pop())<=r||(a=t+Math.ceil((i-t)/r/2)*r,Dte(e,a,t,i,s),u.push(t,a,a,i))}J1.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],r=this.toBBox;if(!ev(e,t))return i;for(var s,a,u,l,y=[];t;){for(s=0,a=t.children.length;s<a;s++)u=t.children[s],ev(e,l=t.leaf?r(u):u)&&(t.leaf?i.push(u):i2(e,l)?this._all(u,i):y.push(u));t=y.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!ev(e,t))return!1;for(var r,s,a,u,l=[];t;){for(r=0,s=t.children.length;r<s;r++)if(a=t.children[r],ev(e,u=t.leaf?i(a):a)){if(t.leaf||i2(e,u))return!0;l.push(a)}t=l.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var s=this.data;this.data=r,r=s}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){return e!=null&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=zp([]),this},remove:function(e,t){if(e==null)return this;for(var i,r,s,a,u=this.data,l=this.toBBox(e),y=[],w=[];u||y.length;){if(u||(u=y.pop(),r=y[y.length-1],i=w.pop(),a=!0),u.leaf&&(s=zte(e,u.children,t))!==-1)return u.children.splice(s,1),y.push(u),this._condense(y),this;a||u.leaf||!i2(u,l)?r?(i++,u=r.children[i],a=!1):u=null:(y.push(u),w.push(i),i=0,r=u,u=u.children[0])}return this},toBBox:function(e){return e},compareMinX:hC,compareMinY:dC,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,r){var s,a=i-t+1,u=this._maxEntries;if(a<=u)return vp(s=zp(e.slice(t,i+1)),this.toBBox),s;r||(r=Math.ceil(Math.log(a)/Math.log(u)),u=Math.ceil(a/Math.pow(u,r-1))),(s=zp([])).leaf=!1,s.height=r;var l,y,w,I,E=Math.ceil(a/u),A=E*Math.ceil(Math.sqrt(u));for(pC(e,t,i,A,this.compareMinX),l=t;l<=i;l+=A)for(pC(e,l,w=Math.min(l+A-1,i),E,this.compareMinY),y=l;y<=w;y+=E)I=Math.min(y+E-1,w),s.children.push(this._build(e,y,I,r-1));return vp(s,this.toBBox),s},_chooseSubtree:function(e,t,i,r){for(var s,a,u,l,y,w,I,E;r.push(t),!t.leaf&&r.length-1!==i;){for(I=E=1/0,s=0,a=t.children.length;s<a;s++)y=t2(u=t.children[s]),(w=Nte(e,u)-y)<E?(E=w,I=y<I?y:I,l=u):w===E&&y<I&&(I=y,l=u);t=l||t.children[0]}return t},_insert:function(e,t,i){var r=this.toBBox,s=i?e:r(e),a=[],u=this._chooseSubtree(s,this.data,t,a);for(u.children.push(e),Gy(u,s);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(s,a,t)},_split:function(e,t){var i=e[t],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);var a=this._chooseSplitIndex(i,s,r),u=zp(i.children.splice(a,i.children.length-a));u.height=i.height,u.leaf=i.leaf,vp(i,this.toBBox),vp(u,this.toBBox),t?e[t-1].children.push(u):this._splitRoot(i,u)},_splitRoot:function(e,t){this.data=zp([e,t]),this.data.height=e.height+1,this.data.leaf=!1,vp(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var r,s,a,u,l,y,w,I;for(y=w=1/0,r=t;r<=i-t;r++)u=Fte(s=Uy(e,0,r,this.toBBox),a=Uy(e,r,i,this.toBBox)),l=t2(s)+t2(a),u<y?(y=u,I=r,w=l<w?l:w):u===y&&l<w&&(w=l,I=r);return I},_chooseSplitAxis:function(e,t,i){var r=e.leaf?this.compareMinX:hC,s=e.leaf?this.compareMinY:dC;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,s)&&e.children.sort(r)},_allDistMargin:function(e,t,i,r){e.children.sort(r);var s,a,u=this.toBBox,l=Uy(e,0,t,u),y=Uy(e,i-t,i,u),w=Q_(l)+Q_(y);for(s=t;s<i-t;s++)a=e.children[s],Gy(l,e.leaf?u(a):a),w+=Q_(l);for(s=i-t-1;s>=t;s--)a=e.children[s],Gy(y,e.leaf?u(a):a),w+=Q_(y);return w},_adjustParentBBoxes:function(e,t,i){for(var r=i;r>=0;r--)Gy(t[r],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)e[i].children.length===0?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():vp(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};let fC=class kz{constructor(t,i){this.key=new Su(0,0,0,0),this.bounds=Sn(),this.objectIds=new Set,this.key.set(i);const r=t.getLODInfoAt(this.key);this.tileInfoView=t,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return tr.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(t){return{$view:{scale:this.scale,timeZone:t}}}createChildTiles(){const t=this.key.getChildKeys(),i=tn.acquire();for(let r=0;r<t.length;r++)i[r]=new kz(this.tileInfoView,t[r]);return i}getQuantizationParameters(){return _D.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}};const ah={added:[],removed:[]},r2=new Set,Bte=new Su(0,0,0,0);function jte(e,t){const i=Mn(t);if(!i)return null;const[r,s]=i.valid;return e[2]>s?[Sn([e[0],e[1],s,e[3]]),Sn([r,e[1],r+e[2]-s,e[3]])]:e[0]<r?[Sn([r,e[1],e[2],e[3]]),Sn([s-(r-e[0]),e[1],s,e[3]])]:null}let Vte=class extends Mu{constructor(t){super(),this._tiles=new Map,this._index=J1(9,Ce("esri-csp-restrictions")?i=>({minX:i.bounds[0],minY:i.bounds[1],maxX:i.bounds[2],maxY:i.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=t}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(t){return this._tiles.has(t)}get(t){return this._tiles.get(t)}getIntersectingTiles(t){if(!t||ZL(t)===0||JL(t)===0)return[];const i=jte(t,this.tileScheme.spatialReference);return i!=null?[...new Set([...this.boundsIntersections(i[0]),...this.boundsIntersections(i[1])])]:this.boundsIntersections(t)}boundsIntersections(t){return this._index.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]})}updateTiles(t){const i={added:[],removed:[]};for(const r of t.added)if(!this.has(r)){const s=new fC(this.tileScheme,r);this._tiles.set(r,s),this._index.insert(s),i.added.push(s)}for(const r of t.removed)if(this.has(r)){const s=this.get(r);this._tiles.delete(r),this._index.remove(s),i.removed.push(s)}this.tiles.length=0,this._tiles.forEach(r=>this.tiles.push(r)),(i.added.length||i.removed.length)&&this.emit("update",i)}setViewState(t){const i=this.tileScheme.getTileCoverage(t,0);if(!i)return;const{spans:r,lodInfo:s}=i,{level:a}=s;if(r.length>0)for(const{row:u,colFrom:l,colTo:y}of r)for(let w=l;w<=y;w++){const I=Bte.set(a,u,s.normalizeCol(w),s.getWorldForColumn(w)).id;if(r2.add(I),!this.has(I)){const E=new fC(this.tileScheme,I);this._tiles.set(I,E),this._index.insert(E),this.tiles.push(E),ah.added.push(E)}}for(let u=this.tiles.length-1;u>=0;u--){const l=this.tiles[u];r2.has(l.id)||(this._tiles.delete(l.id),this.tiles.splice(u,1),this._index.remove(l),ah.removed.push(l))}(ah.added.length||ah.removed.length)&&this.emit("update",ah),Dg.pool.release(i),r2.clear(),ah.added.length=0,ah.removed.length=0}},Yc=class extends Pt{constructor(){super(...arguments),this.color=new oi([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25,this.multiHighlightEnabled=!1}equals(t){return this.color.equals(t.color)&&(this.haloColor||this.color).equals(t.haloColor||t.color)&&this.haloOpacity===t.haloOpacity&&this.fillOpacity===t.fillOpacity&&this.multiHighlightEnabled===t.multiHighlightEnabled}};v([M({type:oi})],Yc.prototype,"color",void 0),v([M({type:oi})],Yc.prototype,"haloColor",void 0),v([M()],Yc.prototype,"haloOpacity",void 0),v([M()],Yc.prototype,"fillOpacity",void 0),v([M()],Yc.prototype,"multiHighlightEnabled",void 0),Yc=v([me("esri.views.2d.support.HighlightOptions")],Yc);const Az=Yc;async function Ute(e,t,i){const r=TD(t)?SD(e,t):t;if(!e.ready||isNaN(r.x)||isNaN(r.y))return{screenPoint:r,results:[]};let s=new Set;const a=new Set;let u=!1,l=null,y=null;i!=null&&i.include?yC(i.include,mC(e,A=>{s.add(A),s2(A,R=>a.add(R))},(A,R)=>{a.add(A),s.add(R)},A=>{l||(l=new Set),l.add(A)},A=>s.add(A),()=>u=!0)):(u=!0,s=new Set(e.allLayerViews),s.forEach(A=>{s2(A,R=>a.add(R))})),i!=null&&i.exclude&&yC(i.exclude,mC(e,A=>{s.delete(A),s2(A,R=>a.delete(R))},A=>a.delete(A),A=>{y||(y=new Set),y.add(A)}));const w=e.allLayerViews.filter(A=>!A.suspended&&s.has(A)).reverse(),I=e.toMap(r);let E=[...u?e.graphicsView.hitTest(I).map(A=>({type:"graphic",graphic:A,layer:null,mapPoint:I})):[],...await Promise.all(w.map(A=>A.hitTest(I,r)).toArray())].filter(pg).flat().filter(pg);return E=E.filter(A=>{var R;return A.type!=="graphic"||((R=A.layer)==null?void 0:R.type)!=="subtype-group"||a.has(A.graphic.layer)}),l&&(E=E.filter(A=>!("graphic"in A)||!A.graphic||(l==null?void 0:l.has(aM(A.graphic))))),y&&(E=E.filter(A=>!("graphic"in A)||!A.graphic||!(y!=null&&y.has(aM(A.graphic))))),{screenPoint:r,results:E}}function mC(e,t,i,r,s,a){return u=>{if(u instanceof OT){if(u.layer===e)a==null||a();else{const l=e.allLayerViews.find(y=>y.layer===u.layer);l&&(s==null||s(l))}r(aM(u))}else if(u.type==="subtype-sublayer"){const l=e.allLayerViews.find(y=>y.layer===u.parent);l&&i(u,l)}else{const l=e.allLayerViews.find(y=>y.layer===u);l&&t(l)}}}function yC(e,t){if(e)if(e1(e))for(const i of e)if(e1(i))for(const r of i)t(r);else t(i);else t(e)}function aM(e){var i,r;const t=e.getObjectId();return t?`${((i=e.layer)==null?void 0:i.uid)??((r=e.sourceLayer)==null?void 0:r.uid)??"MapView"}/${t}`:`"MapView/${e.uid}`}function s2({layer:e},t){e.type==="subtype-group"&&e.sublayers.forEach(i=>{t(i)})}function Gte(e,t,i){const{ctx:r,canvas:s}=Pz(e,i),a=r.getImageData(0,0,e.width,e.height),u=Wte(s,t);return Cz(s),{dataUrl:u,data:a}}function qte(e,t){const{ctx:i,canvas:r}=Pz(e,t),s=i.getImageData(0,0,e.width,e.height);return Cz(r),s}function Pz(e,t){const i=Hte();t.premultipliedAlpha&&Xte(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(e,0,0),t.flipY&&Yte(r),{ctx:r,canvas:i}}function Cz(e){e.width=0,e.height=0}function Hte(){return n2==null&&(n2=document.createElement("canvas")),n2}let n2=null;function Wte(e,t){const i=Qte[t.format],r=t.quality/100;return e.toDataURL(i,r)}function Zte(e,t){const i=Kte(e),r=tie[i];return{format:i,quality:Va(t??r,0,100)}}function Jte(e,t){return t/Math.max(e[0],e[1])}function Jue(e,t,i,r=0,s=0,a=e.width-r,u=e.height-s,l=!1){const{data:y}=e,{width:w,height:I,data:E}=t,A=a/w,R=u/I,G=Math.ceil(A/2),K=Math.ceil(R/2),Y=e.width;for(let ae=0;ae<I;ae++)for(let Te=0;Te<w;Te++){const _e=4*(Te+(l?I-ae-1:ae)*w);let be=0,ke=0,Ae=0,Ve=0,Ze=0,lt=0;const ct=(ae+.5)*R;for(let ut=Math.floor(ae*R);ut<(ae+1)*R;ut++){const nt=Math.abs(ct-(ut+.5))/K,It=(Te+.5)*A,ht=nt*nt;for(let hi=Math.floor(Te*A);hi<(Te+1)*A;hi++){const Zi=Math.abs(It-(hi+.5))/G,gi=Math.sqrt(ht+Zi*Zi);if(gi>=1)continue;let Ut=2*gi*gi*gi-3*gi*gi+1;const ir=4*(r+hi+(s+ut)*Y);lt+=Ut*y[ir+3],ke+=Ut,!i&&y[ir+3]<255&&(Ut=Ut*y[ir+3]/255),Ae+=Ut*y[ir],Ve+=Ut*y[ir+1],Ze+=Ut*y[ir+2],be+=Ut}}E[_e]=Ae/be,E[_e+1]=Ve/be,E[_e+2]=Ze/be,E[_e+3]=lt/ke}return t}function Kte(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return eie}}function Yte(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function Xte(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const a=255/s;t[r]=t[r]*a,t[r+1]=t[r+1]*a,t[r+2]=t[r+2]*a}}}const Qte={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},gC=98,eie="png",tie={png:100,jpg:gC,jpeg:gC},$z={flipY:!0,premultipliedAlpha:!0};async function iie(e,t){const i=await Oz(e,t),{format:r,quality:s}=Zte(t==null?void 0:t.format,t==null?void 0:t.quality);return Gte(i,{format:r,quality:s,rotation:0,disableDecorations:!1},$z)}async function rie(e,t){const i=await Oz(e,t);return qte(i,$z)}function Oz(e,t){const i=oie(t||{},nie(e.stage,e.size),e.size,e.padding),r=sie(t,e.allLayerViews);return e.stage.takeScreenshot(i,r,e.backgroundColor,t==null?void 0:t.rotation)}function sie(e={},t){if(!e.layers)return;const i=[];return e.layers.forEach(r=>{const s=t.find(a=>a.layer.id===r.id);s!=null&&s.container&&i.push(s.container)}),i}function nie(e,t){return Math.min(4,Jte(t,Math.min(4096,e.context.parameters.maxTextureSize)))}function oie(e,t,i,r){e.ignorePadding&&(r={left:0,right:0,top:0,bottom:0});let s=null;e.width!=null&&e.height!=null?s=[e.width,e.height]:e.width==null&&e.height!=null?s=[e.height,e.height]:e.width!=null&&e.height==null?s=[e.width,e.width]:e.width==null&&e.height==null&&(s=null);const a=i[0]-(r.left+r.right),u=i[1]-(r.top+r.bottom);let l,y,w=e.area||{x:0,y:0,width:a,height:u};if(s){const I=a/u,E=s[0]/s[1];if(E>I){const A=w.width/E;w={x:w.x,y:Math.round(w.y+(w.height-A)/2),width:w.width,height:Math.round(A)}}else{const A=w.height*E;w={x:Math.round(w.x+(w.width-A)/2),y:w.y,width:Math.round(A),height:w.height}}}else s=[w.width,w.height];return s[0]>w.width?(l=Math.min(s[0]/w.width,t),y=s[0]/w.width/l):(l=1,y=s[0]/w.width),{cropArea:{x:Math.round((w.x+r.left)*l),y:Math.round((w.y+r.top)*l),width:Math.round(w.width*l),height:Math.round(w.height*l)},outputScale:y,resolutionScale:l}}const _C=160;let qy=class extends Pt{constructor(){super(...arguments),this._timer=void 0}get stationary(){return!this._timer}flip(){this._timestamp=performance.now(),this._timer==null&&(this._timer=setInterval(()=>{performance.now()-this._timestamp>=_C&&this.clear()},_C))}clear(){this._timer&&(clearInterval(this._timer),this._timer=void 0)}};v([M()],qy.prototype,"_timer",void 0),v([M()],qy.prototype,"stationary",null),qy=v([me("esri.views.2d.support.StationaryManager")],qy);const aie=e=>e.includes("Brush");let Lz=class{constructor(){this._names=new Map}begin(t){this._names.has(t)||(this._names.set(t,!1),aie(t)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${t}.Start`))}end(t){this._names.has(t)&&!this._names.get(t)&&(this._names.set(t,!0),performance.mark(`Esri.${t}.End`))}record(t){this._names.has(t)||(this._names.set(t,!0),performance.mark(`Esri.${t}`))}};function vC(e,t={}){return e.getContext("webgl2",t)||null}let o2;function lie(){return o2||(o2=hie()),o2}let cie=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function uie(e){if(typeof WebGL2RenderingContext>"u")return null;const t=document.createElement("canvas");if(!t)return null;let i=vC(t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=vC(t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;e.available=!0,e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(e.supportsHighPrecisionFragment=r.precision>0),i}function hie(){const e=new cie,t=uie(e);return t==null||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function die(e){const t=lie();return t.available?e==="3d"&&t.majorPerformanceCaveat?new gt("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?null:new gt("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new gt("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new gt("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function pie(e){return e&&"nodeType"in e}function fie(e){return e&&typeof e.render=="function"}const bC={component:"esri-component"};let Oh=class extends Pt{constructor(){super(...arguments),this.widget=null}destroy(){var t;this.node=null,(t=this.widget)==null||t.destroy()}get id(){var t,i;return this._get("id")??((t=this.widget)==null?void 0:t.id)??((i=this.node)==null?void 0:i.id)}set id(t){this._set("id",t)}set node(t){const i=this._get("node");t!==i&&(t&&t.classList.add(bC.component),i&&i.classList.remove(bC.component),this._set("node",t))}castNode(t){var i;return(i=this.widget)==null||i.destroy(),t?typeof t=="string"||pie(t)?(this._set("widget",null),AI(t)):(fie(t)&&!t.domNode&&(t.domNode=document.createElement("div")),this._set("widget",t),t.domNode):(this._set("widget",null),null)}};v([M()],Oh.prototype,"id",null),v([M()],Oh.prototype,"node",null),v([es("node")],Oh.prototype,"castNode",null),v([M({readOnly:!0})],Oh.prototype,"widget",void 0),Oh=v([me("esri.views.ui.Component")],Oh);const Zv=Oh,Rz="calcite-mode-";function mie(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function yie(){return mie().startsWith("dark")}function gie(){return`${Rz}${yie()?"dark":"light"}`}function _ie(e){vie(e),e.classList.add(gie())}function vie(e){Array.from(e.classList).forEach(t=>{t.startsWith(Rz)&&e.classList.remove(t)})}const bie={left:0,top:0,bottom:0,right:0},Dz={bottom:30,top:15,right:15,left:15},wl="esri-ui",yn={ui:wl,corner:`${wl}-corner`,innerContainer:`${wl}-inner-container`,manualContainer:`${wl}-manual-container`,cornerContainer:`${wl}-corner-container`,topLeft:`${wl}-top-left`,topRight:`${wl}-top-right`,bottomLeft:`${wl}-bottom-left`,bottomRight:`${wl}-bottom-right`};function wie(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function tv(e){return e===0?"0":`${e}px`}function a2(e){const t=typeof e=="object"&&e!==null&&Object.getPrototypeOf(e);return(t===null||t===Object.prototype)&&("component"in e||"index"in e||"position"in e)?e:null}function l2(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let $a=class extends Mu.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Wn(),this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&l2(t,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&l2(t,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([qt(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,on),qt(()=>this.padding,this._applyUIPadding,on),qt(()=>[this.container,this._locale],([e,t])=>{e&&e.setAttribute("lang",t)},on),JM(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(yn.ui),_ie(e),this._attachContainers(e)),t&&(t.classList.remove(yn.ui),l2(t,{top:"",bottom:"",left:"",right:""}),G4(t)),this._set("container",e))}get height(){var s;const e=((s=this.view)==null?void 0:s.height)??0;if(e===0)return e;const t=this._getViewPadding(),{top:i,bottom:r}=t;return Math.max(e-i-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...Dz,...e}}get width(){var s;const e=((s=this.view)==null?void 0:s.width)??0;if(e===0)return e;const t=this._getViewPadding(),{left:i,right:r}=t;return Math.max(e-i-r,0)}add(e,t){let i,r,s;if(Array.isArray(e))return void e.forEach(u=>this.add(u,t));const a=a2(e);a&&({index:i,position:t,component:e,key:r}=a),t&&typeof t=="object"&&({index:i,key:r,position:t,internal:s}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r,s)}remove(e,t){var r;if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,t));const i=this._find(e);if(i){if(this._componentMap.has(i)&&((r=this._componentMap.get(i))==null?void 0:r.key)!==t)return;const s=this._components.indexOf(i),a=i.node.parentNode;return a==null||a.removeChild(i.node),this._componentMap.delete(i),this._components.splice(s,1)[0]}}empty(e,t={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,t);return}const i=this._positionNameToContainerLookup[e??"manual"],r=Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(s=>{var a;return s==null?!1:!(((a=this._componentMap.get(s))==null?void 0:a.internal)??!1)||t.removeInternal});for(const s of r)this.remove(s)}move(e,t){if(Array.isArray(e)&&e.forEach(a=>this.move(a,t)),!e)return;let i;const r=a2(e)||a2(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getComponents(e,t={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(i=>this._getComponentsAtPosition(i,t)):this._getComponentsAtPosition(e,t):this._components.filter(i=>{var r;return t.includeInternal||!((r=this._componentMap.get(i))!=null&&r.internal)}).map(({widget:i,node:r})=>i??r)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r,s){e instanceof Zv||(e=new Zv({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),this._componentMap.set(e,{key:r,internal:s})}_find(e){return e?e instanceof Zv?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??bie}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(yn.innerContainer,yn.cornerContainer);const t=document.createElement("div");t.classList.add(yn.innerContainer,yn.manualContainer);const i=document.createElement("div");i.classList.add(yn.topLeft,yn.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(yn.topRight,yn.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(yn.bottomLeft,yn.corner),e.appendChild(s);const a=document.createElement("div");a.classList.add(yn.bottomRight,yn.corner),e.appendChild(a),this._innerContainer=e,this._manualContainer=t;const u=oJ();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":a,"top-leading":u?r:i,"top-trailing":u?i:r,"bottom-leading":u?a:s,"bottom-trailing":u?s:a},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.position??"manual",{component:i,index:r}=e,s=this._positionNameToContainerLookup[t],a=r!=null&&r>-1;if(wie(i.widget)&&i.widget.startup(),!a)return void s.appendChild(i.node);const u=Array.from(s.children);if(r===0)return void(s.firstChild?sP(i.node,s.firstChild):s.appendChild(i.node));r>=u.length?s.appendChild(i.node):sP(i.node,u[r])}_toPixelPosition(e){return{top:tv(e.top),left:tv(e.left),right:tv(e.right),bottom:tv(e.bottom)}}_findByComponent(e){return this._components.find(t=>t===e)??null}_findById(e){return this._components.find(({id:t})=>t===e)??null}_findByNode(e){return this._components.find(({node:t})=>t===e)??null}_getComponentsAtPosition(e,t){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(r=>this._findByNode(r)).filter(pg).filter(r=>{var s;return t.includeInternal||!((s=this._componentMap.get(r))!=null&&s.internal)}).map(({widget:r,node:s})=>r??s)}};v([M()],$a.prototype,"_locale",void 0),v([M()],$a.prototype,"container",null),v([M()],$a.prototype,"height",null),v([M({value:Dz})],$a.prototype,"padding",null),v([es("padding")],$a.prototype,"castPadding",null),v([M()],$a.prototype,"view",void 0),v([M()],$a.prototype,"width",null),$a=v([me("esri.views.ui.UI")],$a);const xie=$a,Sie="randomUUID"in crypto;function fE(){if(Sie)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}function ehe(){return`{${fE().toUpperCase()}}`}function the(){return`{${fE()}}`}const Tie={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},Mie={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}},Iie=e=>({...Mie,...e}),Eie=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},kie=(e,t)=>e.find(t),wC=(e,t,i=!1)=>{let r=e;return t.forEach((s,a)=>{const u=r!=null&&r.children?kie(r.children,l=>l.domNode===s):void 0;i&&!u&&a!==t.length-1||(r=u)}),r},Aie=e=>{let t;const i={...Tie,...e},r=Iie(i),s=r.performanceLogger;let a,u=!0,l=!1;const y=[],w=[],I=(A,R,G)=>{var ae;let K;r.eventHandlerInterceptor=(Te,_e,be,ke)=>function(Ae){let Ve;s("domEvent",Ae);const Ze=Eie(Ae.currentTarget,K.domNode),lt=Ze.some(ut=>{var nt;return customElements.get((nt=ut==null?void 0:ut.tagName)==null?void 0:nt.toLowerCase())});if(Ae.eventPhase===Event.CAPTURING_PHASE||!lt)Ze.reverse(),Ve=wC(K.getLastRender(),Ze);else{const ut=Ae.composedPath(),nt=ut.slice(ut.indexOf(Ae.currentTarget),ut.indexOf(K.domNode)).reverse();Ve=wC(K.getLastRender(),nt,!0)}let ct;return Ve&&(ct=i.handleInterceptedEvent(t,Ve,this,Ae)),s("domEventProcessed",Ae),ct},(ae=i.postProcessProjectionOptions)==null||ae.call(i,r);const Y=G();K=A(R,Y,r),r.eventHandlerInterceptor=void 0,y.push(K),w.push(G),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(K,Y)};let E=()=>{if(a=void 0,u){u=!1,s("renderStart",void 0);for(let A=0;A<y.length;A++){const R=w[A]();s("rendered",void 0),y[A].update(R),s("patched",void 0)}s("renderDone",void 0),u=!0}};return i.modifyDoRenderImplementation&&(E=i.modifyDoRenderImplementation(E,y,w)),t={renderNow:E,scheduleRender:()=>{a||l||(a=requestAnimationFrame(E))},stop:()=>{a&&(cancelAnimationFrame(a),a=void 0),l=!0},resume:()=>{l=!1,u=!0,t.scheduleRender()},append:(A,R)=>{I(hu.append,A,R)},insertBefore:(A,R)=>{I(hu.insertBefore,A,R)},merge:(A,R)=>{I(hu.merge,A,R)},replace:(A,R)=>{I(hu.replace,A,R)},detach:A=>{for(let R=0;R<w.length;R++)if(w[R]===A)return w.splice(R,1),y.splice(R,1)[0];throw new Error("renderFunction was not found")}},t};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.7.1
 */const zz="calcite-mode-auto",Nz="calcite-mode-dark",Pie="calcite-mode-light",ihe={autoMode:zz,darkMode:Nz,lightMode:Pie,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},jh={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1};let Np,Fz,Jb,Bz=!1,K1=!1,mE=!1,Gn=!1,xC=null,lM=!1;const Cie=e=>{const t=new URL(e,ts.$resourcesUrl$);return t.origin!==n0.location.origin?t.href:t.pathname},$ie=e=>ts.$resourcesUrl$=e,vd=(e,t="")=>()=>{},Oie="slot-fb{display:contents}slot-fb[hidden]{display:none}",SC="http://www.w3.org/1999/xlink",TC={},Lie="http://www.w3.org/2000/svg",Rie="http://www.w3.org/1999/xhtml",Die=e=>e!=null,yE=e=>(e=typeof e,e==="object"||e==="function");function zie(e){var t,i,r;return(r=(i=(t=e.head)===null||t===void 0?void 0:t.querySelector('meta[name="csp-nonce"]'))===null||i===void 0?void 0:i.getAttribute("content"))!==null&&r!==void 0?r:void 0}const jz=(e,t,...i)=>{let r=null,s=null,a=null,u=!1,l=!1;const y=[],w=E=>{for(let A=0;A<E.length;A++)r=E[A],Array.isArray(r)?w(r):r!=null&&typeof r!="boolean"&&((u=typeof e!="function"&&!yE(r))&&(r=String(r)),u&&l?y[y.length-1].$text$+=r:y.push(u?Y1(null,r):r),l=u)};if(w(i),t){t.key&&(s=t.key),t.name&&(a=t.name);{const E=t.className||t.class;E&&(t.class=typeof E!="object"?E:Object.keys(E).filter(A=>E[A]).join(" "))}}if(typeof e=="function")return e(t===null?{}:t,y,Bie);const I=Y1(e,null);return I.$attrs$=t,y.length>0&&(I.$children$=y),I.$key$=s,I.$name$=a,I},Y1=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},Nie={},Fie=e=>e&&e.$tag$===Nie,Bie={forEach:(e,t)=>e.map(MC).forEach(t),map:(e,t)=>e.map(MC).map(t).map(jie)},MC=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),jie=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),jz(e.vtag,i,...e.vchildren||[])}const t=Y1(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},Vie=e=>yre.map(t=>t(e)).find(t=>!!t),Uie=(e,t)=>e!=null&&!yE(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,Gie=e=>e,rhe=(e,t,i)=>{const r=Gie(e);return{emit:s=>qie(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},qie=(e,t,i)=>{const r=ts.ce(t,i);return e.dispatchEvent(r),r},IC=new WeakMap,Hie=(e,t,i)=>{let r=Q1.get(e);vre&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=t:r.replaceSync(t)):r=t,Q1.set(e,r)},Wie=(e,t,i)=>{var r;const s=Vz(t,i),a=Q1.get(s);if(e=e.nodeType===11?e:ea,a)if(typeof a=="string"){e=e.head||e;let u=IC.get(e),l;if(u||IC.set(e,u=new Set),!u.has(s)){{l=ea.createElement("style"),l.innerHTML=a;const y=(r=ts.$nonce$)!==null&&r!==void 0?r:zie(ea);y!=null&&l.setAttribute("nonce",y),e.insertBefore(l,e.querySelector("link"))}t.$flags$&4&&(l.innerHTML+=Oie),u&&u.add(s)}}else e.adoptedStyleSheets.includes(a)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,a]);return s},Zie=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=vd("attachStyles",t.$tagName$),a=Wie(i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=a,i.classList.add(a+"-h"),r&2&&i.classList.add(a+"-s")),s()},Vz=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),EC=(e,t,i,r,s,a)=>{if(i!==r){let u=$C(e,t),l=t.toLowerCase();if(t==="class"){const y=e.classList,w=kC(i),I=kC(r);y.remove(...w.filter(E=>E&&!I.includes(E))),y.add(...I.filter(E=>E&&!w.includes(E)))}else if(t==="style"){for(const y in i)(!r||r[y]==null)&&(y.includes("-")?e.style.removeProperty(y):e.style[y]="");for(const y in r)(!i||r[y]!==i[y])&&(y.includes("-")?e.style.setProperty(y,r[y]):e.style[y]=r[y])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n"){if(t[2]==="-"?t=t.slice(3):$C(n0,l)?t=l.slice(2):t=l[2]+t.slice(3),i||r){const y=t.endsWith(Uz);t=t.replace(Kie,""),i&&ts.rel(e,t,i,y),r&&ts.ael(e,t,r,y)}}else{const y=yE(r);if((u||y&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{const I=r??"";t==="list"?u=!1:(i==null||e[t]!=I)&&(e[t]=I)}}catch{}let w=!1;l!==(l=l.replace(/^xlink\:?/,""))&&(t=l,w=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(w?e.removeAttributeNS(SC,t):e.removeAttribute(t)):(!u||a&4||s)&&!y&&(r=r===!0?"":r,w?e.setAttributeNS(SC,t,r):e.setAttribute(t,r))}}},Jie=/\s/,kC=e=>e?e.split(Jie):[],Uz="Capture",Kie=new RegExp(Uz+"$"),Gz=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,a=e&&e.$attrs$||TC,u=t.$attrs$||TC;for(r in a)r in u||EC(s,r,a[r],void 0,i,t.$flags$);for(r in u)EC(s,r,a[r],u[r],i,t.$flags$)},X1=(e,t,i,r)=>{var s;const a=t.$children$[i];let u=0,l,y,w;if(Bz||(mE=!0,a.$tag$==="slot"&&(Np&&r.classList.add(Np+"-s"),a.$flags$|=a.$children$?2:1)),a.$text$!==null)l=a.$elm$=ea.createTextNode(a.$text$);else if(a.$flags$&1)l=a.$elm$=ea.createTextNode("");else{if(Gn||(Gn=a.$tag$==="svg"),l=a.$elm$=ea.createElementNS(Gn?Lie:Rie,a.$flags$&2?"slot-fb":a.$tag$),Gn&&a.$tag$==="foreignObject"&&(Gn=!1),Gz(null,a,Gn),Die(Np)&&l["s-si"]!==Np&&l.classList.add(l["s-si"]=Np),a.$children$)for(u=0;u<a.$children$.length;++u)y=X1(e,a,u,l),y&&l.appendChild(y);a.$tag$==="svg"?Gn=!1:l.tagName==="foreignObject"&&(Gn=!0)}return l["s-hn"]=Jb,a.$flags$&3&&(l["s-sr"]=!0,l["s-fs"]=(s=a.$attrs$)===null||s===void 0?void 0:s.slot,l["s-cr"]=Fz,l["s-sn"]=a.$name$||"",w=e&&e.$children$&&e.$children$[i],w&&w.$tag$===a.$tag$&&e.$elm$&&zg(e.$elm$,!1)),l},zg=(e,t)=>{var i;ts.$flags$|=1;const r=e.childNodes;for(let s=r.length-1;s>=0;s--){const a=r[s];a["s-hn"]!==Jb&&a["s-ol"]&&(Wz(a).insertBefore(a,gE(a)),a["s-ol"].remove(),a["s-ol"]=void 0,a["s-sh"]=void 0,a.nodeType===1&&a.setAttribute("slot",(i=a["s-sn"])!==null&&i!==void 0?i:""),mE=!0),t&&zg(a,t)}ts.$flags$&=-2},qz=(e,t,i,r,s,a)=>{let u=e["s-cr"]&&e["s-cr"].parentNode||e,l;for(u.shadowRoot&&u.tagName===Jb&&(u=u.shadowRoot);s<=a;++s)r[s]&&(l=X1(null,i,s,e),l&&(r[s].$elm$=l,u.insertBefore(l,gE(t))))},Hz=(e,t,i)=>{for(let r=t;r<=i;++r){const s=e[r];if(s){const a=s.$elm$;Kz(s),a&&(K1=!0,a["s-ol"]?a["s-ol"].remove():zg(a,!0),a.remove())}}},Yie=(e,t,i,r,s=!1)=>{let a=0,u=0,l=0,y=0,w=t.length-1,I=t[0],E=t[w],A=r.length-1,R=r[0],G=r[A],K,Y;for(;a<=w&&u<=A;)if(I==null)I=t[++a];else if(E==null)E=t[--w];else if(R==null)R=r[++u];else if(G==null)G=r[--A];else if(iv(I,R,s))Fp(I,R,s),I=t[++a],R=r[++u];else if(iv(E,G,s))Fp(E,G,s),E=t[--w],G=r[--A];else if(iv(I,G,s))(I.$tag$==="slot"||G.$tag$==="slot")&&zg(I.$elm$.parentNode,!1),Fp(I,G,s),e.insertBefore(I.$elm$,E.$elm$.nextSibling),I=t[++a],G=r[--A];else if(iv(E,R,s))(I.$tag$==="slot"||G.$tag$==="slot")&&zg(E.$elm$.parentNode,!1),Fp(E,R,s),e.insertBefore(E.$elm$,I.$elm$),E=t[--w],R=r[++u];else{for(l=-1,y=a;y<=w;++y)if(t[y]&&t[y].$key$!==null&&t[y].$key$===R.$key$){l=y;break}l>=0?(Y=t[l],Y.$tag$!==R.$tag$?K=X1(t&&t[u],i,l,e):(Fp(Y,R,s),t[l]=void 0,K=Y.$elm$),R=r[++u]):(K=X1(t&&t[u],i,u,e),R=r[++u]),K&&Wz(I.$elm$).insertBefore(K,gE(I.$elm$))}a>w?qz(e,r[A+1]==null?null:r[A+1].$elm$,i,r,u,A):u>A&&Hz(t,a,w)},iv=(e,t,i=!1)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:i?!0:e.$key$===t.$key$:!1,gE=e=>e&&e["s-ol"]||e,Wz=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,Fp=(e,t,i=!1)=>{const r=t.$elm$=e.$elm$,s=e.$children$,a=t.$children$,u=t.$tag$,l=t.$text$;let y;l===null?(Gn=u==="svg"?!0:u==="foreignObject"?!1:Gn,u==="slot"||Gz(e,t,Gn),s!==null&&a!==null?Yie(r,s,t,a,i):a!==null?(e.$text$!==null&&(r.textContent=""),qz(r,null,t,a,0,a.length-1)):s!==null&&Hz(s,0,s.length-1),Gn&&u==="svg"&&(Gn=!1)):(y=r["s-cr"])?y.parentNode.textContent=l:e.$text$!==l&&(r.data=l)},Zz=e=>{const t=e.childNodes;for(const i of t)if(i.nodeType===1){if(i["s-sr"]){const r=i["s-sn"];i.hidden=!1;for(const s of t)if(s!==i){if(s["s-hn"]!==i["s-hn"]||r!==""){if(s.nodeType===1&&(r===s.getAttribute("slot")||r===s["s-sn"])){i.hidden=!0;break}}else if(s.nodeType===1||s.nodeType===3&&s.textContent.trim()!==""){i.hidden=!0;break}}}Zz(i)}},zl=[],Jz=e=>{let t,i,r;for(const s of e.childNodes){if(s["s-sr"]&&(t=s["s-cr"])&&t.parentNode){i=t.parentNode.childNodes;const a=s["s-sn"];for(r=i.length-1;r>=0;r--)if(t=i[r],!t["s-cn"]&&!t["s-nr"]&&t["s-hn"]!==s["s-hn"]&&!jh.experimentalSlotFixes)if(AC(t,a)){let u=zl.find(l=>l.$nodeToRelocate$===t);K1=!0,t["s-sn"]=t["s-sn"]||a,u?(u.$nodeToRelocate$["s-sh"]=s["s-hn"],u.$slotRefNode$=s):(t["s-sh"]=s["s-hn"],zl.push({$slotRefNode$:s,$nodeToRelocate$:t})),t["s-sr"]&&zl.map(l=>{AC(l.$nodeToRelocate$,t["s-sn"])&&(u=zl.find(y=>y.$nodeToRelocate$===t),u&&!l.$slotRefNode$&&(l.$slotRefNode$=u.$slotRefNode$))})}else zl.some(u=>u.$nodeToRelocate$===t)||zl.push({$nodeToRelocate$:t})}s.nodeType===1&&Jz(s)}},AC=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Kz=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Kz)},Xie=(e,t,i=!1)=>{var r,s,a,u;const l=e.$hostElement$,y=e.$cmpMeta$,w=e.$vnode$||Y1(null,null),I=Fie(t)?t:jz(null,null,t);if(Jb=l.tagName,y.$attrsToReflect$&&(I.$attrs$=I.$attrs$||{},y.$attrsToReflect$.map(([E,A])=>I.$attrs$[A]=l[E])),i&&I.$attrs$)for(const E of Object.keys(I.$attrs$))l.hasAttribute(E)&&!["key","ref","style","class"].includes(E)&&(I.$attrs$[E]=l[E]);I.$tag$=null,I.$flags$|=4,e.$vnode$=I,I.$elm$=w.$elm$=l.shadowRoot||l,Np=l["s-sc"],Fz=l["s-cr"],Bz=(y.$flags$&1)!==0,K1=!1,Fp(w,I,i);{if(ts.$flags$|=1,mE){Jz(I.$elm$);for(const E of zl){const A=E.$nodeToRelocate$;if(!A["s-ol"]){const R=ea.createTextNode("");R["s-nr"]=A,A.parentNode.insertBefore(A["s-ol"]=R,A)}}for(const E of zl){const A=E.$nodeToRelocate$,R=E.$slotRefNode$;if(R){const G=R.parentNode;let K=R.nextSibling;{let Y=(r=A["s-ol"])===null||r===void 0?void 0:r.previousSibling;for(;Y;){let ae=(s=Y["s-nr"])!==null&&s!==void 0?s:null;if(ae&&ae["s-sn"]===A["s-sn"]&&G===ae.parentNode&&(ae=ae.nextSibling,!ae||!ae["s-nr"])){K=ae;break}Y=Y.previousSibling}}(!K&&G!==A.parentNode||A.nextSibling!==K)&&A!==K&&(!A["s-hn"]&&A["s-ol"]&&(A["s-hn"]=A["s-ol"].parentNode.nodeName),G.insertBefore(A,K),A.nodeType===1&&(A.hidden=(a=A["s-ih"])!==null&&a!==void 0?a:!1))}else A.nodeType===1&&(i&&(A["s-ih"]=(u=A.hidden)!==null&&u!==void 0?u:!1),A.hidden=!0)}}K1&&Zz(I.$elm$),ts.$flags$&=-2,zl.length=0}},Qie=(e,t)=>{},_E=(e,t)=>(e.$flags$|=16,Qie(e,e.$ancestorComponent$),wre(()=>ere(e,t))),ere=(e,t)=>{const i=e.$hostElement$,r=vd("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let a;return t?a=of(s,"componentWillLoad"):a=of(s,"componentWillUpdate"),a=PC(a,()=>of(s,"componentWillRender")),r(),PC(a,()=>ire(e,s,t))},PC=(e,t)=>tre(e)?e.then(t):t(),tre=e=>e instanceof Promise||e&&e.then&&typeof e.then=="function",ire=async(e,t,i)=>{const r=e.$hostElement$,s=vd("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&Zie(e);const a=vd("render",e.$cmpMeta$.$tagName$);rre(e,t,r,i),a(),s(),sre(e)},rre=(e,t,i,r)=>{try{xC=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(jh.hasRenderFn||jh.reflect)&&(jh.vdomRender||jh.reflect)&&(jh.hydrateServerSide||Xie(e,t,r))}catch(y){s0(y,e.$hostElement$)}return xC=null,null},sre=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=vd("postUpdate",t),s=i;e.$ancestorComponent$,of(s,"componentDidRender"),e.$flags$&64?(of(s,"componentDidUpdate"),r()):(e.$flags$|=64,of(s,"componentDidLoad"),r())},she=e=>{{const t=Of(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&_E(t,!1),i}},of=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){s0(r)}},nre=(e,t)=>Of(e).$instanceValues$.get(t),ore=(e,t,i,r)=>{const s=Of(e),a=e,u=s.$instanceValues$.get(t),l=s.$flags$,y=a;i=Uie(i,r.$members$[t][0]);const w=Number.isNaN(u)&&Number.isNaN(i);if(i!==u&&!w){s.$instanceValues$.set(t,i);{if(r.$watchers$&&l&128){const E=r.$watchers$[t];E&&E.map(A=>{try{y[A](i,u,t)}catch(R){s0(R,a)}})}if((l&18)===2){if(y.componentShouldUpdate&&y.componentShouldUpdate(i,u,t)===!1)return;_E(s,!1)}}}},are=(e,t,i)=>{var r;const s=e.prototype;if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const a=Object.entries(t.$members$);a.map(([u,[l]])=>{(l&31||l&32)&&Object.defineProperty(s,u,{get(){return nre(this,u)},set(y){ore(this,u,y,t)},configurable:!0,enumerable:!0})});{const u=new Map;s.attributeChangedCallback=function(l,y,w){ts.jmp(()=>{var I;const E=u.get(l);if(this.hasOwnProperty(E))w=this[E],delete this[E];else{if(s.hasOwnProperty(E)&&typeof this[E]=="number"&&this[E]==w)return;if(E==null){const A=Of(this),R=A==null?void 0:A.$flags$;if(R&&!(R&8)&&R&128&&w!==y){const K=this,Y=(I=t.$watchers$)===null||I===void 0?void 0:I[l];Y==null||Y.forEach(ae=>{K[ae]!=null&&K[ae].call(K,w,y,l)})}return}}this[E]=w===null&&typeof this[E]=="boolean"?!1:w})},e.observedAttributes=Array.from(new Set([...Object.keys((r=t.$watchers$)!==null&&r!==void 0?r:{}),...a.filter(([l,y])=>y[0]&15).map(([l,y])=>{var w;const I=y[1]||l;return u.set(I,l),y[0]&512&&((w=t.$attrsToReflect$)===null||w===void 0||w.push([l,I])),I})]))}}return e},lre=async(e,t,i,r)=>{let s;if(!(t.$flags$&32)&&(t.$flags$|=32,s=e.constructor,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let u=s.style;typeof u!="string"&&(u=u[t.$modeName$=Vie(e)]);const l=Vz(i,t.$modeName$);if(!Q1.has(l)){const y=vd("registerStyles",i.$tagName$);Hie(l,u,!!(i.$flags$&1)),y()}}t.$ancestorComponent$,_E(t,!0)},CC=e=>{},cre=e=>{if(!(ts.$flags$&1)){const t=Of(e),i=t.$cmpMeta$,r=vd("connectedCallback",i.$tagName$);t.$flags$&1?(Yz(e,t,i.$listeners$),t!=null&&t.$lazyInstance$?CC(t.$lazyInstance$):t!=null&&t.$onReadyPromise$&&t.$onReadyPromise$.then(()=>CC(t.$lazyInstance$))):(t.$flags$|=1,i.$flags$&12&&ure(e),i.$members$&&Object.entries(i.$members$).map(([s,[a]])=>{if(a&31&&e.hasOwnProperty(s)){const u=e[s];delete e[s],e[s]=u}}),lre(e,t,i)),r()}},ure=e=>{const t=e["s-cr"]=ea.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},hre=async e=>{if(!(ts.$flags$&1)){const t=Of(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},nhe=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};i.$members$=t[2],i.$listeners$=t[3],i.$watchers$=e.$watchers$,i.$attrsToReflect$=[];const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){mre(this,i)},connectedCallback(){cre(this),r&&r.call(this)},disconnectedCallback(){hre(this),s&&s.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),e.is=i.$tagName$,are(e,i)},ohe=(e,t)=>t,Yz=(e,t,i,r)=>{i&&i.map(([s,a,u])=>{const l=pre(e,s),y=dre(t,u),w=fre(s);ts.ael(l,a,y,w),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>ts.rel(l,a,y,w))})},dre=(e,t)=>i=>{try{jh.lazyLoad||e.$hostElement$[t](i)}catch(r){s0(r)}},pre=(e,t)=>t&4?ea:t&8?n0:t&16?ea.body:e,fre=e=>gre?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Xz=new WeakMap,Of=e=>Xz.get(e),mre=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Yz(e,i,t.$listeners$),Xz.set(e,i)},$C=(e,t)=>t in e,s0=(e,t)=>(0,console.error)(e,t),Q1=new Map,yre=[],n0=typeof window<"u"?window:{},ea=n0.document||{head:{}},ahe=n0.HTMLElement||class{},ts={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},gre=(()=>{let e=!1;try{ea.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),_re=e=>Promise.resolve(e),vre=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),cM=[],Qz=[],e6=(e,t)=>i=>{e.push(i),lM||(lM=!0,t&&ts.$flags$&4?bre(uM):ts.raf(uM))},OC=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){s0(i)}e.length=0},uM=()=>{OC(cM),OC(Qz),(lM=cM.length>0)&&ts.raf(uM)},bre=e=>_re().then(e),lhe=e6(cM,!1),wre=e6(Qz,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.7.1
 */function LC(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>e.contains(Nz)||e.contains(zz)&&t?"dark":"light",r=u=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:u}})),s=u=>{a!==u&&r(u),a=u};let a=i();r(a),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",u=>s(u.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function xre(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?LC():document.addEventListener("DOMContentLoaded",()=>LC(),{once:!0}))}const Sre=xre;Sre();let t6;function Tre(){try{Cie(".")}catch{$ie(mo(fi(t6)))}}function vE(e){var i;const t=[];for(const r of Object.keys(e))customElements.get(`calcite-${r}`)||t.push((i=e[r])==null?void 0:i.call(e));return t.length>0?Promise.all(t):null}t6="components/assets";const i6=Symbol("widget"),r6=Symbol("widget-test-data"),Mre=[],Ire={},eb=new WeakMap;function s6(e,t){let i=t.children;if(i!=null&&i.length)for(let s=0;s<i.length;++s)i[s]=s6(e,i[s]);else i=Mre;const r=t.vnodeSelector;if(tb(r)){const s=t.properties||Ire,a=s.key||r;return{vnodeSelector:"div",properties:{key:a,afterCreate:Ere,afterUpdate:kre,afterRemoved:n6,parentWidget:e,widgetConstructor:r,widgetProperties:{...s,key:a,children:i}},children:void 0,text:void 0,domNode:null}}return t}function Ere(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:a}){var l;const u=new s(a);u.container=e,eb.set(e,u),(l=u.afterCreate)==null||l.call(u,u,e),r.addHandles(Ni(()=>n6(e))),queueMicrotask(()=>{u[r6].projector.renderNow()})}function kre(e,t,i,{widgetProperties:r}){var a;const s=eb.get(e);s&&(s.set(r),(a=s.afterUpdate)==null||a.call(s,s,e))}function n6(e){var i;const t=eb.get(e);t&&((i=t.afterRemoved)==null||i.call(t,t,e),t.destroy(),eb.delete(e))}function tb(e){return typeof e=="function"&&e[i6]}const o0={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",basemap:"esri-icon-basemap",bookmark:"esri-icon-bookmark",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",defaultAction:"esri-icon-default-action",description:"esri-icon-description",directions:"esri-icon-directions",dockBottom:"esri-icon-dock-bottom",dockLeft:"esri-icon-dock-left",dockRight:"esri-icon-dock-right",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",elevationProfile:"esri-icon-elevation-profile",environmentSettings:"esri-icon-environment-settings",erase:"esri-icon-erase",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",gear:"esri-icon-gear",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",home:"esri-icon-home",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layerList:"esri-icon-layer-list",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",lineOfSight:"esri-icon-line-of-sight",link:"esri-icon-link",linkExternal:"esri-icon-link-external",linkHorizontal:"esri-icon-link-horizontal",loadingIndicator:"esri-icon-loading-indicator",locate:"esri-icon-locate",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",maximize:"esri-icon-maximize",measure:"esri-icon-measure",measureArea:"esri-icon-measure-area",measureBuildingHeightShadow:"esri-icon-measure-building-height-shadow",measureLine:"esri-icon-measure-line",menu:"esri-icon-menu",minimize:"esri-icon-minimize",minus:"esri-icon-minus",nonVisible:"esri-icon-non-visible",northNavigation:"esri-icon-north-navigation",noticeTriangle:"esri-icon-notice-triangle",organization:"esri-icon-organization",pan:"esri-icon-pan",pan2:"esri-icon-pan2",partlyCloudy:"esri-icon-partly-cloudy",pause:"esri-icon-pause",play:"esri-icon-play",playCircled:"esri-icon-play-circled",plus:"esri-icon-plus",polyline:"esri-icon-polyline",printer:"esri-icon-printer",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",rotate:"esri-icon-rotate",save:"esri-icon-save",search:"esri-icon-search",settings2:"esri-icon-settings2",slice:"esri-icon-slice",swap:"esri-icon-swap",table:"esri-icon-table",timeClock:"esri-icon-time-clock",tracking:"esri-icon-tracking",trash:"esri-icon-trash",unlockedLinkHorizontal:"esri-icon-unlocked-link-horizontal",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",vertexGps:"esri-icon-vertex-gps",visible:"esri-icon-visible",zoomInFixed:"esri-icon-zoom-in-fixed",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomOutFixed:"esri-icon-zoom-out-fixed",zoomToObject:"esri-icon-zoom-to-object"},RC=new Set;function Are(e){RC.add(e),e.finally(()=>RC.delete(e))}var o6;const Pre="esri.widgets.Widget";let Cre=0;const $re={widgetIcon:o0.checkboxUnchecked};function a6(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?a6(e[i],t==null?void 0:t[i]):e[i]=t[i]);return e}const Ore=Aie({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,a,u)=>{const l=t==null?void 0:t(r,s,a,u),y=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in a)||y){const w=r[2].toLowerCase()+r.slice(3),I=R=>l==null?void 0:l.call(a,R);a.addEventListener(w,I,y);const E=()=>a.removeEventListener(w,I,y),A=u.afterRemoved;u.afterRemoved=R=>{A==null||A(R),E()}}return l}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:a}=r,u=s===Event.CAPTURING_PHASE;let l=`on${a}${u?"capture":""}`;const y=t.properties;(y&&l in y||(l=`on${a[0].toUpperCase()}${a.slice(1)}${u?"Capture":""}`,y&&l in y))&&(nR(),e.scheduleRender(),y[l].call(y.bind||i,r))}});let c2=!1,Or=class extends FM(Mu.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._projector=Ore,this._readyForTrueRender=!1,this.iconClass=$re.widgetIcon,this.icon=null,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=U8(async()=>{var u;if((u=this._messageBundleProps)!=null&&u.length){const l=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:y,propertyName:w})=>{if(this.destroyed)return;let I=await QM(y);this.uiStrings&&Object.keys(this.uiStrings)&&(I=a6(Ge(I),this.uiStrings)),this[w]=I}));if(this.destroyed)return;for(const y of l)y.status==="rejected"&&pt.getLogger(this).error("widget-intl:locale-error",this.declaredClass,y.reason)}await this.loadLocale()}),Tre();const i="esri-widget-uid-"+fE(),r=this.render.bind(this);this._trackingTarget=new cb(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const s=()=>{var I;if(!this._readyForTrueRender||this.destroyed)return null;const u=r();let l=u.properties;l||(u.properties=l={});const{key:y}=l;if(y||(l.key=i),tb(u.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${i}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?l.styles||(l.styles={}):(l.class="",l.styles={display:"none"}),l.styles.display||(l.styles.display="");let w=0;return(I=u.children)==null||I.forEach(E=>{if(tb(E.vnodeSelector))return;let{properties:A}=E;A||(E.properties=A={}),A.key||(A.key=`${this.id}--${w++}`)}),s6(this,u)};this.render=()=>{if(c2)return s();let u=iJ(this)??null;if(u)return u;this._trackingTarget.clear(),c2=!0;try{u=jl(this._trackingTarget,s)}catch(l){throw console.error(l),l}finally{c2=!1}return u&&rJ(this,u),u};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),Are(this._resourcesFetch)}normalizeCtorArgs(e,t){const i={...e};return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){var t;const e=this.loadDependencies();return(t=this._messageBundleProps)!=null&&t.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(pk):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Xi(this._trackingTarget),Xi(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,Rx(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return AI(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+Cre++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(o6=i6,r6)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Rx(this),this._projector.scheduleRender())}own(e){E$(pt.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return nJ.apply(this,e)}renderNow(){Rx(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this.addHandles(qt(()=>this.viewModel,(i,r)=>{r&&this.removeHandles("delegated-events"),i&&ab(i)&&this.addHandles(this._delegatedEventNames.map(s=>Vg(i,s,a=>{this.emit(s,a)})),"delegated-events")},Zo)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(pk),this.scheduleRender()};this.addHandles([JM(e),qt(()=>this.uiStrings,e),md(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var t;this._attached&&(this._projector.detach(this.render),this._attached=!1),(t=e==null?void 0:e.parentNode)==null||t.removeChild(e)}};Or[o6]=!0,v([M()],Or.prototype,"_readyForTrueRender",void 0),v([M({value:null})],Or.prototype,"container",null),v([es("container")],Or.prototype,"castContainer",null),v([M()],Or.prototype,"iconClass",void 0),v([M()],Or.prototype,"icon",void 0),v([M()],Or.prototype,"id",null),v([M()],Or.prototype,"label",null),v([M()],Or.prototype,"renderable",null),v([M()],Or.prototype,"uiStrings",void 0),v([M()],Or.prototype,"viewModel",void 0),v([M({value:!0})],Or.prototype,"visible",null),v([M()],Or.prototype,"key",void 0),v([M()],Or.prototype,"children",void 0),v([M()],Or.prototype,"afterCreate",void 0),v([M()],Or.prototype,"afterUpdate",void 0),v([M()],Or.prototype,"afterRemoved",void 0),Or=v([me(Pre)],Or);const Kb=Or,Lre=new Map;function Rre(e){return Lre.get(e)}function DC(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function Dre(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function oy(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function zre(e){return e.type==="bing-maps"}const xl=[];let Bp=class extends Pt{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new At,this.view=null,this._allLayerViewsChange=i=>{var s;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=(s=this.view)==null?void 0:s.allLayerViews;r&&(this.addHandles(r.map(a=>qt(()=>{var u;return[a.suspended,(u=a.layer)==null?void 0:u.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(a=>{a.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(a.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i!=null&&i.removed&&i.removed.forEach(a=>{this._pendingAttributions.delete(a),this._fetchedAttributionData.delete(a)}),this._updateAttributionItems()},this.addHandles([yd(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),md(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var t;return(t=this.view)!=null&&t.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,i=t==null?void 0:t.allLayerViews;if(xl.length=0,!t||!i)return void this._clear();i.forEach(s=>{var l,y;if(s.suspended||!((l=s.layer)!=null&&l.attributionVisible))return;const a=s.layer;if(DC(a,"user"))return void oy(xl,s,a.copyright);if(a.hasAttributionData){if(this._fetchedAttributionData.has(s)){const w=this._fetchedAttributionData.get(s);return void(w?oy(xl,s,this._getDynamicAttribution(w,t,a)):DC(a)&&oy(xl,s,a.copyright))}return void this._fetchAttributionData(s)}const u="portalItem"in a?(y=a.portalItem)==null?void 0:y.accessInformation:void 0;oy(xl,s,u||a.copyright)});const r=i.find(s=>{var a;return((a=s.layer)==null?void 0:a.type)==="integrated-mesh-3dtiles"});if(this.view&&r){const s=Rre(this.view);if(s){const a=s.getAttributionText();for(let u=0;u<a.length;++u)oy(xl,r,a[u])}}Dre(this.items,xl)&&(this.items.removeAll(),this.items.addMany(xl)),xl.length=0,this.notifyChange("state")}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const i=await BO(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const r=i.ok?this._createContributionIndex(i.value,zre(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,r)}this._updateAttributionItems()}_createContributionIndex(t,i){const r=t.contributors,s={};if(!r)return s;for(let a=0;a<r.length;a++){const u=r[a],l=u.coverageAreas;if(!l)return;for(const y of l){const w=y.bbox,I=y.zoomMin-(i&&y.zoomMin?1:0),E=y.zoomMax-(i&&y.zoomMax?1:0),A=new tr({xmin:w[1],ymin:w[0],xmax:w[3],ymax:w[2],spatialReference:si.WGS84}),R={extent:ed(A),attribution:u.attribution||"",score:y.score!=null?y.score:100,id:a};for(let G=I;G<=E;G++)s[G]??(s[G]=[]),s[G].push(R)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(t,i,r){var I;const{extent:s,scale:a}=i;let u=((I=r.tileInfo)==null?void 0:I.scaleToZoom(a))??0;if(u=Math.min(t.maxKey??0,Math.round(u)),!s||u==null||u<=-1)return"";const l=t[u],y=gb(s.center.clone().normalize(),i.spatialReference),w=new Set;return l?l.filter(E=>{const A=E.id,R=!w.has(A)&&y&&E.extent&&_b(E.extent,y);return R&&w.add(A),R}).sort((E,A)=>A.score-E.score||E.objectId-A.objectId).map(E=>E.attribution).join(", "):""}};v([M({readOnly:!0,type:At})],Bp.prototype,"items",void 0),v([M({readOnly:!0})],Bp.prototype,"state",null),v([M()],Bp.prototype,"view",void 0),Bp=v([me("esri.widgets.Attribution.AttributionViewModel")],Bp);const l6=Bp,Ba={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function Nre(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${String(t)}'`);return{value:Bre(e[t])}}}function Fre(e){const t=e==null?void 0:e.type;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function Bre(e){return function(t,...i){Fre(t)?uJ(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function Yb(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var jre=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},c6=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?c6(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=jre(s)),t.push(s))}},Vre=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return c6(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function Tn(e,t,...i){return typeof e!="function"||tb(e)?Vre(e,t,...i):e(t,...i)}function uhe(...e){return e}const bp="esri-attribution",lh={base:bp,poweredBy:`${bp}__powered-by`,sources:`${bp}__sources`,open:`${bp}--open`,sourcesOpen:`${bp}__sources--open`,link:`${bp}__link`,widgetIcon:o0.description};let Ps=class extends Kb{constructor(t,i){super(t,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.iconClass=lh.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new l6}initialize(){this.addHandles(yd(()=>{var t;return(t=this.viewModel)==null?void 0:t.items},"change",()=>this.scheduleRender()))}destroy(){var t;(t=this._resizeObserver)==null||t.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((t,i)=>(t.includes(i.text)||t.push(i.text),t),[]).join(this.itemDelimiter)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const t={[lh.open]:this._isOpen};return Tn("div",{bind:this,class:this.classes(lh.base,Ba.widget,t),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Tn("div",{class:lh.poweredBy},"Powered by"," ",Tn("a",{class:lh.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const t=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,a={[lh.sourcesOpen]:t,[Ba.interactive]:i};return Tn("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(lh.sources,a),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(t){this._prevSourceNodeHeight=t.clientWidth,this._resizeObserver.observe(t)}_checkSourceTextOverflow(t){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:a}=t,u=a>s,l=this._attributionTextOverflowed!==u;if(this._attributionTextOverflowed=u,l&&(i=!0),this._isOpen){const y=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,y&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};v([M()],Ps.prototype,"_isOpen",void 0),v([M()],Ps.prototype,"_isInteractive",null),v([M()],Ps.prototype,"_attributionTextOverflowed",void 0),v([M()],Ps.prototype,"_prevSourceNodeHeight",void 0),v([M({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ps.prototype,"attributionText",null),v([M()],Ps.prototype,"iconClass",void 0),v([M()],Ps.prototype,"icon",void 0),v([M()],Ps.prototype,"itemDelimiter",void 0),v([M()],Ps.prototype,"label",null),v([M(),Yb("esri/widgets/Attribution/t9n/Attribution")],Ps.prototype,"messages",void 0),v([M()],Ps.prototype,"view",null),v([M({type:l6})],Ps.prototype,"viewModel",void 0),v([Nre()],Ps.prototype,"_toggleState",null),Ps=v([me("esri.widgets.Attribution")],Ps);const Ure=Ps;function Gre(e){var t,i;return((t=e==null?void 0:e.spatialReference)==null?void 0:t.isWebMercator)||((i=e==null?void 0:e.spatialReference)==null?void 0:i.isGeographic)||!1}const qre=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return k$(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return v([M()],t.prototype,"goToOverride",void 0),v([M()],t.prototype,"view",void 0),t=v([me("esri.widgets.support.GoTo")],t),t},Hre="esri.widgets.CompassViewModel";let Lh=class extends qre(Pt){constructor(t){super(t),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(qt(()=>this.view,this._updateRotationWatcher,on))}destroy(){this.view=null}get canShowNorth(){return Gre(this.view)}get state(){var t;return!((t=this.view)!=null&&t.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var i,r;if(!((i=this.view)!=null&&i.ready))return;const t={};((r=this.view)==null?void 0:r.type)==="2d"?t.rotation=0:t.heading=0,this.callGoTo({target:t})}_updateForRotation(t){t!=null&&(this.orientation={z:t})}_updateForCamera(t){if(!t)return;const i=-t.heading;this.orientation={x:0,y:0,z:i}}_updateRotationWatcher(t){this.removeAllHandles(),t&&this.addHandles(t.type==="2d"?qt(()=>t==null?void 0:t.rotation,this._updateForRotation,on):qt(()=>t==null?void 0:t.camera,this._updateForCamera,on))}};v([M({readOnly:!0})],Lh.prototype,"canShowNorth",null),v([M()],Lh.prototype,"orientation",void 0),v([M({readOnly:!0})],Lh.prototype,"state",null),v([M()],Lh.prototype,"view",void 0),Lh=v([me(Hre)],Lh);const u6=Lh,zC="esri-compass",u2={base:zC,widgetIcon:o0.locateCircled,iconContainer:`${zC}__icon-container`};let Oa=class extends Kb{constructor(t,i){super(t,i),this.iconClass=u2.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new u6,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return vE({button:()=>it(()=>import("./calcite-button-DGVDwiim.js"),__vite__mapDeps([267,268,269,270,271,272,273,274,275,276,277,278])),icon:()=>it(()=>import("./calcite-icon-CutVJLmf.js"),__vite__mapDeps([279,277,269,270,276]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}reset(){return this.viewModel.reset()}render(){const{orientation:t,state:i}=this.viewModel,r=i==="rotation"?"arrow-up":"compass-needle",s=this.icon??r,{messages:a}=this;return Tn("div",{class:this.classes(u2.base,Ba.widget)},Tn("calcite-button",{class:Ba.widgetButton,disabled:i==="disabled",kind:"neutral",label:a.reset,onclick:this._reset,round:!0,scale:"s",title:a.reset},Tn("div",{"aria-hidden":"true",class:u2.iconContainer,title:a.reset},Tn("calcite-icon",{icon:s,scale:"m",styles:this._toRotationTransform(t)}))))}};v([M()],Oa.prototype,"goToOverride",null),v([M()],Oa.prototype,"iconClass",void 0),v([M()],Oa.prototype,"icon",void 0),v([M()],Oa.prototype,"label",null),v([M(),Yb("esri/widgets/Compass/t9n/Compass")],Oa.prototype,"messages",void 0),v([M()],Oa.prototype,"view",null),v([M({type:u6})],Oa.prototype,"viewModel",void 0),Oa=v([me("esri.widgets.Compass")],Oa);const Wre=Oa,NC="esri-navigation-toggle",h2={base:NC,widgetIcon:o0.pan2,isLayoutHorizontal:`${NC}--horizontal`};let jp=class extends Pt{constructor(t){super(t),this.navigationMode="pan",this.view=null}initialize(){this.addHandles(md(()=>{var t;return(t=this.view)==null?void 0:t.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var t,i;return(t=this.view)!=null&&t.ready&&((i=this.view)==null?void 0:i.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){var i;const t=(i=this.view)==null?void 0:i.inputManager;t&&(t.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};v([M({readOnly:!0})],jp.prototype,"state",null),v([M()],jp.prototype,"navigationMode",void 0),v([M()],jp.prototype,"view",void 0),jp=v([me("esri.widgets.NavigationToggleViewModel")],jp);const h6=jp;let La=class extends Kb{constructor(t,i){super(t,i),this.iconClass=h2.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new h6,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var s;const r=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan"?this._rotateButton:this._panButton;r==null||r.setFocus(),this.toggle()}}loadDependencies(){return vE({button:()=>it(()=>import("./calcite-button-DGVDwiim.js"),__vite__mapDeps([267,268,269,270,271,272,273,274,275,276,277,278]))})}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}set layout(t){t!=="horizontal"&&(t="vertical"),this._set("layout",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){var s,a;const t=((s=this.viewModel)==null?void 0:s.state)==="disabled",i=((a=this.viewModel)==null?void 0:a.navigationMode)==="pan",r=this.messages.toggle;return Tn("div",{class:this.classes(h2.base,Ba.widget,{[h2.isLayoutHorizontal]:this.layout==="horizontal"})},Tn("calcite-button",{afterCreate:u=>{this._panButton=u},appearance:i?"outline-fill":"solid",class:Ba.widgetButton,disabled:t,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),Tn("calcite-button",{afterCreate:u=>{this._rotateButton=u},appearance:i?"solid":"outline-fill",class:Ba.widgetButton,disabled:t,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};v([M()],La.prototype,"iconClass",void 0),v([M()],La.prototype,"icon",void 0),v([M()],La.prototype,"label",null),v([M({value:"vertical"})],La.prototype,"layout",null),v([M(),Yb("esri/widgets/NavigationToggle/t9n/NavigationToggle")],La.prototype,"messages",void 0),v([M()],La.prototype,"view",null),v([M({type:h6})],La.prototype,"viewModel",void 0),La=v([me("esri.widgets.NavigationToggle")],La);const Zre=La;let Rh=class extends Pt{get canZoomIn(){var i,r,s;if(!((i=this.view)==null?void 0:i.ready))return!1;const t=(s=(r=this.view)==null?void 0:r.constraints)==null?void 0:s.effectiveMaxScale;return t===0||this._scale>t}get canZoomOut(){var r;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const i=(r=e.constraints)==null?void 0:r.effectiveMinScale;return i===0||this._scale<i}get _scale(){var t,i,r;const e=(i=(t=this.view)==null?void 0:t.animation)==null?void 0:i.target;return(e&&"then"in e||e==null?void 0:e.scale)??((r=this.view)==null?void 0:r.scale)??0}};v([M({readOnly:!0})],Rh.prototype,"canZoomIn",null),v([M({readOnly:!0})],Rh.prototype,"canZoomOut",null),v([M()],Rh.prototype,"view",void 0),v([M()],Rh.prototype,"_scale",null),Rh=v([me("esri.widgets.Zoom.ZoomConditions2D")],Rh);const Jre=Rh;let Vp=class extends Pt{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};v([M({readOnly:!0})],Vp.prototype,"canZoomIn",null),v([M({readOnly:!0})],Vp.prototype,"canZoomOut",null),v([M()],Vp.prototype,"view",void 0),Vp=v([me("esri.widgets.Zoom.ZoomConditions3D")],Vp);const Kre=Vp;let Xc=class extends Pt{constructor(t){super(t)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var t;return this._zoomConditions!=null&&((t=this._zoomConditions)==null?void 0:t.canZoomOut)}get state(){var t;return(t=this.view)!=null&&t.ready?"ready":"disabled"}set view(t){t?t.type==="2d"?this._zoomConditions=new Jre({view:t}):t.type==="3d"&&(this._zoomConditions=new Kre({view:t})):this._zoomConditions=null,this._set("view",t)}zoomIn(){if(!this.canZoomIn)return;const t=this.view;t.type==="2d"?t.mapViewNavigation.zoomIn():fk(t.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const t=this.view;t.type==="2d"?t.mapViewNavigation.zoomOut():fk(t.goTo({zoomFactor:.5}))}};v([M()],Xc.prototype,"_zoomConditions",void 0),v([M()],Xc.prototype,"canZoomIn",null),v([M()],Xc.prototype,"canZoomOut",null),v([M({readOnly:!0})],Xc.prototype,"state",null),v([M()],Xc.prototype,"view",null),Xc=v([me("esri.widgets.Zoom.ZoomViewModel")],Xc);const d6=Xc,d2={base:"esri-zoom",widgetIcon:o0.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let Ra=class extends Kb{constructor(t,i){super(t,i),this.iconClass=d2.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new d6,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return vE({button:()=>it(()=>import("./calcite-button-DGVDwiim.js"),__vite__mapDeps([267,268,269,270,271,272,273,274,275,276,277,278]))})}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}set layout(t){t!=="horizontal"&&(t="vertical"),this._set("layout",t)}set view(t){this.viewModel.view=t}get view(){return this.viewModel.view}render(){const t={[d2.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:a}=this.messages;return Tn("div",{class:this.classes(d2.base,Ba.widget,t)},Tn("calcite-button",{class:Ba.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),Tn("calcite-button",{class:Ba.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:a,onclick:this.zoomOut,title:a}))}};v([M()],Ra.prototype,"iconClass",void 0),v([M()],Ra.prototype,"icon",void 0),v([M()],Ra.prototype,"label",null),v([M({value:"vertical"})],Ra.prototype,"layout",null),v([M(),Yb("esri/widgets/Zoom/t9n/Zoom")],Ra.prototype,"messages",void 0),v([M()],Ra.prototype,"view",null),v([M({type:d6})],Ra.prototype,"viewModel",void 0),Ra=v([me("esri.widgets.Zoom")],Ra);const Yre=Ra;function Xre(e){return(e==null?void 0:e.view)!==void 0}let Jv=class extends xie{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=t=>{this.components.forEach(i=>{const r=this._find(i),s=r==null?void 0:r.widget;Xre(s)&&(s.view=t)})},this._componentsWatcher=(t,i)=>{this._removeComponents(i),this._addComponents(t),this._adjustPadding(t)}}initialize(){this.addHandles([qt(()=>this.components,this._componentsWatcher,on),qt(()=>this.view,this._updateViewAwareWidgets,on)])}_add(e,t,i,r,s){let a=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;a=this._createComponent(e)}super._add(a,t,i,r,s)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);return new Zv({id:e,node:t})}_createWidget(e){const{view:t}=this;switch(e){case"attribution":return new Ure({view:t});case"compass":return new Wre({view:t});case"navigation-toggle":return new Zre({view:t});case"zoom":return new Yre({view:t})}}};v([M()],Jv.prototype,"components",void 0),Jv=v([me("esri.views.ui.DefaultUI")],Jv);const p6=Jv;let Kv=class extends p6{constructor(t){super(t),this.components=["attribution","zoom"]}};v([M()],Kv.prototype,"components",void 0),Kv=v([me("esri.views.ui.2d.DefaultUI2D")],Kv);const f6=Kv;function FC(e){return e!=null&&typeof e=="object"&&"declaredClass"in e&&e.declaredClass==="esri.WebMap"}var hM;let Yv=hM=class extends wt{constructor(e){super(e),this.color=new oi([0,0,0,1])}clone(){return new hM(Ge({color:this.color}))}};v([M({type:oi,json:{write:!0}})],Yv.prototype,"color",void 0),Yv=hM=v([me("esri.webmap.background.ColorBackground")],Yv);const Qre=Yv;let m6,y6,g6,_6,v6,b6;async function ese(){const[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,Stage:a}]=await Promise.all([it(()=>import("./webglDeps-BvTYyNSJ.js"),__vite__mapDeps([195,95,94,64,196,197])),it(()=>import("./mapViewDeps-Bg8apit_.js"),__vite__mapDeps([198,121,27,28,96,97,93,89,98,99,38,100,101,92,64,94,95,65,102,54,103,59,104,105,153,25,199,200,201,145,202,197,138,137,40,41,136,195,196,203,109,204,91,50,48,47,44,35,90,205,206,207,208,209,210,79,211,212,13,213,214,215,216,217,218,112,219]))]);y6=e,g6=t,_6=i,v6=r,b6=s,m6=a}let Nt=class extends cZ(FJ(MJ(xX))){constructor(e){super(e),this._magnifierView=null,this.stage=null,this._resolveWhenReady=[],this.rootLayerViews=new Sg({getCollections:()=>{var t,i;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:()=>null}),this.featuresTilingScheme=null,this.fullOpacity=1,this.goToManager=new qv({view:this}),this.graphicsView=null,this.stateManager=new Qs({constraints:new cz({view:this})}),this.stationaryManager=new qy,this.labelManager=null,this.mapViewNavigation=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.supersampleScreenshotsEnabled=!0,this.supportsGround=!1,this.frameTask=new eee(this),this.floors=new At,this.highlightOptions=new Az,this.inputManager=new Lte({view:this}),this.map=null,this.spatialReferenceLocked=!1,this.timeline=new Lz,this.type="2d",this.ui=new f6,this.test={takeScreenshot:async t=>rie(this._getScreenshotView(t),t)},this.padding={top:0,right:0,bottom:0,left:0},this.addHandles([qt(()=>this.viewpoint,()=>this.stationaryManager.flip(),gd),this.on("resize",t=>this.stateManager.resize(t.width,t.height))]),SW()}destroy(){this._set("preconditionsReady",!1),this.frameTask=Xi(this.frameTask),this.goToManager.destroy(),this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get graphicsTileStore(){return new Vte(this.featuresTilingScheme)}get constraintsInfo(){var i,r;const e=(i=this.defaultsFromMap)==null?void 0:i.tileInfo,t=this.spatialReference;return{lods:(r=e==null?void 0:e.spatialReference)!=null&&r.equals(t)?e.lods:null,spatialReference:t}}get state(){return this.stateManager.state}get initialExtentRequired(){var u;if(!this.stateManager)return!1;const{scale:e,constraints:t,center:i,viewpoint:r,extent:s}=this;let a=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&((u=this.map.initialViewProperties)!=null&&u.viewpoint))&&!s&&(t!=null&&t.effectiveLODs||(a=-1),(!i||e===0&&a===-1)&&((r==null?void 0:r.targetGeometry)==null||r.targetGeometry.type!=="extent"&&!r.scale))}get _defaultsFromMapSettings(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1},requiresExtentInSpatialReference:this.spatialReferenceLocked}}get typeSpecificPreconditionsReady(){const e=this._getDefaultViewpoint();if(!e)return!1;const t=e.targetGeometry,i=this.spatialReference;return L4(t.spatialReference,i)}set animation(e){const t=this._get("animation");if(e===t)return;if(t&&t.stop(),e!==this.animationManager.animation&&this.animationManager.stop(),!e||e.isFulfilled())return this._set("animation",null),void(this.frameTask.animationInProgress=!1);this._set("animation",e),this.frameTask.animationInProgress=!0;const i=()=>{var r;this.destroyed||(e===this._get("animation")&&(this._set("animation",null),(r=this.frameTask)==null||r.requestFrame()),this.frameTask.animationInProgress=!1)};e.when(i,i)}get background(){return FC(this.map)?this.map.initialViewProperties.background:null}set background(e){this._override("background",e)}get center(){var e;return((e=this.stateManager)==null?void 0:e.center)??null}set center(e){this.stateManager.center=e}get constraints(){var e;return(e=this.stateManager)==null?void 0:e.constraints}set constraints(e){e.view=this;const t=this.stateManager.constraints;this.stateManager.constraints=e,t==null||t.destroy()}get extent(){var e;return((e=this.stateManager)==null?void 0:e.extent)??null}set extent(e){this.stateManager.extent=e}get padding(){var e;return(e=this.stateManager)==null?void 0:e.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}get rendering(){var e;return((e=this.stage)==null?void 0:e.renderRequested)??!1}get resizeAlign(){return this.stateManager.resizeAlign}set resizeAlign(e){this.stateManager.resizeAlign=e}get resolution(){return this.stateManager.resolution??0}get rotation(){return this.stateManager.rotation??0}set rotation(e){const{rotationEnabled:t}=this.constraints;this.constraints.rotationEnabled=!0,this.stateManager.rotation=e,this.constraints.rotationEnabled=t}get scale(){var e;return((e=this.stateManager)==null?void 0:e.scale)??0}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing&&this.stationaryManager.stationary}get updating(){var t,i,r;const e=!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||this.layerViewManager.updating===!0||this.labelManager.updating===!0||this.graphicsView.updating===!0||this.allLayerViews.some(s=>!s.destroyed&&!("layerViews"in s)&&s.updating===!0));if(Ce("esri-2d-log-updating")){const s=this.allLayerViews.reduce((a,u)=>({...a,[`${u.layer.id}(${u.layer.type})`]:!u.destroyed&&!("layerViews"in u)&&u.updating}),{});console.log(`Updating MapView: ${e}
-> Null LayerViewManager: ${!this.layerViewManager}
-> Null LabelManager: ${!this.labelManager}
-> Null GraphicsView: ${!this.graphicsView}
-> layerViewManager.updating: ${(t=this.layerViewManager)==null?void 0:t.updating}
-> labelManager.updating: ${(i=this.labelManager)==null?void 0:i.updating}
-> graphicsView.updating: ${(r=this.graphicsView)==null?void 0:r.updating}
-> allLayerViews: ${JSON.stringify(s)}
`)}return e}get viewpoint(){return this.stateManager.viewpoint??null}set viewpoint(e){this.stateManager.viewpoint=e,this.frameTask.requestFrame()}get zoom(){return this.stateManager.zoom??-1}set zoom(e){this.stateManager.zoom=e}get navigating(){var e;return((e=this.mapViewNavigation)==null?void 0:e.interacting)??!1}goTo(e,t){return this.goToManager.goTo(e,t)}async hitTest(e,t){return Ute(this,e,t)}async takeScreenshot(e){return iie(this._getScreenshotView(e),e)}toMap(e){if(!this.ready)return null;const t=TD(e)?SD(this,e):e;return this.stateManager.toMap(t)}toScreen(e,t){return this.stateManager.toScreen(e,t)}on(e,t,i,r){return this.inputManager&&this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||null}getDefaultTimeZone(){return FC(this.map)?this.map.initialViewProperties.timeZone:null}hasLayerViewModule(e){return QP.hasLayerViewModule(e)}importLayerView(e){return QP.importLayerView(e)}pixelSizeAt(){return this.ready?this.resolution:(pt.getLogger(this).error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}async popupHitTest(e){var y;const t=this.toMap(e),i=await this.hitTest(e),r=this.allLayerViews.toArray().reverse(),s=new globalThis.Map(r.map(w=>[w.layer.uid,w])),a=[];let u=0,l=0;for(;u<i.results.length||l<r.length;){const w=i.results.at(u);if(w&&w.type!=="graphic"){++u;continue}const I=s.get((y=(w==null?void 0:w.layer)??(w==null?void 0:w.graphic.layer))==null?void 0:y.uid);if((!w||I)&&l<r.length&&r.at(l)!==I){const E=r.at(l);"fetchPopupFeaturesAtLocation"in E&&a.push({mapPoint:t,layerView:E}),++l}else w&&(a.push({graphic:w.graphic,layerView:I}),++u)}return{hits:a,location:t}}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}async validate(){let e=die(this.type);if(Ce("safari")&&Ce("safari")<9&&(e=new gt("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:Ce("safari")})),e!=null)throw pt.getLogger(this).warn("#validate()",e.message),e}loadAsyncDependencies(){return ese()}_getDefaultViewpoint(){var K;const{constraints:e,initialExtent:t,map:i,padding:r,size:s}=this;if(!e)return null;const a=i&&"initialViewProperties"in i?i.initialViewProperties:void 0,u=this.stateManager.getUserStartupOptions(this.size),l=a==null?void 0:a.viewpoint,y=((K=l==null?void 0:l.targetGeometry)==null?void 0:K.extent)??t,w=y==null?void 0:y.center,I=(l==null?void 0:l.rotation)??0,E=(l==null?void 0:l.scale)||y&&nf(y,[s[0]-r.left-r.right,s[1]-r.top-r.bottom]),A=u.center??w,R=u.rotation??I,G=u.scale??E;return A&&G?new Fa({targetGeometry:A,scale:G,rotation:R}):null}_startup(){var u;this.timeline.begin("MapView Startup");const e=this._getDefaultViewpoint();this.stateManager.startup(e,this.size,this.spatialReference,(u=this.defaultsFromMap.extent)==null?void 0:u.center),this.graphics.owner=this;const t=new m6(this.surface,{canvas:this.renderCanvas,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this.stage=t,this._magnifierView=new b6,this._magnifierView.magnifier=this.magnifier;const i=new _6({view:this});this._set("labelManager",i);const r=new QQ({view:this});this._set("animationManager",r);const s=new v6({view:this,animationManager:r});this._set("mapViewNavigation",s),this._setupSpatialReferenceDependentProperties(),this.addHandles([this.rootLayerViews.on("change",()=>this._updateStageChildren()),t.on("webgl-error",l=>this.fatalError=l.error),qt(()=>this.stationary,l=>t.stationary=l,Zo),qt(()=>this.background,l=>{t.backgroundColor=l==null?void 0:l.color,this._magnifierView.backgroundColor=l==null?void 0:l.color},Zo),qt(()=>this.magnifier,l=>this._magnifierView.magnifier=l,Zo),qt(()=>this.renderingOptions,l=>t.renderingOptions=l,Zo),qt(()=>this.highlightOptions,l=>t.highlightOptions=l,Zo),qt(()=>this.state.id,()=>t.state=this.state,Zo)],"map-view"),this._updateStageChildren();const a=this._resolveWhenReady;this._resolveWhenReady=[],a.forEach(l=>l(this)),this.timeline.end("MapView Startup"),this.frameTask.start(),this._set("ready",!0)}_teardown(){this._destroySpatialReferenceDependentProperties(),this.removeHandles("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animation=null,this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this.stage.destroy(),this.stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask.stop(),this.stationaryManager.clear(),this._set("ready",!1),this.stateManager.teardown()}_updateStageChildren(){this.stage.removeAllChildren(),this.rootLayerViews.forEach(t=>{this.stage.addChild(t.container)});const e=this.graphicsView;this.stage.addChild(e.container),this.stage.addChild(this._magnifierView)}_setupSpatialReferenceDependentProperties(){const e=new lee(aZ.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",e);const t=new y6({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new g6(e)});this._set("graphicsView",t)}_destroySpatialReferenceDependentProperties(){const e=this.graphicsView;this._set("graphicsView",null),e.destroy(),this._set("featuresTilingScheme",null)}_getScreenshotView(e){var a;const{allLayerViews:t,padding:i,size:r,stage:s}=this;return{allLayerViews:t,backgroundColor:e!=null&&e.ignoreBackground?null:(a=this.background)==null?void 0:a.color,padding:i,size:r,stage:s}}_spatialReferenceChanged(e){if(this.ready){this.frameTask.stop();for(const t of this.allLayerViews)t.processDetach();this._destroySpatialReferenceDependentProperties(),this.stateManager.changeSpatialReference(e),this.stage.state=this.state,this._setupSpatialReferenceDependentProperties();for(const t of this.allLayerViews)t.processAttach();this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}};Nt.type="2d",v([M({readOnly:!0})],Nt.prototype,"animationManager",void 0),v([M({constructOnly:!0})],Nt.prototype,"deactivatedWebGLExtensions",void 0),v([M({constructOnly:!0})],Nt.prototype,"debugWebGLExtensions",void 0),v([M({readOnly:!0})],Nt.prototype,"featuresTilingScheme",void 0),v([M({readOnly:!0})],Nt.prototype,"fullOpacity",void 0),v([M()],Nt.prototype,"goToManager",void 0),v([M({readOnly:!0})],Nt.prototype,"graphicsTileStore",null),v([M()],Nt.prototype,"graphicsView",void 0),v([M()],Nt.prototype,"stateManager",void 0),v([M()],Nt.prototype,"constraintsInfo",null),v([M({readOnly:!0})],Nt.prototype,"state",null),v([M()],Nt.prototype,"initialExtentRequired",null),v([M()],Nt.prototype,"labelManager",void 0),v([M({readOnly:!0})],Nt.prototype,"mapViewNavigation",void 0),v([M({constructOnly:!0})],Nt.prototype,"renderCanvas",void 0),v([M()],Nt.prototype,"renderingOptions",void 0),v([M({constructOnly:!0})],Nt.prototype,"supersampleScreenshotsEnabled",void 0),v([M({readOnly:!0})],Nt.prototype,"supportsGround",void 0),v([M()],Nt.prototype,"_defaultsFromMapSettings",null),v([M({readOnly:!0})],Nt.prototype,"typeSpecificPreconditionsReady",null),v([M()],Nt.prototype,"animation",null),v([M({type:Qre})],Nt.prototype,"background",null),v([M()],Nt.prototype,"center",null),v([M({type:cz})],Nt.prototype,"constraints",null),v([M()],Nt.prototype,"extent",null),v([M()],Nt.prototype,"floors",void 0),v([M({type:Az})],Nt.prototype,"highlightOptions",void 0),v([M({readOnly:!0})],Nt.prototype,"inputManager",void 0),v([M()],Nt.prototype,"map",void 0),v([M()],Nt.prototype,"padding",null),v([M({readOnly:!0})],Nt.prototype,"rendering",null),v([M()],Nt.prototype,"resizeAlign",null),v([M({readOnly:!0})],Nt.prototype,"resolution",null),v([M()],Nt.prototype,"rotation",null),v([M()],Nt.prototype,"scale",null),v([M({constructOnly:!0})],Nt.prototype,"spatialReferenceLocked",void 0),v([M()],Nt.prototype,"stationary",null),v([M({type:Lz,readOnly:!0})],Nt.prototype,"timeline",void 0),v([M({readOnly:!0})],Nt.prototype,"type",void 0),v([M({readOnly:!0})],Nt.prototype,"updating",null),v([M()],Nt.prototype,"viewpoint",null),v([M()],Nt.prototype,"zoom",null),v([M({readOnly:!0})],Nt.prototype,"navigating",null),v([M(),es(e=>e instanceof p6?e:hb(f6,e))],Nt.prototype,"ui",void 0),Nt=v([me("esri.views.MapView")],Nt);const tse=Nt;function ise(e){let t;return{c(){t=Vn("div"),Cs(t,"id","viewDiv"),Cs(t,"class","h-full")},m(i,r){yo(i,t,r)},p:Ds,i:Ds,o:Ds,d(i){i&&qn(t)}}}function rse(e){let t=t$(Yp);return pM(()=>{const i=new f5({basemap:"streets"}),r=new tse({container:"viewDiv",map:i,center:t.center,zoom:t.zoom});r.when(()=>{r.watch(["center","zoom"],()=>{Yp.set({center:[r.center.longitude,r.center.latitude],zoom:r.zoom})})});const s=Yp.subscribe(a=>{(r.center.longitude!==a.center[0]||r.center.latitude!==a.center[1]||r.zoom!==a.zoom)&&r.goTo({center:a.center,zoom:a.zoom})});return()=>{s()}}),[]}class sse extends Wa{constructor(t){super(),Ha(this,t,rse,ise,ra,{})}}const w6=Symbol.for("svelte-maplibre");function a0(){return zF(w6)}function nse(e){let t=new WeakMap;return i=>{var u;let r=t.get(i.originalEvent);if(r!==void 0)return r;let a=(u=i.target.queryRenderedFeatures(i.point).find(l=>{var y;return(y=e.get(l.layer.id))==null?void 0:y.interactive}))==null?void 0:u.layer.id;return t.set(i.originalEvent,a),a}}function ose(){let e=new Map;return DF(w6,{map:Qc(null),source:nx(null),layer:nx(null),popupTarget:nx(null),cluster:Qc(),loadedImages:Qc(new Set),minzoom:Qc(0),maxzoom:Qc(24),layerEvent:Qc(null),layerInfo:e,eventTopMost:nse(e)})}var ase=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lse(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var x6={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(e,t){(function(i,r){e.exports=r()})(ase,function(){var i={},r={};function s(u,l,y){if(r[u]=y,u==="index"){var w="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",I={};return r.shared(I),r.index(i,I),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([w],{type:"text/javascript"}))),i}}s("shared",["exports"],function(u){function l(c,n,h,p){return new(h||(h=Promise))(function(_,S){function T(L){try{$(p.next(L))}catch(z){S(z)}}function k(L){try{$(p.throw(L))}catch(z){S(z)}}function $(L){var z;L.done?_(L.value):(z=L.value,z instanceof h?z:new h(function(N){N(z)})).then(T,k)}$((p=p.apply(c,n||[])).next())})}function y(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var w=I;function I(c,n){this.x=c,this.y=n}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,n){return this.clone()._rotateAround(c,n)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var n=c.x-this.x,h=c.y-this.y;return n*n+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,n){return Math.atan2(this.x*n-this.y*c,this.x*c+this.y*n)},_matMult:function(c){var n=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=n,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var n=Math.cos(c),h=Math.sin(c),p=h*this.x+n*this.y;return this.x=n*this.x-h*this.y,this.y=p,this},_rotateAround:function(c,n){var h=Math.cos(c),p=Math.sin(c),_=n.y+p*(this.x-n.x)+h*(this.y-n.y);return this.x=n.x+h*(this.x-n.x)-p*(this.y-n.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(c){return c instanceof I?c:Array.isArray(c)?new I(c[0],c[1]):c};var E=y(w),A=R;function R(c,n,h,p){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=n,this.p2x=h,this.p2y=p}R.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,n){if(n===void 0&&(n=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,p=0;p<8;p++){var _=this.sampleCurveX(h)-c;if(Math.abs(_)<n)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=_/S}var T=0,k=1;for(h=c,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-c)<n));p++)c>_?T=h:k=h,h=.5*(k-T)+T;return h},solve:function(c,n){return this.sampleCurveY(this.solveCurveX(c,n))}};var G=y(A);let K,Y;function ae(){return K==null&&(K=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),K}function Te(){if(Y==null&&(Y=!1,ae())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let p=0;p<5*5;p++){const _=4*p;n.fillStyle=`rgb(${_},${_+1},${_+2})`,n.fillRect(p%5,Math.floor(p/5),1,1)}const h=n.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&h[p]!==p){Y=!0;break}}}return Y||!1}function _e(c,n,h,p){const _=new G(c,n,h,p);return function(S){return _.solve(S)}}const be=_e(.25,.1,.25,1);function ke(c,n,h){return Math.min(h,Math.max(n,c))}function Ae(c,n,h){const p=h-n,_=((c-n)%p+p)%p+n;return _===n?h:_}function Ve(c,...n){for(const h of n)for(const p in h)c[p]=h[p];return c}let Ze=1;function lt(c,n,h){const p={};for(const _ in c)p[_]=n.call(h||this,c[_],_,c);return p}function ct(c,n,h){const p={};for(const _ in c)n.call(h||this,c[_],_,c)&&(p[_]=c[_]);return p}function ut(c){return Array.isArray(c)?c.map(ut):typeof c=="object"&&c?lt(c,ut):c}const nt={};function It(c){nt[c]||(typeof console<"u"&&console.warn(c),nt[c]=!0)}function ht(c,n,h){return(h.y-c.y)*(n.x-c.x)>(n.y-c.y)*(h.x-c.x)}function hi(c){let n=0;for(let h,p,_=0,S=c.length,T=S-1;_<S;T=_++)h=c[_],p=c[T],n+=(p.x-h.x)*(h.y+p.y);return n}function Zi(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let gi=null;function Ut(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const ir="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ps(c,n,h,p,_){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(c,{timestamp:0});try{const T=S==null?void 0:S.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const k=T.startsWith("BGR"),$=new Uint8ClampedArray(p*_*4);if(yield S.copyTo($,function(L,z,N,V,H){const Z=4*Math.max(-z,0),Q=(Math.max(0,N)-N)*V*4+Z,se=4*V,le=Math.max(0,z),we=Math.max(0,N);return{rect:{x:le,y:we,width:Math.min(L.width,z+V)-le,height:Math.min(L.height,N+H)-we},layout:[{offset:Q,stride:se}]}}(c,n,h,p,_)),k)for(let L=0;L<$.length;L+=4){const z=$[L];$[L]=$[L+2],$[L+2]=z}return $}finally{S.close()}})}let Rr,_r;const cn="AbortError";function fs(){return new Error(cn)}const un={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function En(c){return un.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const is="global-dispatcher";class ms extends Error{constructor(n,h,p,_){super(`AJAXError: ${h} (${n}): ${p}`),this.status=n,this.statusText=h,this.url=p,this.body=_}}const He=()=>Zi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Kt=function(c,n){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const p=En(c.url);if(p)return p(c,n);if(Zi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:c,targetMapId:is},n)}if(!(/^file:/.test(h=c.url)||/^file:/.test(He())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,_){return l(this,void 0,void 0,function*(){const S=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:He(),signal:_.signal});p.type==="json"&&S.headers.set("Accept","application/json");const T=yield fetch(S);if(!T.ok){const L=yield T.blob();throw new ms(T.status,T.statusText,p.url,L)}let k;k=p.type==="arrayBuffer"||p.type==="image"?T.arrayBuffer():p.type==="json"?T.json():T.text();const $=yield k;if(_.signal.aborted)throw fs();return{data:$,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(c,n);if(Zi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:c,mustQueue:!0,targetMapId:is},n)}var h;return function(p,_){return new Promise((S,T)=>{const k=new XMLHttpRequest;k.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(k.responseType="arraybuffer");for(const $ in p.headers)k.setRequestHeader($,p.headers[$]);p.type==="json"&&(k.responseType="text",k.setRequestHeader("Accept","application/json")),k.withCredentials=p.credentials==="include",k.onerror=()=>{T(new Error(k.statusText))},k.onload=()=>{if(!_.signal.aborted)if((k.status>=200&&k.status<300||k.status===0)&&k.response!==null){let $=k.response;if(p.type==="json")try{$=JSON.parse(k.response)}catch(L){return void T(L)}S({data:$,cacheControl:k.getResponseHeader("Cache-Control"),expires:k.getResponseHeader("Expires")})}else{const $=new Blob([k.response],{type:k.getResponseHeader("Content-Type")});T(new ms(k.status,k.statusText,p.url,$))}},_.signal.addEventListener("abort",()=>{k.abort(),T(fs())}),k.send(p.body)})}(c,n)};function Pi(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const n=new URL(c),h=window.location;return n.protocol===h.protocol&&n.host===h.host}function zs(c,n,h){h[c]&&h[c].indexOf(n)!==-1||(h[c]=h[c]||[],h[c].push(n))}function oa(c,n,h){if(h&&h[c]){const p=h[c].indexOf(n);p!==-1&&h[c].splice(p,1)}}class aa{constructor(n,h={}){Ve(this,h),this.type=n}}class vr extends aa{constructor(n,h={}){super("error",Ve({error:n},h))}}class Ka{on(n,h){return this._listeners=this._listeners||{},zs(n,h,this._listeners),this}off(n,h){return oa(n,h,this._listeners),oa(n,h,this._oneTimeListeners),this}once(n,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},zs(n,h,this._oneTimeListeners),this):new Promise(p=>this.once(n,p))}fire(n,h){typeof n=="string"&&(n=new aa(n,h||{}));const p=n.type;if(this.listens(p)){n.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const k of _)k.call(this,n);const S=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const k of S)oa(p,k,this._oneTimeListeners),k.call(this,n);const T=this._eventedParent;T&&(Ve(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(n))}else n instanceof vr&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,h){return this._eventedParent=n,this._eventedParentData=h,this}}var $e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ya=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Cu(c,n){const h={};for(const p in c)p!=="ref"&&(h[p]=c[p]);return Ya.forEach(p=>{p in n&&(h[p]=n[p])}),h}function Qt(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let h=0;h<c.length;h++)if(!Qt(c[h],n[h]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const h in c)if(!Qt(c[h],n[h]))return!1;return!0}return c===n}function Dr(c,n){c.push(n)}function Kn(c,n,h){Dr(h,{command:"addSource",args:[c,n[c]]})}function ql(c,n,h){Dr(n,{command:"removeSource",args:[c]}),h[c]=!0}function Hl(c,n,h,p){ql(c,h,p),Kn(c,n,h)}function Wl(c,n,h){let p;for(p in c[h])if(Object.prototype.hasOwnProperty.call(c[h],p)&&p!=="data"&&!Qt(c[h][p],n[h][p]))return!1;for(p in n[h])if(Object.prototype.hasOwnProperty.call(n[h],p)&&p!=="data"&&!Qt(c[h][p],n[h][p]))return!1;return!0}function Xa(c,n,h,p,_,S){c=c||{},n=n||{};for(const T in c)Object.prototype.hasOwnProperty.call(c,T)&&(Qt(c[T],n[T])||h.push({command:S,args:[p,T,n[T],_]}));for(const T in n)Object.prototype.hasOwnProperty.call(n,T)&&!Object.prototype.hasOwnProperty.call(c,T)&&(Qt(c[T],n[T])||h.push({command:S,args:[p,T,n[T],_]}))}function Zl(c){return c.id}function $u(c,n){return c[n.id]=n,c}class We{constructor(n,h,p,_){this.message=(n?`${n}: `:"")+p,_&&(this.identifier=_),h!=null&&h.__line__&&(this.line=h.__line__)}}function Ns(c,...n){for(const h of n)for(const p in h)c[p]=h[p];return c}class ys extends Error{constructor(n,h){super(h),this.message=h,this.key=n}}class Ou{constructor(n,h=[]){this.parent=n,this.bindings={};for(const[p,_]of h)this.bindings[p]=_}concat(n){return new Ou(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Qa={kind:"null"},Ue={kind:"number"},Bt={kind:"string"},Lt={kind:"boolean"},zr={kind:"color"},hn={kind:"object"},Rt={kind:"value"},la={kind:"collator"},So={kind:"formatted"},ie={kind:"padding"},j={kind:"resolvedImage"},q={kind:"variableAnchorOffsetCollection"};function J(c,n){return{kind:"array",itemType:c,N:n}}function ee(c){if(c.kind==="array"){const n=ee(c.itemType);return typeof c.N=="number"?`array<${n}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${n}>`}return c.kind}const de=[Qa,Ue,Bt,Lt,zr,So,hn,J(Rt),ie,j,q];function pe(c,n){if(n.kind==="error")return null;if(c.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!pe(c.itemType,n.itemType))&&(typeof c.N!="number"||c.N===n.N))return null}else{if(c.kind===n.kind)return null;if(c.kind==="value"){for(const h of de)if(!pe(h,n))return null}}return`Expected ${ee(c)} but found ${ee(n)} instead.`}function ve(c,n){return n.some(h=>h.kind===c.kind)}function ue(c,n){return n.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}function Se(c,n){return c.kind==="array"&&n.kind==="array"?c.itemType.kind===n.itemType.kind&&typeof c.N=="number":c.kind===n.kind}const Ne=.96422,Oe=.82521,Re=4/29,ft=6/29,Et=3*ft*ft,xt=ft*ft*ft,ei=Math.PI/180,Ct=180/Math.PI;function Ci(c){return(c%=360)<0&&(c+=360),c}function xi([c,n,h,p]){let _,S;const T=Dt((.2225045*(c=rr(c))+.7168786*(n=rr(n))+.0606169*(h=rr(h)))/1);c===n&&n===h?_=S=T:(_=Dt((.4360747*c+.3850649*n+.1430804*h)/Ne),S=Dt((.0139322*c+.0971045*n+.7141733*h)/Oe));const k=116*T-16;return[k<0?0:k,500*(_-T),200*(T-S),p]}function rr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Dt(c){return c>xt?Math.pow(c,1/3):c/Et+Re}function Vi([c,n,h,p]){let _=(c+16)/116,S=isNaN(n)?_:_+n/500,T=isNaN(h)?_:_-h/200;return _=1*gs(_),S=Ne*gs(S),T=Oe*gs(T),[kr(3.1338561*S-1.6168667*_-.4906146*T),kr(-.9787684*S+1.9161415*_+.033454*T),kr(.0719453*S-.2289914*_+1.4052427*T),p]}function kr(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function gs(c){return c>ft?c*c*c:Et*(c-Re)}function Gr(c){return parseInt(c.padEnd(2,c),16)/255}function rs(c,n){return Fs(n?c/100:c,0,1)}function Fs(c,n,h){return Math.min(Math.max(n,c),h)}function c0(c){return!c.some(Number.isNaN)}const Qb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class di{constructor(n,h,p,_=1,S=!0){this.r=n,this.g=h,this.b=p,this.a=_,S||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[n,h,p,_]))}static parse(n){if(n instanceof di)return n;if(typeof n!="string")return;const h=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Qb[p];if(_){const[T,k,$]=_;return[T/255,k/255,$/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const T=p.length<6?1:2;let k=1;return[Gr(p.slice(k,k+=T)),Gr(p.slice(k,k+=T)),Gr(p.slice(k,k+=T)),Gr(p.slice(k,k+T)||"ff")]}if(p.startsWith("rgb")){const T=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[k,$,L,z,N,V,H,Z,Q,se,le,we]=T,ce=[z||" ",H||" ",se].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const ye=[L,V,Q].join(""),Le=ye==="%%%"?100:ye===""?255:0;if(Le){const De=[Fs(+$/Le,0,1),Fs(+N/Le,0,1),Fs(+Z/Le,0,1),le?rs(+le,we):1];if(c0(De))return De}}return}}const S=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[T,k,$,L,z,N,V,H,Z]=S,Q=[$||" ",z||" ",V].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const se=[+k,Fs(+L,0,100),Fs(+N,0,100),H?rs(+H,Z):1];if(c0(se))return function([le,we,ce,ye]){function Le(De){const et=(De+le/30)%12,dt=we*Math.min(ce,1-ce);return ce-dt*Math.max(-1,Math.min(et-3,9-et,1))}return le=Ci(le),we/=100,ce/=100,[Le(0),Le(8),Le(4),ye]}(se)}}}(n);return h?new di(...h,!1):void 0}get rgb(){const{r:n,g:h,b:p,a:_}=this,S=_||1/0;return this.overwriteGetter("rgb",[n/S,h/S,p/S,_])}get hcl(){return this.overwriteGetter("hcl",function(n){const[h,p,_,S]=xi(n),T=Math.sqrt(p*p+_*_);return[Math.round(1e4*T)?Ci(Math.atan2(_,p)*Ct):NaN,T,h,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",xi(this.rgb))}overwriteGetter(n,h){return Object.defineProperty(this,n,{value:h}),h}toString(){const[n,h,p,_]=this.rgb;return`rgba(${[n,h,p].map(S=>Math.round(255*S)).join(",")},${_})`}}di.black=new di(0,0,0,1),di.white=new di(1,1,1,1),di.transparent=new di(0,0,0,0),di.red=new di(1,0,0,1);class Lf{constructor(n,h,p){this.sensitivity=n?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,h){return this.collator.compare(n,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Rf{constructor(n,h,p,_,S){this.text=n,this.image=h,this.scale=p,this.fontStack=_,this.textColor=S}}class Bs{constructor(n){this.sections=n}static fromString(n){return new Bs([new Rf(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Bs?n:Bs.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class js{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof js)return n;if(typeof n=="number")return new js([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const h of n)if(typeof h!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new js(n)}}toString(){return JSON.stringify(this.values)}}const u0=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class qr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof qr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let h=0;h<n.length;h+=2){const p=n[h],_=n[h+1];if(typeof p!="string"||!u0.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new qr(n)}}toString(){return JSON.stringify(this.values)}}class dn{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new dn({name:n,available:!1}):null}}function h0(c,n,h,p){return typeof c=="number"&&c>=0&&c<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof h=="number"&&h>=0&&h<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[c,n,h,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[c,n,h,p]:[c,n,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ca(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof di||c instanceof Lf||c instanceof Bs||c instanceof js||c instanceof qr||c instanceof dn)return!0;if(Array.isArray(c)){for(const n of c)if(!ca(n))return!1;return!0}if(typeof c=="object"){for(const n in c)if(!ca(c[n]))return!1;return!0}return!1}function cr(c){if(c===null)return Qa;if(typeof c=="string")return Bt;if(typeof c=="boolean")return Lt;if(typeof c=="number")return Ue;if(c instanceof di)return zr;if(c instanceof Lf)return la;if(c instanceof Bs)return So;if(c instanceof js)return ie;if(c instanceof qr)return q;if(c instanceof dn)return j;if(Array.isArray(c)){const n=c.length;let h;for(const p of c){const _=cr(p);if(h){if(h===_)continue;h=Rt;break}h=_}return J(h||Rt,n)}return hn}function Lu(c){const n=typeof c;return c===null?"":n==="string"||n==="number"||n==="boolean"?String(c):c instanceof di||c instanceof Bs||c instanceof js||c instanceof qr||c instanceof dn?c.toString():JSON.stringify(c)}class el{constructor(n,h){this.type=n,this.value=h}static parse(n,h){if(n.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!ca(n[1]))return h.error("invalid value");const p=n[1];let _=cr(p);const S=h.expectedType;return _.kind!=="array"||_.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(_=S),new el(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ji{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const tl={string:Bt,number:Ue,boolean:Lt,object:hn};class kn{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");let p,_=1;const S=n[0];if(S==="array"){let k,$;if(n.length>2){const L=n[1];if(typeof L!="string"||!(L in tl)||L==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);k=tl[L],_++}else k=Rt;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return h.error('The length argument to "array" must be a positive integer literal',2);$=n[2],_++}p=J(k,$)}else{if(!tl[S])throw new Error(`Types doesn't contain name = ${S}`);p=tl[S]}const T=[];for(;_<n.length;_++){const k=h.parse(n[_],_,Rt);if(!k)return null;T.push(k)}return new kn(p,T)}evaluate(n){for(let h=0;h<this.args.length;h++){const p=this.args[h].evaluate(n);if(!pe(this.type,cr(p)))return p;if(h===this.args.length-1)throw new Ji(`Expected value to be of type ${ee(this.type)}, but found ${ee(cr(p))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Ed={"to-boolean":Lt,"to-color":zr,"to-number":Ue,"to-string":Bt};class Yn{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");const p=n[0];if(!Ed[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&n.length!==2)return h.error("Expected one argument.");const _=Ed[p],S=[];for(let T=1;T<n.length;T++){const k=h.parse(n[T],T,Rt);if(!k)return null;S.push(k)}return new Yn(_,S)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let h,p;for(const _ of this.args){if(h=_.evaluate(n),p=null,h instanceof di)return h;if(typeof h=="string"){const S=n.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(p=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:h0(h[0],h[1],h[2],h[3]),!p))return new di(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Ji(p||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const p of this.args){h=p.evaluate(n);const _=js.parse(h);if(_)return _}throw new Ji(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const p of this.args){h=p.evaluate(n);const _=qr.parse(h);if(_)return _}throw new Ji(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const p of this.args){if(h=p.evaluate(n),h===null)return 0;const _=Number(h);if(!isNaN(_))return _}throw new Ji(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Bs.fromString(Lu(this.args[0].evaluate(n)));case"resolvedImage":return dn.fromString(Lu(this.args[0].evaluate(n)));default:return Lu(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Df=["Unknown","Point","LineString","Polygon"];class Jl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Df[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let h=this._parseColorCache[n];return h||(h=this._parseColorCache[n]=di.parse(n)),h}}class ai{constructor(n,h,p=[],_,S=new Ou,T=[]){this.registry=n,this.path=p,this.key=p.map(k=>`[${k}]`).join(""),this.scope=S,this.errors=T,this.expectedType=_,this._isConstant=h}parse(n,h,p,_,S={}){return h?this.concat(h,p,_)._parse(n,S):this._parse(n,S)}_parse(n,h){function p(_,S,T){return T==="assert"?new kn(S,[_]):T==="coerce"?new Yn(S,[_]):_}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=n[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[_];if(S){let T=S.parse(n,this);if(!T)return null;if(this.expectedType){const k=this.expectedType,$=T.type;if(k.kind!=="string"&&k.kind!=="number"&&k.kind!=="boolean"&&k.kind!=="object"&&k.kind!=="array"||$.kind!=="value")if(k.kind!=="color"&&k.kind!=="formatted"&&k.kind!=="resolvedImage"||$.kind!=="value"&&$.kind!=="string")if(k.kind!=="padding"||$.kind!=="value"&&$.kind!=="number"&&$.kind!=="array")if(k.kind!=="variableAnchorOffsetCollection"||$.kind!=="value"&&$.kind!=="array"){if(this.checkSubtype(k,$))return null}else T=p(T,k,h.typeAnnotation||"coerce");else T=p(T,k,h.typeAnnotation||"coerce");else T=p(T,k,h.typeAnnotation||"coerce");else T=p(T,k,h.typeAnnotation||"assert")}if(!(T instanceof el)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const k=new Jl;try{T=new el(T.type,T.evaluate(k))}catch($){return this.error($.message),null}}return T}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,h,p){const _=typeof n=="number"?this.path.concat(n):this.path,S=p?this.scope.concat(p):this.scope;return new ai(this.registry,this._isConstant,_,h||null,S,this.errors)}error(n,...h){const p=`${this.key}${h.map(_=>`[${_}]`).join("")}`;this.errors.push(new ys(p,n))}checkSubtype(n,h){const p=pe(n,h);return p&&this.error(p),p}}class kd{constructor(n,h,p){this.type=la,this.locale=p,this.caseSensitive=n,this.diacriticSensitive=h}static parse(n,h){if(n.length!==2)return h.error("Expected one argument.");const p=n[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");const _=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Lt);if(!_)return null;const S=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Lt);if(!S)return null;let T=null;return p.locale&&(T=h.parse(p.locale,1,Bt),!T)?null:new kd(_,S,T)}evaluate(n){return new Lf(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}const Xn=8192;function zf(c,n){c[0]=Math.min(c[0],n[0]),c[1]=Math.min(c[1],n[1]),c[2]=Math.max(c[2],n[0]),c[3]=Math.max(c[3],n[1])}function Ru(c,n){return!(c[0]<=n[0]||c[2]>=n[2]||c[1]<=n[1]||c[3]>=n[3])}function d0(c,n){const h=(180+c[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,_=Math.pow(2,n.z);return[Math.round(h*_*Xn),Math.round(p*_*Xn)]}function ew(c,n,h){const p=c[0]-n[0],_=c[1]-n[1],S=c[0]-h[0],T=c[1]-h[1];return p*T-S*_==0&&p*S<=0&&_*T<=0}function Ad(c,n){let h=!1;for(let T=0,k=n.length;T<k;T++){const $=n[T];for(let L=0,z=$.length;L<z-1;L++){if(ew(c,$[L],$[L+1]))return!1;(_=$[L])[1]>(p=c)[1]!=(S=$[L+1])[1]>p[1]&&p[0]<(S[0]-_[0])*(p[1]-_[1])/(S[1]-_[1])+_[0]&&(h=!h)}}var p,_,S;return h}function p0(c,n){for(let h=0;h<n.length;h++)if(Ad(c,n[h]))return!0;return!1}function f0(c,n,h,p){const _=p[0]-h[0],S=p[1]-h[1],T=(c[0]-h[0])*S-_*(c[1]-h[1]),k=(n[0]-h[0])*S-_*(n[1]-h[1]);return T>0&&k<0||T<0&&k>0}function tw(c,n,h){for(const L of h)for(let z=0;z<L.length-1;++z)if((k=[(T=L[z+1])[0]-(S=L[z])[0],T[1]-S[1]])[0]*($=[(_=n)[0]-(p=c)[0],_[1]-p[1]])[1]-k[1]*$[0]!=0&&f0(p,_,S,T)&&f0(S,T,p,_))return!0;var p,_,S,T,k,$;return!1}function m0(c,n){for(let h=0;h<c.length;++h)if(!Ad(c[h],n))return!1;for(let h=0;h<c.length-1;++h)if(tw(c[h],c[h+1],n))return!1;return!0}function iw(c,n){for(let h=0;h<n.length;h++)if(m0(c,n[h]))return!0;return!1}function Pd(c,n,h){const p=[];for(let _=0;_<c.length;_++){const S=[];for(let T=0;T<c[_].length;T++){const k=d0(c[_][T],h);zf(n,k),S.push(k)}p.push(S)}return p}function Nf(c,n,h){const p=[];for(let _=0;_<c.length;_++){const S=Pd(c[_],n,h);p.push(S)}return p}function y0(c,n,h,p){if(c[0]<h[0]||c[0]>h[2]){const _=.5*p;let S=c[0]-h[0]>_?-p:h[0]-c[0]>_?p:0;S===0&&(S=c[0]-h[2]>_?-p:h[2]-c[0]>_?p:0),c[0]+=S}zf(n,c)}function g0(c,n,h,p){const _=Math.pow(2,p.z)*Xn,S=[p.x*Xn,p.y*Xn],T=[];for(const k of c)for(const $ of k){const L=[$.x+S[0],$.y+S[1]];y0(L,n,h,_),T.push(L)}return T}function Cd(c,n,h,p){const _=Math.pow(2,p.z)*Xn,S=[p.x*Xn,p.y*Xn],T=[];for(const $ of c){const L=[];for(const z of $){const N=[z.x+S[0],z.y+S[1]];zf(n,N),L.push(N)}T.push(L)}if(n[2]-n[0]<=_/2){(k=n)[0]=k[1]=1/0,k[2]=k[3]=-1/0;for(const $ of T)for(const L of $)y0(L,n,h,_)}var k;return T}class il{constructor(n,h){this.type=Lt,this.geojson=n,this.geometries=h}static parse(n,h){if(n.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(ca(n[1])){const p=n[1];if(p.type==="FeatureCollection"){const _=[];for(const S of p.features){const{type:T,coordinates:k}=S.geometry;T==="Polygon"&&_.push(k),T==="MultiPolygon"&&_.push(...k)}if(_.length)return new il(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new il(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new il(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(h,p){const _=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(p.type==="Polygon"){const k=Pd(p.coordinates,S,T),$=g0(h.geometry(),_,S,T);if(!Ru(_,S))return!1;for(const L of $)if(!Ad(L,k))return!1}if(p.type==="MultiPolygon"){const k=Nf(p.coordinates,S,T),$=g0(h.geometry(),_,S,T);if(!Ru(_,S))return!1;for(const L of $)if(!p0(L,k))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(h,p){const _=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(p.type==="Polygon"){const k=Pd(p.coordinates,S,T),$=Cd(h.geometry(),_,S,T);if(!Ru(_,S))return!1;for(const L of $)if(!m0(L,k))return!1}if(p.type==="MultiPolygon"){const k=Nf(p.coordinates,S,T),$=Cd(h.geometry(),_,S,T);if(!Ru(_,S))return!1;for(const L of $)if(!iw(L,k))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $d{constructor(n,h){this.type=h.type,this.name=n,this.boundExpression=h}static parse(n,h){if(n.length!==2||typeof n[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const p=n[1];return h.scope.has(p)?new $d(p,h.scope.get(p)):h.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class pn{constructor(n,h,p,_){this.name=n,this.type=h,this._evaluate=p,this.args=_}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,h){const p=n[0],_=pn.definitions[p];if(!_)return h.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(_)?_[0]:_.type,T=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,k=T.filter(([L])=>!Array.isArray(L)||L.length===n.length-1);let $=null;for(const[L,z]of k){$=new ai(h.registry,Du,h.path,null,h.scope);const N=[];let V=!1;for(let H=1;H<n.length;H++){const Z=n[H],Q=Array.isArray(L)?L[H-1]:L.type,se=$.parse(Z,1+N.length,Q);if(!se){V=!0;break}N.push(se)}if(!V)if(Array.isArray(L)&&L.length!==N.length)$.error(`Expected ${L.length} arguments, but found ${N.length} instead.`);else{for(let H=0;H<N.length;H++){const Z=Array.isArray(L)?L[H]:L.type,Q=N[H];$.concat(H+1).checkSubtype(Z,Q.type)}if($.errors.length===0)return new pn(p,S,z,N)}}if(k.length===1)h.errors.push(...$.errors);else{const L=(k.length?k:T).map(([N])=>{return V=N,Array.isArray(V)?`(${V.map(ee).join(", ")})`:`(${ee(V.type)}...)`;var V}).join(" | "),z=[];for(let N=1;N<n.length;N++){const V=h.parse(n[N],1+z.length);if(!V)return null;z.push(ee(V.type))}h.error(`Expected arguments of type ${L}, but found (${z.join(", ")}) instead.`)}return null}static register(n,h){pn.definitions=h;for(const p in h)n[p]=pn}}function Du(c){if(c instanceof $d)return Du(c.boundExpression);if(c instanceof pn&&c.name==="error"||c instanceof kd||c instanceof il)return!1;const n=c instanceof Yn||c instanceof kn;let h=!0;return c.eachChild(p=>{h=n?h&&Du(p):h&&p instanceof el}),!!h&&zu(c)&&Od(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function zu(c){if(c instanceof pn&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof il)return!1;let n=!0;return c.eachChild(h=>{n&&!zu(h)&&(n=!1)}),n}function Nu(c){if(c instanceof pn&&c.name==="feature-state")return!1;let n=!0;return c.eachChild(h=>{n&&!Nu(h)&&(n=!1)}),n}function Od(c,n){if(c instanceof pn&&n.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(p=>{h&&!Od(p,n)&&(h=!1)}),h}function Fu(c,n){const h=c.length-1;let p,_,S=0,T=h,k=0;for(;S<=T;)if(k=Math.floor((S+T)/2),p=c[k],_=c[k+1],p<=n){if(k===h||n<_)return k;S=k+1}else{if(!(p>n))throw new Ji("Input is not a number.");T=k-1}return 0}class Kl{constructor(n,h,p){this.type=n,this.input=h,this.labels=[],this.outputs=[];for(const[_,S]of p)this.labels.push(_),this.outputs.push(S)}static parse(n,h){if(n.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return h.error("Expected an even number of arguments.");const p=h.parse(n[1],1,Ue);if(!p)return null;const _=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let T=1;T<n.length;T+=2){const k=T===1?-1/0:n[T],$=n[T+1],L=T,z=T+1;if(typeof k!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(_.length&&_[_.length-1][0]>=k)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const N=h.parse($,z,S);if(!N)return null;S=S||N.type,_.push([k,N])}return new Kl(S,p,_)}evaluate(n){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(n);const _=this.input.evaluate(n);if(_<=h[0])return p[0].evaluate(n);const S=h.length;return _>=h[S-1]?p[S-1].evaluate(n):p[Fu(h,_)].evaluate(n)}eachChild(n){n(this.input);for(const h of this.outputs)n(h)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function rw(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var sw=_0;function _0(c,n,h,p){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=n,this.p2x=h,this.p2y=p}_0.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,n){if(n===void 0&&(n=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,p=0;p<8;p++){var _=this.sampleCurveX(h)-c;if(Math.abs(_)<n)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=_/S}var T=0,k=1;for(h=c,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-c)<n));p++)c>_?T=h:k=h,h=.5*(k-T)+T;return h},solve:function(c,n){return this.sampleCurveY(this.solveCurveX(c,n))}};var nw=rw(sw);function rl(c,n,h){return c+h*(n-c)}function Ld(c,n,h){return c.map((p,_)=>rl(p,n[_],h))}const Vs={number:rl,color:function(c,n,h,p="rgb"){switch(p){case"rgb":{const[_,S,T,k]=Ld(c.rgb,n.rgb,h);return new di(_,S,T,k,!1)}case"hcl":{const[_,S,T,k]=c.hcl,[$,L,z,N]=n.hcl;let V,H;if(isNaN(_)||isNaN($))isNaN(_)?isNaN($)?V=NaN:(V=$,T!==1&&T!==0||(H=L)):(V=_,z!==1&&z!==0||(H=S));else{let we=$-_;$>_&&we>180?we-=360:$<_&&_-$>180&&(we+=360),V=_+h*we}const[Z,Q,se,le]=function([we,ce,ye,Le]){return we=isNaN(we)?0:we*ei,Vi([ye,Math.cos(we)*ce,Math.sin(we)*ce,Le])}([V,H??rl(S,L,h),rl(T,z,h),rl(k,N,h)]);return new di(Z,Q,se,le,!1)}case"lab":{const[_,S,T,k]=Vi(Ld(c.lab,n.lab,h));return new di(_,S,T,k,!1)}}},array:Ld,padding:function(c,n,h){return new js(Ld(c.values,n.values,h))},variableAnchorOffsetCollection:function(c,n,h){const p=c.values,_=n.values;if(p.length!==_.length)throw new Ji(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${n.toString()}`);const S=[];for(let T=0;T<p.length;T+=2){if(p[T]!==_[T])throw new Ji(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${p[T]}, to[${T}]: ${_[T]}`);S.push(p[T]);const[k,$]=p[T+1],[L,z]=_[T+1];S.push([rl(k,L,h),rl($,z,h)])}return new qr(S)}};class ss{constructor(n,h,p,_,S){this.type=n,this.operator=h,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[T,k]of S)this.labels.push(T),this.outputs.push(k)}static interpolationFactor(n,h,p,_){let S=0;if(n.name==="exponential")S=Yl(h,n.base,p,_);else if(n.name==="linear")S=Yl(h,1,p,_);else if(n.name==="cubic-bezier"){const T=n.controlPoints;S=new nw(T[0],T[1],T[2],T[3]).solve(Yl(h,1,p,_))}return S}static parse(n,h){let[p,_,S,...T]=n;if(!Array.isArray(_)||_.length===0)return h.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const L=_[1];if(typeof L!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:L}}else{if(_[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const L=_.slice(1);if(L.length!==4||L.some(z=>typeof z!="number"||z<0||z>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:L}}}if(n.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,Ue),!S)return null;const k=[];let $=null;p==="interpolate-hcl"||p==="interpolate-lab"?$=zr:h.expectedType&&h.expectedType.kind!=="value"&&($=h.expectedType);for(let L=0;L<T.length;L+=2){const z=T[L],N=T[L+1],V=L+3,H=L+4;if(typeof z!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(k.length&&k[k.length-1][0]>=z)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const Z=h.parse(N,H,$);if(!Z)return null;$=$||Z.type,k.push([z,Z])}return Se($,Ue)||Se($,zr)||Se($,ie)||Se($,q)||Se($,J(Ue))?new ss($,p,_,S,k):h.error(`Type ${ee($)} is not interpolatable.`)}evaluate(n){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(n);const _=this.input.evaluate(n);if(_<=h[0])return p[0].evaluate(n);const S=h.length;if(_>=h[S-1])return p[S-1].evaluate(n);const T=Fu(h,_),k=ss.interpolationFactor(this.interpolation,_,h[T],h[T+1]),$=p[T].evaluate(n),L=p[T+1].evaluate(n);switch(this.operator){case"interpolate":return Vs[this.type.kind]($,L,k);case"interpolate-hcl":return Vs.color($,L,k,"hcl");case"interpolate-lab":return Vs.color($,L,k,"lab")}}eachChild(n){n(this.input);for(const h of this.outputs)n(h)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Yl(c,n,h,p){const _=p-h,S=c-h;return _===0?0:n===1?S/_:(Math.pow(n,S)-1)/(Math.pow(n,_)-1)}class ii{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expectected at least one argument.");let p=null;const _=h.expectedType;_&&_.kind!=="value"&&(p=_);const S=[];for(const k of n.slice(1)){const $=h.parse(k,1+S.length,p,void 0,{typeAnnotation:"omit"});if(!$)return null;p=p||$.type,S.push($)}if(!p)throw new Error("No output type");const T=_&&S.some(k=>pe(_,k.type));return new ii(T?Rt:p,S)}evaluate(n){let h,p=null,_=0;for(const S of this.args)if(_++,p=S.evaluate(n),p&&p instanceof dn&&!p.available&&(h||(h=p.name),p=null,_===this.args.length&&(p=h)),p!==null)break;return p}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}class Rd{constructor(n,h){this.type=h.type,this.bindings=[].concat(n),this.result=h}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const h of this.bindings)n(h[1]);n(this.result)}static parse(n,h){if(n.length<4)return h.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const p=[];for(let S=1;S<n.length-1;S+=2){const T=n[S];if(typeof T!="string")return h.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const k=h.parse(n[S+1],S+1);if(!k)return null;p.push([T,k])}const _=h.parse(n[n.length-1],n.length-1,h.expectedType,p);return _?new Rd(p,_):null}outputDefined(){return this.result.outputDefined()}}class Ff{constructor(n,h,p){this.type=n,this.index=h,this.input=p}static parse(n,h){if(n.length!==3)return h.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=h.parse(n[1],1,Ue),_=h.parse(n[2],2,J(h.expectedType||Rt));return p&&_?new Ff(_.type.itemType,p,_):null}evaluate(n){const h=this.index.evaluate(n),p=this.input.evaluate(n);if(h<0)throw new Ji(`Array index out of bounds: ${h} < 0.`);if(h>=p.length)throw new Ji(`Array index out of bounds: ${h} > ${p.length-1}.`);if(h!==Math.floor(h))throw new Ji(`Array index must be an integer, but found ${h} instead.`);return p[h]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class Bf{constructor(n,h){this.type=Lt,this.needle=n,this.haystack=h}static parse(n,h){if(n.length!==3)return h.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=h.parse(n[1],1,Rt),_=h.parse(n[2],2,Rt);return p&&_?ve(p.type,[Lt,Bt,Ue,Qa,Rt])?new Bf(p,_):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ee(p.type)} instead`):null}evaluate(n){const h=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!p)return!1;if(!ue(h,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${ee(cr(h))} instead.`);if(!ue(p,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${ee(cr(p))} instead.`);return p.indexOf(h)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Dd{constructor(n,h,p){this.type=Ue,this.needle=n,this.haystack=h,this.fromIndex=p}static parse(n,h){if(n.length<=2||n.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const p=h.parse(n[1],1,Rt),_=h.parse(n[2],2,Rt);if(!p||!_)return null;if(!ve(p.type,[Lt,Bt,Ue,Qa,Rt]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ee(p.type)} instead`);if(n.length===4){const S=h.parse(n[3],3,Ue);return S?new Dd(p,_,S):null}return new Dd(p,_)}evaluate(n){const h=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!ue(h,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${ee(cr(h))} instead.`);if(!ue(p,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${ee(cr(p))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(n);return p.indexOf(h,_)}return p.indexOf(h)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class jf{constructor(n,h,p,_,S,T){this.inputType=n,this.type=h,this.input=p,this.cases=_,this.outputs=S,this.otherwise=T}static parse(n,h){if(n.length<5)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return h.error("Expected an even number of arguments.");let p,_;h.expectedType&&h.expectedType.kind!=="value"&&(_=h.expectedType);const S={},T=[];for(let L=2;L<n.length-1;L+=2){let z=n[L];const N=n[L+1];Array.isArray(z)||(z=[z]);const V=h.concat(L);if(z.length===0)return V.error("Expected at least one branch label.");for(const Z of z){if(typeof Z!="number"&&typeof Z!="string")return V.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return V.error("Numeric branch labels must be integer values.");if(p){if(V.checkSubtype(p,cr(Z)))return null}else p=cr(Z);if(S[String(Z)]!==void 0)return V.error("Branch labels must be unique.");S[String(Z)]=T.length}const H=h.parse(N,L,_);if(!H)return null;_=_||H.type,T.push(H)}const k=h.parse(n[1],1,Rt);if(!k)return null;const $=h.parse(n[n.length-1],n.length-1,_);return $?k.type.kind!=="value"&&h.concat(1).checkSubtype(p,k.type)?null:new jf(p,_,k,S,T,$):null}evaluate(n){const h=this.input.evaluate(n);return(cr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class Vf{constructor(n,h,p){this.type=n,this.branches=h,this.otherwise=p}static parse(n,h){if(n.length<4)return h.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return h.error("Expected an odd number of arguments.");let p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);const _=[];for(let T=1;T<n.length-1;T+=2){const k=h.parse(n[T],T,Lt);if(!k)return null;const $=h.parse(n[T+1],T+1,p);if(!$)return null;_.push([k,$]),p=p||$.type}const S=h.parse(n[n.length-1],n.length-1,p);if(!S)return null;if(!p)throw new Error("Can't infer output type");return new Vf(p,_,S)}evaluate(n){for(const[h,p]of this.branches)if(h.evaluate(n))return p.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[h,p]of this.branches)n(h),n(p);n(this.otherwise)}outputDefined(){return this.branches.every(([n,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class zd{constructor(n,h,p,_){this.type=n,this.input=h,this.beginIndex=p,this.endIndex=_}static parse(n,h){if(n.length<=2||n.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const p=h.parse(n[1],1,Rt),_=h.parse(n[2],2,Ue);if(!p||!_)return null;if(!ve(p.type,[J(Rt),Bt,Rt]))return h.error(`Expected first argument to be of type array or string, but found ${ee(p.type)} instead`);if(n.length===4){const S=h.parse(n[3],3,Ue);return S?new zd(p.type,p,_,S):null}return new zd(p.type,p,_)}evaluate(n){const h=this.input.evaluate(n),p=this.beginIndex.evaluate(n);if(!ue(h,["string","array"]))throw new Ji(`Expected first argument to be of type array or string, but found ${ee(cr(h))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(n);return h.slice(p,_)}return h.slice(p)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function v0(c,n){return c==="=="||c==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function b0(c,n,h,p){return p.compare(n,h)===0}function Xl(c,n,h){const p=c!=="=="&&c!=="!=";return class S6{constructor(S,T,k){this.type=Lt,this.lhs=S,this.rhs=T,this.collator=k,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const k=S[0];let $=T.parse(S[1],1,Rt);if(!$)return null;if(!v0(k,$.type))return T.concat(1).error(`"${k}" comparisons are not supported for type '${ee($.type)}'.`);let L=T.parse(S[2],2,Rt);if(!L)return null;if(!v0(k,L.type))return T.concat(2).error(`"${k}" comparisons are not supported for type '${ee(L.type)}'.`);if($.type.kind!==L.type.kind&&$.type.kind!=="value"&&L.type.kind!=="value")return T.error(`Cannot compare types '${ee($.type)}' and '${ee(L.type)}'.`);p&&($.type.kind==="value"&&L.type.kind!=="value"?$=new kn(L.type,[$]):$.type.kind!=="value"&&L.type.kind==="value"&&(L=new kn($.type,[L])));let z=null;if(S.length===4){if($.type.kind!=="string"&&L.type.kind!=="string"&&$.type.kind!=="value"&&L.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(z=T.parse(S[3],3,la),!z)return null}return new S6($,L,z)}evaluate(S){const T=this.lhs.evaluate(S),k=this.rhs.evaluate(S);if(p&&this.hasUntypedArgument){const $=cr(T),L=cr(k);if($.kind!==L.kind||$.kind!=="string"&&$.kind!=="number")throw new Ji(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${$.kind}, ${L.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const $=cr(T),L=cr(k);if($.kind!=="string"||L.kind!=="string")return n(S,T,k)}return this.collator?h(S,T,k,this.collator.evaluate(S)):n(S,T,k)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const ow=Xl("==",function(c,n,h){return n===h},b0),aw=Xl("!=",function(c,n,h){return n!==h},function(c,n,h,p){return!b0(0,n,h,p)}),lw=Xl("<",function(c,n,h){return n<h},function(c,n,h,p){return p.compare(n,h)<0}),cw=Xl(">",function(c,n,h){return n>h},function(c,n,h,p){return p.compare(n,h)>0}),uw=Xl("<=",function(c,n,h){return n<=h},function(c,n,h,p){return p.compare(n,h)<=0}),hw=Xl(">=",function(c,n,h){return n>=h},function(c,n,h,p){return p.compare(n,h)>=0});class Uf{constructor(n,h,p,_,S){this.type=Bt,this.number=n,this.locale=h,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=S}static parse(n,h){if(n.length!==3)return h.error("Expected two arguments.");const p=h.parse(n[1],1,Ue);if(!p)return null;const _=n[2];if(typeof _!="object"||Array.isArray(_))return h.error("NumberFormat options argument must be an object.");let S=null;if(_.locale&&(S=h.parse(_.locale,1,Bt),!S))return null;let T=null;if(_.currency&&(T=h.parse(_.currency,1,Bt),!T))return null;let k=null;if(_["min-fraction-digits"]&&(k=h.parse(_["min-fraction-digits"],1,Ue),!k))return null;let $=null;return _["max-fraction-digits"]&&($=h.parse(_["max-fraction-digits"],1,Ue),!$)?null:new Uf(p,S,T,k,$)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class Nd{constructor(n){this.type=So,this.sections=n}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");const p=n[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");const _=[];let S=!1;for(let T=1;T<=n.length-1;++T){const k=n[T];if(S&&typeof k=="object"&&!Array.isArray(k)){S=!1;let $=null;if(k["font-scale"]&&($=h.parse(k["font-scale"],1,Ue),!$))return null;let L=null;if(k["text-font"]&&(L=h.parse(k["text-font"],1,J(Bt)),!L))return null;let z=null;if(k["text-color"]&&(z=h.parse(k["text-color"],1,zr),!z))return null;const N=_[_.length-1];N.scale=$,N.font=L,N.textColor=z}else{const $=h.parse(n[T],1,Rt);if(!$)return null;const L=$.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,_.push({content:$,scale:null,font:null,textColor:null})}}return new Nd(_)}evaluate(n){return new Bs(this.sections.map(h=>{const p=h.content.evaluate(n);return cr(p)===j?new Rf("",p,null,null,null):new Rf(Lu(p),null,h.scale?h.scale.evaluate(n):null,h.font?h.font.evaluate(n).join(","):null,h.textColor?h.textColor.evaluate(n):null)}))}eachChild(n){for(const h of this.sections)n(h.content),h.scale&&n(h.scale),h.font&&n(h.font),h.textColor&&n(h.textColor)}outputDefined(){return!1}}class Gf{constructor(n){this.type=j,this.input=n}static parse(n,h){if(n.length!==2)return h.error("Expected two arguments.");const p=h.parse(n[1],1,Bt);return p?new Gf(p):h.error("No image name provided.")}evaluate(n){const h=this.input.evaluate(n),p=dn.fromString(h);return p&&n.availableImages&&(p.available=n.availableImages.indexOf(h)>-1),p}eachChild(n){n(this.input)}outputDefined(){return!1}}class qf{constructor(n){this.type=Ue,this.input=n}static parse(n,h){if(n.length!==2)return h.error(`Expected 1 argument, but found ${n.length-1} instead.`);const p=h.parse(n[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${ee(p.type)} instead.`):new qf(p):null}evaluate(n){const h=this.input.evaluate(n);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Ji(`Expected value to be of type string or array, but found ${ee(cr(h))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Ql={"==":ow,"!=":aw,">":cw,"<":lw,">=":hw,"<=":uw,array:kn,at:Ff,boolean:kn,case:Vf,coalesce:ii,collator:kd,format:Nd,image:Gf,in:Bf,"index-of":Dd,interpolate:ss,"interpolate-hcl":ss,"interpolate-lab":ss,length:qf,let:Rd,literal:el,match:jf,number:kn,"number-format":Uf,object:kn,slice:zd,step:Kl,string:kn,"to-boolean":Yn,"to-color":Yn,"to-number":Yn,"to-string":Yn,var:$d,within:il};function w0(c,[n,h,p,_]){n=n.evaluate(c),h=h.evaluate(c),p=p.evaluate(c);const S=_?_.evaluate(c):1,T=h0(n,h,p,S);if(T)throw new Ji(T);return new di(n/255,h/255,p/255,S,!1)}function x0(c,n){return c in n}function Hf(c,n){const h=n[c];return h===void 0?null:h}function sl(c){return{type:c}}function S0(c){return{result:"success",value:c}}function ec(c){return{result:"error",value:c}}function tc(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function T0(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Wf(c){return!!c.expression&&c.expression.interpolated}function ri(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function ic(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function dw(c){return c}function M0(c,n){const h=n.type==="color",p=c.stops&&typeof c.stops[0][0]=="object",_=p||!(p||c.property!==void 0),S=c.type||(Wf(n)?"exponential":"interval");if(h||n.type==="padding"){const z=h?di.parse:js.parse;(c=Ns({},c)).stops&&(c.stops=c.stops.map(N=>[N[0],z(N[1])])),c.default=z(c.default?c.default:n.default)}if(c.colorSpace&&(T=c.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var T;let k,$,L;if(S==="exponential")k=I0;else if(S==="interval")k=sr;else if(S==="categorical"){k=pw,$=Object.create(null);for(const z of c.stops)$[z[0]]=z[1];L=typeof c.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);k=ti}if(p){const z={},N=[];for(let Z=0;Z<c.stops.length;Z++){const Q=c.stops[Z],se=Q[0].zoom;z[se]===void 0&&(z[se]={zoom:se,type:c.type,property:c.property,default:c.default,stops:[]},N.push(se)),z[se].stops.push([Q[0].value,Q[1]])}const V=[];for(const Z of N)V.push([z[Z].zoom,M0(z[Z],n)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:ss.interpolationFactor.bind(void 0,H),zoomStops:V.map(Z=>Z[0]),evaluate:({zoom:Z},Q)=>I0({stops:V,base:c.base},n,Z).evaluate(Z,Q)}}if(_){const z=S==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:ss.interpolationFactor.bind(void 0,z),zoomStops:c.stops.map(N=>N[0]),evaluate:({zoom:N})=>k(c,n,N,$,L)}}return{kind:"source",evaluate(z,N){const V=N&&N.properties?N.properties[c.property]:void 0;return V===void 0?Bu(c.default,n.default):k(c,n,V,$,L)}}}function Bu(c,n,h){return c!==void 0?c:n!==void 0?n:h!==void 0?h:void 0}function pw(c,n,h,p,_){return Bu(typeof h===_?p[h]:void 0,c.default,n.default)}function sr(c,n,h){if(ri(h)!=="number")return Bu(c.default,n.default);const p=c.stops.length;if(p===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[p-1][0])return c.stops[p-1][1];const _=Fu(c.stops.map(S=>S[0]),h);return c.stops[_][1]}function I0(c,n,h){const p=c.base!==void 0?c.base:1;if(ri(h)!=="number")return Bu(c.default,n.default);const _=c.stops.length;if(_===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[_-1][0])return c.stops[_-1][1];const S=Fu(c.stops.map(z=>z[0]),h),T=function(z,N,V,H){const Z=H-V,Q=z-V;return Z===0?0:N===1?Q/Z:(Math.pow(N,Q)-1)/(Math.pow(N,Z)-1)}(h,p,c.stops[S][0],c.stops[S+1][0]),k=c.stops[S][1],$=c.stops[S+1][1],L=Vs[n.type]||dw;return typeof k.evaluate=="function"?{evaluate(...z){const N=k.evaluate.apply(void 0,z),V=$.evaluate.apply(void 0,z);if(N!==void 0&&V!==void 0)return L(N,V,T,c.colorSpace)}}:L(k,$,T,c.colorSpace)}function ti(c,n,h){switch(n.type){case"color":h=di.parse(h);break;case"formatted":h=Bs.fromString(h.toString());break;case"resolvedImage":h=dn.fromString(h.toString());break;case"padding":h=js.parse(h);break;default:ri(h)===n.type||n.type==="enum"&&n.values[h]||(h=void 0)}return Bu(h,c.default,n.default)}pn.register(Ql,{error:[{kind:"error"},[Bt],(c,[n])=>{throw new Ji(n.evaluate(c))}],typeof:[Bt,[Rt],(c,[n])=>ee(cr(n.evaluate(c)))],"to-rgba":[J(Ue,4),[zr],(c,[n])=>{const[h,p,_,S]=n.evaluate(c).rgb;return[255*h,255*p,255*_,S]}],rgb:[zr,[Ue,Ue,Ue],w0],rgba:[zr,[Ue,Ue,Ue,Ue],w0],has:{type:Lt,overloads:[[[Bt],(c,[n])=>x0(n.evaluate(c),c.properties())],[[Bt,hn],(c,[n,h])=>x0(n.evaluate(c),h.evaluate(c))]]},get:{type:Rt,overloads:[[[Bt],(c,[n])=>Hf(n.evaluate(c),c.properties())],[[Bt,hn],(c,[n,h])=>Hf(n.evaluate(c),h.evaluate(c))]]},"feature-state":[Rt,[Bt],(c,[n])=>Hf(n.evaluate(c),c.featureState||{})],properties:[hn,[],c=>c.properties()],"geometry-type":[Bt,[],c=>c.geometryType()],id:[Rt,[],c=>c.id()],zoom:[Ue,[],c=>c.globals.zoom],"heatmap-density":[Ue,[],c=>c.globals.heatmapDensity||0],"line-progress":[Ue,[],c=>c.globals.lineProgress||0],accumulated:[Rt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Ue,sl(Ue),(c,n)=>{let h=0;for(const p of n)h+=p.evaluate(c);return h}],"*":[Ue,sl(Ue),(c,n)=>{let h=1;for(const p of n)h*=p.evaluate(c);return h}],"-":{type:Ue,overloads:[[[Ue,Ue],(c,[n,h])=>n.evaluate(c)-h.evaluate(c)],[[Ue],(c,[n])=>-n.evaluate(c)]]},"/":[Ue,[Ue,Ue],(c,[n,h])=>n.evaluate(c)/h.evaluate(c)],"%":[Ue,[Ue,Ue],(c,[n,h])=>n.evaluate(c)%h.evaluate(c)],ln2:[Ue,[],()=>Math.LN2],pi:[Ue,[],()=>Math.PI],e:[Ue,[],()=>Math.E],"^":[Ue,[Ue,Ue],(c,[n,h])=>Math.pow(n.evaluate(c),h.evaluate(c))],sqrt:[Ue,[Ue],(c,[n])=>Math.sqrt(n.evaluate(c))],log10:[Ue,[Ue],(c,[n])=>Math.log(n.evaluate(c))/Math.LN10],ln:[Ue,[Ue],(c,[n])=>Math.log(n.evaluate(c))],log2:[Ue,[Ue],(c,[n])=>Math.log(n.evaluate(c))/Math.LN2],sin:[Ue,[Ue],(c,[n])=>Math.sin(n.evaluate(c))],cos:[Ue,[Ue],(c,[n])=>Math.cos(n.evaluate(c))],tan:[Ue,[Ue],(c,[n])=>Math.tan(n.evaluate(c))],asin:[Ue,[Ue],(c,[n])=>Math.asin(n.evaluate(c))],acos:[Ue,[Ue],(c,[n])=>Math.acos(n.evaluate(c))],atan:[Ue,[Ue],(c,[n])=>Math.atan(n.evaluate(c))],min:[Ue,sl(Ue),(c,n)=>Math.min(...n.map(h=>h.evaluate(c)))],max:[Ue,sl(Ue),(c,n)=>Math.max(...n.map(h=>h.evaluate(c)))],abs:[Ue,[Ue],(c,[n])=>Math.abs(n.evaluate(c))],round:[Ue,[Ue],(c,[n])=>{const h=n.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[Ue,[Ue],(c,[n])=>Math.floor(n.evaluate(c))],ceil:[Ue,[Ue],(c,[n])=>Math.ceil(n.evaluate(c))],"filter-==":[Lt,[Bt,Rt],(c,[n,h])=>c.properties()[n.value]===h.value],"filter-id-==":[Lt,[Rt],(c,[n])=>c.id()===n.value],"filter-type-==":[Lt,[Bt],(c,[n])=>c.geometryType()===n.value],"filter-<":[Lt,[Bt,Rt],(c,[n,h])=>{const p=c.properties()[n.value],_=h.value;return typeof p==typeof _&&p<_}],"filter-id-<":[Lt,[Rt],(c,[n])=>{const h=c.id(),p=n.value;return typeof h==typeof p&&h<p}],"filter->":[Lt,[Bt,Rt],(c,[n,h])=>{const p=c.properties()[n.value],_=h.value;return typeof p==typeof _&&p>_}],"filter-id->":[Lt,[Rt],(c,[n])=>{const h=c.id(),p=n.value;return typeof h==typeof p&&h>p}],"filter-<=":[Lt,[Bt,Rt],(c,[n,h])=>{const p=c.properties()[n.value],_=h.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[Lt,[Rt],(c,[n])=>{const h=c.id(),p=n.value;return typeof h==typeof p&&h<=p}],"filter->=":[Lt,[Bt,Rt],(c,[n,h])=>{const p=c.properties()[n.value],_=h.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[Lt,[Rt],(c,[n])=>{const h=c.id(),p=n.value;return typeof h==typeof p&&h>=p}],"filter-has":[Lt,[Rt],(c,[n])=>n.value in c.properties()],"filter-has-id":[Lt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Lt,[J(Bt)],(c,[n])=>n.value.indexOf(c.geometryType())>=0],"filter-id-in":[Lt,[J(Rt)],(c,[n])=>n.value.indexOf(c.id())>=0],"filter-in-small":[Lt,[Bt,J(Rt)],(c,[n,h])=>h.value.indexOf(c.properties()[n.value])>=0],"filter-in-large":[Lt,[Bt,J(Rt)],(c,[n,h])=>function(p,_,S,T){for(;S<=T;){const k=S+T>>1;if(_[k]===p)return!0;_[k]>p?T=k-1:S=k+1}return!1}(c.properties()[n.value],h.value,0,h.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(c,[n,h])=>n.evaluate(c)&&h.evaluate(c)],[sl(Lt),(c,n)=>{for(const h of n)if(!h.evaluate(c))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(c,[n,h])=>n.evaluate(c)||h.evaluate(c)],[sl(Lt),(c,n)=>{for(const h of n)if(h.evaluate(c))return!0;return!1}]]},"!":[Lt,[Lt],(c,[n])=>!n.evaluate(c)],"is-supported-script":[Lt,[Bt],(c,[n])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(n.evaluate(c))}],upcase:[Bt,[Bt],(c,[n])=>n.evaluate(c).toUpperCase()],downcase:[Bt,[Bt],(c,[n])=>n.evaluate(c).toLowerCase()],concat:[Bt,sl(Rt),(c,n)=>n.map(h=>Lu(h.evaluate(c))).join("")],"resolved-locale":[Bt,[la],(c,[n])=>n.evaluate(c).resolvedLocale()]});class ju{constructor(n,h){var p;this.expression=n,this._warningHistory={},this._evaluator=new Jl,this._defaultValue=h?(p=h).type==="color"&&ic(p.default)?new di(0,0,0,0):p.type==="color"?di.parse(p.default)||null:p.type==="padding"?js.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?qr.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(n,h,p,_,S,T){return this._evaluator.globals=n,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(n,h,p,_,S,T){this._evaluator.globals=n,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map($=>JSON.stringify($)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}}}function Ii(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Ql}function Si(c,n){const h=new ai(Ql,Du,[],n?function(_){const S={color:zr,string:Bt,number:Ue,enum:Bt,boolean:Lt,formatted:So,padding:ie,resolvedImage:j,variableAnchorOffsetCollection:q};return _.type==="array"?J(S[_.value]||Rt,_.length):S[_.type]}(n):void 0),p=h.parse(c,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?S0(new ju(p,n)):ec(h.errors)}class rc{constructor(n,h){this.kind=n,this._styleExpression=h,this.isStateDependent=n!=="constant"&&!Nu(h.expression)}evaluateWithoutErrorHandling(n,h,p,_,S,T){return this._styleExpression.evaluateWithoutErrorHandling(n,h,p,_,S,T)}evaluate(n,h,p,_,S,T){return this._styleExpression.evaluate(n,h,p,_,S,T)}}class Fd{constructor(n,h,p,_){this.kind=n,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=n!=="camera"&&!Nu(h.expression),this.interpolationType=_}evaluateWithoutErrorHandling(n,h,p,_,S,T){return this._styleExpression.evaluateWithoutErrorHandling(n,h,p,_,S,T)}evaluate(n,h,p,_,S,T){return this._styleExpression.evaluate(n,h,p,_,S,T)}interpolationFactor(n,h,p){return this.interpolationType?ss.interpolationFactor(this.interpolationType,n,h,p):0}}function E0(c,n){const h=Si(c,n);if(h.result==="error")return h;const p=h.value.expression,_=zu(p);if(!_&&!tc(n))return ec([new ys("","data expressions not supported")]);const S=Od(p,["zoom"]);if(!S&&!T0(n))return ec([new ys("","zoom expressions not supported")]);const T=jd(p);return T||S?T instanceof ys?ec([T]):T instanceof ss&&!Wf(n)?ec([new ys("",'"interpolate" expressions cannot be used with this property')]):S0(T?new Fd(_?"camera":"composite",h.value,T.labels,T instanceof ss?T.interpolation:void 0):new rc(_?"constant":"source",h.value)):ec([new ys("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bd{constructor(n,h){this._parameters=n,this._specification=h,Ns(this,M0(this._parameters,this._specification))}static deserialize(n){return new Bd(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function jd(c){let n=null;if(c instanceof Rd)n=jd(c.result);else if(c instanceof ii){for(const h of c.args)if(n=jd(h),n)break}else(c instanceof Kl||c instanceof ss)&&c.input instanceof pn&&c.input.name==="zoom"&&(n=c);return n instanceof ys||c.eachChild(h=>{const p=jd(h);p instanceof ys?n=p:!n&&p?n=new ys("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&p&&n!==p&&(n=new ys("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function Zf(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const n of c.slice(1))if(!Zf(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const k0={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vd(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Zf(c)||(c=sc(c));const n=Si(c,k0);if(n.result==="error")throw new Error(n.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,_)=>n.value.evaluate(h,p,{},_),needGeometry:Jf(c)}}function A0(c,n){return c<n?-1:c>n?1:0}function Jf(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let n=1;n<c.length;n++)if(Jf(c[n]))return!0;return!1}function sc(c){if(!c)return!0;const n=c[0];return c.length<=1?n!=="any":n==="=="?Kf(c[1],c[2],"=="):n==="!="?Ud(Kf(c[1],c[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Kf(c[1],c[2],n):n==="any"?(h=c.slice(1),["any"].concat(h.map(sc))):n==="all"?["all"].concat(c.slice(1).map(sc)):n==="none"?["all"].concat(c.slice(1).map(sc).map(Ud)):n==="in"?P0(c[1],c.slice(2)):n==="!in"?Ud(P0(c[1],c.slice(2))):n==="has"?C0(c[1]):n==="!has"?Ud(C0(c[1])):n!=="within"||c;var h}function Kf(c,n,h){switch(c){case"$type":return[`filter-type-${h}`,n];case"$id":return[`filter-id-${h}`,n];default:return[`filter-${h}`,c,n]}}function P0(c,n){if(n.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(h=>typeof h!=typeof n[0])?["filter-in-large",c,["literal",n.sort(A0)]]:["filter-in-small",c,["literal",n]]}}function C0(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Ud(c){return["!",c]}function Yf(c){const n=typeof c;if(n==="number"||n==="boolean"||n==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let _="[";for(const S of c)_+=`${Yf(S)},`;return`${_}]`}const h=Object.keys(c).sort();let p="{";for(let _=0;_<h.length;_++)p+=`${JSON.stringify(h[_])}:${Yf(c[h[_]])},`;return`${p}}`}function fw(c){let n="";for(const h of Ya)n+=`/${Yf(c[h])}`;return n}function $0(c){const n=c.value;return n?[new We(c.key,n,"constants have been deprecated as of v8")]:[]}function Ki(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function ua(c){if(Array.isArray(c))return c.map(ua);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const n={};for(const h in c)n[h]=ua(c[h]);return n}return Ki(c)}function Us(c){const n=c.key,h=c.value,p=c.valueSpec||{},_=c.objectElementValidators||{},S=c.style,T=c.styleSpec,k=c.validateSpec;let $=[];const L=ri(h);if(L!=="object")return[new We(n,h,`object expected, ${L} found`)];for(const z in h){const N=z.split(".")[0],V=p[N]||p["*"];let H;if(_[N])H=_[N];else if(p[N])H=k;else if(_["*"])H=_["*"];else{if(!p["*"]){$.push(new We(n,h[z],`unknown property "${z}"`));continue}H=k}$=$.concat(H({key:(n&&`${n}.`)+z,value:h[z],valueSpec:V,style:S,styleSpec:T,object:h,objectKey:z,validateSpec:k},h))}for(const z in p)_[z]||p[z].required&&p[z].default===void 0&&h[z]===void 0&&$.push(new We(n,h,`missing required property "${z}"`));return $}function nc(c){const n=c.value,h=c.valueSpec,p=c.style,_=c.styleSpec,S=c.key,T=c.arrayElementValidator||c.validateSpec;if(ri(n)!=="array")return[new We(S,n,`array expected, ${ri(n)} found`)];if(h.length&&n.length!==h.length)return[new We(S,n,`array length ${h.length} expected, length ${n.length} found`)];if(h["min-length"]&&n.length<h["min-length"])return[new We(S,n,`array length at least ${h["min-length"]} expected, length ${n.length} found`)];let k={type:h.value,values:h.values};_.$version<7&&(k.function=h.function),ri(h.value)==="object"&&(k=h.value);let $=[];for(let L=0;L<n.length;L++)$=$.concat(T({array:n,arrayIndex:L,value:n[L],valueSpec:k,validateSpec:c.validateSpec,style:p,styleSpec:_,key:`${S}[${L}]`}));return $}function Xf(c){const n=c.key,h=c.value,p=c.valueSpec;let _=ri(h);return _==="number"&&h!=h&&(_="NaN"),_!=="number"?[new We(n,h,`number expected, ${_} found`)]:"minimum"in p&&h<p.minimum?[new We(n,h,`${h} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&h>p.maximum?[new We(n,h,`${h} is greater than the maximum value ${p.maximum}`)]:[]}function Qf(c){const n=c.valueSpec,h=Ki(c.value.type);let p,_,S,T={};const k=h!=="categorical"&&c.value.property===void 0,$=!k,L=ri(c.value.stops)==="array"&&ri(c.value.stops[0])==="array"&&ri(c.value.stops[0][0])==="object",z=Us({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(H){if(h==="identity")return[new We(H.key,H.value,'identity function may not have a "stops" property')];let Z=[];const Q=H.value;return Z=Z.concat(nc({key:H.key,value:Q,valueSpec:H.valueSpec,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:N})),ri(Q)==="array"&&Q.length===0&&Z.push(new We(H.key,Q,"array must have at least one stop")),Z},default:function(H){return H.validateSpec({key:H.key,value:H.value,valueSpec:n,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec})}}});return h==="identity"&&k&&z.push(new We(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||z.push(new We(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!Wf(c.valueSpec)&&z.push(new We(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&($&&!tc(c.valueSpec)?z.push(new We(c.key,c.value,"property functions not supported")):k&&!T0(c.valueSpec)&&z.push(new We(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!L||c.value.property!==void 0||z.push(new We(c.key,c.value,'"property" property is required')),z;function N(H){let Z=[];const Q=H.value,se=H.key;if(ri(Q)!=="array")return[new We(se,Q,`array expected, ${ri(Q)} found`)];if(Q.length!==2)return[new We(se,Q,`array length 2 expected, length ${Q.length} found`)];if(L){if(ri(Q[0])!=="object")return[new We(se,Q,`object expected, ${ri(Q[0])} found`)];if(Q[0].zoom===void 0)return[new We(se,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new We(se,Q,"object stop key must have value")];if(S&&S>Ki(Q[0].zoom))return[new We(se,Q[0].zoom,"stop zoom values must appear in ascending order")];Ki(Q[0].zoom)!==S&&(S=Ki(Q[0].zoom),_=void 0,T={}),Z=Z.concat(Us({key:`${se}[0]`,value:Q[0],valueSpec:{zoom:{}},validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Xf,value:V}}))}else Z=Z.concat(V({key:`${se}[0]`,value:Q[0],valueSpec:{},validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec},Q));return Ii(ua(Q[1]))?Z.concat([new We(`${se}[1]`,Q[1],"expressions are not allowed in function stops.")]):Z.concat(H.validateSpec({key:`${se}[1]`,value:Q[1],valueSpec:n,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec}))}function V(H,Z){const Q=ri(H.value),se=Ki(H.value),le=H.value!==null?H.value:Z;if(p){if(Q!==p)return[new We(H.key,le,`${Q} stop domain type must match previous stop domain type ${p}`)]}else p=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean")return[new We(H.key,le,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&h!=="categorical"){let we=`number expected, ${Q} found`;return tc(n)&&h===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(H.key,le,we)]}return h!=="categorical"||Q!=="number"||isFinite(se)&&Math.floor(se)===se?h!=="categorical"&&Q==="number"&&_!==void 0&&se<_?[new We(H.key,le,"stop domain values must appear in ascending order")]:(_=se,h==="categorical"&&se in T?[new We(H.key,le,"stop domain values must be unique")]:(T[se]=!0,[])):[new We(H.key,le,`integer expected, found ${se}`)]}}function oc(c){const n=(c.expressionContext==="property"?E0:Si)(ua(c.value),c.valueSpec);if(n.result==="error")return n.value.map(p=>new We(`${c.key}${p.key}`,c.value,p.message));const h=n.value.expression||n.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new We(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Nu(h))return[new We(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Nu(h))return[new We(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!Od(h,["zoom","feature-state"]))return[new We(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!zu(h))return[new We(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function nl(c){const n=c.key,h=c.value,p=c.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(Ki(h))===-1&&_.push(new We(n,h,`expected one of [${p.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(p.values).indexOf(Ki(h))===-1&&_.push(new We(n,h,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(h)} found`)),_}function ac(c){return Zf(ua(c.value))?oc(Ns({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Vu(c)}function Vu(c){const n=c.value,h=c.key;if(ri(n)!=="array")return[new We(h,n,`array expected, ${ri(n)} found`)];const p=c.styleSpec;let _,S=[];if(n.length<1)return[new We(h,n,"filter array must have at least 1 element")];switch(S=S.concat(nl({key:`${h}[0]`,value:n[0],valueSpec:p.filter_operator,style:c.style,styleSpec:c.styleSpec})),Ki(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Ki(n[1])==="$type"&&S.push(new We(h,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&S.push(new We(h,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=ri(n[1]),_!=="string"&&S.push(new We(`${h}[1]`,n[1],`string expected, ${_} found`)));for(let T=2;T<n.length;T++)_=ri(n[T]),Ki(n[1])==="$type"?S=S.concat(nl({key:`${h}[${T}]`,value:n[T],valueSpec:p.geometry_type,style:c.style,styleSpec:c.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&S.push(new We(`${h}[${T}]`,n[T],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let T=1;T<n.length;T++)S=S.concat(Vu({key:`${h}[${T}]`,value:n[T],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":_=ri(n[1]),n.length!==2?S.push(new We(h,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&S.push(new We(`${h}[1]`,n[1],`string expected, ${_} found`));break;case"within":_=ri(n[1]),n.length!==2?S.push(new We(h,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="object"&&S.push(new We(`${h}[1]`,n[1],`object expected, ${_} found`))}return S}function em(c,n){const h=c.key,p=c.validateSpec,_=c.style,S=c.styleSpec,T=c.value,k=c.objectKey,$=S[`${n}_${c.layerType}`];if(!$)return[];const L=k.match(/^(.*)-transition$/);if(n==="paint"&&L&&$[L[1]]&&$[L[1]].transition)return p({key:h,value:T,valueSpec:S.transition,style:_,styleSpec:S});const z=c.valueSpec||$[k];if(!z)return[new We(h,T,`unknown property "${k}"`)];let N;if(ri(T)==="string"&&tc(z)&&!z.tokens&&(N=/^{([^}]+)}$/.exec(T)))return[new We(h,T,`"${k}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const V=[];return c.layerType==="symbol"&&(k==="text-field"&&_&&!_.glyphs&&V.push(new We(h,T,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&ic(ua(T))&&Ki(T.type)==="identity"&&V.push(new We(h,T,'"text-font" does not support identity functions'))),V.concat(p({key:c.key,value:T,valueSpec:z,style:_,styleSpec:S,expressionContext:"property",propertyType:n,propertyKey:k}))}function Gd(c){return em(c,"paint")}function tm(c){return em(c,"layout")}function im(c){let n=[];const h=c.value,p=c.key,_=c.style,S=c.styleSpec;h.type||h.ref||n.push(new We(p,h,'either "type" or "ref" is required'));let T=Ki(h.type);const k=Ki(h.ref);if(h.id){const $=Ki(h.id);for(let L=0;L<c.arrayIndex;L++){const z=_.layers[L];Ki(z.id)===$&&n.push(new We(p,h.id,`duplicate layer id "${h.id}", previously used at line ${z.id.__line__}`))}}if("ref"in h){let $;["type","source","source-layer","filter","layout"].forEach(L=>{L in h&&n.push(new We(p,h[L],`"${L}" is prohibited for ref layers`))}),_.layers.forEach(L=>{Ki(L.id)===k&&($=L)}),$?$.ref?n.push(new We(p,h.ref,"ref cannot reference another ref layer")):T=Ki($.type):n.push(new We(p,h.ref,`ref layer "${k}" not found`))}else if(T!=="background")if(h.source){const $=_.sources&&_.sources[h.source],L=$&&Ki($.type);$?L==="vector"&&T==="raster"?n.push(new We(p,h.source,`layer "${h.id}" requires a raster source`)):L!=="raster-dem"&&T==="hillshade"?n.push(new We(p,h.source,`layer "${h.id}" requires a raster-dem source`)):L==="raster"&&T!=="raster"?n.push(new We(p,h.source,`layer "${h.id}" requires a vector source`)):L!=="vector"||h["source-layer"]?L==="raster-dem"&&T!=="hillshade"?n.push(new We(p,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!h.paint||!h.paint["line-gradient"]||L==="geojson"&&$.lineMetrics||n.push(new We(p,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new We(p,h,`layer "${h.id}" must specify a "source-layer"`)):n.push(new We(p,h.source,`source "${h.source}" not found`))}else n.push(new We(p,h,'missing required property "source"'));return n=n.concat(Us({key:p,value:h,valueSpec:S.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${p}.type`,value:h.type,valueSpec:S.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:h,objectKey:"type"}),filter:ac,layout:$=>Us({layer:h,key:$.key,value:$.value,style:$.style,styleSpec:$.styleSpec,validateSpec:$.validateSpec,objectElementValidators:{"*":L=>tm(Ns({layerType:T},L))}}),paint:$=>Us({layer:h,key:$.key,value:$.value,style:$.style,styleSpec:$.styleSpec,validateSpec:$.validateSpec,objectElementValidators:{"*":L=>Gd(Ns({layerType:T},L))}})}})),n}function Qn(c){const n=c.value,h=c.key,p=ri(n);return p!=="string"?[new We(h,n,`string expected, ${p} found`)]:[]}const O0={promoteId:function({key:c,value:n}){if(ri(n)==="string")return Qn({key:c,value:n});{const h=[];for(const p in n)h.push(...Qn({key:`${c}.${p}`,value:n[p]}));return h}}};function L0(c){const n=c.value,h=c.key,p=c.styleSpec,_=c.style,S=c.validateSpec;if(!n.type)return[new We(h,n,'"type" is required')];const T=Ki(n.type);let k;switch(T){case"vector":case"raster":return k=Us({key:h,value:n,valueSpec:p[`source_${T.replace("-","_")}`],style:c.style,styleSpec:p,objectElementValidators:O0,validateSpec:S}),k;case"raster-dem":return k=function($){var L;const z=(L=$.sourceName)!==null&&L!==void 0?L:"",N=$.value,V=$.styleSpec,H=V.source_raster_dem,Z=$.style;let Q=[];const se=ri(N);if(N===void 0)return Q;if(se!=="object")return Q.push(new We("source_raster_dem",N,`object expected, ${se} found`)),Q;const le=Ki(N.encoding)==="custom",we=["redFactor","greenFactor","blueFactor","baseShift"],ce=$.value.encoding?`"${$.value.encoding}"`:"Default";for(const ye in N)!le&&we.includes(ye)?Q.push(new We(ye,N[ye],`In "${z}": "${ye}" is only valid when "encoding" is set to "custom". ${ce} encoding found`)):H[ye]?Q=Q.concat($.validateSpec({key:ye,value:N[ye],valueSpec:H[ye],validateSpec:$.validateSpec,style:Z,styleSpec:V})):Q.push(new We(ye,N[ye],`unknown property "${ye}"`));return Q}({sourceName:h,value:n,style:c.style,styleSpec:p,validateSpec:S}),k;case"geojson":if(k=Us({key:h,value:n,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:S,objectElementValidators:O0}),n.cluster)for(const $ in n.clusterProperties){const[L,z]=n.clusterProperties[$],N=typeof L=="string"?[L,["accumulated"],["get",$]]:L;k.push(...oc({key:`${h}.${$}.map`,value:z,validateSpec:S,expressionContext:"cluster-map"})),k.push(...oc({key:`${h}.${$}.reduce`,value:N,validateSpec:S,expressionContext:"cluster-reduce"}))}return k;case"video":return Us({key:h,value:n,valueSpec:p.source_video,style:_,validateSpec:S,styleSpec:p});case"image":return Us({key:h,value:n,valueSpec:p.source_image,style:_,validateSpec:S,styleSpec:p});case"canvas":return[new We(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nl({key:`${h}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:S,styleSpec:p})}}function R0(c){const n=c.value,h=c.styleSpec,p=h.light,_=c.style;let S=[];const T=ri(n);if(n===void 0)return S;if(T!=="object")return S=S.concat([new We("light",n,`object expected, ${T} found`)]),S;for(const k in n){const $=k.match(/^(.*)-transition$/);S=S.concat($&&p[$[1]]&&p[$[1]].transition?c.validateSpec({key:k,value:n[k],valueSpec:h.transition,validateSpec:c.validateSpec,style:_,styleSpec:h}):p[k]?c.validateSpec({key:k,value:n[k],valueSpec:p[k],validateSpec:c.validateSpec,style:_,styleSpec:h}):[new We(k,n[k],`unknown property "${k}"`)])}return S}function D0(c){const n=c.value,h=c.styleSpec,p=h.sky,_=c.style,S=ri(n);if(n===void 0)return[];if(S!=="object")return[new We("sky",n,`object expected, ${S} found`)];let T=[];for(const k in n)T=T.concat(p[k]?Ar({key:k,value:n[k],valueSpec:p[k],style:_,styleSpec:h}):[new We(k,n[k],`unknown property "${k}"`)]);return T}function z0(c){const n=c.value,h=c.styleSpec,p=h.terrain,_=c.style;let S=[];const T=ri(n);if(n===void 0)return S;if(T!=="object")return S=S.concat([new We("terrain",n,`object expected, ${T} found`)]),S;for(const k in n)S=S.concat(p[k]?c.validateSpec({key:k,value:n[k],valueSpec:p[k],validateSpec:c.validateSpec,style:_,styleSpec:h}):[new We(k,n[k],`unknown property "${k}"`)]);return S}function Uu(c){let n=[];const h=c.value,p=c.key;if(Array.isArray(h)){const _=[],S=[];for(const T in h)h[T].id&&_.includes(h[T].id)&&n.push(new We(p,h,`all the sprites' ids must be unique, but ${h[T].id} is duplicated`)),_.push(h[T].id),h[T].url&&S.includes(h[T].url)&&n.push(new We(p,h,`all the sprites' URLs must be unique, but ${h[T].url} is duplicated`)),S.push(h[T].url),n=n.concat(Us({key:`${p}[${T}]`,value:h[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return n}return Qn({key:p,value:h})}const Gu={"*":()=>[],array:nc,boolean:function(c){const n=c.value,h=c.key,p=ri(n);return p!=="boolean"?[new We(h,n,`boolean expected, ${p} found`)]:[]},number:Xf,color:function(c){const n=c.key,h=c.value,p=ri(h);return p!=="string"?[new We(n,h,`color expected, ${p} found`)]:di.parse(String(h))?[]:[new We(n,h,`color expected, "${h}" found`)]},constants:$0,enum:nl,filter:ac,function:Qf,layer:im,object:Us,source:L0,light:R0,sky:D0,terrain:z0,string:Qn,formatted:function(c){return Qn(c).length===0?[]:oc(c)},resolvedImage:function(c){return Qn(c).length===0?[]:oc(c)},padding:function(c){const n=c.key,h=c.value;if(ri(h)==="array"){if(h.length<1||h.length>4)return[new We(n,h,`padding requires 1 to 4 values; ${h.length} values found`)];const p={type:"number"};let _=[];for(let S=0;S<h.length;S++)_=_.concat(c.validateSpec({key:`${n}[${S}]`,value:h[S],validateSpec:c.validateSpec,valueSpec:p}));return _}return Xf({key:n,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const n=c.key,h=c.value,p=ri(h),_=c.styleSpec;if(p!=="array"||h.length<1||h.length%2!=0)return[new We(n,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let T=0;T<h.length;T+=2)S=S.concat(nl({key:`${n}[${T}]`,value:h[T],valueSpec:_.layout_symbol["text-anchor"]})),S=S.concat(nc({key:`${n}[${T+1}]`,value:h[T+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:_}));return S},sprite:Uu};function Ar(c){const n=c.value,h=c.valueSpec,p=c.styleSpec;return c.validateSpec=Ar,h.expression&&ic(Ki(n))?Qf(c):h.expression&&Ii(ua(n))?oc(c):h.type&&Gu[h.type]?Gu[h.type](c):Us(Ns({},c,{valueSpec:h.type?p[h.type]:h}))}function lc(c){const n=c.value,h=c.key,p=Qn(c);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new We(h,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new We(h,n,'"glyphs" url must include a "{range}" token'))),p}function fn(c,n=$e){let h=[];return h=h.concat(Ar({key:"",value:c,valueSpec:n.$root,styleSpec:n,style:c,validateSpec:Ar,objectElementValidators:{glyphs:lc,"*":()=>[]}})),c.constants&&(h=h.concat($0({key:"constants",value:c.constants,style:c,styleSpec:n,validateSpec:Ar}))),N0(h)}function eo(c){return function(n){return c({...n,validateSpec:Ar})}}function N0(c){return[].concat(c).sort((n,h)=>n.line-h.line)}function _s(c){return function(...n){return N0(c.apply(this,n))}}fn.source=_s(eo(L0)),fn.sprite=_s(eo(Uu)),fn.glyphs=_s(eo(lc)),fn.light=_s(eo(R0)),fn.sky=_s(eo(D0)),fn.terrain=_s(eo(z0)),fn.layer=_s(eo(im)),fn.filter=_s(eo(ac)),fn.paintProperty=_s(eo(Gd)),fn.layoutProperty=_s(eo(tm));const cc=fn,rm=cc.light,mw=cc.paintProperty,sm=cc.layoutProperty;function F0(c,n){let h=!1;if(n&&n.length)for(const p of n)c.fire(new vr(new Error(p.message))),h=!0;return h}class To{constructor(n,h,p){const _=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const T=new Int32Array(this.arrayBuffer);n=T[0],this.d=(h=T[1])+2*(p=T[2]);for(let $=0;$<this.d*this.d;$++){const L=T[3+$],z=T[3+$+1];_.push(L===z?null:T.subarray(L,z))}const k=T[3+_.length+1];this.keys=T.subarray(T[3+_.length],k),this.bboxes=T.subarray(k),this.insert=this._insertReadonly}else{this.d=h+2*p;for(let T=0;T<this.d*this.d;T++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=n,this.padding=p,this.scale=h/n,this.uid=0;const S=p/h*n;this.min=-S,this.max=n+S}insert(n,h,p,_,S){this._forEachCell(h,p,_,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,h,p,_,S,T){this.cells[S].push(T)}query(n,h,p,_,S){const T=this.min,k=this.max;if(n<=T&&h<=T&&k<=p&&k<=_&&!S)return Array.prototype.slice.call(this.keys);{const $=[];return this._forEachCell(n,h,p,_,this._queryCell,$,{},S),$}}_queryCell(n,h,p,_,S,T,k,$){const L=this.cells[S];if(L!==null){const z=this.keys,N=this.bboxes;for(let V=0;V<L.length;V++){const H=L[V];if(k[H]===void 0){const Z=4*H;($?$(N[Z+0],N[Z+1],N[Z+2],N[Z+3]):n<=N[Z+2]&&h<=N[Z+3]&&p>=N[Z+0]&&_>=N[Z+1])?(k[H]=!0,T.push(z[H])):k[H]=!1}}}}_forEachCell(n,h,p,_,S,T,k,$){const L=this._convertToCellCoord(n),z=this._convertToCellCoord(h),N=this._convertToCellCoord(p),V=this._convertToCellCoord(_);for(let H=L;H<=N;H++)for(let Z=z;Z<=V;Z++){const Q=this.d*Z+H;if((!$||$(this._convertFromCellCoord(H),this._convertFromCellCoord(Z),this._convertFromCellCoord(H+1),this._convertFromCellCoord(Z+1)))&&S.call(this,n,h,p,_,Q,T,k,$))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,h=3+this.cells.length+1+1;let p=0;for(let T=0;T<this.cells.length;T++)p+=this.cells[T].length;const _=new Int32Array(h+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let S=h;for(let T=0;T<n.length;T++){const k=n[T];_[3+T]=S,_.set(k,S),S+=k.length}return _[3+n.length]=S,_.set(this.keys,S),S+=this.keys.length,_[3+n.length+1]=S,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer}static serialize(n,h){const p=n.toArrayBuffer();return h&&h.push(p),{buffer:p}}static deserialize(n){return new To(n.buffer)}}const ha={};function st(c,n,h={}){if(ha[c])throw new Error(`${c} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:c,writeable:!1}),ha[c]={klass:n,omit:h.omit||[],shallow:h.shallow||[]}}st("Object",Object),st("TransferableGridIndex",To),st("Color",di),st("Error",Error),st("AJAXError",ms),st("ResolvedImage",dn),st("StylePropertyFunction",Bd),st("StyleExpression",ju,{omit:["_evaluator"]}),st("ZoomDependentExpression",Fd),st("ZoomConstantExpression",rc),st("CompoundExpression",pn,{omit:["_evaluate"]});for(const c in Ql)Ql[c]._classRegistryKey||st(`Expression_${c}`,Ql[c]);function nm(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ol(c,n){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(nm(c)||Ut(c))return n&&n.push(c),c;if(ArrayBuffer.isView(c)){const h=c;return n&&n.push(h.buffer),h}if(c instanceof ImageData)return n&&n.push(c.data.buffer),c;if(Array.isArray(c)){const h=[];for(const p of c)h.push(ol(p,n));return h}if(typeof c=="object"){const h=c.constructor,p=h._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!ha[p])throw new Error(`${p} is not registered.`);const _=h.serialize?h.serialize(c,n):{};if(h.serialize){if(n&&_===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in c){if(!c.hasOwnProperty(S)||ha[p].omit.indexOf(S)>=0)continue;const T=c[S];_[S]=ha[p].shallow.indexOf(S)>=0?T:ol(T,n)}c instanceof Error&&(_.message=c.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(_.$name=p),_}throw new Error("can't serialize object of type "+typeof c)}function uc(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||nm(c)||Ut(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(uc);if(typeof c=="object"){const n=c.$name||"Object";if(!ha[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:h}=ha[n];if(!h)throw new Error(`can't deserialize unregistered class ${n}`);if(h.deserialize)return h.deserialize(c);const p=Object.create(h.prototype);for(const _ of Object.keys(c)){if(_==="$name")continue;const S=c[_];p[_]=ha[n].shallow.indexOf(_)>=0?S:uc(S)}return p}throw new Error("can't deserialize object of type "+typeof c)}class om{constructor(){this.first=!0}update(n,h){const p=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=p,!0))}}const tt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function qu(c){for(const n of c)if(Hd(n.charCodeAt(0)))return!0;return!1}function qd(c){for(const n of c)if(!B0(n.charCodeAt(0)))return!1;return!0}function B0(c){return!(tt.Arabic(c)||tt["Arabic Supplement"](c)||tt["Arabic Extended-A"](c)||tt["Arabic Presentation Forms-A"](c)||tt["Arabic Presentation Forms-B"](c))}function Hd(c){return!(c!==746&&c!==747&&(c<4352||!(tt["Bopomofo Extended"](c)||tt.Bopomofo(c)||tt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||tt["CJK Compatibility Ideographs"](c)||tt["CJK Compatibility"](c)||tt["CJK Radicals Supplement"](c)||tt["CJK Strokes"](c)||!(!tt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||tt["CJK Unified Ideographs Extension A"](c)||tt["CJK Unified Ideographs"](c)||tt["Enclosed CJK Letters and Months"](c)||tt["Hangul Compatibility Jamo"](c)||tt["Hangul Jamo Extended-A"](c)||tt["Hangul Jamo Extended-B"](c)||tt["Hangul Jamo"](c)||tt["Hangul Syllables"](c)||tt.Hiragana(c)||tt["Ideographic Description Characters"](c)||tt.Kanbun(c)||tt["Kangxi Radicals"](c)||tt["Katakana Phonetic Extensions"](c)||tt.Katakana(c)&&c!==12540||!(!tt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!tt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||tt["Unified Canadian Aboriginal Syllabics"](c)||tt["Unified Canadian Aboriginal Syllabics Extended"](c)||tt["Vertical Forms"](c)||tt["Yijing Hexagram Symbols"](c)||tt["Yi Syllables"](c)||tt["Yi Radicals"](c))))}function am(c){return!(Hd(c)||function(n){return!!(tt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||tt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||tt["Letterlike Symbols"](n)||tt["Number Forms"](n)||tt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||tt["Control Pictures"](n)&&n!==9251||tt["Optical Character Recognition"](n)||tt["Enclosed Alphanumerics"](n)||tt["Geometric Shapes"](n)||tt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||tt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||tt["CJK Symbols and Punctuation"](n)||tt.Katakana(n)||tt["Private Use Area"](n)||tt["CJK Compatibility Forms"](n)||tt["Small Form Variants"](n)||tt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(c))}function lm(c){return c>=1424&&c<=2303||tt["Arabic Presentation Forms-A"](c)||tt["Arabic Presentation Forms-B"](c)}function cm(c,n){return!(!n&&lm(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||tt.Khmer(c))}function j0(c){for(const n of c)if(lm(n.charCodeAt(0)))return!0;return!1}const al=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class $i{constructor(n,h){this.zoom=n,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new om,this.transition={})}isSupportedScript(n){return function(h,p){for(const _ of h)if(!cm(_.charCodeAt(0),p))return!1;return!0}(n,al.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,h=n-Math.floor(n),p=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}}}class Wd{constructor(n,h){this.property=n,this.value=h,this.expression=function(p,_){if(ic(p))return new Bd(p,_);if(Ii(p)){const S=E0(p,_);if(S.result==="error")throw new Error(S.value.map(T=>`${T.key}: ${T.message}`).join(", "));return S.value}{let S=p;return _.type==="color"&&typeof p=="string"?S=di.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(S=qr.parse(p)):S=js.parse(p),{kind:"constant",evaluate:()=>S}}}(h===void 0?n.specification.default:h,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,h,p){return this.property.possiblyEvaluate(this,n,h,p)}}class Zd{constructor(n){this.property=n,this.value=new Wd(n,void 0)}transitioned(n,h){return new hm(this.property,this.value,h,Ve({},n.transition,this.transition),n.now)}untransitioned(){return new hm(this.property,this.value,null,{},0)}}class um{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return ut(this._values[n].value.value)}setValue(n,h){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Zd(this._values[n].property)),this._values[n].value=new Wd(this._values[n].property,h===null?void 0:ut(h))}getTransition(n){return ut(this._values[n].transition)}setTransition(n,h){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Zd(this._values[n].property)),this._values[n].transition=ut(h)||void 0}serialize(){const n={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(n[h]=p);const _=this.getTransition(h);_!==void 0&&(n[`${h}-transition`]=_)}return n}transitioned(n,h){const p=new V0(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(n,h._values[_]);return p}untransitioned(){const n=new V0(this._properties);for(const h of Object.keys(this._values))n._values[h]=this._values[h].untransitioned();return n}}class hm{constructor(n,h,p,_,S){this.property=n,this.value=h,this.begin=S+_.delay||0,this.end=this.begin+_.duration||0,n.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(n,h,p){const _=n.now||0,S=this.value.possiblyEvaluate(n,h,p),T=this.prior;if(T){if(_>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(_<this.begin)return T.possiblyEvaluate(n,h,p);{const k=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(n,h,p),S,function($){if($<=0)return 0;if($>=1)return 1;const L=$*$,z=L*$;return 4*($<.5?z:3*($-L)+z-.75)}(k))}}return S}}class V0{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,h,p){const _=new Hu(this._properties);for(const S of Object.keys(this._values))_._values[S]=this._values[S].possiblyEvaluate(n,h,p);return _}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class yw{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return ut(this._values[n].value)}setValue(n,h){this._values[n]=new Wd(this._values[n].property,h===null?void 0:ut(h))}serialize(){const n={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(n[h]=p)}return n}possiblyEvaluate(n,h,p){const _=new Hu(this._properties);for(const S of Object.keys(this._values))_._values[S]=this._values[S].possiblyEvaluate(n,h,p);return _}}class An{constructor(n,h,p){this.property=n,this.value=h,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,h,p,_){return this.property.evaluate(this.value,this.parameters,n,h,p,_)}}class Hu{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class yt{constructor(n){this.specification=n}possiblyEvaluate(n,h){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(h)}interpolate(n,h,p){const _=Vs[this.specification.type];return _?_(n,h,p):n}}class bt{constructor(n,h){this.specification=n,this.overrides=h}possiblyEvaluate(n,h,p,_){return new An(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(h,null,{},p,_)}:n.expression,h)}interpolate(n,h,p){if(n.value.kind!=="constant"||h.value.kind!=="constant")return n;if(n.value.value===void 0||h.value.value===void 0)return new An(this,{kind:"constant",value:void 0},n.parameters);const _=Vs[this.specification.type];if(_){const S=_(n.value.value,h.value.value,p);return new An(this,{kind:"constant",value:S},n.parameters)}return n}evaluate(n,h,p,_,S,T){return n.kind==="constant"?n.value:n.evaluate(h,p,_,S,T)}}class ll extends bt{possiblyEvaluate(n,h,p,_){if(n.value===void 0)return new An(this,{kind:"constant",value:void 0},h);if(n.expression.kind==="constant"){const S=n.expression.evaluate(h,null,{},p,_),T=n.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(T,T,T,h);return new An(this,{kind:"constant",value:k},h)}if(n.expression.kind==="camera"){const S=this._calculate(n.expression.evaluate({zoom:h.zoom-1}),n.expression.evaluate({zoom:h.zoom}),n.expression.evaluate({zoom:h.zoom+1}),h);return new An(this,{kind:"constant",value:S},h)}return new An(this,n.expression,h)}evaluate(n,h,p,_,S,T){if(n.kind==="source"){const k=n.evaluate(h,p,_,S,T);return this._calculate(k,k,k,h)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(h.zoom)-1},p,_),n.evaluate({zoom:Math.floor(h.zoom)},p,_),n.evaluate({zoom:Math.floor(h.zoom)+1},p,_),h):n.value}_calculate(n,h,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:h}:{from:p,to:h}}interpolate(n){return n}}class dm{constructor(n){this.specification=n}possiblyEvaluate(n,h,p,_){if(n.value!==void 0){if(n.expression.kind==="constant"){const S=n.expression.evaluate(h,null,{},p,_);return this._calculate(S,S,S,h)}return this._calculate(n.expression.evaluate(new $i(Math.floor(h.zoom-1),h)),n.expression.evaluate(new $i(Math.floor(h.zoom),h)),n.expression.evaluate(new $i(Math.floor(h.zoom+1),h)),h)}}_calculate(n,h,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:h}:{from:p,to:h}}interpolate(n){return n}}class Wu{constructor(n){this.specification=n}possiblyEvaluate(n,h,p,_){return!!n.expression.evaluate(h,null,{},p,_)}interpolate(){return!1}}class vs{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in n){const p=n[h];p.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new Wd(p,void 0),S=this.defaultTransitionablePropertyValues[h]=new Zd(p);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate({})}}}st("DataDrivenProperty",bt),st("DataConstantProperty",yt),st("CrossFadedDataDrivenProperty",ll),st("CrossFadedProperty",dm),st("ColorRampProperty",Wu);const U0="-transition";class Pn extends Ka{constructor(n,h){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),h.layout&&(this._unevaluatedLayout=new yw(h.layout)),h.paint)){this._transitionablePaint=new um(h.paint);for(const p in n.paint)this.setPaintProperty(p,n.paint[p],{validate:!1});for(const p in n.layout)this.setLayoutProperty(p,n.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hu(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,h,p={}){h!=null&&this._validate(sm,`layers.${this.id}.layout.${n}`,n,h,p)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,h):this.visibility=h)}getPaintProperty(n){return n.endsWith(U0)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,h,p={}){if(h!=null&&this._validate(mw,`layers.${this.id}.paint.${n}`,n,h,p))return!1;if(n.endsWith(U0))return this._transitionablePaint.setTransition(n.slice(0,-11),h||void 0),!1;{const _=this._transitionablePaint._values[n],S=_.property.specification["property-type"]==="cross-faded-data-driven",T=_.value.isDataDriven(),k=_.value;this._transitionablePaint.setValue(n,h),this._handleSpecialPaintPropertyUpdate(n);const $=this._transitionablePaint._values[n].value;return $.isDataDriven()||T||S||this._handleOverridablePaintPropertyUpdate(n,k,$)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,h,p){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,h){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,h)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),ct(n,(h,p)=>!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length))}_validate(n,h,p,_,S={}){return(!S||S.validate!==!1)&&F0(this,n.call(cc,{key:h,layerType:this.type,objectKey:p,value:_,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const h=this.paint.get(n);if(h instanceof An&&tc(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const G0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hc{constructor(n,h){this._structArray=n,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ui{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,h){return n._trim(),h&&(n.isTransferred=!0,h.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const h=Object.create(this.prototype);return h.arrayBuffer=n.arrayBuffer,h.length=n.length,h.capacity=n.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function nr(c,n=1){let h=0,p=0;return{members:c.map(_=>{const S=G0[_.type].BYTES_PER_ELEMENT,T=h=q0(h,Math.max(n,S)),k=_.components||1;return p=Math.max(p,S),h+=S*k,{name:_.name,type:_.type,components:k,offset:T}}),size:q0(h,Math.max(p,n)),alignment:n}}function q0(c,n){return Math.ceil(c/n)*n}class Zu extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,h)}emplace(n,h,p){const _=2*n;return this.int16[_+0]=h,this.int16[_+1]=p,n}}Zu.prototype.bytesPerElement=4,st("StructArrayLayout2i4",Zu);class Jd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,h,p)}emplace(n,h,p,_){const S=3*n;return this.int16[S+0]=h,this.int16[S+1]=p,this.int16[S+2]=_,n}}Jd.prototype.bytesPerElement=6,st("StructArrayLayout3i6",Jd);class da extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,_){const S=this.length;return this.resize(S+1),this.emplace(S,n,h,p,_)}emplace(n,h,p,_,S){const T=4*n;return this.int16[T+0]=h,this.int16[T+1]=p,this.int16[T+2]=_,this.int16[T+3]=S,n}}da.prototype.bytesPerElement=8,st("StructArrayLayout4i8",da);class pm extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S,T){const k=this.length;return this.resize(k+1),this.emplace(k,n,h,p,_,S,T)}emplace(n,h,p,_,S,T,k){const $=6*n;return this.int16[$+0]=h,this.int16[$+1]=p,this.int16[$+2]=_,this.int16[$+3]=S,this.int16[$+4]=T,this.int16[$+5]=k,n}}pm.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",pm);class fm extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S,T){const k=this.length;return this.resize(k+1),this.emplace(k,n,h,p,_,S,T)}emplace(n,h,p,_,S,T,k){const $=4*n,L=8*n;return this.int16[$+0]=h,this.int16[$+1]=p,this.uint8[L+4]=_,this.uint8[L+5]=S,this.uint8[L+6]=T,this.uint8[L+7]=k,n}}fm.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",fm);class Ju extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,h)}emplace(n,h,p){const _=2*n;return this.float32[_+0]=h,this.float32[_+1]=p,n}}Ju.prototype.bytesPerElement=8,st("StructArrayLayout2f8",Ju);class mm extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S,T,k,$,L,z){const N=this.length;return this.resize(N+1),this.emplace(N,n,h,p,_,S,T,k,$,L,z)}emplace(n,h,p,_,S,T,k,$,L,z,N){const V=10*n;return this.uint16[V+0]=h,this.uint16[V+1]=p,this.uint16[V+2]=_,this.uint16[V+3]=S,this.uint16[V+4]=T,this.uint16[V+5]=k,this.uint16[V+6]=$,this.uint16[V+7]=L,this.uint16[V+8]=z,this.uint16[V+9]=N,n}}mm.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",mm);class Kd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S,T,k,$,L,z,N,V){const H=this.length;return this.resize(H+1),this.emplace(H,n,h,p,_,S,T,k,$,L,z,N,V)}emplace(n,h,p,_,S,T,k,$,L,z,N,V,H){const Z=12*n;return this.int16[Z+0]=h,this.int16[Z+1]=p,this.int16[Z+2]=_,this.int16[Z+3]=S,this.uint16[Z+4]=T,this.uint16[Z+5]=k,this.uint16[Z+6]=$,this.uint16[Z+7]=L,this.int16[Z+8]=z,this.int16[Z+9]=N,this.int16[Z+10]=V,this.int16[Z+11]=H,n}}Kd.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",Kd);class ym extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,h,p)}emplace(n,h,p,_){const S=3*n;return this.float32[S+0]=h,this.float32[S+1]=p,this.float32[S+2]=_,n}}ym.prototype.bytesPerElement=12,st("StructArrayLayout3f12",ym);class gm extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.uint32[1*n+0]=h,n}}gm.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",gm);class Mo extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S,T,k,$,L){const z=this.length;return this.resize(z+1),this.emplace(z,n,h,p,_,S,T,k,$,L)}emplace(n,h,p,_,S,T,k,$,L,z){const N=10*n,V=5*n;return this.int16[N+0]=h,this.int16[N+1]=p,this.int16[N+2]=_,this.int16[N+3]=S,this.int16[N+4]=T,this.int16[N+5]=k,this.uint32[V+3]=$,this.uint16[N+8]=L,this.uint16[N+9]=z,n}}Mo.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",Mo);class Yd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S,T){const k=this.length;return this.resize(k+1),this.emplace(k,n,h,p,_,S,T)}emplace(n,h,p,_,S,T,k){const $=6*n;return this.int16[$+0]=h,this.int16[$+1]=p,this.int16[$+2]=_,this.int16[$+3]=S,this.int16[$+4]=T,this.int16[$+5]=k,n}}Yd.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",Yd);class Ku extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S){const T=this.length;return this.resize(T+1),this.emplace(T,n,h,p,_,S)}emplace(n,h,p,_,S,T){const k=4*n,$=8*n;return this.float32[k+0]=h,this.float32[k+1]=p,this.float32[k+2]=_,this.int16[$+6]=S,this.int16[$+7]=T,n}}Ku.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",Ku);class Xd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p,_){const S=this.length;return this.resize(S+1),this.emplace(S,n,h,p,_)}emplace(n,h,p,_,S){const T=12*n,k=3*n;return this.uint8[T+0]=h,this.uint8[T+1]=p,this.float32[k+1]=_,this.float32[k+2]=S,n}}Xd.prototype.bytesPerElement=12,st("StructArrayLayout2ub2f12",Xd);class dc extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,h,p)}emplace(n,h,p,_){const S=3*n;return this.uint16[S+0]=h,this.uint16[S+1]=p,this.uint16[S+2]=_,n}}dc.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",dc);class _m extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S,T,k,$,L,z,N,V,H,Z,Q,se,le){const we=this.length;return this.resize(we+1),this.emplace(we,n,h,p,_,S,T,k,$,L,z,N,V,H,Z,Q,se,le)}emplace(n,h,p,_,S,T,k,$,L,z,N,V,H,Z,Q,se,le,we){const ce=24*n,ye=12*n,Le=48*n;return this.int16[ce+0]=h,this.int16[ce+1]=p,this.uint16[ce+2]=_,this.uint16[ce+3]=S,this.uint32[ye+2]=T,this.uint32[ye+3]=k,this.uint32[ye+4]=$,this.uint16[ce+10]=L,this.uint16[ce+11]=z,this.uint16[ce+12]=N,this.float32[ye+7]=V,this.float32[ye+8]=H,this.uint8[Le+36]=Z,this.uint8[Le+37]=Q,this.uint8[Le+38]=se,this.uint32[ye+10]=le,this.int16[ce+22]=we,n}}_m.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_m);class pc extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p,_,S,T,k,$,L,z,N,V,H,Z,Q,se,le,we,ce,ye,Le,De,et,dt,Qe,Xe,qe,ot){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,n,h,p,_,S,T,k,$,L,z,N,V,H,Z,Q,se,le,we,ce,ye,Le,De,et,dt,Qe,Xe,qe,ot)}emplace(n,h,p,_,S,T,k,$,L,z,N,V,H,Z,Q,se,le,we,ce,ye,Le,De,et,dt,Qe,Xe,qe,ot,Ke){const je=32*n,_t=16*n;return this.int16[je+0]=h,this.int16[je+1]=p,this.int16[je+2]=_,this.int16[je+3]=S,this.int16[je+4]=T,this.int16[je+5]=k,this.int16[je+6]=$,this.int16[je+7]=L,this.uint16[je+8]=z,this.uint16[je+9]=N,this.uint16[je+10]=V,this.uint16[je+11]=H,this.uint16[je+12]=Z,this.uint16[je+13]=Q,this.uint16[je+14]=se,this.uint16[je+15]=le,this.uint16[je+16]=we,this.uint16[je+17]=ce,this.uint16[je+18]=ye,this.uint16[je+19]=Le,this.uint16[je+20]=De,this.uint16[je+21]=et,this.uint16[je+22]=dt,this.uint32[_t+12]=Qe,this.float32[_t+13]=Xe,this.float32[_t+14]=qe,this.uint16[je+30]=ot,this.uint16[je+31]=Ke,n}}pc.prototype.bytesPerElement=64,st("StructArrayLayout8i15ui1ul2f2ui64",pc);class pa extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.float32[1*n+0]=h,n}}pa.prototype.bytesPerElement=4,st("StructArrayLayout1f4",pa);class vm extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,h,p)}emplace(n,h,p,_){const S=3*n;return this.uint16[6*n+0]=h,this.float32[S+1]=p,this.float32[S+2]=_,n}}vm.prototype.bytesPerElement=12,st("StructArrayLayout1ui2f12",vm);class Qd extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,h,p)}emplace(n,h,p,_){const S=4*n;return this.uint32[2*n+0]=h,this.uint16[S+2]=p,this.uint16[S+3]=_,n}}Qd.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",Qd);class cl extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,h)}emplace(n,h,p){const _=2*n;return this.uint16[_+0]=h,this.uint16[_+1]=p,n}}cl.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",cl);class bm extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.uint16[1*n+0]=h,n}}bm.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",bm);class wm extends Ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p,_){const S=this.length;return this.resize(S+1),this.emplace(S,n,h,p,_)}emplace(n,h,p,_,S){const T=4*n;return this.float32[T+0]=h,this.float32[T+1]=p,this.float32[T+2]=_,this.float32[T+3]=S,n}}wm.prototype.bytesPerElement=16,st("StructArrayLayout4f16",wm);class xm extends hc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new E(this.anchorPointX,this.anchorPointY)}}xm.prototype.size=20;class H0 extends Mo{get(n){return new xm(this,n)}}st("CollisionBoxArray",H0);class b extends hc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}b.prototype.size=48;class o extends _m{get(n){return new b(this,n)}}st("PlacedSymbolArray",o);class d extends hc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}d.prototype.size=64;class f extends pc{get(n){return new d(this,n)}}st("SymbolInstanceArray",f);class g extends pa{getoffsetX(n){return this.float32[1*n+0]}}st("GlyphOffsetArray",g);class x extends Jd{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}st("SymbolLineVertexArray",x);class P extends hc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}P.prototype.size=12;class C extends vm{get(n){return new P(this,n)}}st("TextAnchorOffsetArray",C);class O extends hc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}O.prototype.size=8;class D extends Qd{get(n){return new O(this,n)}}st("FeatureIndexArray",D);class F extends Zu{}class B extends Zu{}class W extends Zu{}class re extends pm{}class te extends fm{}class ne extends Ju{}class X extends mm{}class he extends Kd{}class Me extends ym{}class oe extends gm{}class ge extends Yd{}class Ie extends Xd{}class Ee extends dc{}class Pe extends cl{}const Be=nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ze}=Be;class Fe{constructor(n=[]){this.segments=n}prepareSegment(n,h,p,_){let S=this.segments[this.segments.length-1];return n>Fe.MAX_VERTEX_ARRAY_LENGTH&&It(`Max vertices per segment is ${Fe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!S||S.vertexLength+n>Fe.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==_)&&(S={vertexOffset:h.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},_!==void 0&&(S.sortKey=_),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const n of this.segments)for(const h in n.vaos)n.vaos[h].destroy()}static simpleSegment(n,h,p,_){return new Fe([{vertexOffset:n,primitiveOffset:h,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function rt(c,n){return 256*(c=ke(Math.floor(c),0,255))+ke(Math.floor(n),0,255)}Fe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",Fe);const $t=nr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Je={exports:{}},St={exports:{}};St.exports=function(c,n){var h,p,_,S,T,k,$,L;for(p=c.length-(h=3&c.length),_=n,T=3432918353,k=461845907,L=0;L<p;)$=255&c.charCodeAt(L)|(255&c.charCodeAt(++L))<<8|(255&c.charCodeAt(++L))<<16|(255&c.charCodeAt(++L))<<24,++L,_=27492+(65535&(S=5*(65535&(_=(_^=$=(65535&($=($=(65535&$)*T+((($>>>16)*T&65535)<<16)&4294967295)<<15|$>>>17))*k+((($>>>16)*k&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch($=0,h){case 3:$^=(255&c.charCodeAt(L+2))<<16;case 2:$^=(255&c.charCodeAt(L+1))<<8;case 1:_^=$=(65535&($=($=(65535&($^=255&c.charCodeAt(L)))*T+((($>>>16)*T&65535)<<16)&4294967295)<<15|$>>>17))*k+((($>>>16)*k&65535)<<16)&4294967295}return _^=c.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var zt=St.exports,Yt={exports:{}};Yt.exports=function(c,n){for(var h,p=c.length,_=n^p,S=0;p>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(S)|(255&c.charCodeAt(++S))<<8|(255&c.charCodeAt(++S))<<16|(255&c.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++S;switch(p){case 3:_^=(255&c.charCodeAt(S+2))<<16;case 2:_^=(255&c.charCodeAt(S+1))<<8;case 1:_=1540483477*(65535&(_^=255&c.charCodeAt(S)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var kt=zt,jt=Yt.exports;Je.exports=kt,Je.exports.murmur3=kt,Je.exports.murmur2=jt;var Vt=y(Je.exports);class Fi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,h,p,_){this.ids.push(Ti(n)),this.positions.push(h,p,_)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Ti(n);let p=0,_=this.ids.length-1;for(;p<_;){const T=p+_>>1;this.ids[T]>=h?_=T:p=T+1}const S=[];for(;this.ids[p]===h;)S.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return S}static serialize(n,h){const p=new Float64Array(n.ids),_=new Uint32Array(n.positions);return bs(p,_,0,p.length-1),h&&h.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(n){const h=new Fi;return h.ids=n.ids,h.positions=n.positions,h.indexed=!0,h}}function Ti(c){const n=+c;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Vt(String(c))}function bs(c,n,h,p){for(;h<p;){const _=c[h+p>>1];let S=h-1,T=p+1;for(;;){do S++;while(c[S]<_);do T--;while(c[T]>_);if(S>=T)break;ur(c,S,T),ur(n,3*S,3*T),ur(n,3*S+1,3*T+1),ur(n,3*S+2,3*T+2)}T-h<p-T?(bs(c,n,h,T),h=T+1):(bs(c,n,T+1,p),p=T)}}function ur(c,n,h){const p=c[n];c[n]=c[h],c[h]=p}st("FeaturePositionMap",Fi);class Ei{constructor(n,h){this.gl=n.gl,this.location=h}}class Hr extends Ei{constructor(n,h){super(n,h),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Cn extends Ei{constructor(n,h){super(n,h),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class to extends Ei{constructor(n,h){super(n,h),this.current=di.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const ul=new Float32Array(16);function hl(c){return[rt(255*c.r,255*c.g),rt(255*c.b,255*c.a)]}class io{constructor(n,h,p){this.value=n,this.uniformNames=h.map(_=>`u_${_}`),this.type=p}setUniform(n,h,p){n.set(p.constantOr(this.value))}getBinding(n,h,p){return this.type==="color"?new to(n,h):new Hr(n,h)}}class $n{constructor(n,h){this.uniformNames=h.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=n.tlbr}setUniform(n,h,p,_){const S=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&n.set(S)}getBinding(n,h,p){return p.substr(0,9)==="u_pattern"?new Cn(n,h):new Hr(n,h)}}class Gi{constructor(n,h,p,_){this.expression=n,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,h,p,_,S){const T=this.paintVertexArray.length,k=this.expression.evaluate(new $i(0),h,{},_,[],S);this.paintVertexArray.resize(n),this._setPaintValue(T,n,k)}updatePaintArray(n,h,p,_){const S=this.expression.evaluate({zoom:0},p,_);this._setPaintValue(n,h,S)}_setPaintValue(n,h,p){if(this.type==="color"){const _=hl(p);for(let S=n;S<h;S++)this.paintVertexArray.emplace(S,_[0],_[1])}else{for(let _=n;_<h;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oi{constructor(n,h,p,_,S,T){this.expression=n,this.uniformNames=h.map(k=>`u_${k}_t`),this.type=p,this.useIntegerZoom=_,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map(k=>({name:`a_${k}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(n,h,p,_,S){const T=this.expression.evaluate(new $i(this.zoom),h,{},_,[],S),k=this.expression.evaluate(new $i(this.zoom+1),h,{},_,[],S),$=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue($,n,T,k)}updatePaintArray(n,h,p,_){const S=this.expression.evaluate({zoom:this.zoom},p,_),T=this.expression.evaluate({zoom:this.zoom+1},p,_);this._setPaintValue(n,h,S,T)}_setPaintValue(n,h,p,_){if(this.type==="color"){const S=hl(p),T=hl(_);for(let k=n;k<h;k++)this.paintVertexArray.emplace(k,S[0],S[1],T[0],T[1])}else{for(let S=n;S<h;S++)this.paintVertexArray.emplace(S,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,h){const p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,_=ke(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(_)}getBinding(n,h,p){return new Hr(n,h)}}class Yi{constructor(n,h,p,_,S,T){this.expression=n,this.type=h,this.useIntegerZoom=p,this.zoom=_,this.layerId=T,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(n,h,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(_,n,h.patterns&&h.patterns[this.layerId],p)}updatePaintArray(n,h,p,_,S){this._setPaintValues(n,h,p.patterns&&p.patterns[this.layerId],S)}_setPaintValues(n,h,p,_){if(!_||!p)return;const{min:S,mid:T,max:k}=p,$=_[S],L=_[T],z=_[k];if($&&L&&z)for(let N=n;N<h;N++)this.zoomInPaintVertexArray.emplace(N,L.tl[0],L.tl[1],L.br[0],L.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],L.pixelRatio,$.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,L.tl[0],L.tl[1],L.br[0],L.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],L.pixelRatio,z.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,$t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,$t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fc{constructor(n,h,p){this.binders={},this._buffers=[];const _=[];for(const S in n.paint._values){if(!p(S))continue;const T=n.paint.get(S);if(!(T instanceof An&&tc(T.property.specification)))continue;const k=Pr(S,n.type),$=T.value,L=T.property.specification.type,z=T.property.useIntegerZoom,N=T.property.specification["property-type"],V=N==="cross-faded"||N==="cross-faded-data-driven";if($.kind==="constant")this.binders[S]=V?new $n($.value,k):new io($.value,k,L),_.push(`/u_${S}`);else if($.kind==="source"||V){const H=Gs(S,L,"source");this.binders[S]=V?new Yi($,L,z,h,H,n.id):new Gi($,k,L,H),_.push(`/a_${S}`)}else{const H=Gs(S,L,"composite");this.binders[S]=new Oi($,k,L,z,h,H),_.push(`/z_${S}`)}}this.cacheKey=_.sort().join("")}getMaxValue(n){const h=this.binders[n];return h instanceof Gi||h instanceof Oi?h.maxValue:0}populatePaintArrays(n,h,p,_,S){for(const T in this.binders){const k=this.binders[T];(k instanceof Gi||k instanceof Oi||k instanceof Yi)&&k.populatePaintArray(n,h,p,_,S)}}setConstantPatternPositions(n,h){for(const p in this.binders){const _=this.binders[p];_ instanceof $n&&_.setConstantPatternPositions(n,h)}}updatePaintArrays(n,h,p,_,S){let T=!1;for(const k in n){const $=h.getPositions(k);for(const L of $){const z=p.feature(L.index);for(const N in this.binders){const V=this.binders[N];if((V instanceof Gi||V instanceof Oi||V instanceof Yi)&&V.expression.isStateDependent===!0){const H=_.paint.get(N);V.expression=H.value,V.updatePaintArray(L.start,L.end,z,n[k],S),T=!0}}}}return T}defines(){const n=[];for(const h in this.binders){const p=this.binders[h];(p instanceof io||p instanceof $n)&&n.push(...p.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return n}getBinderAttributes(){const n=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Gi||p instanceof Oi)for(let _=0;_<p.paintVertexAttributes.length;_++)n.push(p.paintVertexAttributes[_].name);else if(p instanceof Yi)for(let _=0;_<$t.members.length;_++)n.push($t.members[_].name)}return n}getBinderUniforms(){const n=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof io||p instanceof $n||p instanceof Oi)for(const _ of p.uniformNames)n.push(_)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,h){const p=[];for(const _ in this.binders){const S=this.binders[_];if(S instanceof io||S instanceof $n||S instanceof Oi){for(const T of S.uniformNames)if(h[T]){const k=S.getBinding(n,h[T],T);p.push({name:T,property:_,binding:k})}}}return p}setUniforms(n,h,p,_){for(const{name:S,property:T,binding:k}of h)this.binders[T].setUniform(k,_,p.get(T),S)}updatePaintBuffers(n){this._buffers=[];for(const h in this.binders){const p=this.binders[h];if(n&&p instanceof Yi){const _=n.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof Gi||p instanceof Oi)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(n){for(const h in this.binders){const p=this.binders[h];(p instanceof Gi||p instanceof Oi||p instanceof Yi)&&p.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const h=this.binders[n];(h instanceof Gi||h instanceof Oi||h instanceof Yi)&&h.destroy()}}}class Di{constructor(n,h,p=()=>!0){this.programConfigurations={};for(const _ of n)this.programConfigurations[_.id]=new fc(_,h,p);this.needsUpload=!1,this._featureMap=new Fi,this._bufferOffset=0}populatePaintArrays(n,h,p,_,S,T){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(n,h,_,S,T);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,h,p,_){for(const S of p)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(n,this._featureMap,h,S,_)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Pr(c,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${n}-`,"").replace(/-/g,"_")]}function Gs(c,n,h){const p={color:{source:Ju,composite:wm},number:{source:pa,composite:Ju}},_=function(S){return{"line-pattern":{source:X,composite:X},"fill-pattern":{source:X,composite:X},"fill-extrusion-pattern":{source:X,composite:X}}[S]}(c);return _&&_[h]||p[n][h]}st("ConstantBinder",io),st("CrossFadedConstantBinder",$n),st("SourceExpressionBinder",Gi),st("CrossFadedCompositeBinder",Yi),st("CompositeExpressionBinder",Oi),st("ProgramConfiguration",fc,{omit:["_buffers"]}),st("ProgramConfigurationSet",Di);const Jt=8192,Sm=Math.pow(2,14)-1,W0=-Sm-1;function dl(c){const n=Jt/c.extent,h=c.loadGeometry();for(let p=0;p<h.length;p++){const _=h[p];for(let S=0;S<_.length;S++){const T=_[S],k=Math.round(T.x*n),$=Math.round(T.y*n);T.x=ke(k,W0,Sm),T.y=ke($,W0,Sm),(k<T.x||k>T.x+1||$<T.y||$>T.y+1)&&It("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function pl(c,n){return{type:c.type,id:c.id,properties:c.properties,geometry:n?dl(c):[]}}function ep(c,n,h,p,_){c.emplaceBack(2*n+(p+1)/2,2*h+(_+1)/2)}class Tm{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new B,this.indexArray=new Ee,this.segments=new Fe,this.programConfigurations=new Di(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,p){const _=this.layers[0],S=[];let T=null,k=!1;_.type==="circle"&&(T=_.layout.get("circle-sort-key"),k=!T.isConstant());for(const{feature:$,id:L,index:z,sourceLayerIndex:N}of n){const V=this.layers[0]._featureFilter.needGeometry,H=pl($,V);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),H,p))continue;const Z=k?T.evaluate(H,{},p):void 0,Q={id:L,properties:$.properties,type:$.type,sourceLayerIndex:N,index:z,geometry:V?H.geometry:dl($),patterns:{},sortKey:Z};S.push(Q)}k&&S.sort(($,L)=>$.sortKey-L.sortKey);for(const $ of S){const{geometry:L,index:z,sourceLayerIndex:N}=$,V=n[z].feature;this.addFeature($,L,z,p),h.featureIndex.insert(V,L,z,N,this.index)}}update(n,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ze),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,h,p,_){for(const S of h)for(const T of S){const k=T.x,$=T.y;if(k<0||k>=Jt||$<0||$>=Jt)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),z=L.vertexLength;ep(this.layoutVertexArray,k,$,-1,-1),ep(this.layoutVertexArray,k,$,1,-1),ep(this.layoutVertexArray,k,$,1,1),ep(this.layoutVertexArray,k,$,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,{},_)}}function fl(c,n){for(let h=0;h<c.length;h++)if(tp(n,c[h]))return!0;for(let h=0;h<n.length;h++)if(tp(c,n[h]))return!0;return!!Yu(c,n)}function Z0(c,n,h){return!!tp(c,n)||!!Xu(n,c,h)}function Mm(c,n){if(c.length===1)return xE(n,c[0]);for(let h=0;h<n.length;h++){const p=n[h];for(let _=0;_<p.length;_++)if(tp(c,p[_]))return!0}for(let h=0;h<c.length;h++)if(xE(n,c[h]))return!0;for(let h=0;h<n.length;h++)if(Yu(c,n[h]))return!0;return!1}function J0(c,n,h){if(c.length>1){if(Yu(c,n))return!0;for(let p=0;p<n.length;p++)if(Xu(n[p],c,h))return!0}for(let p=0;p<c.length;p++)if(Xu(c[p],n,h))return!0;return!1}function Yu(c,n){if(c.length===0||n.length===0)return!1;for(let h=0;h<c.length-1;h++){const p=c[h],_=c[h+1];for(let S=0;S<n.length-1;S++)if(K0(p,_,n[S],n[S+1]))return!0}return!1}function K0(c,n,h,p){return ht(c,h,p)!==ht(n,h,p)&&ht(c,n,h)!==ht(c,n,p)}function Xu(c,n,h){const p=h*h;if(n.length===1)return c.distSqr(n[0])<p;for(let _=1;_<n.length;_++)if(wE(c,n[_-1],n[_])<p)return!0;return!1}function wE(c,n,h){const p=n.distSqr(h);if(p===0)return c.distSqr(n);const _=((c.x-n.x)*(h.x-n.x)+(c.y-n.y)*(h.y-n.y))/p;return c.distSqr(_<0?n:_>1?h:h.sub(n)._mult(_)._add(n))}function xE(c,n){let h,p,_,S=!1;for(let T=0;T<c.length;T++){h=c[T];for(let k=0,$=h.length-1;k<h.length;$=k++)p=h[k],_=h[$],p.y>n.y!=_.y>n.y&&n.x<(_.x-p.x)*(n.y-p.y)/(_.y-p.y)+p.x&&(S=!S)}return S}function tp(c,n){let h=!1;for(let p=0,_=c.length-1;p<c.length;_=p++){const S=c[p],T=c[_];S.y>n.y!=T.y>n.y&&n.x<(T.x-S.x)*(n.y-S.y)/(T.y-S.y)+S.x&&(h=!h)}return h}function C6(c,n,h){const p=h[0],_=h[2];if(c.x<p.x&&n.x<p.x||c.x>_.x&&n.x>_.x||c.y<p.y&&n.y<p.y||c.y>_.y&&n.y>_.y)return!1;const S=ht(c,n,h[0]);return S!==ht(c,n,h[1])||S!==ht(c,n,h[2])||S!==ht(c,n,h[3])}function Im(c,n,h){const p=n.paint.get(c).value;return p.kind==="constant"?p.value:h.programConfigurations.get(n.id).getMaxValue(c)}function Y0(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function X0(c,n,h,p,_){if(!n[0]&&!n[1])return c;const S=E.convert(n)._mult(_);h==="viewport"&&S._rotate(-p);const T=[];for(let k=0;k<c.length;k++)T.push(c[k].sub(S));return T}let SE,TE;st("CircleBucket",Tm,{omit:["layers"]});var $6={get paint(){return TE=TE||new vs({"circle-radius":new bt($e.paint_circle["circle-radius"]),"circle-color":new bt($e.paint_circle["circle-color"]),"circle-blur":new bt($e.paint_circle["circle-blur"]),"circle-opacity":new bt($e.paint_circle["circle-opacity"]),"circle-translate":new yt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new yt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bt($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bt($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bt($e.paint_circle["circle-stroke-opacity"])})},get layout(){return SE=SE||new vs({"circle-sort-key":new bt($e.layout_circle["circle-sort-key"])})}},ws=1e-6,ip=typeof Float32Array<"u"?Float32Array:Array;function gw(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function ME(c,n,h){var p=n[0],_=n[1],S=n[2],T=n[3],k=n[4],$=n[5],L=n[6],z=n[7],N=n[8],V=n[9],H=n[10],Z=n[11],Q=n[12],se=n[13],le=n[14],we=n[15],ce=h[0],ye=h[1],Le=h[2],De=h[3];return c[0]=ce*p+ye*k+Le*N+De*Q,c[1]=ce*_+ye*$+Le*V+De*se,c[2]=ce*S+ye*L+Le*H+De*le,c[3]=ce*T+ye*z+Le*Z+De*we,c[4]=(ce=h[4])*p+(ye=h[5])*k+(Le=h[6])*N+(De=h[7])*Q,c[5]=ce*_+ye*$+Le*V+De*se,c[6]=ce*S+ye*L+Le*H+De*le,c[7]=ce*T+ye*z+Le*Z+De*we,c[8]=(ce=h[8])*p+(ye=h[9])*k+(Le=h[10])*N+(De=h[11])*Q,c[9]=ce*_+ye*$+Le*V+De*se,c[10]=ce*S+ye*L+Le*H+De*le,c[11]=ce*T+ye*z+Le*Z+De*we,c[12]=(ce=h[12])*p+(ye=h[13])*k+(Le=h[14])*N+(De=h[15])*Q,c[13]=ce*_+ye*$+Le*V+De*se,c[14]=ce*S+ye*L+Le*H+De*le,c[15]=ce*T+ye*z+Le*Z+De*we,c}Math.hypot||(Math.hypot=function(){for(var c=0,n=arguments.length;n--;)c+=arguments[n]*arguments[n];return Math.sqrt(c)});var Em,O6=ME;function Q0(c,n,h){var p=n[0],_=n[1],S=n[2],T=n[3];return c[0]=h[0]*p+h[4]*_+h[8]*S+h[12]*T,c[1]=h[1]*p+h[5]*_+h[9]*S+h[13]*T,c[2]=h[2]*p+h[6]*_+h[10]*S+h[14]*T,c[3]=h[3]*p+h[7]*_+h[11]*S+h[15]*T,c}Em=new ip(4),ip!=Float32Array&&(Em[0]=0,Em[1]=0,Em[2]=0,Em[3]=0);class L6 extends Pn{constructor(n){super(n,$6)}createBucket(n){return new Tm(n)}queryRadius(n){const h=n;return Im("circle-radius",this,h)+Im("circle-stroke-width",this,h)+Y0(this.paint.get("circle-translate"))}queryIntersectsFeature(n,h,p,_,S,T,k,$){const L=X0(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,k),z=this.paint.get("circle-radius").evaluate(h,p)+this.paint.get("circle-stroke-width").evaluate(h,p),N=this.paint.get("circle-pitch-alignment")==="map",V=N?L:function(Z,Q){return Z.map(se=>IE(se,Q))}(L,$),H=N?z*k:z;for(const Z of _)for(const Q of Z){const se=N?Q:IE(Q,$);let le=H;const we=Q0([],[Q.x,Q.y,0,1],$);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=we[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=T.cameraToCenterDistance/we[3]),Z0(V,se,le))return!0}return!1}}function IE(c,n){const h=Q0([],[c.x,c.y,0,1],n);return new E(h[0]/h[3],h[1]/h[3])}class EE extends Tm{}let kE;st("HeatmapBucket",EE,{omit:["layers"]});var R6={get paint(){return kE=kE||new vs({"heatmap-radius":new bt($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bt($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Wu($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yt($e.paint_heatmap["heatmap-opacity"])})}};function _w(c,{width:n,height:h},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==n*h*p)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${n*h*p}`)}else _=new Uint8Array(n*h*p);return c.width=n,c.height=h,c.data=_,c}function AE(c,{width:n,height:h},p){if(n===c.width&&h===c.height)return;const _=_w({},{width:n,height:h},p);vw(c,_,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,n),height:Math.min(c.height,h)},p),c.width=n,c.height=h,c.data=_.data}function vw(c,n,h,p,_,S){if(_.width===0||_.height===0)return n;if(_.width>c.width||_.height>c.height||h.x>c.width-_.width||h.y>c.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>n.width||_.height>n.height||p.x>n.width-_.width||p.y>n.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const T=c.data,k=n.data;if(T===k)throw new Error("srcData equals dstData, so image is already copied");for(let $=0;$<_.height;$++){const L=((h.y+$)*c.width+h.x)*S,z=((p.y+$)*n.width+p.x)*S;for(let N=0;N<_.width*S;N++)k[z+N]=T[L+N]}return n}class km{constructor(n,h){_w(this,n,1,h)}resize(n){AE(this,n,1)}clone(){return new km({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,h,p,_,S){vw(n,h,p,_,S,1)}}class On{constructor(n,h){_w(this,n,4,h)}resize(n){AE(this,n,4)}replace(n,h){h?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new On({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,h,p,_,S){vw(n,h,p,_,S,4)}}function PE(c){const n={},h=c.resolution||256,p=c.clips?c.clips.length:1,_=c.image||new On({width:h,height:p});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const S=(T,k,$)=>{n[c.evaluationKey]=$;const L=c.expression.evaluate(n);_.data[T+k+0]=Math.floor(255*L.r/L.a),_.data[T+k+1]=Math.floor(255*L.g/L.a),_.data[T+k+2]=Math.floor(255*L.b/L.a),_.data[T+k+3]=Math.floor(255*L.a)};if(c.clips)for(let T=0,k=0;T<p;++T,k+=4*h)for(let $=0,L=0;$<h;$++,L+=4){const z=$/(h-1),{start:N,end:V}=c.clips[T];S(k,L,N*(1-z)+V*z)}else for(let T=0,k=0;T<h;T++,k+=4)S(0,k,T/(h-1));return _}st("AlphaImage",km),st("RGBAImage",On);class D6 extends Pn{createBucket(n){return new EE(n)}constructor(n){super(n,R6),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=PE({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let CE;var z6={get paint(){return CE=CE||new vs({"hillshade-illumination-direction":new yt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yt($e.paint_hillshade["hillshade-accent-color"])})}};class N6 extends Pn{constructor(n){super(n,z6)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const F6=nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:B6}=F6;var bw={exports:{}};function e_(c,n,h){h=h||2;var p,_,S,T,k,$,L,z=n&&n.length,N=z?n[0]*h:c.length,V=$E(c,0,N,h,!0),H=[];if(!V||V.next===V.prev)return H;if(z&&(V=function(Q,se,le,we){var ce,ye,Le,De=[];for(ce=0,ye=se.length;ce<ye;ce++)(Le=$E(Q,se[ce]*we,ce<ye-1?se[ce+1]*we:Q.length,we,!1))===Le.next&&(Le.steiner=!0),De.push(Z6(Le));for(De.sort(q6),ce=0;ce<De.length;ce++)le=H6(De[ce],le);return le}(c,n,V,h)),c.length>80*h){p=S=c[0],_=T=c[1];for(var Z=h;Z<N;Z+=h)(k=c[Z])<p&&(p=k),($=c[Z+1])<_&&(_=$),k>S&&(S=k),$>T&&(T=$);L=(L=Math.max(S-p,T-_))!==0?32767/L:0}return Am(V,H,h,p,_,L,0),H}function $E(c,n,h,p,_){var S,T;if(_===Sw(c,n,h,p)>0)for(S=n;S<h;S+=p)T=RE(S,c[S],c[S+1],T);else for(S=h-p;S>=n;S-=p)T=RE(S,c[S],c[S+1],T);return T&&t_(T,T.next)&&(Cm(T),T=T.next),T}function Qu(c,n){if(!c)return c;n||(n=c);var h,p=c;do if(h=!1,p.steiner||!t_(p,p.next)&&or(p.prev,p,p.next)!==0)p=p.next;else{if(Cm(p),(p=n=p.prev)===p.next)break;h=!0}while(h||p!==n);return n}function Am(c,n,h,p,_,S,T){if(c){!T&&S&&function(z,N,V,H){var Z=z;do Z.z===0&&(Z.z=ww(Z.x,Z.y,N,V,H)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==z);Z.prevZ.nextZ=null,Z.prevZ=null,function(Q){var se,le,we,ce,ye,Le,De,et,dt=1;do{for(le=Q,Q=null,ye=null,Le=0;le;){for(Le++,we=le,De=0,se=0;se<dt&&(De++,we=we.nextZ);se++);for(et=dt;De>0||et>0&&we;)De!==0&&(et===0||!we||le.z<=we.z)?(ce=le,le=le.nextZ,De--):(ce=we,we=we.nextZ,et--),ye?ye.nextZ=ce:Q=ce,ce.prevZ=ye,ye=ce;le=we}ye.nextZ=null,dt*=2}while(Le>1)}(Z)}(c,p,_,S);for(var k,$,L=c;c.prev!==c.next;)if(k=c.prev,$=c.next,S?V6(c,p,_,S):j6(c))n.push(k.i/h|0),n.push(c.i/h|0),n.push($.i/h|0),Cm(c),c=$.next,L=$.next;else if((c=$)===L){T?T===1?Am(c=U6(Qu(c),n,h),n,h,p,_,S,2):T===2&&G6(c,n,h,p,_,S):Am(Qu(c),n,h,p,_,S,1);break}}}function j6(c){var n=c.prev,h=c,p=c.next;if(or(n,h,p)>=0)return!1;for(var _=n.x,S=h.x,T=p.x,k=n.y,$=h.y,L=p.y,z=_<S?_<T?_:T:S<T?S:T,N=k<$?k<L?k:L:$<L?$:L,V=_>S?_>T?_:T:S>T?S:T,H=k>$?k>L?k:L:$>L?$:L,Z=p.next;Z!==n;){if(Z.x>=z&&Z.x<=V&&Z.y>=N&&Z.y<=H&&rp(_,k,S,$,T,L,Z.x,Z.y)&&or(Z.prev,Z,Z.next)>=0)return!1;Z=Z.next}return!0}function V6(c,n,h,p){var _=c.prev,S=c,T=c.next;if(or(_,S,T)>=0)return!1;for(var k=_.x,$=S.x,L=T.x,z=_.y,N=S.y,V=T.y,H=k<$?k<L?k:L:$<L?$:L,Z=z<N?z<V?z:V:N<V?N:V,Q=k>$?k>L?k:L:$>L?$:L,se=z>N?z>V?z:V:N>V?N:V,le=ww(H,Z,n,h,p),we=ww(Q,se,n,h,p),ce=c.prevZ,ye=c.nextZ;ce&&ce.z>=le&&ye&&ye.z<=we;){if(ce.x>=H&&ce.x<=Q&&ce.y>=Z&&ce.y<=se&&ce!==_&&ce!==T&&rp(k,z,$,N,L,V,ce.x,ce.y)&&or(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,ye.x>=H&&ye.x<=Q&&ye.y>=Z&&ye.y<=se&&ye!==_&&ye!==T&&rp(k,z,$,N,L,V,ye.x,ye.y)&&or(ye.prev,ye,ye.next)>=0))return!1;ye=ye.nextZ}for(;ce&&ce.z>=le;){if(ce.x>=H&&ce.x<=Q&&ce.y>=Z&&ce.y<=se&&ce!==_&&ce!==T&&rp(k,z,$,N,L,V,ce.x,ce.y)&&or(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;ye&&ye.z<=we;){if(ye.x>=H&&ye.x<=Q&&ye.y>=Z&&ye.y<=se&&ye!==_&&ye!==T&&rp(k,z,$,N,L,V,ye.x,ye.y)&&or(ye.prev,ye,ye.next)>=0)return!1;ye=ye.nextZ}return!0}function U6(c,n,h){var p=c;do{var _=p.prev,S=p.next.next;!t_(_,S)&&OE(_,p,p.next,S)&&Pm(_,S)&&Pm(S,_)&&(n.push(_.i/h|0),n.push(p.i/h|0),n.push(S.i/h|0),Cm(p),Cm(p.next),p=c=S),p=p.next}while(p!==c);return Qu(p)}function G6(c,n,h,p,_,S){var T=c;do{for(var k=T.next.next;k!==T.prev;){if(T.i!==k.i&&J6(T,k)){var $=LE(T,k);return T=Qu(T,T.next),$=Qu($,$.next),Am(T,n,h,p,_,S,0),void Am($,n,h,p,_,S,0)}k=k.next}T=T.next}while(T!==c)}function q6(c,n){return c.x-n.x}function H6(c,n){var h=function(_,S){var T,k=S,$=_.x,L=_.y,z=-1/0;do{if(L<=k.y&&L>=k.next.y&&k.next.y!==k.y){var N=k.x+(L-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(N<=$&&N>z&&(z=N,T=k.x<k.next.x?k:k.next,N===$))return T}k=k.next}while(k!==S);if(!T)return null;var V,H=T,Z=T.x,Q=T.y,se=1/0;k=T;do $>=k.x&&k.x>=Z&&$!==k.x&&rp(L<Q?$:z,L,Z,Q,L<Q?z:$,L,k.x,k.y)&&(V=Math.abs(L-k.y)/($-k.x),Pm(k,_)&&(V<se||V===se&&(k.x>T.x||k.x===T.x&&W6(T,k)))&&(T=k,se=V)),k=k.next;while(k!==H);return T}(c,n);if(!h)return n;var p=LE(h,c);return Qu(p,p.next),Qu(h,h.next)}function W6(c,n){return or(c.prev,c,n.prev)<0&&or(n.next,c,c.next)<0}function ww(c,n,h,p,_){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-p)*_|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Z6(c){var n=c,h=c;do(n.x<h.x||n.x===h.x&&n.y<h.y)&&(h=n),n=n.next;while(n!==c);return h}function rp(c,n,h,p,_,S,T,k){return(_-T)*(n-k)>=(c-T)*(S-k)&&(c-T)*(p-k)>=(h-T)*(n-k)&&(h-T)*(S-k)>=(_-T)*(p-k)}function J6(c,n){return c.next.i!==n.i&&c.prev.i!==n.i&&!function(h,p){var _=h;do{if(_.i!==h.i&&_.next.i!==h.i&&_.i!==p.i&&_.next.i!==p.i&&OE(_,_.next,h,p))return!0;_=_.next}while(_!==h);return!1}(c,n)&&(Pm(c,n)&&Pm(n,c)&&function(h,p){var _=h,S=!1,T=(h.x+p.x)/2,k=(h.y+p.y)/2;do _.y>k!=_.next.y>k&&_.next.y!==_.y&&T<(_.next.x-_.x)*(k-_.y)/(_.next.y-_.y)+_.x&&(S=!S),_=_.next;while(_!==h);return S}(c,n)&&(or(c.prev,c,n.prev)||or(c,n.prev,n))||t_(c,n)&&or(c.prev,c,c.next)>0&&or(n.prev,n,n.next)>0)}function or(c,n,h){return(n.y-c.y)*(h.x-n.x)-(n.x-c.x)*(h.y-n.y)}function t_(c,n){return c.x===n.x&&c.y===n.y}function OE(c,n,h,p){var _=r_(or(c,n,h)),S=r_(or(c,n,p)),T=r_(or(h,p,c)),k=r_(or(h,p,n));return _!==S&&T!==k||!(_!==0||!i_(c,h,n))||!(S!==0||!i_(c,p,n))||!(T!==0||!i_(h,c,p))||!(k!==0||!i_(h,n,p))}function i_(c,n,h){return n.x<=Math.max(c.x,h.x)&&n.x>=Math.min(c.x,h.x)&&n.y<=Math.max(c.y,h.y)&&n.y>=Math.min(c.y,h.y)}function r_(c){return c>0?1:c<0?-1:0}function Pm(c,n){return or(c.prev,c,c.next)<0?or(c,n,c.next)>=0&&or(c,c.prev,n)>=0:or(c,n,c.prev)<0||or(c,c.next,n)<0}function LE(c,n){var h=new xw(c.i,c.x,c.y),p=new xw(n.i,n.x,n.y),_=c.next,S=n.prev;return c.next=n,n.prev=c,h.next=_,_.prev=h,p.next=h,h.prev=p,S.next=p,p.prev=S,p}function RE(c,n,h,p){var _=new xw(c,n,h);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function Cm(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function xw(c,n,h){this.i=c,this.x=n,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sw(c,n,h,p){for(var _=0,S=n,T=h-p;S<h;S+=p)_+=(c[T]-c[S])*(c[S+1]+c[T+1]),T=S;return _}bw.exports=e_,bw.exports.default=e_,e_.deviation=function(c,n,h,p){var _=n&&n.length,S=Math.abs(Sw(c,0,_?n[0]*h:c.length,h));if(_)for(var T=0,k=n.length;T<k;T++)S-=Math.abs(Sw(c,n[T]*h,T<k-1?n[T+1]*h:c.length,h));var $=0;for(T=0;T<p.length;T+=3){var L=p[T]*h,z=p[T+1]*h,N=p[T+2]*h;$+=Math.abs((c[L]-c[N])*(c[z+1]-c[L+1])-(c[L]-c[z])*(c[N+1]-c[L+1]))}return S===0&&$===0?0:Math.abs(($-S)/S)},e_.flatten=function(c){for(var n=c[0][0].length,h={vertices:[],holes:[],dimensions:n},p=0,_=0;_<c.length;_++){for(var S=0;S<c[_].length;S++)for(var T=0;T<n;T++)h.vertices.push(c[_][S][T]);_>0&&h.holes.push(p+=c[_-1].length)}return h};var DE=y(bw.exports);function K6(c,n,h,p,_){zE(c,n,h||0,p||c.length-1,_||Y6)}function zE(c,n,h,p,_){for(;p>h;){if(p-h>600){var S=p-h+1,T=n-h+1,k=Math.log(S),$=.5*Math.exp(2*k/3),L=.5*Math.sqrt(k*$*(S-$)/S)*(T-S/2<0?-1:1);zE(c,n,Math.max(h,Math.floor(n-T*$/S+L)),Math.min(p,Math.floor(n+(S-T)*$/S+L)),_)}var z=c[n],N=h,V=p;for($m(c,h,n),_(c[p],z)>0&&$m(c,h,p);N<V;){for($m(c,N,V),N++,V--;_(c[N],z)<0;)N++;for(;_(c[V],z)>0;)V--}_(c[h],z)===0?$m(c,h,V):$m(c,++V,p),V<=n&&(h=V+1),n<=V&&(p=V-1)}}function $m(c,n,h){var p=c[n];c[n]=c[h],c[h]=p}function Y6(c,n){return c<n?-1:c>n?1:0}function Tw(c,n){const h=c.length;if(h<=1)return[c];const p=[];let _,S;for(let T=0;T<h;T++){const k=hi(c[T]);k!==0&&(c[T].area=Math.abs(k),S===void 0&&(S=k<0),S===k<0?(_&&p.push(_),_=[c[T]]):_.push(c[T]))}if(_&&p.push(_),n>1)for(let T=0;T<p.length;T++)p[T].length<=n||(K6(p[T],n,1,p[T].length-1,X6),p[T]=p[T].slice(0,n));return p}function X6(c,n){return n.area-c.area}function Mw(c,n,h){const p=h.patternDependencies;let _=!1;for(const S of n){const T=S.paint.get(`${c}-pattern`);T.isConstant()||(_=!0);const k=T.constantOr(null);k&&(_=!0,p[k.to]=!0,p[k.from]=!0)}return _}function Iw(c,n,h,p,_){const S=_.patternDependencies;for(const T of n){const k=T.paint.get(`${c}-pattern`).value;if(k.kind!=="constant"){let $=k.evaluate({zoom:p-1},h,{},_.availableImages),L=k.evaluate({zoom:p},h,{},_.availableImages),z=k.evaluate({zoom:p+1},h,{},_.availableImages);$=$&&$.name?$.name:$,L=L&&L.name?L.name:L,z=z&&z.name?z.name:z,S[$]=!0,S[L]=!0,S[z]=!0,h.patterns[T.id]={min:$,mid:L,max:z}}}return h}class Ew{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new W,this.indexArray=new Ee,this.indexArray2=new Pe,this.programConfigurations=new Di(n.layers,n.zoom),this.segments=new Fe,this.segments2=new Fe,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,p){this.hasPattern=Mw("fill",this.layers,h);const _=this.layers[0].layout.get("fill-sort-key"),S=!_.isConstant(),T=[];for(const{feature:k,id:$,index:L,sourceLayerIndex:z}of n){const N=this.layers[0]._featureFilter.needGeometry,V=pl(k,N);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),V,p))continue;const H=S?_.evaluate(V,{},p,h.availableImages):void 0,Z={id:$,properties:k.properties,type:k.type,sourceLayerIndex:z,index:L,geometry:N?V.geometry:dl(k),patterns:{},sortKey:H};T.push(Z)}S&&T.sort((k,$)=>k.sortKey-$.sortKey);for(const k of T){const{geometry:$,index:L,sourceLayerIndex:z}=k;if(this.hasPattern){const N=Iw("fill",this.layers,k,this.zoom,h);this.patternFeatures.push(N)}else this.addFeature(k,$,L,p,{});h.featureIndex.insert(n[L].feature,$,L,z,this.index)}}update(n,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,p)}addFeatures(n,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,B6),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,h,p,_,S){for(const T of Tw(h,500)){let k=0;for(const H of T)k+=H.length;const $=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),L=$.vertexLength,z=[],N=[];for(const H of T){if(H.length===0)continue;H!==T[0]&&N.push(z.length/2);const Z=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),Q=Z.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(Q+H.length-1,Q),z.push(H[0].x),z.push(H[0].y);for(let se=1;se<H.length;se++)this.layoutVertexArray.emplaceBack(H[se].x,H[se].y),this.indexArray2.emplaceBack(Q+se-1,Q+se),z.push(H[se].x),z.push(H[se].y);Z.vertexLength+=H.length,Z.primitiveLength+=H.length}const V=DE(z,N);for(let H=0;H<V.length;H+=3)this.indexArray.emplaceBack(L+V[H],L+V[H+1],L+V[H+2]);$.vertexLength+=k,$.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,S,_)}}let NE,FE;st("FillBucket",Ew,{omit:["layers","patternFeatures"]});var Q6={get paint(){return FE=FE||new vs({"fill-antialias":new yt($e.paint_fill["fill-antialias"]),"fill-opacity":new bt($e.paint_fill["fill-opacity"]),"fill-color":new bt($e.paint_fill["fill-color"]),"fill-outline-color":new bt($e.paint_fill["fill-outline-color"]),"fill-translate":new yt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new yt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new ll($e.paint_fill["fill-pattern"])})},get layout(){return NE=NE||new vs({"fill-sort-key":new bt($e.layout_fill["fill-sort-key"])})}};class eN extends Pn{constructor(n){super(n,Q6)}recalculate(n,h){super.recalculate(n,h);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Ew(n)}queryRadius(){return Y0(this.paint.get("fill-translate"))}queryIntersectsFeature(n,h,p,_,S,T,k){return Mm(X0(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,k),_)}isTileClipped(){return!0}}const tN=nr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),iN=nr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:rN}=tN;var mc={},sN=w,BE=sp;function sp(c,n,h,p,_){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=p,this._values=_,c.readFields(nN,this,n)}function nN(c,n,h){c==1?n.id=h.readVarint():c==2?function(p,_){for(var S=p.readVarint()+p.pos;p.pos<S;){var T=_._keys[p.readVarint()],k=_._values[p.readVarint()];_.properties[T]=k}}(h,n):c==3?n.type=h.readVarint():c==4&&(n._geometry=h.pos)}function oN(c){for(var n,h,p=0,_=0,S=c.length,T=S-1;_<S;T=_++)p+=((h=c[T]).x-(n=c[_]).x)*(n.y+h.y);return p}sp.types=["Unknown","Point","LineString","Polygon"],sp.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var n,h=c.readVarint()+c.pos,p=1,_=0,S=0,T=0,k=[];c.pos<h;){if(_<=0){var $=c.readVarint();p=7&$,_=$>>3}if(_--,p===1||p===2)S+=c.readSVarint(),T+=c.readSVarint(),p===1&&(n&&k.push(n),n=[]),n.push(new sN(S,T));else{if(p!==7)throw new Error("unknown command "+p);n&&n.push(n[0].clone())}}return n&&k.push(n),k},sp.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var n=c.readVarint()+c.pos,h=1,p=0,_=0,S=0,T=1/0,k=-1/0,$=1/0,L=-1/0;c.pos<n;){if(p<=0){var z=c.readVarint();h=7&z,p=z>>3}if(p--,h===1||h===2)(_+=c.readSVarint())<T&&(T=_),_>k&&(k=_),(S+=c.readSVarint())<$&&($=S),S>L&&(L=S);else if(h!==7)throw new Error("unknown command "+h)}return[T,$,k,L]},sp.prototype.toGeoJSON=function(c,n,h){var p,_,S=this.extent*Math.pow(2,h),T=this.extent*c,k=this.extent*n,$=this.loadGeometry(),L=sp.types[this.type];function z(H){for(var Z=0;Z<H.length;Z++){var Q=H[Z];H[Z]=[360*(Q.x+T)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+k)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var N=[];for(p=0;p<$.length;p++)N[p]=$[p][0];z($=N);break;case 2:for(p=0;p<$.length;p++)z($[p]);break;case 3:for($=function(H){var Z=H.length;if(Z<=1)return[H];for(var Q,se,le=[],we=0;we<Z;we++){var ce=oN(H[we]);ce!==0&&(se===void 0&&(se=ce<0),se===ce<0?(Q&&le.push(Q),Q=[H[we]]):Q.push(H[we]))}return Q&&le.push(Q),le}($),p=0;p<$.length;p++)for(_=0;_<$[p].length;_++)z($[p][_])}$.length===1?$=$[0]:L="Multi"+L;var V={type:"Feature",geometry:{type:L,coordinates:$},properties:this.properties};return"id"in this&&(V.id=this.id),V};var aN=BE,jE=VE;function VE(c,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(lN,this,n),this.length=this._features.length}function lN(c,n,h){c===15?n.version=h.readVarint():c===1?n.name=h.readString():c===5?n.extent=h.readVarint():c===2?n._features.push(h.pos):c===3?n._keys.push(h.readString()):c===4&&n._values.push(function(p){for(var _=null,S=p.readVarint()+p.pos;p.pos<S;){var T=p.readVarint()>>3;_=T===1?p.readString():T===2?p.readFloat():T===3?p.readDouble():T===4?p.readVarint64():T===5?p.readVarint():T===6?p.readSVarint():T===7?p.readBoolean():null}return _}(h))}VE.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var n=this._pbf.readVarint()+this._pbf.pos;return new aN(this._pbf,n,this.extent,this._keys,this._values)};var cN=jE;function uN(c,n,h){if(c===3){var p=new cN(h,h.readVarint()+h.pos);p.length&&(n[p.name]=p)}}mc.VectorTile=function(c,n){this.layers=c.readFields(uN,{},n)},mc.VectorTileFeature=BE,mc.VectorTileLayer=jE;const hN=mc.VectorTileFeature.types,kw=Math.pow(2,13);function Om(c,n,h,p,_,S,T,k){c.emplaceBack(n,h,2*Math.floor(p*kw)+T,_*kw*2,S*kw*2,Math.round(k))}class Aw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new re,this.centroidVertexArray=new F,this.indexArray=new Ee,this.programConfigurations=new Di(n.layers,n.zoom),this.segments=new Fe,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,p){this.features=[],this.hasPattern=Mw("fill-extrusion",this.layers,h);for(const{feature:_,id:S,index:T,sourceLayerIndex:k}of n){const $=this.layers[0]._featureFilter.needGeometry,L=pl(_,$);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),L,p))continue;const z={id:S,sourceLayerIndex:k,index:T,geometry:$?L.geometry:dl(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Iw("fill-extrusion",this.layers,z,this.zoom,h)):this.addFeature(z,z.geometry,T,p,{}),h.featureIndex.insert(_,z.geometry,T,k,this.index,!0)}}addFeatures(n,h,p){for(const _ of this.features){const{geometry:S}=_;this.addFeature(_,S,_.index,h,p)}}update(n,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,rN),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,iN.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,h,p,_,S){const T={x:0,y:0,vertexCount:0};for(const k of Tw(h,500)){let $=0;for(const Z of k)$+=Z.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Z of k){if(Z.length===0||pN(Z))continue;let Q=0;for(let se=0;se<Z.length;se++){const le=Z[se];if(se>=1){const we=Z[se-1];if(!dN(le,we)){L.vertexLength+4>Fe.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ce=le.sub(we)._perp()._unit(),ye=we.dist(le);Q+ye>32768&&(Q=0),Om(this.layoutVertexArray,le.x,le.y,ce.x,ce.y,0,0,Q),Om(this.layoutVertexArray,le.x,le.y,ce.x,ce.y,0,1,Q),T.x+=2*le.x,T.y+=2*le.y,T.vertexCount+=2,Q+=ye,Om(this.layoutVertexArray,we.x,we.y,ce.x,ce.y,0,0,Q),Om(this.layoutVertexArray,we.x,we.y,ce.x,ce.y,0,1,Q),T.x+=2*we.x,T.y+=2*we.y,T.vertexCount+=2;const Le=L.vertexLength;this.indexArray.emplaceBack(Le,Le+2,Le+1),this.indexArray.emplaceBack(Le+1,Le+2,Le+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+$>Fe.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment($,this.layoutVertexArray,this.indexArray)),hN[n.type]!=="Polygon")continue;const z=[],N=[],V=L.vertexLength;for(const Z of k)if(Z.length!==0){Z!==k[0]&&N.push(z.length/2);for(let Q=0;Q<Z.length;Q++){const se=Z[Q];Om(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),T.x+=se.x,T.y+=se.y,T.vertexCount+=1,z.push(se.x),z.push(se.y)}}const H=DE(z,N);for(let Z=0;Z<H.length;Z+=3)this.indexArray.emplaceBack(V+H[Z],V+H[Z+2],V+H[Z+1]);L.primitiveLength+=H.length/3,L.vertexLength+=$}for(let k=0;k<T.vertexCount;k++)this.centroidVertexArray.emplaceBack(Math.floor(T.x/T.vertexCount),Math.floor(T.y/T.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,S,_)}}function dN(c,n){return c.x===n.x&&(c.x<0||c.x>Jt)||c.y===n.y&&(c.y<0||c.y>Jt)}function pN(c){return c.every(n=>n.x<0)||c.every(n=>n.x>Jt)||c.every(n=>n.y<0)||c.every(n=>n.y>Jt)}let UE;st("FillExtrusionBucket",Aw,{omit:["layers","features"]});var fN={get paint(){return UE=UE||new vs({"fill-extrusion-opacity":new yt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bt($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ll($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bt($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bt($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new yt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mN extends Pn{constructor(n){super(n,fN)}createBucket(n){return new Aw(n)}queryRadius(){return Y0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,h,p,_,S,T,k,$){const L=X0(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,k),z=this.paint.get("fill-extrusion-height").evaluate(h,p),N=this.paint.get("fill-extrusion-base").evaluate(h,p),V=function(Z,Q,se,le){const we=[];for(const ce of Z){const ye=[ce.x,ce.y,0,1];Q0(ye,ye,Q),we.push(new E(ye[0]/ye[3],ye[1]/ye[3]))}return we}(L,$),H=function(Z,Q,se,le){const we=[],ce=[],ye=le[8]*Q,Le=le[9]*Q,De=le[10]*Q,et=le[11]*Q,dt=le[8]*se,Qe=le[9]*se,Xe=le[10]*se,qe=le[11]*se;for(const ot of Z){const Ke=[],je=[];for(const _t of ot){const mt=_t.x,Wt=_t.y,Li=le[0]*mt+le[4]*Wt+le[12],zi=le[1]*mt+le[5]*Wt+le[13],wr=le[2]*mt+le[6]*Wt+le[14],mn=le[3]*mt+le[7]*Wt+le[15],xs=wr+De,hr=mn+et,Nr=Li+dt,Zr=zi+Qe,Ss=wr+Xe,Ts=mn+qe,xr=new E((Li+ye)/hr,(zi+Le)/hr);xr.z=xs/hr,Ke.push(xr);const Sr=new E(Nr/Ts,Zr/Ts);Sr.z=Ss/Ts,je.push(Sr)}we.push(Ke),ce.push(je)}return[we,ce]}(_,N,z,$);return function(Z,Q,se){let le=1/0;Mm(se,Q)&&(le=GE(se,Q[0]));for(let we=0;we<Q.length;we++){const ce=Q[we],ye=Z[we];for(let Le=0;Le<ce.length-1;Le++){const De=ce[Le],et=[De,ce[Le+1],ye[Le+1],ye[Le],De];fl(se,et)&&(le=Math.min(le,GE(se,et)))}}return le!==1/0&&le}(H[0],H[1],V)}}function Lm(c,n){return c.x*n.x+c.y*n.y}function GE(c,n){if(c.length===1){let h=0;const p=n[h++];let _;for(;!_||p.equals(_);)if(_=n[h++],!_)return 1/0;for(;h<n.length;h++){const S=n[h],T=c[0],k=_.sub(p),$=S.sub(p),L=T.sub(p),z=Lm(k,k),N=Lm(k,$),V=Lm($,$),H=Lm(L,k),Z=Lm(L,$),Q=z*V-N*N,se=(V*H-N*Z)/Q,le=(z*Z-N*H)/Q,we=p.z*(1-se-le)+_.z*se+S.z*le;if(isFinite(we))return we}return 1/0}{let h=1/0;for(const p of n)h=Math.min(h,p.z);return h}}const yN=nr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gN}=yN,_N=nr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vN}=_N,bN=mc.VectorTileFeature.types,wN=Math.cos(Math.PI/180*37.5),qE=Math.pow(2,14)/.5;class Pw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new te,this.layoutVertexArray2=new ne,this.indexArray=new Ee,this.programConfigurations=new Di(n.layers,n.zoom),this.segments=new Fe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,p){this.hasPattern=Mw("line",this.layers,h);const _=this.layers[0].layout.get("line-sort-key"),S=!_.isConstant(),T=[];for(const{feature:k,id:$,index:L,sourceLayerIndex:z}of n){const N=this.layers[0]._featureFilter.needGeometry,V=pl(k,N);if(!this.layers[0]._featureFilter.filter(new $i(this.zoom),V,p))continue;const H=S?_.evaluate(V,{},p):void 0,Z={id:$,properties:k.properties,type:k.type,sourceLayerIndex:z,index:L,geometry:N?V.geometry:dl(k),patterns:{},sortKey:H};T.push(Z)}S&&T.sort((k,$)=>k.sortKey-$.sortKey);for(const k of T){const{geometry:$,index:L,sourceLayerIndex:z}=k;if(this.hasPattern){const N=Iw("line",this.layers,k,this.zoom,h);this.patternFeatures.push(N)}else this.addFeature(k,$,L,p,{});h.featureIndex.insert(n[L].feature,$,L,z,this.index)}}update(n,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,p)}addFeatures(n,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,vN)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,gN),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,h,p,_,S){const T=this.layers[0].layout,k=T.get("line-join").evaluate(n,{}),$=T.get("line-cap"),L=T.get("line-miter-limit"),z=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const N of h)this.addLine(N,n,k,$,L,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,S,_)}addLine(n,h,p,_,S,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<n.length-1;le++)this.totalDistance+=n[le].dist(n[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k=bN[h.type]==="Polygon";let $=n.length;for(;$>=2&&n[$-1].equals(n[$-2]);)$--;let L=0;for(;L<$-1&&n[L].equals(n[L+1]);)L++;if($<(k?3:2))return;p==="bevel"&&(S=1.05);const z=this.overscaling<=16?15*Jt/(512*this.overscaling):0,N=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let V,H,Z,Q,se;this.e1=this.e2=-1,k&&(V=n[$-2],se=n[L].sub(V)._unit()._perp());for(let le=L;le<$;le++){if(Z=le===$-1?k?n[L+1]:void 0:n[le+1],Z&&n[le].equals(Z))continue;se&&(Q=se),V&&(H=V),V=n[le],se=Z?Z.sub(V)._unit()._perp():Q,Q=Q||se;let we=Q.add(se);we.x===0&&we.y===0||we._unit();const ce=Q.x*se.x+Q.y*se.y,ye=we.x*se.x+we.y*se.y,Le=ye!==0?1/ye:1/0,De=2*Math.sqrt(2-2*ye),et=ye<wN&&H&&Z,dt=Q.x*se.y-Q.y*se.x>0;if(et&&le>L){const qe=V.dist(H);if(qe>2*z){const ot=V.sub(V.sub(H)._mult(z/qe)._round());this.updateDistance(H,ot),this.addCurrentVertex(ot,Q,0,0,N),H=ot}}const Qe=H&&Z;let Xe=Qe?p:k?"butt":_;if(Qe&&Xe==="round"&&(Le<T?Xe="miter":Le<=2&&(Xe="fakeround")),Xe==="miter"&&Le>S&&(Xe="bevel"),Xe==="bevel"&&(Le>2&&(Xe="flipbevel"),Le<S&&(Xe="miter")),H&&this.updateDistance(H,V),Xe==="miter")we._mult(Le),this.addCurrentVertex(V,we,0,0,N);else if(Xe==="flipbevel"){if(Le>100)we=se.mult(-1);else{const qe=Le*Q.add(se).mag()/Q.sub(se).mag();we._perp()._mult(qe*(dt?-1:1))}this.addCurrentVertex(V,we,0,0,N),this.addCurrentVertex(V,we.mult(-1),0,0,N)}else if(Xe==="bevel"||Xe==="fakeround"){const qe=-Math.sqrt(Le*Le-1),ot=dt?qe:0,Ke=dt?0:qe;if(H&&this.addCurrentVertex(V,Q,ot,Ke,N),Xe==="fakeround"){const je=Math.round(180*De/Math.PI/20);for(let _t=1;_t<je;_t++){let mt=_t/je;if(mt!==.5){const Li=mt-.5;mt+=mt*Li*(mt-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*Li*Li+(.848013+ce*(.215638*ce-1.06021)))}const Wt=se.sub(Q)._mult(mt)._add(Q)._unit()._mult(dt?-1:1);this.addHalfVertex(V,Wt.x,Wt.y,!1,dt,0,N)}}Z&&this.addCurrentVertex(V,se,-ot,-Ke,N)}else if(Xe==="butt")this.addCurrentVertex(V,we,0,0,N);else if(Xe==="square"){const qe=H?1:-1;this.addCurrentVertex(V,we,qe,qe,N)}else Xe==="round"&&(H&&(this.addCurrentVertex(V,Q,0,0,N),this.addCurrentVertex(V,Q,1,1,N,!0)),Z&&(this.addCurrentVertex(V,se,-1,-1,N,!0),this.addCurrentVertex(V,se,0,0,N)));if(et&&le<$-1){const qe=V.dist(Z);if(qe>2*z){const ot=V.add(Z.sub(V)._mult(z/qe)._round());this.updateDistance(V,ot),this.addCurrentVertex(ot,se,0,0,N),V=ot}}}}addCurrentVertex(n,h,p,_,S,T=!1){const k=h.y*_-h.x,$=-h.y-h.x*_;this.addHalfVertex(n,h.x+h.y*p,h.y-h.x*p,T,!1,p,S),this.addHalfVertex(n,k,$,T,!0,-_,S),this.distance>qE/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,h,p,_,S,T))}addHalfVertex({x:n,y:h},p,_,S,T,k,$){const L=.5*(this.lineClips?this.scaledDistance*(qE-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(S?1:0),(h<<1)+(T?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(k===0?0:k<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=$.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),$.primitiveLength++),T?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,h){this.distance+=n.dist(h),this.updateScaledDistance()}}let HE,WE;st("LineBucket",Pw,{omit:["layers","patternFeatures"]});var ZE={get paint(){return WE=WE||new vs({"line-opacity":new bt($e.paint_line["line-opacity"]),"line-color":new bt($e.paint_line["line-color"]),"line-translate":new yt($e.paint_line["line-translate"]),"line-translate-anchor":new yt($e.paint_line["line-translate-anchor"]),"line-width":new bt($e.paint_line["line-width"]),"line-gap-width":new bt($e.paint_line["line-gap-width"]),"line-offset":new bt($e.paint_line["line-offset"]),"line-blur":new bt($e.paint_line["line-blur"]),"line-dasharray":new dm($e.paint_line["line-dasharray"]),"line-pattern":new ll($e.paint_line["line-pattern"]),"line-gradient":new Wu($e.paint_line["line-gradient"])})},get layout(){return HE=HE||new vs({"line-cap":new yt($e.layout_line["line-cap"]),"line-join":new bt($e.layout_line["line-join"]),"line-miter-limit":new yt($e.layout_line["line-miter-limit"]),"line-round-limit":new yt($e.layout_line["line-round-limit"]),"line-sort-key":new bt($e.layout_line["line-sort-key"])})}};class xN extends bt{possiblyEvaluate(n,h){return h=new $i(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(n,h)}evaluate(n,h,p,_){return h=Ve({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(n,h,p,_)}}let s_;class SN extends Pn{constructor(n){super(n,ZE),this.gradientVersion=0,s_||(s_=new xN(ZE.paint.properties["line-width"].specification),s_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Kl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,h){super.recalculate(n,h),this.paint._values["line-floorwidth"]=s_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Pw(n)}queryRadius(n){const h=n,p=JE(Im("line-width",this,h),Im("line-gap-width",this,h)),_=Im("line-offset",this,h);return p/2+Math.abs(_)+Y0(this.paint.get("line-translate"))}queryIntersectsFeature(n,h,p,_,S,T,k){const $=X0(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,k),L=k/2*JE(this.paint.get("line-width").evaluate(h,p),this.paint.get("line-gap-width").evaluate(h,p)),z=this.paint.get("line-offset").evaluate(h,p);return z&&(_=function(N,V){const H=[];for(let Z=0;Z<N.length;Z++){const Q=N[Z],se=[];for(let le=0;le<Q.length;le++){const we=Q[le-1],ce=Q[le],ye=Q[le+1],Le=le===0?new E(0,0):ce.sub(we)._unit()._perp(),De=le===Q.length-1?new E(0,0):ye.sub(ce)._unit()._perp(),et=Le._add(De)._unit(),dt=et.x*De.x+et.y*De.y;dt!==0&&et._mult(1/dt),se.push(et._mult(V)._add(ce))}H.push(se)}return H}(_,z*k)),function(N,V,H){for(let Z=0;Z<V.length;Z++){const Q=V[Z];if(N.length>=3){for(let se=0;se<Q.length;se++)if(tp(N,Q[se]))return!0}if(J0(N,Q,H))return!0}return!1}($,_,L)}isTileClipped(){return!0}}function JE(c,n){return n>0?n+2*c:c}const TN=nr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),MN=nr([{name:"a_projected_pos",components:3,type:"Float32"}],4);nr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const IN=nr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);nr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const KE=nr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),EN=nr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function kN(c,n,h){return c.sections.forEach(p=>{p.text=function(_,S,T){const k=S.layout.get("text-transform").evaluate(T,{});return k==="uppercase"?_=_.toLocaleUpperCase():k==="lowercase"&&(_=_.toLocaleLowerCase()),al.applyArabicShaping&&(_=al.applyArabicShaping(_)),_}(p.text,n,h)}),c}nr([{name:"triangle",components:3,type:"Uint16"}]),nr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),nr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),nr([{type:"Float32",name:"offsetX"}]),nr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),nr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Rm={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var br=24,YE=_i,XE=function(c,n,h,p,_){var S,T,k=8*_-p-1,$=(1<<k)-1,L=$>>1,z=-7,N=h?_-1:0,V=h?-1:1,H=c[n+N];for(N+=V,S=H&(1<<-z)-1,H>>=-z,z+=k;z>0;S=256*S+c[n+N],N+=V,z-=8);for(T=S&(1<<-z)-1,S>>=-z,z+=p;z>0;T=256*T+c[n+N],N+=V,z-=8);if(S===0)S=1-L;else{if(S===$)return T?NaN:1/0*(H?-1:1);T+=Math.pow(2,p),S-=L}return(H?-1:1)*T*Math.pow(2,S-p)},QE=function(c,n,h,p,_,S){var T,k,$,L=8*S-_-1,z=(1<<L)-1,N=z>>1,V=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=p?0:S-1,Z=p?1:-1,Q=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(k=isNaN(n)?1:0,T=z):(T=Math.floor(Math.log(n)/Math.LN2),n*($=Math.pow(2,-T))<1&&(T--,$*=2),(n+=T+N>=1?V/$:V*Math.pow(2,1-N))*$>=2&&(T++,$/=2),T+N>=z?(k=0,T=z):T+N>=1?(k=(n*$-1)*Math.pow(2,_),T+=N):(k=n*Math.pow(2,N-1)*Math.pow(2,_),T=0));_>=8;c[h+H]=255&k,H+=Z,k/=256,_-=8);for(T=T<<_|k,L+=_;L>0;c[h+H]=255&T,H+=Z,T/=256,L-=8);c[h+H-Z]|=128*Q};function _i(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}_i.Varint=0,_i.Fixed64=1,_i.Bytes=2,_i.Fixed32=5;var Cw=4294967296,e3=1/Cw,t3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ml(c){return c.type===_i.Bytes?c.readVarint()+c.pos:c.pos+1}function np(c,n,h){return h?4294967296*n+(c>>>0):4294967296*(n>>>0)+(c>>>0)}function i3(c,n,h){var p=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));h.realloc(p);for(var _=h.pos-1;_>=c;_--)h.buf[_+p]=h.buf[_]}function AN(c,n){for(var h=0;h<c.length;h++)n.writeVarint(c[h])}function PN(c,n){for(var h=0;h<c.length;h++)n.writeSVarint(c[h])}function CN(c,n){for(var h=0;h<c.length;h++)n.writeFloat(c[h])}function $N(c,n){for(var h=0;h<c.length;h++)n.writeDouble(c[h])}function ON(c,n){for(var h=0;h<c.length;h++)n.writeBoolean(c[h])}function LN(c,n){for(var h=0;h<c.length;h++)n.writeFixed32(c[h])}function RN(c,n){for(var h=0;h<c.length;h++)n.writeSFixed32(c[h])}function DN(c,n){for(var h=0;h<c.length;h++)n.writeFixed64(c[h])}function zN(c,n){for(var h=0;h<c.length;h++)n.writeSFixed64(c[h])}function n_(c,n){return(c[n]|c[n+1]<<8|c[n+2]<<16)+16777216*c[n+3]}function op(c,n,h){c[h]=n,c[h+1]=n>>>8,c[h+2]=n>>>16,c[h+3]=n>>>24}function r3(c,n){return(c[n]|c[n+1]<<8|c[n+2]<<16)+(c[n+3]<<24)}_i.prototype={destroy:function(){this.buf=null},readFields:function(c,n,h){for(h=h||this.length;this.pos<h;){var p=this.readVarint(),_=p>>3,S=this.pos;this.type=7&p,c(_,n,this),this.pos===S&&this.skip(p)}return n},readMessage:function(c,n){return this.readFields(c,n,this.readVarint()+this.pos)},readFixed32:function(){var c=n_(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=r3(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=n_(this.buf,this.pos)+n_(this.buf,this.pos+4)*Cw;return this.pos+=8,c},readSFixed64:function(){var c=n_(this.buf,this.pos)+r3(this.buf,this.pos+4)*Cw;return this.pos+=8,c},readFloat:function(){var c=XE(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=XE(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var n,h,p=this.buf;return n=127&(h=p[this.pos++]),h<128?n:(n|=(127&(h=p[this.pos++]))<<7,h<128?n:(n|=(127&(h=p[this.pos++]))<<14,h<128?n:(n|=(127&(h=p[this.pos++]))<<21,h<128?n:function(_,S,T){var k,$,L=T.buf;if(k=(112&($=L[T.pos++]))>>4,$<128||(k|=(127&($=L[T.pos++]))<<3,$<128)||(k|=(127&($=L[T.pos++]))<<10,$<128)||(k|=(127&($=L[T.pos++]))<<17,$<128)||(k|=(127&($=L[T.pos++]))<<24,$<128)||(k|=(1&($=L[T.pos++]))<<31,$<128))return np(_,k,S);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(h=p[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,n=this.pos;return this.pos=c,c-n>=12&&t3?function(h,p,_){return t3.decode(h.subarray(p,_))}(this.buf,n,c):function(h,p,_){for(var S="",T=p;T<_;){var k,$,L,z=h[T],N=null,V=z>239?4:z>223?3:z>191?2:1;if(T+V>_)break;V===1?z<128&&(N=z):V===2?(192&(k=h[T+1]))==128&&(N=(31&z)<<6|63&k)<=127&&(N=null):V===3?($=h[T+2],(192&(k=h[T+1]))==128&&(192&$)==128&&((N=(15&z)<<12|(63&k)<<6|63&$)<=2047||N>=55296&&N<=57343)&&(N=null)):V===4&&($=h[T+2],L=h[T+3],(192&(k=h[T+1]))==128&&(192&$)==128&&(192&L)==128&&((N=(15&z)<<18|(63&k)<<12|(63&$)<<6|63&L)<=65535||N>=1114112)&&(N=null)),N===null?(N=65533,V=1):N>65535&&(N-=65536,S+=String.fromCharCode(N>>>10&1023|55296),N=56320|1023&N),S+=String.fromCharCode(N),T+=V}return S}(this.buf,n,c)},readBytes:function(){var c=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,c);return this.pos=c,n},readPackedVarint:function(c,n){if(this.type!==_i.Bytes)return c.push(this.readVarint(n));var h=ml(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(n));return c},readPackedSVarint:function(c){if(this.type!==_i.Bytes)return c.push(this.readSVarint());var n=ml(this);for(c=c||[];this.pos<n;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==_i.Bytes)return c.push(this.readBoolean());var n=ml(this);for(c=c||[];this.pos<n;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==_i.Bytes)return c.push(this.readFloat());var n=ml(this);for(c=c||[];this.pos<n;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==_i.Bytes)return c.push(this.readDouble());var n=ml(this);for(c=c||[];this.pos<n;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==_i.Bytes)return c.push(this.readFixed32());var n=ml(this);for(c=c||[];this.pos<n;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==_i.Bytes)return c.push(this.readSFixed32());var n=ml(this);for(c=c||[];this.pos<n;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==_i.Bytes)return c.push(this.readFixed64());var n=ml(this);for(c=c||[];this.pos<n;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==_i.Bytes)return c.push(this.readSFixed64());var n=ml(this);for(c=c||[];this.pos<n;)c.push(this.readSFixed64());return c},skip:function(c){var n=7&c;if(n===_i.Varint)for(;this.buf[this.pos++]>127;);else if(n===_i.Bytes)this.pos=this.readVarint()+this.pos;else if(n===_i.Fixed32)this.pos+=4;else{if(n!==_i.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(c,n){this.writeVarint(c<<3|n)},realloc:function(c){for(var n=this.length||16;n<this.pos+c;)n*=2;if(n!==this.length){var h=new Uint8Array(n);h.set(this.buf),this.buf=h,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),op(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),op(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),op(this.buf,-1&c,this.pos),op(this.buf,Math.floor(c*e3),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),op(this.buf,-1&c,this.pos),op(this.buf,Math.floor(c*e3),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(n,h){var p,_;if(n>=0?(p=n%4294967296|0,_=n/4294967296|0):(_=~(-n/4294967296),4294967295^(p=~(-n%4294967296))?p=p+1|0:(p=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,T,k){k.buf[k.pos++]=127&S|128,S>>>=7,k.buf[k.pos++]=127&S|128,S>>>=7,k.buf[k.pos++]=127&S|128,S>>>=7,k.buf[k.pos++]=127&S|128,k.buf[k.pos]=127&(S>>>=7)}(p,0,h),function(S,T){var k=(7&S)<<4;T.buf[T.pos++]|=k|((S>>>=3)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S)))))}(_,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var n=this.pos;this.pos=function(p,_,S){for(var T,k,$=0;$<_.length;$++){if((T=_.charCodeAt($))>55295&&T<57344){if(!k){T>56319||$+1===_.length?(p[S++]=239,p[S++]=191,p[S++]=189):k=T;continue}if(T<56320){p[S++]=239,p[S++]=191,p[S++]=189,k=T;continue}T=k-55296<<10|T-56320|65536,k=null}else k&&(p[S++]=239,p[S++]=191,p[S++]=189,k=null);T<128?p[S++]=T:(T<2048?p[S++]=T>>6|192:(T<65536?p[S++]=T>>12|224:(p[S++]=T>>18|240,p[S++]=T>>12&63|128),p[S++]=T>>6&63|128),p[S++]=63&T|128)}return S}(this.buf,c,this.pos);var h=this.pos-n;h>=128&&i3(n,h,this),this.pos=n-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),QE(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),QE(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var n=c.length;this.writeVarint(n),this.realloc(n);for(var h=0;h<n;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,n){this.pos++;var h=this.pos;c(n,this);var p=this.pos-h;p>=128&&i3(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p},writeMessage:function(c,n,h){this.writeTag(c,_i.Bytes),this.writeRawMessage(n,h)},writePackedVarint:function(c,n){n.length&&this.writeMessage(c,AN,n)},writePackedSVarint:function(c,n){n.length&&this.writeMessage(c,PN,n)},writePackedBoolean:function(c,n){n.length&&this.writeMessage(c,ON,n)},writePackedFloat:function(c,n){n.length&&this.writeMessage(c,CN,n)},writePackedDouble:function(c,n){n.length&&this.writeMessage(c,$N,n)},writePackedFixed32:function(c,n){n.length&&this.writeMessage(c,LN,n)},writePackedSFixed32:function(c,n){n.length&&this.writeMessage(c,RN,n)},writePackedFixed64:function(c,n){n.length&&this.writeMessage(c,DN,n)},writePackedSFixed64:function(c,n){n.length&&this.writeMessage(c,zN,n)},writeBytesField:function(c,n){this.writeTag(c,_i.Bytes),this.writeBytes(n)},writeFixed32Field:function(c,n){this.writeTag(c,_i.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(c,n){this.writeTag(c,_i.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(c,n){this.writeTag(c,_i.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(c,n){this.writeTag(c,_i.Fixed64),this.writeSFixed64(n)},writeVarintField:function(c,n){this.writeTag(c,_i.Varint),this.writeVarint(n)},writeSVarintField:function(c,n){this.writeTag(c,_i.Varint),this.writeSVarint(n)},writeStringField:function(c,n){this.writeTag(c,_i.Bytes),this.writeString(n)},writeFloatField:function(c,n){this.writeTag(c,_i.Fixed32),this.writeFloat(n)},writeDoubleField:function(c,n){this.writeTag(c,_i.Fixed64),this.writeDouble(n)},writeBooleanField:function(c,n){this.writeVarintField(c,!!n)}};var $w=y(YE);const Ow=3;function NN(c,n,h){c===1&&h.readMessage(FN,n)}function FN(c,n,h){if(c===3){const{id:p,bitmap:_,width:S,height:T,left:k,top:$,advance:L}=h.readMessage(BN,{});n.push({id:p,bitmap:new km({width:S+2*Ow,height:T+2*Ow},_),metrics:{width:S,height:T,left:k,top:$,advance:L}})}}function BN(c,n,h){c===1?n.id=h.readVarint():c===2?n.bitmap=h.readBytes():c===3?n.width=h.readVarint():c===4?n.height=h.readVarint():c===5?n.left=h.readSVarint():c===6?n.top=h.readSVarint():c===7&&(n.advance=h.readVarint())}const s3=Ow;function n3(c){let n=0,h=0;for(const T of c)n+=T.w*T.h,h=Math.max(h,T.w);c.sort((T,k)=>k.h-T.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),h),h:1/0}];let _=0,S=0;for(const T of c)for(let k=p.length-1;k>=0;k--){const $=p[k];if(!(T.w>$.w||T.h>$.h)){if(T.x=$.x,T.y=$.y,S=Math.max(S,T.y+T.h),_=Math.max(_,T.x+T.w),T.w===$.w&&T.h===$.h){const L=p.pop();k<p.length&&(p[k]=L)}else T.h===$.h?($.x+=T.w,$.w-=T.w):T.w===$.w?($.y+=T.h,$.h-=T.h):(p.push({x:$.x+T.w,y:$.y,w:$.w-T.w,h:T.h}),$.y+=T.h,$.h-=T.h);break}}return{w:_,h:S,fill:n/(_*S)||0}}const qs=1;class Lw{constructor(n,{pixelRatio:h,version:p,stretchX:_,stretchY:S,content:T}){this.paddedRect=n,this.pixelRatio=h,this.stretchX=_,this.stretchY=S,this.content=T,this.version=p}get tl(){return[this.paddedRect.x+qs,this.paddedRect.y+qs]}get br(){return[this.paddedRect.x+this.paddedRect.w-qs,this.paddedRect.y+this.paddedRect.h-qs]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*qs)/this.pixelRatio,(this.paddedRect.h-2*qs)/this.pixelRatio]}}class o3{constructor(n,h){const p={},_={};this.haveRenderCallbacks=[];const S=[];this.addImages(n,p,S),this.addImages(h,_,S);const{w:T,h:k}=n3(S),$=new On({width:T||1,height:k||1});for(const L in n){const z=n[L],N=p[L].paddedRect;On.copy(z.data,$,{x:0,y:0},{x:N.x+qs,y:N.y+qs},z.data)}for(const L in h){const z=h[L],N=_[L].paddedRect,V=N.x+qs,H=N.y+qs,Z=z.data.width,Q=z.data.height;On.copy(z.data,$,{x:0,y:0},{x:V,y:H},z.data),On.copy(z.data,$,{x:0,y:Q-1},{x:V,y:H-1},{width:Z,height:1}),On.copy(z.data,$,{x:0,y:0},{x:V,y:H+Q},{width:Z,height:1}),On.copy(z.data,$,{x:Z-1,y:0},{x:V-1,y:H},{width:1,height:Q}),On.copy(z.data,$,{x:0,y:0},{x:V+Z,y:H},{width:1,height:Q})}this.image=$,this.iconPositions=p,this.patternPositions=_}addImages(n,h,p){for(const _ in n){const S=n[_],T={x:0,y:0,w:S.data.width+2*qs,h:S.data.height+2*qs};p.push(T),h[_]=new Lw(T,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(n,h){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in n.updatedImages)this.patchUpdatedImage(this.iconPositions[p],n.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],n.getImage(p),h)}patchUpdatedImage(n,h,p){if(!n||!h||n.version===h.version)return;n.version=h.version;const[_,S]=n.tl;p.update(h.data,void 0,{x:_,y:S})}}var yc;st("ImagePosition",Lw),st("ImageAtlas",o3),u.ah=void 0,(yc=u.ah||(u.ah={}))[yc.none=0]="none",yc[yc.horizontal=1]="horizontal",yc[yc.vertical=2]="vertical",yc[yc.horizontalOnly=3]="horizontalOnly";const Dm=-17;class zm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,h){const p=new zm;return p.scale=n||1,p.fontStack=h,p}static forImage(n){const h=new zm;return h.imageName=n,h}}class ap{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,h){const p=new ap;for(let _=0;_<n.sections.length;_++){const S=n.sections[_];S.image?p.addImageSection(S):p.addTextSection(S,h)}return p}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let h="";for(let p=0;p<n.length;p++){const _=n.charCodeAt(p+1)||null,S=n.charCodeAt(p-1)||null;h+=_&&am(_)&&!Rm[n[p+1]]||S&&am(S)&&!Rm[n[p-1]]||!Rm[n[p]]?n[p]:Rm[n[p]]}return h}(this.text)}trim(){let n=0;for(let p=0;p<this.text.length&&a_[this.text.charCodeAt(p)];p++)n++;let h=this.text.length;for(let p=this.text.length-1;p>=0&&p>=n&&a_[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(n,h),this.sectionIndex=this.sectionIndex.slice(n,h)}substring(n,h){const p=new ap;return p.text=this.text.substring(n,h),p.sectionIndex=this.sectionIndex.slice(n,h),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,h)=>Math.max(n,this.sections[h].scale),0)}addTextSection(n,h){this.text+=n.text,this.sections.push(zm.forText(n.scale,n.fontStack||h));const p=this.sections.length-1;for(let _=0;_<n.text.length;++_)this.sectionIndex.push(p)}addImageSection(n){const h=n.image?n.image.name:"";if(h.length===0)return void It("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(zm.forImage(h)),this.sectionIndex.push(this.sections.length-1)):It("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function o_(c,n,h,p,_,S,T,k,$,L,z,N,V,H,Z,Q){const se=ap.fromFeature(c,_);let le;N===u.ah.vertical&&se.verticalizePunctuation();const{processBidirectionalText:we,processStyledBidirectionalText:ce}=al;if(we&&se.sections.length===1){le=[];const De=we(se.toString(),Rw(se,L,S,n,p,H,Z));for(const et of De){const dt=new ap;dt.text=et,dt.sections=se.sections;for(let Qe=0;Qe<et.length;Qe++)dt.sectionIndex.push(0);le.push(dt)}}else if(ce){le=[];const De=ce(se.text,se.sectionIndex,Rw(se,L,S,n,p,H,Z));for(const et of De){const dt=new ap;dt.text=et[0],dt.sectionIndex=et[1],dt.sections=se.sections,le.push(dt)}}else le=function(De,et){const dt=[],Qe=De.text;let Xe=0;for(const qe of et)dt.push(De.substring(Xe,qe)),Xe=qe;return Xe<Qe.length&&dt.push(De.substring(Xe,Qe.length)),dt}(se,Rw(se,L,S,n,p,H,Z));const ye=[],Le={positionedLines:ye,text:se.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:N,iconsInText:!1,verticalizable:!1};return function(De,et,dt,Qe,Xe,qe,ot,Ke,je,_t,mt,Wt){let Li=0,zi=Dm,wr=0,mn=0;const xs=Ke==="right"?1:Ke==="left"?0:.5;let hr=0;for(const xr of Xe){xr.trim();const Sr=xr.getMaxScale(),ns=(Sr-1)*br,Ms={positionedGlyphs:[],lineOffset:0};De.positionedLines[hr]=Ms;const os=Ms.positionedGlyphs;let Hs=0;if(!xr.length()){zi+=qe,++hr;continue}for(let Tr=0;Tr<xr.length();Tr++){const Xt=xr.getSection(Tr),as=xr.getSectionIndex(Tr),Jr=xr.getCharCode(Tr);let Mr=0,ro=null,Io=null,Eo=null,yl=br;const so=!(je===u.ah.horizontal||!mt&&!Hd(Jr)||mt&&(a_[Jr]||(Nr=Jr,tt.Arabic(Nr)||tt["Arabic Supplement"](Nr)||tt["Arabic Extended-A"](Nr)||tt["Arabic Presentation Forms-A"](Nr)||tt["Arabic Presentation Forms-B"](Nr))));if(Xt.imageName){const Rn=Qe[Xt.imageName];if(!Rn)continue;Eo=Xt.imageName,De.iconsInText=De.iconsInText||!0,Io=Rn.paddedRect;const Zs=Rn.displaySize;Xt.scale=Xt.scale*br/Wt,ro={width:Zs[0],height:Zs[1],left:qs,top:-s3,advance:so?Zs[1]:Zs[0]},Mr=ns+(br-Zs[1]*Xt.scale),yl=ro.advance;const gl=so?Zs[0]*Xt.scale-br*Sr:Zs[1]*Xt.scale-br*Sr;gl>0&&gl>Hs&&(Hs=gl)}else{const Rn=dt[Xt.fontStack],Zs=Rn&&Rn[Jr];if(Zs&&Zs.rect)Io=Zs.rect,ro=Zs.metrics;else{const gl=et[Xt.fontStack],Vm=gl&&gl[Jr];if(!Vm)continue;ro=Vm.metrics}Mr=(Sr-Xt.scale)*br}so?(De.verticalizable=!0,os.push({glyph:Jr,imageName:Eo,x:Li,y:zi+Mr,vertical:so,scale:Xt.scale,fontStack:Xt.fontStack,sectionIndex:as,metrics:ro,rect:Io}),Li+=yl*Xt.scale+_t):(os.push({glyph:Jr,imageName:Eo,x:Li,y:zi+Mr,vertical:so,scale:Xt.scale,fontStack:Xt.fontStack,sectionIndex:as,metrics:ro,rect:Io}),Li+=ro.advance*Xt.scale+_t)}os.length!==0&&(wr=Math.max(Li-_t,wr),UN(os,0,os.length-1,xs,Hs)),Li=0;const Ws=qe*Sr+Hs;Ms.lineOffset=Math.max(Hs,ns),zi+=Ws,mn=Math.max(Ws,mn),++hr}var Nr;const Zr=zi-Dm,{horizontalAlign:Ss,verticalAlign:Ts}=Dw(ot);(function(xr,Sr,ns,Ms,os,Hs,Ws,Tr,Xt){const as=(Sr-ns)*os;let Jr=0;Jr=Hs!==Ws?-Tr*Ms-Dm:(-Ms*Xt+.5)*Ws;for(const Mr of xr)for(const ro of Mr.positionedGlyphs)ro.x+=as,ro.y+=Jr})(De.positionedLines,xs,Ss,Ts,wr,mn,qe,Zr,Xe.length),De.top+=-Ts*Zr,De.bottom=De.top+Zr,De.left+=-Ss*wr,De.right=De.left+wr}(Le,n,h,p,le,T,k,$,N,L,V,Q),!function(De){for(const et of De)if(et.positionedGlyphs.length!==0)return!1;return!0}(ye)&&Le}const a_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function a3(c,n,h,p,_,S){if(n.imageName){const T=p[n.imageName];return T?T.displaySize[0]*n.scale*br/S+_:0}{const T=h[n.fontStack],k=T&&T[c];return k?k.metrics.advance*n.scale+_:0}}function l3(c,n,h,p){const _=Math.pow(c-n,2);return p?c<n?_/2:2*_:_+Math.abs(h)*h}function VN(c,n,h){let p=0;return c===10&&(p-=1e4),h&&(p+=150),c!==40&&c!==65288||(p+=50),n!==41&&n!==65289||(p+=50),p}function c3(c,n,h,p,_,S){let T=null,k=l3(n,h,_,S);for(const $ of p){const L=l3(n-$.x,h,_,S)+$.badness;L<=k&&(T=$,k=L)}return{index:c,x:n,priorBreak:T,badness:k}}function u3(c){return c?u3(c.priorBreak).concat(c.index):[]}function Rw(c,n,h,p,_,S,T){if(S!=="point")return[];if(!c)return[];const k=[],$=function(V,H,Z,Q,se,le){let we=0;for(let ce=0;ce<V.length();ce++){const ye=V.getSection(ce);we+=a3(V.getCharCode(ce),ye,Q,se,H,le)}return we/Math.max(1,Math.ceil(we/Z))}(c,n,h,p,_,T),L=c.text.indexOf("​")>=0;let z=0;for(let V=0;V<c.length();V++){const H=c.getSection(V),Z=c.getCharCode(V);if(a_[Z]||(z+=a3(Z,H,p,_,n,T)),V<c.length()-1){const Q=!((N=Z)<11904||!(tt["Bopomofo Extended"](N)||tt.Bopomofo(N)||tt["CJK Compatibility Forms"](N)||tt["CJK Compatibility Ideographs"](N)||tt["CJK Compatibility"](N)||tt["CJK Radicals Supplement"](N)||tt["CJK Strokes"](N)||tt["CJK Symbols and Punctuation"](N)||tt["CJK Unified Ideographs Extension A"](N)||tt["CJK Unified Ideographs"](N)||tt["Enclosed CJK Letters and Months"](N)||tt["Halfwidth and Fullwidth Forms"](N)||tt.Hiragana(N)||tt["Ideographic Description Characters"](N)||tt["Kangxi Radicals"](N)||tt["Katakana Phonetic Extensions"](N)||tt.Katakana(N)||tt["Vertical Forms"](N)||tt["Yi Radicals"](N)||tt["Yi Syllables"](N)));(jN[Z]||Q||H.imageName)&&k.push(c3(V+1,z,$,k,VN(Z,c.getCharCode(V+1),Q&&L),!1))}}var N;return u3(c3(c.length(),z,$,k,0,!0))}function Dw(c){let n=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:n,verticalAlign:h}}function UN(c,n,h,p,_){if(!p&&!_)return;const S=c[h],T=(c[h].x+S.metrics.advance*S.scale)*p;for(let k=n;k<=h;k++)c[k].x-=T,c[k].y+=_}function GN(c,n,h){const{horizontalAlign:p,verticalAlign:_}=Dw(h),S=n[0]-c.displaySize[0]*p,T=n[1]-c.displaySize[1]*_;return{image:c,top:T,bottom:T+c.displaySize[1],left:S,right:S+c.displaySize[0]}}function h3(c,n,h,p,_,S){const T=c.image;let k;if(T.content){const se=T.content,le=T.pixelRatio||1;k=[se[0]/le,se[1]/le,T.displaySize[0]-se[2]/le,T.displaySize[1]-se[3]/le]}const $=n.left*S,L=n.right*S;let z,N,V,H;h==="width"||h==="both"?(H=_[0]+$-p[3],N=_[0]+L+p[1]):(H=_[0]+($+L-T.displaySize[0])/2,N=H+T.displaySize[0]);const Z=n.top*S,Q=n.bottom*S;return h==="height"||h==="both"?(z=_[1]+Z-p[0],V=_[1]+Q+p[2]):(z=_[1]+(Z+Q-T.displaySize[1])/2,V=z+T.displaySize[1]),{image:T,top:z,right:N,bottom:V,left:H,collisionPadding:k}}const Nm=255,fa=128,gc=Nm*fa;function d3(c,n){const{expression:h}=n;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new $i(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=h;let S=0;for(;S<p.length&&p[S]<=c;)S++;S=Math.max(0,S-1);let T=S;for(;T<p.length&&p[T]<c+1;)T++;T=Math.min(p.length-1,T);const k=p[S],$=p[T];return h.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:$,interpolationType:_}:{kind:"camera",minZoom:k,maxZoom:$,minSize:h.evaluate(new $i(k)),maxSize:h.evaluate(new $i($)),interpolationType:_}}}function zw(c,n,h){let p="never";const _=c.get(n);return _?p=_:c.get(h)&&(p="always"),p}const qN=mc.VectorTileFeature.types,HN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function l_(c,n,h,p,_,S,T,k,$,L,z,N,V){const H=k?Math.min(gc,Math.round(k[0])):0,Z=k?Math.min(gc,Math.round(k[1])):0;c.emplaceBack(n,h,Math.round(32*p),Math.round(32*_),S,T,(H<<1)+($?1:0),Z,16*L,16*z,256*N,256*V)}function Nw(c,n,h){c.emplaceBack(n.x,n.y,h),c.emplaceBack(n.x,n.y,h),c.emplaceBack(n.x,n.y,h),c.emplaceBack(n.x,n.y,h)}function WN(c){for(const n of c.sections)if(j0(n.text))return!0;return!1}class Fw{constructor(n){this.layoutVertexArray=new he,this.indexArray=new Ee,this.programConfigurations=n,this.segments=new Fe,this.dynamicLayoutVertexArray=new Me,this.opacityVertexArray=new oe,this.hasVisibleVertices=!1,this.placedSymbolArray=new o}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,h,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,TN.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,MN.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,HN,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",Fw);class Bw{constructor(n,h,p){this.layoutVertexArray=new n,this.layoutAttributes=h,this.indexArray=new p,this.segments=new Fe,this.collisionVertexArray=new Ie}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,IN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",Bw);class lp{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(T=>T.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gw([]),this.placementViewportMatrix=gw([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=d3(this.zoom,h["text-size"]),this.iconSizeData=d3(this.zoom,h["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),S=p.get("symbol-z-order");this.canOverlap=zw(p,"text-overlap","text-allow-overlap")!=="never"||zw(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(T=>u.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=n.sourceID}createArrays(){this.text=new Fw(new Di(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Fw(new Di(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new g,this.lineVertexArray=new x,this.symbolInstances=new f,this.textAnchorOffsets=new C}calculateGlyphDependencies(n,h,p,_,S){for(let T=0;T<n.length;T++)if(h[n.charCodeAt(T)]=!0,(p||_)&&S){const k=Rm[n.charAt(T)];k&&(h[k.charCodeAt(0)]=!0)}}populate(n,h,p){const _=this.layers[0],S=_.layout,T=S.get("text-font"),k=S.get("text-field"),$=S.get("icon-image"),L=(k.value.kind!=="constant"||k.value.value instanceof Bs&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),z=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,N=S.get("symbol-sort-key");if(this.features=[],!L&&!z)return;const V=h.iconDependencies,H=h.glyphDependencies,Z=h.availableImages,Q=new $i(this.zoom);for(const{feature:se,id:le,index:we,sourceLayerIndex:ce}of n){const ye=_._featureFilter.needGeometry,Le=pl(se,ye);if(!_._featureFilter.filter(Q,Le,p))continue;let De,et;if(ye||(Le.geometry=dl(se)),L){const Qe=_.getValueAndResolveTokens("text-field",Le,p,Z),Xe=Bs.factory(Qe),qe=this.hasRTLText=this.hasRTLText||WN(Xe);(!qe||al.getRTLTextPluginStatus()==="unavailable"||qe&&al.isParsed())&&(De=kN(Xe,_,Le))}if(z){const Qe=_.getValueAndResolveTokens("icon-image",Le,p,Z);et=Qe instanceof dn?Qe:dn.fromString(Qe)}if(!De&&!et)continue;const dt=this.sortFeaturesByKey?N.evaluate(Le,{},p):void 0;if(this.features.push({id:le,text:De,icon:et,index:we,sourceLayerIndex:ce,geometry:Le.geometry,properties:se.properties,type:qN[se.type],sortKey:dt}),et&&(V[et.name]=!0),De){const Qe=T.evaluate(Le,{},p).join(","),Xe=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const qe of De.sections)if(qe.image)V[qe.image.name]=!0;else{const ot=qu(De.toString()),Ke=qe.fontStack||Qe,je=H[Ke]=H[Ke]||{};this.calculateGlyphDependencies(qe.text,je,Xe,this.allowVerticalPlacement,ot)}}}S.get("symbol-placement")==="line"&&(this.features=function(se){const le={},we={},ce=[];let ye=0;function Le(Qe){ce.push(se[Qe]),ye++}function De(Qe,Xe,qe){const ot=we[Qe];return delete we[Qe],we[Xe]=ot,ce[ot].geometry[0].pop(),ce[ot].geometry[0]=ce[ot].geometry[0].concat(qe[0]),ot}function et(Qe,Xe,qe){const ot=le[Xe];return delete le[Xe],le[Qe]=ot,ce[ot].geometry[0].shift(),ce[ot].geometry[0]=qe[0].concat(ce[ot].geometry[0]),ot}function dt(Qe,Xe,qe){const ot=qe?Xe[0][Xe[0].length-1]:Xe[0][0];return`${Qe}:${ot.x}:${ot.y}`}for(let Qe=0;Qe<se.length;Qe++){const Xe=se[Qe],qe=Xe.geometry,ot=Xe.text?Xe.text.toString():null;if(!ot){Le(Qe);continue}const Ke=dt(ot,qe),je=dt(ot,qe,!0);if(Ke in we&&je in le&&we[Ke]!==le[je]){const _t=et(Ke,je,qe),mt=De(Ke,je,ce[_t].geometry);delete le[Ke],delete we[je],we[dt(ot,ce[mt].geometry,!0)]=mt,ce[_t].geometry=null}else Ke in we?De(Ke,je,qe):je in le?et(Ke,je,qe):(Le(Qe),le[Ke]=ye-1,we[je]=ye-1)}return ce.filter(Qe=>Qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,le)=>se.sortKey-le.sortKey)}update(n,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(n,h,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,h){const p=this.lineVertexArray.length;if(n.segment!==void 0){let _=n.dist(h[n.segment+1]),S=n.dist(h[n.segment]);const T={};for(let k=n.segment+1;k<h.length;k++)T[k]={x:h[k].x,y:h[k].y,tileUnitDistanceFromAnchor:_},k<h.length-1&&(_+=h[k+1].dist(h[k]));for(let k=n.segment||0;k>=0;k--)T[k]={x:h[k].x,y:h[k].y,tileUnitDistanceFromAnchor:S},k>0&&(S+=h[k-1].dist(h[k]));for(let k=0;k<h.length;k++){const $=T[k];this.lineVertexArray.emplaceBack($.x,$.y,$.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(n,h,p,_,S,T,k,$,L,z,N,V){const H=n.indexArray,Z=n.layoutVertexArray,Q=n.segments.prepareSegment(4*h.length,Z,H,this.canOverlap?T.sortKey:void 0),se=this.glyphOffsetArray.length,le=Q.vertexLength,we=this.allowVerticalPlacement&&k===u.ah.vertical?Math.PI/2:0,ce=T.text&&T.text.sections;for(let ye=0;ye<h.length;ye++){const{tl:Le,tr:De,bl:et,br:dt,tex:Qe,pixelOffsetTL:Xe,pixelOffsetBR:qe,minFontScaleX:ot,minFontScaleY:Ke,glyphOffset:je,isSDF:_t,sectionIndex:mt}=h[ye],Wt=Q.vertexLength,Li=je[1];l_(Z,$.x,$.y,Le.x,Li+Le.y,Qe.x,Qe.y,p,_t,Xe.x,Xe.y,ot,Ke),l_(Z,$.x,$.y,De.x,Li+De.y,Qe.x+Qe.w,Qe.y,p,_t,qe.x,Xe.y,ot,Ke),l_(Z,$.x,$.y,et.x,Li+et.y,Qe.x,Qe.y+Qe.h,p,_t,Xe.x,qe.y,ot,Ke),l_(Z,$.x,$.y,dt.x,Li+dt.y,Qe.x+Qe.w,Qe.y+Qe.h,p,_t,qe.x,qe.y,ot,Ke),Nw(n.dynamicLayoutVertexArray,$,we),H.emplaceBack(Wt,Wt+1,Wt+2),H.emplaceBack(Wt+1,Wt+2,Wt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(je[0]),ye!==h.length-1&&mt===h[ye+1].sectionIndex||n.programConfigurations.populatePaintArrays(Z.length,T,T.index,{},V,ce&&ce[mt])}n.placedSymbolArray.emplaceBack($.x,$.y,se,this.glyphOffsetArray.length-se,le,L,z,$.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],k,0,!1,0,N)}_addCollisionDebugVertex(n,h,p,_,S,T){return h.emplaceBack(0,0),n.emplaceBack(p.x,p.y,_,S,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(n,h,p,_,S,T,k){const $=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),L=$.vertexLength,z=S.layoutVertexArray,N=S.collisionVertexArray,V=k.anchorX,H=k.anchorY;this._addCollisionDebugVertex(z,N,T,V,H,new E(n,h)),this._addCollisionDebugVertex(z,N,T,V,H,new E(p,h)),this._addCollisionDebugVertex(z,N,T,V,H,new E(p,_)),this._addCollisionDebugVertex(z,N,T,V,H,new E(n,_)),$.vertexLength+=4;const Z=S.indexArray;Z.emplaceBack(L,L+1),Z.emplaceBack(L+1,L+2),Z.emplaceBack(L+2,L+3),Z.emplaceBack(L+3,L),$.primitiveLength+=4}addDebugCollisionBoxes(n,h,p,_){for(let S=n;S<h;S++){const T=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,_?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bw(ge,KE.members,Pe),this.iconCollisionBox=new Bw(ge,KE.members,Pe);for(let n=0;n<this.symbolInstances.length;n++){const h=this.symbolInstances.get(n);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(n,h,p,_,S,T,k,$,L){const z={};for(let N=h;N<p;N++){const V=n.get(N);z.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.textFeatureIndex=V.featureIndex;break}for(let N=_;N<S;N++){const V=n.get(N);z.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.verticalTextFeatureIndex=V.featureIndex;break}for(let N=T;N<k;N++){const V=n.get(N);z.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.iconFeatureIndex=V.featureIndex;break}for(let N=$;N<L;N++){const V=n.get(N);z.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},z.verticalIconFeatureIndex=V.featureIndex;break}return z}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,h){const p=n.placedSymbolArray.get(h),_=p.vertexStartIndex+4*p.numGlyphs;for(let S=p.vertexStartIndex;S<_;S+=4)n.indexArray.emplaceBack(S,S+1,S+2),n.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(n),p=Math.cos(n),_=[],S=[],T=[];for(let k=0;k<this.symbolInstances.length;++k){T.push(k);const $=this.symbolInstances.get(k);_.push(0|Math.round(h*$.anchorX+p*$.anchorY)),S.push($.featureIndex)}return T.sort((k,$)=>_[k]-_[$]||S[$]-S[k]),T}addToSortKeyRanges(n,h){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const p=this.symbolInstances.get(h);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((_,S,T)=>{_>=0&&T.indexOf(_)===S&&this.addIndicesForPlacedSymbol(this.text,_)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let p3,f3;st("SymbolBucket",lp,{omit:["layers","collisionBoxArray","features","compareText"]}),lp.MAX_GLYPHS=65535,lp.addDynamicAttributes=Nw;var jw={get paint(){return f3=f3||new vs({"icon-opacity":new bt($e.paint_symbol["icon-opacity"]),"icon-color":new bt($e.paint_symbol["icon-color"]),"icon-halo-color":new bt($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new bt($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bt($e.paint_symbol["icon-halo-blur"]),"icon-translate":new yt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new yt($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new bt($e.paint_symbol["text-opacity"]),"text-color":new bt($e.paint_symbol["text-color"],{runtimeType:zr,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new bt($e.paint_symbol["text-halo-color"]),"text-halo-width":new bt($e.paint_symbol["text-halo-width"]),"text-halo-blur":new bt($e.paint_symbol["text-halo-blur"]),"text-translate":new yt($e.paint_symbol["text-translate"]),"text-translate-anchor":new yt($e.paint_symbol["text-translate-anchor"])})},get layout(){return p3=p3||new vs({"symbol-placement":new yt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new yt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bt($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yt($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new yt($e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new yt($e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new yt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new yt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new bt($e.layout_symbol["icon-size"]),"icon-text-fit":new yt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new bt($e.layout_symbol["icon-image"]),"icon-rotate":new bt($e.layout_symbol["icon-rotate"]),"icon-padding":new bt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new yt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new bt($e.layout_symbol["icon-offset"]),"icon-anchor":new bt($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yt($e.layout_symbol["text-rotation-alignment"]),"text-field":new bt($e.layout_symbol["text-field"]),"text-font":new bt($e.layout_symbol["text-font"]),"text-size":new bt($e.layout_symbol["text-size"]),"text-max-width":new bt($e.layout_symbol["text-max-width"]),"text-line-height":new yt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new bt($e.layout_symbol["text-letter-spacing"]),"text-justify":new bt($e.layout_symbol["text-justify"]),"text-radial-offset":new bt($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yt($e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new bt($e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new bt($e.layout_symbol["text-anchor"]),"text-max-angle":new yt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new yt($e.layout_symbol["text-writing-mode"]),"text-rotate":new bt($e.layout_symbol["text-rotate"]),"text-padding":new yt($e.layout_symbol["text-padding"]),"text-keep-upright":new yt($e.layout_symbol["text-keep-upright"]),"text-transform":new bt($e.layout_symbol["text-transform"]),"text-offset":new bt($e.layout_symbol["text-offset"]),"text-allow-overlap":new yt($e.layout_symbol["text-allow-overlap"]),"text-overlap":new yt($e.layout_symbol["text-overlap"]),"text-ignore-placement":new yt($e.layout_symbol["text-ignore-placement"]),"text-optional":new yt($e.layout_symbol["text-optional"])})}};class m3{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Qa,this.defaultValue=n}evaluate(n){if(n.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(n.formattedSection))return h.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",m3,{omit:["defaultValue"]});class c_ extends Pn{constructor(n){super(n,jw)}recalculate(n,h){if(super.recalculate(n,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const S of p)_.indexOf(S)<0&&_.push(S);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,h,p,_){const S=this.layout.get(n).evaluate(h,{},p,_),T=this._unevaluatedLayout._values[n];return T.isDataDriven()||Ii(T.value)||!S?S:function(k,$){return $.replace(/{([^{}]+)}/g,(L,z)=>k&&z in k?String(k[z]):"")}(h.properties,S)}createBucket(n){return new lp(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of jw.paint.overridableProperties){if(!c_.hasPaintOverride(this.layout,n))continue;const h=this.paint.get(n),p=new m3(h),_=new ju(p,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new rc("source",_):new Fd("composite",_,h.value.zoomStops),this.paint._values[n]=new An(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(n,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&c_.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,h){const p=n.get("text-field"),_=jw.paint.properties[h];let S=!1;const T=k=>{for(const $ of k)if(_.overrides&&_.overrides.hasOverride($))return void(S=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Bs)T(p.value.value.sections);else if(p.value.kind==="source"){const k=L=>{S||(L instanceof el&&cr(L.value)===So?T(L.value.sections):L instanceof Nd?T(L.sections):L.eachChild(k))},$=p.value;$._styleExpression&&k($._styleExpression.expression)}return S}}let y3;var ZN={get paint(){return y3=y3||new vs({"background-color":new yt($e.paint_background["background-color"]),"background-pattern":new dm($e.paint_background["background-pattern"]),"background-opacity":new yt($e.paint_background["background-opacity"])})}};class JN extends Pn{constructor(n){super(n,ZN)}}let g3;var KN={get paint(){return g3=g3||new vs({"raster-opacity":new yt($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new yt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new yt($e.paint_raster["raster-saturation"]),"raster-contrast":new yt($e.paint_raster["raster-contrast"]),"raster-resampling":new yt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new yt($e.paint_raster["raster-fade-duration"])})}};class YN extends Pn{constructor(n){super(n,KN)}}class XN extends Pn{constructor(n){super(n,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class QN{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Vw=63710088e-1;class _c{constructor(n,h){if(isNaN(n)||isNaN(h))throw new Error(`Invalid LngLat object: (${n}, ${h})`);if(this.lng=+n,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _c(Ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const h=Math.PI/180,p=this.lat*h,_=n.lat*h,S=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((n.lng-this.lng)*h);return Vw*Math.acos(Math.min(S,1))}static convert(n){if(n instanceof _c)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new _c(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new _c(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _3=2*Math.PI*Vw;function v3(c){return _3*Math.cos(c*Math.PI/180)}function b3(c){return(180+c)/360}function w3(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function x3(c,n){return c/v3(n)}function Uw(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class u_{constructor(n,h,p=0){this.x=+n,this.y=+h,this.z=+p}static fromLngLat(n,h=0){const p=_c.convert(n);return new u_(b3(p.lng),w3(p.lat),x3(h,p.lat))}toLngLat(){return new _c(360*this.x-180,Uw(this.y))}toAltitude(){return this.z*v3(Uw(this.y))}meterInMercatorCoordinateUnits(){return 1/_3*(n=Uw(this.y),1/Math.cos(n*Math.PI/180));var n}}function S3(c,n,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[c*p-2*Math.PI*6378137/2,n*p-2*Math.PI*6378137/2]}class Gw{constructor(n,h,p){if(n<0||n>25||p<0||p>=Math.pow(2,n)||h<0||h>=Math.pow(2,n))throw new Error(`x=${h}, y=${p}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=h,this.y=p,this.key=Fm(0,n,n,h,p)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,h,p){const _=(T=this.y,k=this.z,$=S3(256*(S=this.x),256*(T=Math.pow(2,k)-T-1),k),L=S3(256*(S+1),256*(T+1),k),$[0]+","+$[1]+","+L[0]+","+L[1]);var S,T,k,$,L;const z=function(N,V,H){let Z,Q="";for(let se=N;se>0;se--)Z=1<<se-1,Q+=(V&Z?1:0)+(H&Z?2:0);return Q}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,_)}isChildOf(n){const h=this.z-n.z;return h>0&&n.x===this.x>>h&&n.y===this.y>>h}getTilePoint(n){const h=Math.pow(2,this.z);return new E((n.x*h-this.x)*Jt,(n.y*h-this.y)*Jt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class T3{constructor(n,h){this.wrap=n,this.canonical=h,this.key=Fm(n,h.z,h.z,h.x,h.y)}}class Ln{constructor(n,h,p,_,S){if(n<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${p}`);this.overscaledZ=n,this.wrap=h,this.canonical=new Gw(p,+_,+S),this.key=Fm(h,n,p,_,S)}clone(){return new Ln(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-n;return n>this.canonical.z?new Ln(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ln(n,this.wrap,n,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(n,h){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-n;return n>this.canonical.z?Fm(this.wrap*+h,n,this.canonical.z,this.canonical.x,this.canonical.y):Fm(this.wrap*+h,n,n,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const h=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>h&&n.canonical.y===this.canonical.y>>h}children(n){if(this.overscaledZ>=n)return[new Ln(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new Ln(h,this.wrap,h,p,_),new Ln(h,this.wrap,h,p+1,_),new Ln(h,this.wrap,h,p,_+1),new Ln(h,this.wrap,h,p+1,_+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Ln(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Ln(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new T3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new u_(n.x-this.wrap,n.y))}}function Fm(c,n,h,p,_){(c*=2)<0&&(c=-1*c-1);const S=1<<h;return(S*S*c+S*_+p).toString(36)+h.toString(36)+n.toString(36)}st("CanonicalTileID",Gw),st("OverscaledTileID",Ln,{omit:["posMatrix"]});class M3{constructor(n,h,p,_=1,S=1,T=1,k=0){if(this.uid=n,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void It(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const $=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=S,this.blueFactor=T,this.baseShift=k;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let L=0;L<$;L++)this.data[this._idx(-1,L)]=this.data[this._idx(0,L)],this.data[this._idx($,L)]=this.data[this._idx($-1,L)],this.data[this._idx(L,-1)]=this.data[this._idx(L,0)],this.data[this._idx(L,$)]=this.data[this._idx(L,$-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx($,-1)]=this.data[this._idx($-1,0)],this.data[this._idx(-1,$)]=this.data[this._idx(0,$-1)],this.data[this._idx($,$)]=this.data[this._idx($-1,$-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let L=0;L<$;L++)for(let z=0;z<$;z++){const N=this.get(L,z);N>this.max&&(this.max=N),N<this.min&&(this.min=N)}}get(n,h){const p=new Uint8Array(this.data.buffer),_=4*this._idx(n,h);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,h){if(n<-1||n>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(n+1)}unpack(n,h,p){return n*this.redFactor+h*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new On({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,h,p){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let _=h*this.dim,S=h*this.dim+this.dim,T=p*this.dim,k=p*this.dim+this.dim;switch(h){case-1:_=S-1;break;case 1:S=_+1}switch(p){case-1:T=k-1;break;case 1:k=T+1}const $=-h*this.dim,L=-p*this.dim;for(let z=T;z<k;z++)for(let N=_;N<S;N++)this.data[this._idx(N,z)]=n.data[this._idx(N+$,z+L)]}}st("DEMData",M3);class I3{constructor(n){this._stringToNumber={},this._numberToString=[];for(let h=0;h<n.length;h++){const p=n[h];this._stringToNumber[p]=h,this._numberToString[h]=p}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class E3{constructor(n,h,p,_,S){this.type="Feature",this._vectorTileFeature=n,n._z=h,n._x=p,n._y=_,this.properties=n.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(n[h]=this[h]);return n}}class k3{constructor(n,h){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new To(Jt,16,0),this.grid3D=new To(Jt,16,0),this.featureIndexArray=new D,this.promoteId=h}insert(n,h,p,_,S,T){const k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,S);const $=T?this.grid3D:this.grid;for(let L=0;L<h.length;L++){const z=h[L],N=[1/0,1/0,-1/0,-1/0];for(let V=0;V<z.length;V++){const H=z[V];N[0]=Math.min(N[0],H.x),N[1]=Math.min(N[1],H.y),N[2]=Math.max(N[2],H.x),N[3]=Math.max(N[3],H.y)}N[0]<Jt&&N[1]<Jt&&N[2]>=0&&N[3]>=0&&$.insert(k,N[0],N[1],N[2],N[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new mc.VectorTile(new $w(this.rawTileData)).layers,this.sourceLayerCoder=new I3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,h,p,_){this.loadVTLayers();const S=n.params||{},T=Jt/n.tileSize/n.scale,k=Vd(S.filter),$=n.queryGeometry,L=n.queryPadding*T,z=P3($),N=this.grid.query(z.minX-L,z.minY-L,z.maxX+L,z.maxY+L),V=P3(n.cameraQueryGeometry),H=this.grid3D.query(V.minX-L,V.minY-L,V.maxX+L,V.maxY+L,(se,le,we,ce)=>function(ye,Le,De,et,dt){for(const Xe of ye)if(Le<=Xe.x&&De<=Xe.y&&et>=Xe.x&&dt>=Xe.y)return!0;const Qe=[new E(Le,De),new E(Le,dt),new E(et,dt),new E(et,De)];if(ye.length>2){for(const Xe of Qe)if(tp(ye,Xe))return!0}for(let Xe=0;Xe<ye.length-1;Xe++)if(C6(ye[Xe],ye[Xe+1],Qe))return!0;return!1}(n.cameraQueryGeometry,se-L,le-L,we+L,ce+L));for(const se of H)N.push(se);N.sort(eF);const Z={};let Q;for(let se=0;se<N.length;se++){const le=N[se];if(le===Q)continue;Q=le;const we=this.featureIndexArray.get(le);let ce=null;this.loadMatchingFeature(Z,we.bucketIndex,we.sourceLayerIndex,we.featureIndex,k,S.layers,S.availableImages,h,p,_,(ye,Le,De)=>(ce||(ce=dl(ye)),Le.queryIntersectsFeature($,ye,De,ce,this.z,n.transform,T,n.pixelPosMatrix)))}return Z}loadMatchingFeature(n,h,p,_,S,T,k,$,L,z,N){const V=this.bucketLayerIDs[h];if(T&&!function(se,le){for(let we=0;we<se.length;we++)if(le.indexOf(se[we])>=0)return!0;return!1}(T,V))return;const H=this.sourceLayerCoder.decode(p),Z=this.vtLayers[H].feature(_);if(S.needGeometry){const se=pl(Z,!0);if(!S.filter(new $i(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!S.filter(new $i(this.tileID.overscaledZ),Z))return;const Q=this.getId(Z,H);for(let se=0;se<V.length;se++){const le=V[se];if(T&&T.indexOf(le)<0)continue;const we=$[le];if(!we)continue;let ce={};Q&&z&&(ce=z.getState(we.sourceLayer||"_geojsonTileLayer",Q));const ye=Ve({},L[le]);ye.paint=A3(ye.paint,we.paint,Z,ce,k),ye.layout=A3(ye.layout,we.layout,Z,ce,k);const Le=!N||N(Z,we,ce);if(!Le)continue;const De=new E3(Z,this.z,this.x,this.y,Q);De.layer=ye;let et=n[le];et===void 0&&(et=n[le]=[]),et.push({featureIndex:_,feature:De,intersectionZ:Le})}}lookupSymbolFeatures(n,h,p,_,S,T,k,$){const L={};this.loadVTLayers();const z=Vd(S);for(const N of n)this.loadMatchingFeature(L,p,_,N,z,T,k,$,h);return L}hasLayer(n){for(const h of this.bucketLayerIDs)for(const p of h)if(n===p)return!0;return!1}getId(n,h){let p=n.id;return this.promoteId&&(p=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof p=="boolean"&&(p=Number(p))),p}}function A3(c,n,h,p,_){return lt(c,(S,T)=>{const k=n instanceof Hu?n.get(T):null;return k&&k.evaluate?k.evaluate(h,p,_):k})}function P3(c){let n=1/0,h=1/0,p=-1/0,_=-1/0;for(const S of c)n=Math.min(n,S.x),h=Math.min(h,S.y),p=Math.max(p,S.x),_=Math.max(_,S.y);return{minX:n,minY:h,maxX:p,maxY:_}}function eF(c,n){return n-c}function C3(c,n,h,p,_){const S=[];for(let T=0;T<c.length;T++){const k=c[T];let $;for(let L=0;L<k.length-1;L++){let z=k[L],N=k[L+1];z.x<n&&N.x<n||(z.x<n?z=new E(n,z.y+(n-z.x)/(N.x-z.x)*(N.y-z.y))._round():N.x<n&&(N=new E(n,z.y+(n-z.x)/(N.x-z.x)*(N.y-z.y))._round()),z.y<h&&N.y<h||(z.y<h?z=new E(z.x+(h-z.y)/(N.y-z.y)*(N.x-z.x),h)._round():N.y<h&&(N=new E(z.x+(h-z.y)/(N.y-z.y)*(N.x-z.x),h)._round()),z.x>=p&&N.x>=p||(z.x>=p?z=new E(p,z.y+(p-z.x)/(N.x-z.x)*(N.y-z.y))._round():N.x>=p&&(N=new E(p,z.y+(p-z.x)/(N.x-z.x)*(N.y-z.y))._round()),z.y>=_&&N.y>=_||(z.y>=_?z=new E(z.x+(_-z.y)/(N.y-z.y)*(N.x-z.x),_)._round():N.y>=_&&(N=new E(z.x+(_-z.y)/(N.y-z.y)*(N.x-z.x),_)._round()),$&&z.equals($[$.length-1])||($=[z],S.push($)),$.push(N)))))}}return S}st("FeatureIndex",k3,{omit:["rawTileData","sourceLayerCoder"]});class vc extends E{constructor(n,h,p,_){super(n,h),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new vc(this.x,this.y,this.angle,this.segment)}}function $3(c,n,h,p,_){if(n.segment===void 0||h===0)return!0;let S=n,T=n.segment+1,k=0;for(;k>-h/2;){if(T--,T<0)return!1;k-=c[T].dist(S),S=c[T]}k+=c[T].dist(c[T+1]),T++;const $=[];let L=0;for(;k<h/2;){const z=c[T],N=c[T+1];if(!N)return!1;let V=c[T-1].angleTo(z)-z.angleTo(N);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),$.push({distance:k,angleDelta:V}),L+=V;k-$[0].distance>p;)L-=$.shift().angleDelta;if(L>_)return!1;T++,k+=z.dist(N)}return!0}function O3(c){let n=0;for(let h=0;h<c.length-1;h++)n+=c[h].dist(c[h+1]);return n}function L3(c,n,h){return c?.6*n*h:0}function R3(c,n){return Math.max(c?c.right-c.left:0,n?n.right-n.left:0)}function tF(c,n,h,p,_,S){const T=L3(h,_,S),k=R3(h,p)*S;let $=0;const L=O3(c)/2;for(let z=0;z<c.length-1;z++){const N=c[z],V=c[z+1],H=N.dist(V);if($+H>L){const Z=(L-$)/H,Q=Vs.number(N.x,V.x,Z),se=Vs.number(N.y,V.y,Z),le=new vc(Q,se,V.angleTo(N),z);return le._round(),!T||$3(c,le,k,T,n)?le:void 0}$+=H}}function iF(c,n,h,p,_,S,T,k,$){const L=L3(p,S,T),z=R3(p,_),N=z*T,V=c[0].x===0||c[0].x===$||c[0].y===0||c[0].y===$;return n-N<n/4&&(n=N+n/4),D3(c,V?n/2*k%n:(z/2+2*S)*T*k%n,n,L,h,N,V,!1,$)}function D3(c,n,h,p,_,S,T,k,$){const L=S/2,z=O3(c);let N=0,V=n-h,H=[];for(let Z=0;Z<c.length-1;Z++){const Q=c[Z],se=c[Z+1],le=Q.dist(se),we=se.angleTo(Q);for(;V+h<N+le;){V+=h;const ce=(V-N)/le,ye=Vs.number(Q.x,se.x,ce),Le=Vs.number(Q.y,se.y,ce);if(ye>=0&&ye<$&&Le>=0&&Le<$&&V-L>=0&&V+L<=z){const De=new vc(ye,Le,we,Z);De._round(),p&&!$3(c,De,S,p,_)||H.push(De)}}N+=le}return k||H.length||T||(H=D3(c,N/2,h,p,_,S,T,!0,$)),H}st("Anchor",vc);const cp=qs;function z3(c,n,h,p){const _=[],S=c.image,T=S.pixelRatio,k=S.paddedRect.w-2*cp,$=S.paddedRect.h-2*cp,L=c.right-c.left,z=c.bottom-c.top,N=S.stretchX||[[0,k]],V=S.stretchY||[[0,$]],H=(qe,ot)=>qe+ot[1]-ot[0],Z=N.reduce(H,0),Q=V.reduce(H,0),se=k-Z,le=$-Q;let we=0,ce=Z,ye=0,Le=Q,De=0,et=se,dt=0,Qe=le;if(S.content&&p){const qe=S.content;we=h_(N,0,qe[0]),ye=h_(V,0,qe[1]),ce=h_(N,qe[0],qe[2]),Le=h_(V,qe[1],qe[3]),De=qe[0]-we,dt=qe[1]-ye,et=qe[2]-qe[0]-ce,Qe=qe[3]-qe[1]-Le}const Xe=(qe,ot,Ke,je)=>{const _t=d_(qe.stretch-we,ce,L,c.left),mt=p_(qe.fixed-De,et,qe.stretch,Z),Wt=d_(ot.stretch-ye,Le,z,c.top),Li=p_(ot.fixed-dt,Qe,ot.stretch,Q),zi=d_(Ke.stretch-we,ce,L,c.left),wr=p_(Ke.fixed-De,et,Ke.stretch,Z),mn=d_(je.stretch-ye,Le,z,c.top),xs=p_(je.fixed-dt,Qe,je.stretch,Q),hr=new E(_t,Wt),Nr=new E(zi,Wt),Zr=new E(zi,mn),Ss=new E(_t,mn),Ts=new E(mt/T,Li/T),xr=new E(wr/T,xs/T),Sr=n*Math.PI/180;if(Sr){const os=Math.sin(Sr),Hs=Math.cos(Sr),Ws=[Hs,-os,os,Hs];hr._matMult(Ws),Nr._matMult(Ws),Ss._matMult(Ws),Zr._matMult(Ws)}const ns=qe.stretch+qe.fixed,Ms=ot.stretch+ot.fixed;return{tl:hr,tr:Nr,bl:Ss,br:Zr,tex:{x:S.paddedRect.x+cp+ns,y:S.paddedRect.y+cp+Ms,w:Ke.stretch+Ke.fixed-ns,h:je.stretch+je.fixed-Ms},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ts,pixelOffsetBR:xr,minFontScaleX:et/T/L,minFontScaleY:Qe/T/z,isSDF:h}};if(p&&(S.stretchX||S.stretchY)){const qe=N3(N,se,Z),ot=N3(V,le,Q);for(let Ke=0;Ke<qe.length-1;Ke++){const je=qe[Ke],_t=qe[Ke+1];for(let mt=0;mt<ot.length-1;mt++)_.push(Xe(je,ot[mt],_t,ot[mt+1]))}}else _.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:$+1}));return _}function h_(c,n,h){let p=0;for(const _ of c)p+=Math.max(n,Math.min(h,_[1]))-Math.max(n,Math.min(h,_[0]));return p}function N3(c,n,h){const p=[{fixed:-cp,stretch:0}];for(const[_,S]of c){const T=p[p.length-1];p.push({fixed:_-T.stretch,stretch:T.stretch}),p.push({fixed:_-T.stretch,stretch:T.stretch+(S-_)})}return p.push({fixed:n+cp,stretch:h}),p}function d_(c,n,h,p){return c/n*h+p}function p_(c,n,h,p){return c-n*h/p}class f_{constructor(n,h,p,_,S,T,k,$,L,z){if(this.boxStartIndex=n.length,L){let N=T.top,V=T.bottom;const H=T.collisionPadding;H&&(N-=H[1],V+=H[3]);let Z=V-N;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{let N=T.top*k-$[0],V=T.bottom*k+$[2],H=T.left*k-$[3],Z=T.right*k+$[1];const Q=T.collisionPadding;if(Q&&(H-=Q[0]*k,N-=Q[1]*k,Z+=Q[2]*k,V+=Q[3]*k),z){const se=new E(H,N),le=new E(Z,N),we=new E(H,V),ce=new E(Z,V),ye=z*Math.PI/180;se._rotate(ye),le._rotate(ye),we._rotate(ye),ce._rotate(ye),H=Math.min(se.x,le.x,we.x,ce.x),Z=Math.max(se.x,le.x,we.x,ce.x),N=Math.min(se.y,le.y,we.y,ce.y),V=Math.max(se.y,le.y,we.y,ce.y)}n.emplaceBack(h.x,h.y,H,N,Z,V,p,_,S)}this.boxEndIndex=n.length}}class rF{constructor(n=[],h=sF){if(this.data=n,this.length=this.data.length,this.compare=h,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:h,compare:p}=this,_=h[n];for(;n>0;){const S=n-1>>1,T=h[S];if(p(_,T)>=0)break;h[n]=T,n=S}h[n]=_}_down(n){const{data:h,compare:p}=this,_=this.length>>1,S=h[n];for(;n<_;){let T=1+(n<<1),k=h[T];const $=T+1;if($<this.length&&p(h[$],k)<0&&(T=$,k=h[$]),p(k,S)>=0)break;h[n]=k,n=T}h[n]=S}}function sF(c,n){return c<n?-1:c>n?1:0}function nF(c,n=1,h=!1){let p=1/0,_=1/0,S=-1/0,T=-1/0;const k=c[0];for(let H=0;H<k.length;H++){const Z=k[H];(!H||Z.x<p)&&(p=Z.x),(!H||Z.y<_)&&(_=Z.y),(!H||Z.x>S)&&(S=Z.x),(!H||Z.y>T)&&(T=Z.y)}const $=Math.min(S-p,T-_);let L=$/2;const z=new rF([],oF);if($===0)return new E(p,_);for(let H=p;H<S;H+=$)for(let Z=_;Z<T;Z+=$)z.push(new up(H+L,Z+L,L,c));let N=function(H){let Z=0,Q=0,se=0;const le=H[0];for(let we=0,ce=le.length,ye=ce-1;we<ce;ye=we++){const Le=le[we],De=le[ye],et=Le.x*De.y-De.x*Le.y;Q+=(Le.x+De.x)*et,se+=(Le.y+De.y)*et,Z+=3*et}return new up(Q/Z,se/Z,0,H)}(c),V=z.length;for(;z.length;){const H=z.pop();(H.d>N.d||!N.d)&&(N=H,h&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,V)),H.max-N.d<=n||(L=H.h/2,z.push(new up(H.p.x-L,H.p.y-L,L,c)),z.push(new up(H.p.x+L,H.p.y-L,L,c)),z.push(new up(H.p.x-L,H.p.y+L,L,c)),z.push(new up(H.p.x+L,H.p.y+L,L,c)),V+=4)}return h&&(console.log(`num probes: ${V}`),console.log(`best distance: ${N.d}`)),N.p}function oF(c,n){return n.max-c.max}function up(c,n,h,p){this.p=new E(c,n),this.h=h,this.d=function(_,S){let T=!1,k=1/0;for(let $=0;$<S.length;$++){const L=S[$];for(let z=0,N=L.length,V=N-1;z<N;V=z++){const H=L[z],Z=L[V];H.y>_.y!=Z.y>_.y&&_.x<(Z.x-H.x)*(_.y-H.y)/(Z.y-H.y)+H.x&&(T=!T),k=Math.min(k,wE(_,H,Z))}}return(T?1:-1)*Math.sqrt(k)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Wr;u.ap=void 0,(Wr=u.ap||(u.ap={}))[Wr.center=1]="center",Wr[Wr.left=2]="left",Wr[Wr.right=3]="right",Wr[Wr.top=4]="top",Wr[Wr.bottom=5]="bottom",Wr[Wr["top-left"]=6]="top-left",Wr[Wr["top-right"]=7]="top-right",Wr[Wr["bottom-left"]=8]="bottom-left",Wr[Wr["bottom-right"]=9]="bottom-right";const bc=7,qw=Number.POSITIVE_INFINITY;function F3(c,n){return n[1]!==qw?function(h,p,_){let S=0,T=0;switch(p=Math.abs(p),_=Math.abs(_),h){case"top-right":case"top-left":case"top":T=_-bc;break;case"bottom-right":case"bottom-left":case"bottom":T=-_+bc}switch(h){case"top-right":case"bottom-right":case"right":S=-p;break;case"top-left":case"bottom-left":case"left":S=p}return[S,T]}(c,n[0],n[1]):function(h,p){let _=0,S=0;p<0&&(p=0);const T=p/Math.SQRT2;switch(h){case"top-right":case"top-left":S=T-bc;break;case"bottom-right":case"bottom-left":S=-T+bc;break;case"bottom":S=-p+bc;break;case"top":S=p-bc}switch(h){case"top-right":case"bottom-right":_=-T;break;case"top-left":case"bottom-left":_=T;break;case"left":_=p;break;case"right":_=-p}return[_,S]}(c,n[0])}function B3(c,n,h){var p;const _=c.layout,S=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(n,{},h);if(S){const k=S.values,$=[];for(let L=0;L<k.length;L+=2){const z=$[L]=k[L],N=k[L+1].map(V=>V*br);z.startsWith("top")?N[1]-=bc:z.startsWith("bottom")&&(N[1]+=bc),$[L+1]=N}return new qr($)}const T=_.get("text-variable-anchor");if(T){let k;k=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(n,{},h)*br,qw]:_.get("text-offset").evaluate(n,{},h).map(L=>L*br);const $=[];for(const L of T)$.push(L,F3(L,k));return new qr($)}return null}function Hw(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function aF(c,n,h,p,_,S,T,k,$,L,z){let N=S.textMaxSize.evaluate(n,{});N===void 0&&(N=T);const V=c.layers[0].layout,H=V.get("icon-offset").evaluate(n,{},z),Z=V3(h.horizontal),Q=T/24,se=c.tilePixelRatio*Q,le=c.tilePixelRatio*N/24,we=c.tilePixelRatio*k,ce=c.tilePixelRatio*V.get("symbol-spacing"),ye=V.get("text-padding")*c.tilePixelRatio,Le=function(je,_t,mt,Wt=1){const Li=je.get("icon-padding").evaluate(_t,{},mt),zi=Li&&Li.values;return[zi[0]*Wt,zi[1]*Wt,zi[2]*Wt,zi[3]*Wt]}(V,n,z,c.tilePixelRatio),De=V.get("text-max-angle")/180*Math.PI,et=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",dt=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Qe=V.get("symbol-placement"),Xe=ce/2,qe=V.get("icon-text-fit");let ot;p&&qe!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(ot=h3(p,h.vertical,qe,V.get("icon-text-fit-padding"),H,Q)),Z&&(p=h3(p,Z,qe,V.get("icon-text-fit-padding"),H,Q)));const Ke=(je,_t)=>{_t.x<0||_t.x>=Jt||_t.y<0||_t.y>=Jt||function(mt,Wt,Li,zi,wr,mn,xs,hr,Nr,Zr,Ss,Ts,xr,Sr,ns,Ms,os,Hs,Ws,Tr,Xt,as,Jr,Mr,ro){const Io=mt.addToLineVertexArray(Wt,Li);let Eo,yl,so,Rn,Zs=0,gl=0,Vm=0,H3=0,ex=-1,tx=-1;const _l={};let W3=Vt("");if(mt.allowVerticalPlacement&&zi.vertical){const ls=hr.layout.get("text-rotate").evaluate(Xt,{},Mr)+90;so=new f_(Nr,Wt,Zr,Ss,Ts,zi.vertical,xr,Sr,ns,ls),xs&&(Rn=new f_(Nr,Wt,Zr,Ss,Ts,xs,os,Hs,ns,ls))}if(wr){const ls=hr.layout.get("icon-rotate").evaluate(Xt,{}),Dn=hr.layout.get("icon-text-fit")!=="none",eh=z3(wr,ls,Jr,Dn),Ao=xs?z3(xs,ls,Jr,Dn):void 0;yl=new f_(Nr,Wt,Zr,Ss,Ts,wr,os,Hs,!1,ls),Zs=4*eh.length;const th=mt.iconSizeData;let ma=null;th.kind==="source"?(ma=[fa*hr.layout.get("icon-size").evaluate(Xt,{})],ma[0]>gc&&It(`${mt.layerIds[0]}: Value for "icon-size" is >= ${Nm}. Reduce your "icon-size".`)):th.kind==="composite"&&(ma=[fa*as.compositeIconSizes[0].evaluate(Xt,{},Mr),fa*as.compositeIconSizes[1].evaluate(Xt,{},Mr)],(ma[0]>gc||ma[1]>gc)&&It(`${mt.layerIds[0]}: Value for "icon-size" is >= ${Nm}. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,eh,ma,Tr,Ws,Xt,u.ah.none,Wt,Io.lineStartIndex,Io.lineLength,-1,Mr),ex=mt.icon.placedSymbolArray.length-1,Ao&&(gl=4*Ao.length,mt.addSymbols(mt.icon,Ao,ma,Tr,Ws,Xt,u.ah.vertical,Wt,Io.lineStartIndex,Io.lineLength,-1,Mr),tx=mt.icon.placedSymbolArray.length-1)}const Z3=Object.keys(zi.horizontal);for(const ls of Z3){const Dn=zi.horizontal[ls];if(!Eo){W3=Vt(Dn.text);const Ao=hr.layout.get("text-rotate").evaluate(Xt,{},Mr);Eo=new f_(Nr,Wt,Zr,Ss,Ts,Dn,xr,Sr,ns,Ao)}const eh=Dn.positionedLines.length===1;if(Vm+=j3(mt,Wt,Dn,mn,hr,ns,Xt,Ms,Io,zi.vertical?u.ah.horizontal:u.ah.horizontalOnly,eh?Z3:[ls],_l,ex,as,Mr),eh)break}zi.vertical&&(H3+=j3(mt,Wt,zi.vertical,mn,hr,ns,Xt,Ms,Io,u.ah.vertical,["vertical"],_l,tx,as,Mr));const uF=Eo?Eo.boxStartIndex:mt.collisionBoxArray.length,hF=Eo?Eo.boxEndIndex:mt.collisionBoxArray.length,dF=so?so.boxStartIndex:mt.collisionBoxArray.length,pF=so?so.boxEndIndex:mt.collisionBoxArray.length,fF=yl?yl.boxStartIndex:mt.collisionBoxArray.length,mF=yl?yl.boxEndIndex:mt.collisionBoxArray.length,yF=Rn?Rn.boxStartIndex:mt.collisionBoxArray.length,gF=Rn?Rn.boxEndIndex:mt.collisionBoxArray.length;let ko=-1;const y_=(ls,Dn)=>ls&&ls.circleDiameter?Math.max(ls.circleDiameter,Dn):Dn;ko=y_(Eo,ko),ko=y_(so,ko),ko=y_(yl,ko),ko=y_(Rn,ko);const J3=ko>-1?1:0;J3&&(ko*=ro/br),mt.glyphOffsetArray.length>=lp.MAX_GLYPHS&&It("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xt.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,Xt.sortKey);const _F=B3(hr,Xt,Mr),[vF,bF]=function(ls,Dn){const eh=ls.length,Ao=Dn==null?void 0:Dn.values;if((Ao==null?void 0:Ao.length)>0)for(let th=0;th<Ao.length;th+=2){const ma=Ao[th+1];ls.emplaceBack(u.ap[Ao[th]],ma[0],ma[1])}return[eh,ls.length]}(mt.textAnchorOffsets,_F);mt.symbolInstances.emplaceBack(Wt.x,Wt.y,_l.right>=0?_l.right:-1,_l.center>=0?_l.center:-1,_l.left>=0?_l.left:-1,_l.vertical||-1,ex,tx,W3,uF,hF,dF,pF,fF,mF,yF,gF,Zr,Vm,H3,Zs,gl,J3,0,xr,ko,vF,bF)}(c,_t,je,h,p,_,ot,c.layers[0],c.collisionBoxArray,n.index,n.sourceLayerIndex,c.index,se,[ye,ye,ye,ye],et,$,we,Le,dt,H,n,S,L,z,T)};if(Qe==="line")for(const je of C3(n.geometry,0,0,Jt,Jt)){const _t=iF(je,ce,De,h.vertical||Z,p,24,le,c.overscaling,Jt);for(const mt of _t)Z&&lF(c,Z.text,Xe,mt)||Ke(je,mt)}else if(Qe==="line-center"){for(const je of n.geometry)if(je.length>1){const _t=tF(je,De,h.vertical||Z,p,24,le);_t&&Ke(je,_t)}}else if(n.type==="Polygon")for(const je of Tw(n.geometry,0)){const _t=nF(je,16);Ke(je[0],new vc(_t.x,_t.y,0))}else if(n.type==="LineString")for(const je of n.geometry)Ke(je,new vc(je[0].x,je[0].y,0));else if(n.type==="Point")for(const je of n.geometry)for(const _t of je)Ke([_t],new vc(_t.x,_t.y,0))}function j3(c,n,h,p,_,S,T,k,$,L,z,N,V,H,Z){const Q=function(we,ce,ye,Le,De,et,dt,Qe){const Xe=Le.layout.get("text-rotate").evaluate(et,{})*Math.PI/180,qe=[];for(const ot of ce.positionedLines)for(const Ke of ot.positionedGlyphs){if(!Ke.rect)continue;const je=Ke.rect||{};let _t=s3+1,mt=!0,Wt=1,Li=0;const zi=(De||Qe)&&Ke.vertical,wr=Ke.metrics.advance*Ke.scale/2;if(Qe&&ce.verticalizable&&(Li=ot.lineOffset/2-(Ke.imageName?-(br-Ke.metrics.width*Ke.scale)/2:(Ke.scale-1)*br)),Ke.imageName){const Tr=dt[Ke.imageName];mt=Tr.sdf,Wt=Tr.pixelRatio,_t=qs/Wt}const mn=De?[Ke.x+wr,Ke.y]:[0,0];let xs=De?[0,0]:[Ke.x+wr+ye[0],Ke.y+ye[1]-Li],hr=[0,0];zi&&(hr=xs,xs=[0,0]);const Nr=Ke.metrics.isDoubleResolution?2:1,Zr=(Ke.metrics.left-_t)*Ke.scale-wr+xs[0],Ss=(-Ke.metrics.top-_t)*Ke.scale+xs[1],Ts=Zr+je.w/Nr*Ke.scale/Wt,xr=Ss+je.h/Nr*Ke.scale/Wt,Sr=new E(Zr,Ss),ns=new E(Ts,Ss),Ms=new E(Zr,xr),os=new E(Ts,xr);if(zi){const Tr=new E(-wr,wr-Dm),Xt=-Math.PI/2,as=br/2-wr,Jr=new E(5-Dm-as,-(Ke.imageName?as:0)),Mr=new E(...hr);Sr._rotateAround(Xt,Tr)._add(Jr)._add(Mr),ns._rotateAround(Xt,Tr)._add(Jr)._add(Mr),Ms._rotateAround(Xt,Tr)._add(Jr)._add(Mr),os._rotateAround(Xt,Tr)._add(Jr)._add(Mr)}if(Xe){const Tr=Math.sin(Xe),Xt=Math.cos(Xe),as=[Xt,-Tr,Tr,Xt];Sr._matMult(as),ns._matMult(as),Ms._matMult(as),os._matMult(as)}const Hs=new E(0,0),Ws=new E(0,0);qe.push({tl:Sr,tr:ns,bl:Ms,br:os,tex:je,writingMode:ce.writingMode,glyphOffset:mn,sectionIndex:Ke.sectionIndex,isSDF:mt,pixelOffsetTL:Hs,pixelOffsetBR:Ws,minFontScaleX:0,minFontScaleY:0})}return qe}(0,h,k,_,S,T,p,c.allowVerticalPlacement),se=c.textSizeData;let le=null;se.kind==="source"?(le=[fa*_.layout.get("text-size").evaluate(T,{})],le[0]>gc&&It(`${c.layerIds[0]}: Value for "text-size" is >= ${Nm}. Reduce your "text-size".`)):se.kind==="composite"&&(le=[fa*H.compositeTextSizes[0].evaluate(T,{},Z),fa*H.compositeTextSizes[1].evaluate(T,{},Z)],(le[0]>gc||le[1]>gc)&&It(`${c.layerIds[0]}: Value for "text-size" is >= ${Nm}. Reduce your "text-size".`)),c.addSymbols(c.text,Q,le,k,S,T,L,n,$.lineStartIndex,$.lineLength,V,Z);for(const we of z)N[we]=c.text.placedSymbolArray.length-1;return 4*Q.length}function V3(c){for(const n in c)return c[n];return null}function lF(c,n,h,p){const _=c.compareText;if(n in _){const S=_[n];for(let T=S.length-1;T>=0;T--)if(p.dist(S[T])<h)return!0}else _[n]=[];return _[n].push(p),!1}const U3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ww{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,p]=new Uint8Array(n,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const S=U3[15&p];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(n,2,1),[k]=new Uint32Array(n,4,1);return new Ww(k,T,S,n)}constructor(n,h=64,p=Float64Array,_){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=p,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const S=U3.indexOf(this.ArrayType),T=2*n*this.ArrayType.BYTES_PER_ELEMENT,k=n*this.IndexArrayType.BYTES_PER_ELEMENT,$=(8-k%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+k+$,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+T+k+$),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+k+$,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=n)}add(n,h){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=n,this.coords[this._pos++]=h,p}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Zw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,h,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:k}=this,$=[0,S.length-1,0],L=[];for(;$.length;){const z=$.pop()||0,N=$.pop()||0,V=$.pop()||0;if(N-V<=k){for(let se=V;se<=N;se++){const le=T[2*se],we=T[2*se+1];le>=n&&le<=p&&we>=h&&we<=_&&L.push(S[se])}continue}const H=V+N>>1,Z=T[2*H],Q=T[2*H+1];Z>=n&&Z<=p&&Q>=h&&Q<=_&&L.push(S[H]),(z===0?n<=Z:h<=Q)&&($.push(V),$.push(H-1),$.push(1-z)),(z===0?p>=Z:_>=Q)&&($.push(H+1),$.push(N),$.push(1-z))}return L}within(n,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:S,nodeSize:T}=this,k=[0,_.length-1,0],$=[],L=p*p;for(;k.length;){const z=k.pop()||0,N=k.pop()||0,V=k.pop()||0;if(N-V<=T){for(let se=V;se<=N;se++)q3(S[2*se],S[2*se+1],n,h)<=L&&$.push(_[se]);continue}const H=V+N>>1,Z=S[2*H],Q=S[2*H+1];q3(Z,Q,n,h)<=L&&$.push(_[H]),(z===0?n-p<=Z:h-p<=Q)&&(k.push(V),k.push(H-1),k.push(1-z)),(z===0?n+p>=Z:h+p>=Q)&&(k.push(H+1),k.push(N),k.push(1-z))}return $}}function Zw(c,n,h,p,_,S){if(_-p<=h)return;const T=p+_>>1;G3(c,n,T,p,_,S),Zw(c,n,h,p,T-1,1-S),Zw(c,n,h,T+1,_,1-S)}function G3(c,n,h,p,_,S){for(;_>p;){if(_-p>600){const L=_-p+1,z=h-p+1,N=Math.log(L),V=.5*Math.exp(2*N/3),H=.5*Math.sqrt(N*V*(L-V)/L)*(z-L/2<0?-1:1);G3(c,n,h,Math.max(p,Math.floor(h-z*V/L+H)),Math.min(_,Math.floor(h+(L-z)*V/L+H)),S)}const T=n[2*h+S];let k=p,$=_;for(Bm(c,n,p,h),n[2*_+S]>T&&Bm(c,n,p,_);k<$;){for(Bm(c,n,k,$),k++,$--;n[2*k+S]<T;)k++;for(;n[2*$+S]>T;)$--}n[2*p+S]===T?Bm(c,n,p,$):($++,Bm(c,n,$,_)),$<=h&&(p=$+1),h<=$&&(_=$-1)}}function Bm(c,n,h,p){Jw(c,h,p),Jw(n,2*h,2*p),Jw(n,2*h+1,2*p+1)}function Jw(c,n,h){const p=c[n];c[n]=c[h],c[h]=p}function q3(c,n,h,p){const _=c-h,S=n-p;return _*_+S*S}var Kw;u.bd=void 0,(Kw=u.bd||(u.bd={})).create="create",Kw.load="load",Kw.fullLoad="fullLoad";let m_=null,jm=[];const Yw=1e3/60,Xw="loadTime",Qw="fullLoadTime",cF={mark(c){performance.mark(c)},frame(c){const n=c;m_!=null&&jm.push(n-m_),m_=n},clearMetrics(){m_=null,jm=[],performance.clearMeasures(Xw),performance.clearMeasures(Qw);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(Xw,u.bd.create,u.bd.load),performance.measure(Qw,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(Xw)[0].duration,n=performance.getEntriesByName(Qw)[0].duration,h=jm.length,p=1/(jm.reduce((S,T)=>S+T,0)/h/1e3),_=jm.filter(S=>S>Yw).reduce((S,T)=>S+(T-Yw)/Yw,0);return{loadTime:c,fullLoadTime:n,fps:p,percentDroppedFrames:_/(h+_)*100,totalFrames:h}}};u.$=Fe,u.A=ip,u.B=function(c){if(gi==null){const n=c.navigator?c.navigator.userAgent:null;gi=!!c.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return gi},u.C=class{constructor(c,n){this.target=c,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new QN(()=>this.process()),this.subscription=function(h,p,_,S){return h.addEventListener(p,_,!1),{unsubscribe:()=>{h.removeEventListener(p,_,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=Zi(self)?c:window}registerMessageHandler(c,n){this.messageHandlers[c]=n}sendAsync(c,n){return new Promise((h,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:h,reject:p},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const k={id:_,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(k)},{once:!0});const S=[],T=Object.assign(Object.assign({},c),{id:_,sourceMapId:this.mapId,origin:location.origin,data:ol(c.data,S)});this.target.postMessage(T,{transfer:S})})}receive(c){const n=c.data,h=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[h];const p=this.abortControllers[h];return delete this.abortControllers[h],void(p&&p.abort())}if(Zi(self)||n.mustQueue)return this.tasks[h]=n,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,n)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),n=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(c,n)}processTask(c,n){return l(this,void 0,void 0,function*(){if(n.type==="<response>"){const _=this.resolveRejects[c];return delete this.resolveRejects[c],_?void(n.error?_.reject(uc(n.error)):_.resolve(uc(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=uc(n.data),p=new AbortController;this.abortControllers[c]=p;try{const _=yield this.messageHandlers[n.type](n.sourceMapId,h,p);this.completeTask(c,null,_)}catch(_){this.completeTask(c,_)}})}completeTask(c,n,h){const p=[];delete this.abortControllers[c];const _={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?ol(n):null,data:ol(h,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=yt,u.E=Ka,u.F=function(){var c=new ip(16);return ip!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=is,u.H=function(c,n,h){var p,_,S,T,k,$,L,z,N,V,H,Z,Q=h[0],se=h[1],le=h[2];return n===c?(c[12]=n[0]*Q+n[4]*se+n[8]*le+n[12],c[13]=n[1]*Q+n[5]*se+n[9]*le+n[13],c[14]=n[2]*Q+n[6]*se+n[10]*le+n[14],c[15]=n[3]*Q+n[7]*se+n[11]*le+n[15]):(_=n[1],S=n[2],T=n[3],k=n[4],$=n[5],L=n[6],z=n[7],N=n[8],V=n[9],H=n[10],Z=n[11],c[0]=p=n[0],c[1]=_,c[2]=S,c[3]=T,c[4]=k,c[5]=$,c[6]=L,c[7]=z,c[8]=N,c[9]=V,c[10]=H,c[11]=Z,c[12]=p*Q+k*se+N*le+n[12],c[13]=_*Q+$*se+V*le+n[13],c[14]=S*Q+L*se+H*le+n[14],c[15]=T*Q+z*se+Z*le+n[15]),c},u.I=Lw,u.J=function(c,n,h){var p=h[0],_=h[1],S=h[2];return c[0]=n[0]*p,c[1]=n[1]*p,c[2]=n[2]*p,c[3]=n[3]*p,c[4]=n[4]*_,c[5]=n[5]*_,c[6]=n[6]*_,c[7]=n[7]*_,c[8]=n[8]*S,c[9]=n[9]*S,c[10]=n[10]*S,c[11]=n[11]*S,c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15],c},u.K=ME,u.L=function(c,n){const h={};for(let p=0;p<n.length;p++){const _=n[p];_ in c&&(h[_]=c[_])}return h},u.M=_c,u.N=b3,u.O=w3,u.P=E,u.Q=Ln,u.R=On,u.S=ae,u.T=um,u.U=Te,u.V=ps,u.W=Jt,u.X=nr,u.Y=u_,u.Z=class extends da{},u._=l,u.a=un,u.a$=function(c,n,h){return c[0]=n[0]*h[0],c[1]=n[1]*h[1],c[2]=n[2]*h[2],c[3]=n[3]*h[3],c},u.a0=Gw,u.a1=We,u.a2=c=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(h=>{n.onloadstart=()=>{h(n)};for(const p of c){const _=window.document.createElement("source");Pi(p)||(n.crossOrigin="Anonymous"),_.src=p,n.appendChild(_)}})},u.a3=function(){return Ze++},u.a4=H0,u.a5=lp,u.a6=Vd,u.a7=pl,u.a8=$i,u.a9=E3,u.aA=ut,u.aB=function(c,n){if(!c)return[{command:"setStyle",args:[n]}];let h=[];try{if(!Qt(c.version,n.version))return[{command:"setStyle",args:[n]}];Qt(c.center,n.center)||h.push({command:"setCenter",args:[n.center]}),Qt(c.zoom,n.zoom)||h.push({command:"setZoom",args:[n.zoom]}),Qt(c.bearing,n.bearing)||h.push({command:"setBearing",args:[n.bearing]}),Qt(c.pitch,n.pitch)||h.push({command:"setPitch",args:[n.pitch]}),Qt(c.sprite,n.sprite)||h.push({command:"setSprite",args:[n.sprite]}),Qt(c.glyphs,n.glyphs)||h.push({command:"setGlyphs",args:[n.glyphs]}),Qt(c.transition,n.transition)||h.push({command:"setTransition",args:[n.transition]}),Qt(c.light,n.light)||h.push({command:"setLight",args:[n.light]}),Qt(c.terrain,n.terrain)||h.push({command:"setTerrain",args:[n.terrain]}),Qt(c.sky,n.sky)||h.push({command:"setSky",args:[n.sky]});const p={},_=[];(function(T,k,$,L){let z;for(z in k=k||{},T=T||{})Object.prototype.hasOwnProperty.call(T,z)&&(Object.prototype.hasOwnProperty.call(k,z)||ql(z,$,L));for(z in k)Object.prototype.hasOwnProperty.call(k,z)&&(Object.prototype.hasOwnProperty.call(T,z)?Qt(T[z],k[z])||(T[z].type==="geojson"&&k[z].type==="geojson"&&Wl(T,k,z)?Dr($,{command:"setGeoJSONSourceData",args:[z,k[z].data]}):Hl(z,k,$,L)):Kn(z,k,$))})(c.sources,n.sources,_,p);const S=[];c.layers&&c.layers.forEach(T=>{"source"in T&&p[T.source]?h.push({command:"removeLayer",args:[T.id]}):S.push(T)}),h=h.concat(_),function(T,k,$){k=k||[];const L=(T=T||[]).map(Zl),z=k.map(Zl),N=T.reduce($u,{}),V=k.reduce($u,{}),H=L.slice(),Z=Object.create(null);let Q,se,le,we,ce;for(let ye=0,Le=0;ye<L.length;ye++)Q=L[ye],Object.prototype.hasOwnProperty.call(V,Q)?Le++:(Dr($,{command:"removeLayer",args:[Q]}),H.splice(H.indexOf(Q,Le),1));for(let ye=0,Le=0;ye<z.length;ye++)Q=z[z.length-1-ye],H[H.length-1-ye]!==Q&&(Object.prototype.hasOwnProperty.call(N,Q)?(Dr($,{command:"removeLayer",args:[Q]}),H.splice(H.lastIndexOf(Q,H.length-Le),1)):Le++,we=H[H.length-ye],Dr($,{command:"addLayer",args:[V[Q],we]}),H.splice(H.length-ye,0,Q),Z[Q]=!0);for(let ye=0;ye<z.length;ye++)if(Q=z[ye],se=N[Q],le=V[Q],!Z[Q]&&!Qt(se,le))if(Qt(se.source,le.source)&&Qt(se["source-layer"],le["source-layer"])&&Qt(se.type,le.type)){for(ce in Xa(se.layout,le.layout,$,Q,null,"setLayoutProperty"),Xa(se.paint,le.paint,$,Q,null,"setPaintProperty"),Qt(se.filter,le.filter)||Dr($,{command:"setFilter",args:[Q,le.filter]}),Qt(se.minzoom,le.minzoom)&&Qt(se.maxzoom,le.maxzoom)||Dr($,{command:"setLayerZoomRange",args:[Q,le.minzoom,le.maxzoom]}),se)Object.prototype.hasOwnProperty.call(se,ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&(ce.indexOf("paint.")===0?Xa(se[ce],le[ce],$,Q,ce.slice(6),"setPaintProperty"):Qt(se[ce],le[ce])||Dr($,{command:"setLayerProperty",args:[Q,ce,le[ce]]}));for(ce in le)Object.prototype.hasOwnProperty.call(le,ce)&&!Object.prototype.hasOwnProperty.call(se,ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&(ce.indexOf("paint.")===0?Xa(se[ce],le[ce],$,Q,ce.slice(6),"setPaintProperty"):Qt(se[ce],le[ce])||Dr($,{command:"setLayerProperty",args:[Q,ce,le[ce]]}))}else Dr($,{command:"removeLayer",args:[Q]}),we=H[H.lastIndexOf(Q)+1],Dr($,{command:"addLayer",args:[le,we]})}(S,n.layers,h)}catch(p){console.warn("Unable to compute style diff:",p),h=[{command:"setStyle",args:[n]}]}return h},u.aC=function(c){const n=[],h=c.id;return h===void 0&&n.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&n.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&n.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),n},u.aD=function c(n,h){if(Array.isArray(n)){if(!Array.isArray(h)||n.length!==h.length)return!1;for(let p=0;p<n.length;p++)if(!c(n[p],h[p]))return!1;return!0}if(typeof n=="object"&&n!==null&&h!==null){if(typeof h!="object"||Object.keys(n).length!==Object.keys(h).length)return!1;for(const p in n)if(!c(n[p],h[p]))return!1;return!0}return n===h},u.aE=lt,u.aF=ct,u.aG=class extends Ei{constructor(c,n){super(c,n),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=Hr,u.aI=class extends Ei{constructor(c,n){super(c,n),this.current=ul}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let n=1;n<16;n++)if(c[n]!==this.current[n]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Cn,u.aK=class extends Ei{constructor(c,n){super(c,n),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends Ei{constructor(c,n){super(c,n),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=to,u.aN=function(c,n,h,p,_,S,T){var k=1/(n-h),$=1/(p-_),L=1/(S-T);return c[0]=-2*k,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*$,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*L,c[11]=0,c[12]=(n+h)*k,c[13]=(_+p)*$,c[14]=(T+S)*L,c[15]=1,c},u.aO=di,u.aP=O6,u.aQ=class extends Ku{},u.aR=EN,u.aS=class extends dc{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=PE,u.aV=F,u.aW=class extends bm{},u.aX=Ee,u.aY=function(c,n){return c[0]===n[0]&&c[1]===n[1]&&c[2]===n[2]&&c[3]===n[3]&&c[4]===n[4]&&c[5]===n[5]&&c[6]===n[6]&&c[7]===n[7]&&c[8]===n[8]&&c[9]===n[9]&&c[10]===n[10]&&c[11]===n[11]&&c[12]===n[12]&&c[13]===n[13]&&c[14]===n[14]&&c[15]===n[15]},u.aZ=function(c,n){var h=c[0],p=c[1],_=c[2],S=c[3],T=c[4],k=c[5],$=c[6],L=c[7],z=c[8],N=c[9],V=c[10],H=c[11],Z=c[12],Q=c[13],se=c[14],le=c[15],we=n[0],ce=n[1],ye=n[2],Le=n[3],De=n[4],et=n[5],dt=n[6],Qe=n[7],Xe=n[8],qe=n[9],ot=n[10],Ke=n[11],je=n[12],_t=n[13],mt=n[14],Wt=n[15];return Math.abs(h-we)<=ws*Math.max(1,Math.abs(h),Math.abs(we))&&Math.abs(p-ce)<=ws*Math.max(1,Math.abs(p),Math.abs(ce))&&Math.abs(_-ye)<=ws*Math.max(1,Math.abs(_),Math.abs(ye))&&Math.abs(S-Le)<=ws*Math.max(1,Math.abs(S),Math.abs(Le))&&Math.abs(T-De)<=ws*Math.max(1,Math.abs(T),Math.abs(De))&&Math.abs(k-et)<=ws*Math.max(1,Math.abs(k),Math.abs(et))&&Math.abs($-dt)<=ws*Math.max(1,Math.abs($),Math.abs(dt))&&Math.abs(L-Qe)<=ws*Math.max(1,Math.abs(L),Math.abs(Qe))&&Math.abs(z-Xe)<=ws*Math.max(1,Math.abs(z),Math.abs(Xe))&&Math.abs(N-qe)<=ws*Math.max(1,Math.abs(N),Math.abs(qe))&&Math.abs(V-ot)<=ws*Math.max(1,Math.abs(V),Math.abs(ot))&&Math.abs(H-Ke)<=ws*Math.max(1,Math.abs(H),Math.abs(Ke))&&Math.abs(Z-je)<=ws*Math.max(1,Math.abs(Z),Math.abs(je))&&Math.abs(Q-_t)<=ws*Math.max(1,Math.abs(Q),Math.abs(_t))&&Math.abs(se-mt)<=ws*Math.max(1,Math.abs(se),Math.abs(mt))&&Math.abs(le-Wt)<=ws*Math.max(1,Math.abs(le),Math.abs(Wt))},u.a_=function(c,n){return c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15],c},u.aa=function(c){const n={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,p,_,S)=>{const T=_||S;return n[p]=!T||T.toLowerCase(),""}),n["max-age"]){const h=parseInt(n["max-age"],10);isNaN(h)?delete n["max-age"]:n["max-age"]=h}return n},u.ab=function(c,n){const h=[];for(const p in c)p in n||h.push(p);return h},u.ac=ke,u.ad=function(c,n,h){var p=Math.sin(h),_=Math.cos(h),S=n[0],T=n[1],k=n[2],$=n[3],L=n[4],z=n[5],N=n[6],V=n[7];return n!==c&&(c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[0]=S*_+L*p,c[1]=T*_+z*p,c[2]=k*_+N*p,c[3]=$*_+V*p,c[4]=L*_-S*p,c[5]=z*_-T*p,c[6]=N*_-k*p,c[7]=V*_-$*p,c},u.ae=function(c){var n=new ip(16);return n[0]=c[0],n[1]=c[1],n[2]=c[2],n[3]=c[3],n[4]=c[4],n[5]=c[5],n[6]=c[6],n[7]=c[7],n[8]=c[8],n[9]=c[9],n[10]=c[10],n[11]=c[11],n[12]=c[12],n[13]=c[13],n[14]=c[14],n[15]=c[15],n},u.af=Q0,u.ag=function(c,n){let h=0,p=0;if(c.kind==="constant")p=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:_,minZoom:S,maxZoom:T}=c,k=_?ke(ss.interpolationFactor(_,n,S,T),0,1):0;c.kind==="camera"?p=Vs.number(c.minSize,c.maxSize,k):h=k}return{uSizeT:h,uSize:p}},u.ai=function(c,{uSize:n,uSizeT:h},{lowerSize:p,upperSize:_}){return c.kind==="source"?p/fa:c.kind==="composite"?Vs.number(p/fa,_/fa,h):n},u.aj=Nw,u.ak=function(c,n,h,p){const _=n.y-c.y,S=n.x-c.x,T=p.y-h.y,k=p.x-h.x,$=T*S-k*_;if($===0)return null;const L=(k*(c.y-h.y)-T*(c.x-h.x))/$;return new E(c.x+L*S,c.y+L*_)},u.al=C3,u.am=fl,u.an=gw,u.ao=br,u.aq=zw,u.ar=function(c,n){var h=n[0],p=n[1],_=n[2],S=n[3],T=n[4],k=n[5],$=n[6],L=n[7],z=n[8],N=n[9],V=n[10],H=n[11],Z=n[12],Q=n[13],se=n[14],le=n[15],we=h*k-p*T,ce=h*$-_*T,ye=h*L-S*T,Le=p*$-_*k,De=p*L-S*k,et=_*L-S*$,dt=z*Q-N*Z,Qe=z*se-V*Z,Xe=z*le-H*Z,qe=N*se-V*Q,ot=N*le-H*Q,Ke=V*le-H*se,je=we*Ke-ce*ot+ye*qe+Le*Xe-De*Qe+et*dt;return je?(c[0]=(k*Ke-$*ot+L*qe)*(je=1/je),c[1]=(_*ot-p*Ke-S*qe)*je,c[2]=(Q*et-se*De+le*Le)*je,c[3]=(V*De-N*et-H*Le)*je,c[4]=($*Xe-T*Ke-L*Qe)*je,c[5]=(h*Ke-_*Xe+S*Qe)*je,c[6]=(se*ye-Z*et-le*ce)*je,c[7]=(z*et-V*ye+H*ce)*je,c[8]=(T*ot-k*Xe+L*dt)*je,c[9]=(p*Xe-h*ot-S*dt)*je,c[10]=(Z*De-Q*ye+le*we)*je,c[11]=(N*ye-z*De-H*we)*je,c[12]=(k*Qe-T*qe-$*dt)*je,c[13]=(h*qe-p*Qe+_*dt)*je,c[14]=(Q*ce-Z*Le-se*we)*je,c[15]=(z*Le-N*ce+V*we)*je,c):null},u.as=Hw,u.at=Dw,u.au=Ww,u.av=function(){const c={},n=$e.$version;for(const h in $e.$root){const p=$e.$root[h];if(p.required){let _=null;_=h==="version"?n:p.type==="array"?[]:{},_!=null&&(c[h]=_)}}return c},u.aw=om,u.ax=He,u.ay=function(c){c=c.slice();const n=Object.create(null);for(let h=0;h<c.length;h++)n[c[h].id]=c[h];for(let h=0;h<c.length;h++)"ref"in c[h]&&(c[h]=Cu(c[h],n[c[h].ref]));return c},u.az=function(c){if(c.type==="custom")return new XN(c);switch(c.type){case"background":return new JN(c);case"circle":return new L6(c);case"fill":return new eN(c);case"fill-extrusion":return new mN(c);case"heatmap":return new D6(c);case"hillshade":return new N6(c);case"line":return new SN(c);case"raster":return new YN(c);case"symbol":return new c_(c)}},u.b=Ut,u.b0=function(c,n){return c[0]*n[0]+c[1]*n[1]+c[2]*n[2]+c[3]*n[3]},u.b1=Ae,u.b2=T3,u.b3=x3,u.b4=function(c,n,h,p,_){var S,T=1/Math.tan(n/2);return c[0]=T/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=T,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,_!=null&&_!==1/0?(c[10]=(_+p)*(S=1/(p-_)),c[14]=2*_*p*S):(c[10]=-1,c[14]=-2*p),c},u.b5=function(c,n,h){var p=Math.sin(h),_=Math.cos(h),S=n[4],T=n[5],k=n[6],$=n[7],L=n[8],z=n[9],N=n[10],V=n[11];return n!==c&&(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[4]=S*_+L*p,c[5]=T*_+z*p,c[6]=k*_+N*p,c[7]=$*_+V*p,c[8]=L*_-S*p,c[9]=z*_-T*p,c[10]=N*_-k*p,c[11]=V*_-$*p,c},u.b6=_e,u.b7=be,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,n){return c[0]=n[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=n[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=n[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=al,u.ba=class extends Jd{},u.bb=Vw,u.bc=cF,u.be=ms,u.bf=function(c,n){un.REGISTERED_PROTOCOLS[c]=n},u.bg=function(c){delete un.REGISTERED_PROTOCOLS[c]},u.bh=function(c,n){const h={};for(let _=0;_<c.length;_++){const S=n&&n[c[_].id]||fw(c[_]);n&&(n[c[_].id]=S);let T=h[S];T||(T=h[S]=[]),T.push(c[_])}const p=[];for(const _ in h)p.push(h[_]);return p},u.bi=st,u.bj=I3,u.bk=k3,u.bl=o3,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=Jt/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const n=c.bucket.layers[0],h=n.layout,p=n._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new $i(c.bucket.zoom+1),c.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new $i(c.bucket.zoom+1),c.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new $i(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:z}=c.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new $i(L),c.canonical),p["text-size"].possiblyEvaluate(new $i(z),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:z}=c.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new $i(L),c.canonical),p["icon-size"].possiblyEvaluate(new $i(z),c.canonical)]}const S=h.get("text-line-height")*br,T=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",k=h.get("text-keep-upright"),$=h.get("text-size");for(const L of c.bucket.features){const z=h.get("text-font").evaluate(L,{},c.canonical).join(","),N=$.evaluate(L,{},c.canonical),V=_.layoutTextSize.evaluate(L,{},c.canonical),H=_.layoutIconSize.evaluate(L,{},c.canonical),Z={horizontal:{},vertical:void 0},Q=L.text;let se,le=[0,0];if(Q){const ye=Q.toString(),Le=h.get("text-letter-spacing").evaluate(L,{},c.canonical)*br,De=qd(ye)?Le:0,et=h.get("text-anchor").evaluate(L,{},c.canonical),dt=B3(n,L,c.canonical);if(!dt){const Ke=h.get("text-radial-offset").evaluate(L,{},c.canonical);le=Ke?F3(et,[Ke*br,qw]):h.get("text-offset").evaluate(L,{},c.canonical).map(je=>je*br)}let Qe=T?"center":h.get("text-justify").evaluate(L,{},c.canonical);const Xe=h.get("symbol-placement"),qe=Xe==="point"?h.get("text-max-width").evaluate(L,{},c.canonical)*br:0,ot=()=>{c.bucket.allowVerticalPlacement&&qu(ye)&&(Z.vertical=o_(Q,c.glyphMap,c.glyphPositions,c.imagePositions,z,qe,S,et,"left",De,le,u.ah.vertical,!0,Xe,V,N))};if(!T&&dt){const Ke=new Set;if(Qe==="auto")for(let _t=0;_t<dt.values.length;_t+=2)Ke.add(Hw(dt.values[_t]));else Ke.add(Qe);let je=!1;for(const _t of Ke)if(!Z.horizontal[_t])if(je)Z.horizontal[_t]=Z.horizontal[0];else{const mt=o_(Q,c.glyphMap,c.glyphPositions,c.imagePositions,z,qe,S,"center",_t,De,le,u.ah.horizontal,!1,Xe,V,N);mt&&(Z.horizontal[_t]=mt,je=mt.positionedLines.length===1)}ot()}else{Qe==="auto"&&(Qe=Hw(et));const Ke=o_(Q,c.glyphMap,c.glyphPositions,c.imagePositions,z,qe,S,et,Qe,De,le,u.ah.horizontal,!1,Xe,V,N);Ke&&(Z.horizontal[Qe]=Ke),ot(),qu(ye)&&T&&k&&(Z.vertical=o_(Q,c.glyphMap,c.glyphPositions,c.imagePositions,z,qe,S,et,Qe,De,le,u.ah.vertical,!1,Xe,V,N))}}let we=!1;if(L.icon&&L.icon.name){const ye=c.imageMap[L.icon.name];ye&&(se=GN(c.imagePositions[L.icon.name],h.get("icon-offset").evaluate(L,{},c.canonical),h.get("icon-anchor").evaluate(L,{},c.canonical)),we=!!ye.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=we:c.bucket.sdfIcons!==we&&It("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ye.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const ce=V3(Z.horizontal)||Z.vertical;c.bucket.iconsInText=!!ce&&ce.iconsInText,(ce||se)&&aF(c.bucket,L,Z,se,c.imageMap,_,V,H,le,we,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=Pw,u.bo=Ew,u.bp=Aw,u.bq=mc,u.br=$w,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,n,h,p,_){return l(this,void 0,void 0,function*(){if(Te())try{return yield ps(c,n,h,p,_)}catch{}return function(S,T,k,$,L){const z=S.width,N=S.height;Rr&&_r||(Rr=new OffscreenCanvas(z,N),_r=Rr.getContext("2d",{willReadFrequently:!0})),Rr.width=z,Rr.height=N,_r.drawImage(S,0,0,z,N);const V=_r.getImageData(T,k,$,L);return _r.clearRect(0,0,z,N),V.data}(c,n,h,p,_)})},u.bu=M3,u.bv=y,u.bw=w,u.bx=YE,u.by=Si,u.bz=function(c){return c.message===cn},u.c=fs,u.d=c=>l(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(n)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=Ve,u.f=c=>new Promise((n,h)=>{const p=new Image;p.onload=()=>{n(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=ir})},p.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(c)],{type:"image/png"});p.src=c.byteLength?URL.createObjectURL(_):ir}),u.g=En,u.h=(c,n)=>Kt(Ve(c,{type:"json"}),n),u.i=Zi,u.j=vr,u.k=aa,u.l=(c,n)=>Kt(Ve(c,{type:"arrayBuffer"}),n),u.m=Kt,u.n=function(c){return new $w(c).readFields(NN,[])},u.o=km,u.p=n3,u.q=vs,u.r=rm,u.s=Pi,u.t=F0,u.u=tt,u.v=$e,u.w=It,u.x=cc,u.y=function([c,n,h]){return n+=90,n*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(n)*Math.sin(h),y:c*Math.sin(n)*Math.sin(h),z:c*Math.cos(h)}},u.z=Vs}),s("worker",["./shared"],function(u){class l{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,q){for(const ee of j){this._layerConfigs[ee.id]=ee;const de=this._layers[ee.id]=u.az(ee);de._featureFilter=u.a6(de.filter),this.keyCache[ee.id]&&delete this.keyCache[ee.id]}for(const ee of q)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const J=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const ee of J){const de=ee.map(Oe=>this._layers[Oe.id]),pe=de[0];if(pe.visibility==="none")continue;const ve=pe.source||"";let ue=this.familiesBySource[ve];ue||(ue=this.familiesBySource[ve]={});const Se=pe.sourceLayer||"_geojsonTileLayer";let Ne=ue[Se];Ne||(Ne=ue[Se]=[]),Ne.push(de)}}}class y{constructor(j){const q={},J=[];for(const ve in j){const ue=j[ve],Se=q[ve]={};for(const Ne in ue){const Oe=ue[+Ne];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const Re={x:0,y:0,w:Oe.bitmap.width+2,h:Oe.bitmap.height+2};J.push(Re),Se[Ne]={rect:Re,metrics:Oe.metrics}}}const{w:ee,h:de}=u.p(J),pe=new u.o({width:ee||1,height:de||1});for(const ve in j){const ue=j[ve];for(const Se in ue){const Ne=ue[+Se];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Oe=q[ve][Se].rect;u.o.copy(Ne.bitmap,pe,{x:0,y:0},{x:Oe.x+1,y:Oe.y+1},Ne.bitmap)}}this.image=pe,this.positions=q}}u.bi("GlyphAtlas",y);class w{constructor(j){this.tileID=new u.Q(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,q,J,ee){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new u.a4;const de=new u.bj(Object.keys(j.layers).sort()),pe=new u.bk(this.tileID,this.promoteId);pe.bucketLayerIDs=[];const ve={},ue={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},Se=q.familiesBySource[this.source];for(const Dt in Se){const Vi=j.layers[Dt];if(!Vi)continue;Vi.version===1&&u.w(`Vector tile source "${this.source}" layer "${Dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const kr=de.encode(Dt),gs=[];for(let Gr=0;Gr<Vi.length;Gr++){const rs=Vi.feature(Gr),Fs=pe.getId(rs,Dt);gs.push({feature:rs,id:Fs,index:Gr,sourceLayerIndex:kr})}for(const Gr of Se[Dt]){const rs=Gr[0];rs.source!==this.source&&u.w(`layer.source = ${rs.source} does not equal this.source = ${this.source}`),rs.minzoom&&this.zoom<Math.floor(rs.minzoom)||rs.maxzoom&&this.zoom>=rs.maxzoom||rs.visibility!=="none"&&(I(Gr,this.zoom,J),(ve[rs.id]=rs.createBucket({index:pe.bucketLayerIDs.length,layers:Gr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:kr,sourceID:this.source})).populate(gs,ue,this.tileID.canonical),pe.bucketLayerIDs.push(Gr.map(Fs=>Fs.id)))}}const Ne=u.aE(ue.glyphDependencies,Dt=>Object.keys(Dt).map(Number));this.inFlightDependencies.forEach(Dt=>Dt==null?void 0:Dt.abort()),this.inFlightDependencies=[];let Oe=Promise.resolve({});if(Object.keys(Ne).length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),Oe=ee.sendAsync({type:"getGlyphs",data:{stacks:Ne,source:this.source,tileID:this.tileID,type:"glyphs"}},Dt)}const Re=Object.keys(ue.iconDependencies);let ft=Promise.resolve({});if(Re.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),ft=ee.sendAsync({type:"getImages",data:{icons:Re,source:this.source,tileID:this.tileID,type:"icons"}},Dt)}const Et=Object.keys(ue.patternDependencies);let xt=Promise.resolve({});if(Et.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),xt=ee.sendAsync({type:"getImages",data:{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"}},Dt)}const[ei,Ct,Ci]=yield Promise.all([Oe,ft,xt]),xi=new y(ei),rr=new u.bl(Ct,Ci);for(const Dt in ve){const Vi=ve[Dt];Vi instanceof u.a5?(I(Vi.layers,this.zoom,J),u.bm({bucket:Vi,glyphMap:ei,glyphPositions:xi.positions,imageMap:Ct,imagePositions:rr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vi.hasPattern&&(Vi instanceof u.bn||Vi instanceof u.bo||Vi instanceof u.bp)&&(I(Vi.layers,this.zoom,J),Vi.addFeatures(ue,this.tileID.canonical,rr.patternPositions))}return this.status="done",{buckets:Object.values(ve).filter(Dt=>!Dt.isEmpty()),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xi.image,imageAtlas:rr,glyphMap:this.returnDependencies?ei:null,iconMap:this.returnDependencies?Ct:null,glyphPositions:this.returnDependencies?xi.positions:null}})}}function I(ie,j,q){const J=new u.a8(j);for(const ee of ie)ee.recalculate(J,q)}class E{constructor(j,q,J){this.actor=j,this.layerIndex=q,this.availableImages=J,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,q){return u._(this,void 0,void 0,function*(){const J=yield u.l(j.request,q);try{return{vectorTile:new u.bq.VectorTile(new u.br(J.data)),rawData:J.data,cacheControl:J.cacheControl,expires:J.expires}}catch(ee){const de=new Uint8Array(J.data);let pe=`Unable to parse the tile at ${j.request.url}, `;throw pe+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ee.messge}`,new Error(pe)}})}loadTile(j){return u._(this,void 0,void 0,function*(){const q=j.uid,J=!!(j&&j.request&&j.request.collectResourceTiming)&&new u.bs(j.request),ee=new w(j);this.loading[q]=ee;const de=new AbortController;ee.abort=de;try{const pe=yield this.loadVectorTile(j,de);if(delete this.loading[q],!pe)return null;const ve=pe.rawData,ue={};pe.expires&&(ue.expires=pe.expires),pe.cacheControl&&(ue.cacheControl=pe.cacheControl);const Se={};if(J){const Oe=J.finish();Oe&&(Se.resourceTiming=JSON.parse(JSON.stringify(Oe)))}ee.vectorTile=pe.vectorTile;const Ne=ee.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[q]=ee,this.fetching[q]={rawTileData:ve,cacheControl:ue,resourceTiming:Se};try{const Oe=yield Ne;return u.e({rawTileData:ve.slice(0)},Oe,ue,Se)}finally{delete this.fetching[q]}}catch(pe){throw delete this.loading[q],ee.status="done",this.loaded[q]=ee,pe}})}reloadTile(j){return u._(this,void 0,void 0,function*(){const q=j.uid;if(!this.loaded||!this.loaded[q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const J=this.loaded[q];if(J.showCollisionBoxes=j.showCollisionBoxes,J.status==="parsing"){const ee=yield J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor);let de;if(this.fetching[q]){const{rawTileData:pe,cacheControl:ve,resourceTiming:ue}=this.fetching[q];delete this.fetching[q],de=u.e({rawTileData:pe.slice(0)},ee,ve,ue)}else de=ee;return de}if(J.status==="done"&&J.vectorTile)return J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(j){return u._(this,void 0,void 0,function*(){const q=this.loading,J=j.uid;q&&q[J]&&q[J].abort&&(q[J].abort.abort(),delete q[J])})}removeTile(j){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class A{constructor(){this.loaded={}}loadTile(j){return u._(this,void 0,void 0,function*(){const{uid:q,encoding:J,rawImageData:ee,redFactor:de,greenFactor:pe,blueFactor:ve,baseShift:ue}=j,Se=ee.width+2,Ne=ee.height+2,Oe=u.b(ee)?new u.R({width:Se,height:Ne},yield u.bt(ee,-1,-1,Se,Ne)):ee,Re=new u.bu(q,Oe,J,de,pe,ve,ue);return this.loaded=this.loaded||{},this.loaded[q]=Re,Re})}removeTile(j){const q=this.loaded,J=j.uid;q&&q[J]&&delete q[J]}}function R(ie,j){if(ie.length!==0){G(ie[0],j);for(var q=1;q<ie.length;q++)G(ie[q],!j)}}function G(ie,j){for(var q=0,J=0,ee=0,de=ie.length,pe=de-1;ee<de;pe=ee++){var ve=(ie[ee][0]-ie[pe][0])*(ie[pe][1]+ie[ee][1]),ue=q+ve;J+=Math.abs(q)>=Math.abs(ve)?q-ue+ve:ve-ue+q,q=ue}q+J>=0!=!!j&&ie.reverse()}var K=u.bv(function ie(j,q){var J,ee=j&&j.type;if(ee==="FeatureCollection")for(J=0;J<j.features.length;J++)ie(j.features[J],q);else if(ee==="GeometryCollection")for(J=0;J<j.geometries.length;J++)ie(j.geometries[J],q);else if(ee==="Feature")ie(j.geometry,q);else if(ee==="Polygon")R(j.coordinates,q);else if(ee==="MultiPolygon")for(J=0;J<j.coordinates.length;J++)R(j.coordinates[J],q);return j});const Y=u.bq.VectorTileFeature.prototype.toGeoJSON;var ae={exports:{}},Te=u.bw,_e=u.bq.VectorTileFeature,be=ke;function ke(ie,j){this.options=j||{},this.features=ie,this.length=ie.length}function Ae(ie,j){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=j||4096}ke.prototype.feature=function(ie){return new Ae(this.features[ie],this.options.extent)},Ae.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var j=0;j<ie.length;j++){for(var q=ie[j],J=[],ee=0;ee<q.length;ee++)J.push(new Te(q[ee][0],q[ee][1]));this.geometry.push(J)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,j=1/0,q=-1/0,J=1/0,ee=-1/0,de=0;de<ie.length;de++)for(var pe=ie[de],ve=0;ve<pe.length;ve++){var ue=pe[ve];j=Math.min(j,ue.x),q=Math.max(q,ue.x),J=Math.min(J,ue.y),ee=Math.max(ee,ue.y)}return[j,J,q,ee]},Ae.prototype.toGeoJSON=_e.prototype.toGeoJSON;var Ve=u.bx,Ze=be;function lt(ie){var j=new Ve;return function(q,J){for(var ee in q.layers)J.writeMessage(3,ct,q.layers[ee])}(ie,j),j.finish()}function ct(ie,j){var q;j.writeVarintField(15,ie.version||1),j.writeStringField(1,ie.name||""),j.writeVarintField(5,ie.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<ie.length;q++)J.feature=ie.feature(q),j.writeMessage(2,ut,J);var ee=J.keys;for(q=0;q<ee.length;q++)j.writeStringField(3,ee[q]);var de=J.values;for(q=0;q<de.length;q++)j.writeMessage(4,Zi,de[q])}function ut(ie,j){var q=ie.feature;q.id!==void 0&&j.writeVarintField(1,q.id),j.writeMessage(2,nt,ie),j.writeVarintField(3,q.type),j.writeMessage(4,hi,q)}function nt(ie,j){var q=ie.feature,J=ie.keys,ee=ie.values,de=ie.keycache,pe=ie.valuecache;for(var ve in q.properties){var ue=q.properties[ve],Se=de[ve];if(ue!==null){Se===void 0&&(J.push(ve),de[ve]=Se=J.length-1),j.writeVarint(Se);var Ne=typeof ue;Ne!=="string"&&Ne!=="boolean"&&Ne!=="number"&&(ue=JSON.stringify(ue));var Oe=Ne+":"+ue,Re=pe[Oe];Re===void 0&&(ee.push(ue),pe[Oe]=Re=ee.length-1),j.writeVarint(Re)}}}function It(ie,j){return(j<<3)+(7&ie)}function ht(ie){return ie<<1^ie>>31}function hi(ie,j){for(var q=ie.loadGeometry(),J=ie.type,ee=0,de=0,pe=q.length,ve=0;ve<pe;ve++){var ue=q[ve],Se=1;J===1&&(Se=ue.length),j.writeVarint(It(1,Se));for(var Ne=J===3?ue.length-1:ue.length,Oe=0;Oe<Ne;Oe++){Oe===1&&J!==1&&j.writeVarint(It(2,Ne-1));var Re=ue[Oe].x-ee,ft=ue[Oe].y-de;j.writeVarint(ht(Re)),j.writeVarint(ht(ft)),ee+=Re,de+=ft}J===3&&j.writeVarint(It(7,1))}}function Zi(ie,j){var q=typeof ie;q==="string"?j.writeStringField(1,ie):q==="boolean"?j.writeBooleanField(7,ie):q==="number"&&(ie%1!=0?j.writeDoubleField(3,ie):ie<0?j.writeSVarintField(6,ie):j.writeVarintField(5,ie))}ae.exports=lt,ae.exports.fromVectorTileJs=lt,ae.exports.fromGeojsonVt=function(ie,j){j=j||{};var q={};for(var J in ie)q[J]=new Ze(ie[J].features,j),q[J].name=J,q[J].version=j.version,q[J].extent=j.extent;return lt({layers:q})},ae.exports.GeoJSONWrapper=Ze;var gi=u.bv(ae.exports);const Ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},ir=Math.fround||(ps=new Float32Array(1),ie=>(ps[0]=+ie,ps[0]));var ps;const Rr=3,_r=5,cn=6;class fs{constructor(j){this.options=Object.assign(Object.create(Ut),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:q,minZoom:J,maxZoom:ee}=this.options;q&&console.time("total time");const de=`prepare ${j.length} points`;q&&console.time(de),this.points=j;const pe=[];for(let ue=0;ue<j.length;ue++){const Se=j[ue];if(!Se.geometry)continue;const[Ne,Oe]=Se.geometry.coordinates,Re=ir(is(Ne)),ft=ir(ms(Oe));pe.push(Re,ft,1/0,ue,-1,1),this.options.reduce&&pe.push(0)}let ve=this.trees[ee+1]=this._createTree(pe);q&&console.timeEnd(de);for(let ue=ee;ue>=J;ue--){const Se=+Date.now();ve=this.trees[ue]=this._createTree(this._cluster(ve,ue)),q&&console.log("z%d: %d clusters in %dms",ue,ve.numItems,+Date.now()-Se)}return q&&console.timeEnd("total time"),this}getClusters(j,q){let J=((j[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,j[1]));let de=j[2]===180?180:((j[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)J=-180,de=180;else if(J>de){const Oe=this.getClusters([J,ee,180,pe],q),Re=this.getClusters([-180,ee,de,pe],q);return Oe.concat(Re)}const ve=this.trees[this._limitZoom(q)],ue=ve.range(is(J),ms(pe),is(de),ms(ee)),Se=ve.data,Ne=[];for(const Oe of ue){const Re=this.stride*Oe;Ne.push(Se[Re+_r]>1?un(Se,Re,this.clusterProps):this.points[Se[Re+Rr]])}return Ne}getChildren(j){const q=this._getOriginId(j),J=this._getOriginZoom(j),ee="No cluster with the specified id.",de=this.trees[J];if(!de)throw new Error(ee);const pe=de.data;if(q*this.stride>=pe.length)throw new Error(ee);const ve=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ue=de.within(pe[q*this.stride],pe[q*this.stride+1],ve),Se=[];for(const Ne of ue){const Oe=Ne*this.stride;pe[Oe+4]===j&&Se.push(pe[Oe+_r]>1?un(pe,Oe,this.clusterProps):this.points[pe[Oe+Rr]])}if(Se.length===0)throw new Error(ee);return Se}getLeaves(j,q,J){const ee=[];return this._appendLeaves(ee,j,q=q||10,J=J||0,0),ee}getTile(j,q,J){const ee=this.trees[this._limitZoom(j)],de=Math.pow(2,j),{extent:pe,radius:ve}=this.options,ue=ve/pe,Se=(J-ue)/de,Ne=(J+1+ue)/de,Oe={features:[]};return this._addTileFeatures(ee.range((q-ue)/de,Se,(q+1+ue)/de,Ne),ee.data,q,J,de,Oe),q===0&&this._addTileFeatures(ee.range(1-ue/de,Se,1,Ne),ee.data,de,J,de,Oe),q===de-1&&this._addTileFeatures(ee.range(0,Se,ue/de,Ne),ee.data,-1,J,de,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(j){let q=this._getOriginZoom(j)-1;for(;q<=this.options.maxZoom;){const J=this.getChildren(j);if(q++,J.length!==1)break;j=J[0].properties.cluster_id}return q}_appendLeaves(j,q,J,ee,de){const pe=this.getChildren(q);for(const ve of pe){const ue=ve.properties;if(ue&&ue.cluster?de+ue.point_count<=ee?de+=ue.point_count:de=this._appendLeaves(j,ue.cluster_id,J,ee,de):de<ee?de++:j.push(ve),j.length===J)break}return de}_createTree(j){const q=new u.au(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<j.length;J+=this.stride)q.add(j[J],j[J+1]);return q.finish(),q.data=j,q}_addTileFeatures(j,q,J,ee,de,pe){for(const ve of j){const ue=ve*this.stride,Se=q[ue+_r]>1;let Ne,Oe,Re;if(Se)Ne=En(q,ue,this.clusterProps),Oe=q[ue],Re=q[ue+1];else{const xt=this.points[q[ue+Rr]];Ne=xt.properties;const[ei,Ct]=xt.geometry.coordinates;Oe=is(ei),Re=ms(Ct)}const ft={type:1,geometry:[[Math.round(this.options.extent*(Oe*de-J)),Math.round(this.options.extent*(Re*de-ee))]],tags:Ne};let Et;Et=Se||this.options.generateId?q[ue+Rr]:this.points[q[ue+Rr]].id,Et!==void 0&&(ft.id=Et),pe.features.push(ft)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,q){const{radius:J,extent:ee,reduce:de,minPoints:pe}=this.options,ve=J/(ee*Math.pow(2,q)),ue=j.data,Se=[],Ne=this.stride;for(let Oe=0;Oe<ue.length;Oe+=Ne){if(ue[Oe+2]<=q)continue;ue[Oe+2]=q;const Re=ue[Oe],ft=ue[Oe+1],Et=j.within(ue[Oe],ue[Oe+1],ve),xt=ue[Oe+_r];let ei=xt;for(const Ct of Et){const Ci=Ct*Ne;ue[Ci+2]>q&&(ei+=ue[Ci+_r])}if(ei>xt&&ei>=pe){let Ct,Ci=Re*xt,xi=ft*xt,rr=-1;const Dt=((Oe/Ne|0)<<5)+(q+1)+this.points.length;for(const Vi of Et){const kr=Vi*Ne;if(ue[kr+2]<=q)continue;ue[kr+2]=q;const gs=ue[kr+_r];Ci+=ue[kr]*gs,xi+=ue[kr+1]*gs,ue[kr+4]=Dt,de&&(Ct||(Ct=this._map(ue,Oe,!0),rr=this.clusterProps.length,this.clusterProps.push(Ct)),de(Ct,this._map(ue,kr)))}ue[Oe+4]=Dt,Se.push(Ci/ei,xi/ei,1/0,Dt,-1,ei),de&&Se.push(rr)}else{for(let Ct=0;Ct<Ne;Ct++)Se.push(ue[Oe+Ct]);if(ei>1)for(const Ct of Et){const Ci=Ct*Ne;if(!(ue[Ci+2]<=q)){ue[Ci+2]=q;for(let xi=0;xi<Ne;xi++)Se.push(ue[Ci+xi])}}}}return Se}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,q,J){if(j[q+_r]>1){const pe=this.clusterProps[j[q+cn]];return J?Object.assign({},pe):pe}const ee=this.points[j[q+Rr]].properties,de=this.options.map(ee);return J&&de===ee?Object.assign({},de):de}}function un(ie,j,q){return{type:"Feature",id:ie[j+Rr],properties:En(ie,j,q),geometry:{type:"Point",coordinates:[(J=ie[j],360*(J-.5)),He(ie[j+1])]}};var J}function En(ie,j,q){const J=ie[j+_r],ee=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,de=ie[j+cn],pe=de===-1?{}:Object.assign({},q[de]);return Object.assign(pe,{cluster:!0,cluster_id:ie[j+Rr],point_count:J,point_count_abbreviated:ee})}function is(ie){return ie/360+.5}function ms(ie){const j=Math.sin(ie*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function He(ie){const j=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function Kt(ie,j,q,J){for(var ee,de=J,pe=q-j>>1,ve=q-j,ue=ie[j],Se=ie[j+1],Ne=ie[q],Oe=ie[q+1],Re=j+3;Re<q;Re+=3){var ft=Pi(ie[Re],ie[Re+1],ue,Se,Ne,Oe);if(ft>de)ee=Re,de=ft;else if(ft===de){var Et=Math.abs(Re-pe);Et<ve&&(ee=Re,ve=Et)}}de>J&&(ee-j>3&&Kt(ie,j,ee,J),ie[ee+2]=de,q-ee>3&&Kt(ie,ee,q,J))}function Pi(ie,j,q,J,ee,de){var pe=ee-q,ve=de-J;if(pe!==0||ve!==0){var ue=((ie-q)*pe+(j-J)*ve)/(pe*pe+ve*ve);ue>1?(q=ee,J=de):ue>0&&(q+=pe*ue,J+=ve*ue)}return(pe=ie-q)*pe+(ve=j-J)*ve}function zs(ie,j,q,J){var ee={id:ie===void 0?null:ie,type:j,geometry:q,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var pe=de.geometry,ve=de.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")oa(de,pe);else if(ve==="Polygon"||ve==="MultiLineString")for(var ue=0;ue<pe.length;ue++)oa(de,pe[ue]);else if(ve==="MultiPolygon")for(ue=0;ue<pe.length;ue++)for(var Se=0;Se<pe[ue].length;Se++)oa(de,pe[ue][Se])}(ee),ee}function oa(ie,j){for(var q=0;q<j.length;q+=3)ie.minX=Math.min(ie.minX,j[q]),ie.minY=Math.min(ie.minY,j[q+1]),ie.maxX=Math.max(ie.maxX,j[q]),ie.maxY=Math.max(ie.maxY,j[q+1])}function aa(ie,j,q,J){if(j.geometry){var ee=j.geometry.coordinates,de=j.geometry.type,pe=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),ve=[],ue=j.id;if(q.promoteId?ue=j.properties[q.promoteId]:q.generateId&&(ue=J||0),de==="Point")vr(ee,ve);else if(de==="MultiPoint")for(var Se=0;Se<ee.length;Se++)vr(ee[Se],ve);else if(de==="LineString")Ka(ee,ve,pe,!1);else if(de==="MultiLineString"){if(q.lineMetrics){for(Se=0;Se<ee.length;Se++)Ka(ee[Se],ve=[],pe,!1),ie.push(zs(ue,"LineString",ve,j.properties));return}$e(ee,ve,pe,!1)}else if(de==="Polygon")$e(ee,ve,pe,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(Se=0;Se<j.geometry.geometries.length;Se++)aa(ie,{id:ue,geometry:j.geometry.geometries[Se],properties:j.properties},q,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Se=0;Se<ee.length;Se++){var Ne=[];$e(ee[Se],Ne,pe,!0),ve.push(Ne)}}ie.push(zs(ue,de,ve,j.properties))}}function vr(ie,j){j.push(Ya(ie[0])),j.push(Cu(ie[1])),j.push(0)}function Ka(ie,j,q,J){for(var ee,de,pe=0,ve=0;ve<ie.length;ve++){var ue=Ya(ie[ve][0]),Se=Cu(ie[ve][1]);j.push(ue),j.push(Se),j.push(0),ve>0&&(pe+=J?(ee*Se-ue*de)/2:Math.sqrt(Math.pow(ue-ee,2)+Math.pow(Se-de,2))),ee=ue,de=Se}var Ne=j.length-3;j[2]=1,Kt(j,0,Ne,q),j[Ne+2]=1,j.size=Math.abs(pe),j.start=0,j.end=j.size}function $e(ie,j,q,J){for(var ee=0;ee<ie.length;ee++){var de=[];Ka(ie[ee],de,q,J),j.push(de)}}function Ya(ie){return ie/360+.5}function Cu(ie){var j=Math.sin(ie*Math.PI/180),q=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return q<0?0:q>1?1:q}function Qt(ie,j,q,J,ee,de,pe,ve){if(J/=j,de>=(q/=j)&&pe<J)return ie;if(pe<q||de>=J)return null;for(var ue=[],Se=0;Se<ie.length;Se++){var Ne=ie[Se],Oe=Ne.geometry,Re=Ne.type,ft=ee===0?Ne.minX:Ne.minY,Et=ee===0?Ne.maxX:Ne.maxY;if(ft>=q&&Et<J)ue.push(Ne);else if(!(Et<q||ft>=J)){var xt=[];if(Re==="Point"||Re==="MultiPoint")Dr(Oe,xt,q,J,ee);else if(Re==="LineString")Kn(Oe,xt,q,J,ee,!1,ve.lineMetrics);else if(Re==="MultiLineString")Hl(Oe,xt,q,J,ee,!1);else if(Re==="Polygon")Hl(Oe,xt,q,J,ee,!0);else if(Re==="MultiPolygon")for(var ei=0;ei<Oe.length;ei++){var Ct=[];Hl(Oe[ei],Ct,q,J,ee,!0),Ct.length&&xt.push(Ct)}if(xt.length){if(ve.lineMetrics&&Re==="LineString"){for(ei=0;ei<xt.length;ei++)ue.push(zs(Ne.id,Re,xt[ei],Ne.tags));continue}Re!=="LineString"&&Re!=="MultiLineString"||(xt.length===1?(Re="LineString",xt=xt[0]):Re="MultiLineString"),Re!=="Point"&&Re!=="MultiPoint"||(Re=xt.length===3?"Point":"MultiPoint"),ue.push(zs(Ne.id,Re,xt,Ne.tags))}}}return ue.length?ue:null}function Dr(ie,j,q,J,ee){for(var de=0;de<ie.length;de+=3){var pe=ie[de+ee];pe>=q&&pe<=J&&(j.push(ie[de]),j.push(ie[de+1]),j.push(ie[de+2]))}}function Kn(ie,j,q,J,ee,de,pe){for(var ve,ue,Se=ql(ie),Ne=ee===0?Xa:Zl,Oe=ie.start,Re=0;Re<ie.length-3;Re+=3){var ft=ie[Re],Et=ie[Re+1],xt=ie[Re+2],ei=ie[Re+3],Ct=ie[Re+4],Ci=ee===0?ft:Et,xi=ee===0?ei:Ct,rr=!1;pe&&(ve=Math.sqrt(Math.pow(ft-ei,2)+Math.pow(Et-Ct,2))),Ci<q?xi>q&&(ue=Ne(Se,ft,Et,ei,Ct,q),pe&&(Se.start=Oe+ve*ue)):Ci>J?xi<J&&(ue=Ne(Se,ft,Et,ei,Ct,J),pe&&(Se.start=Oe+ve*ue)):Wl(Se,ft,Et,xt),xi<q&&Ci>=q&&(ue=Ne(Se,ft,Et,ei,Ct,q),rr=!0),xi>J&&Ci<=J&&(ue=Ne(Se,ft,Et,ei,Ct,J),rr=!0),!de&&rr&&(pe&&(Se.end=Oe+ve*ue),j.push(Se),Se=ql(ie)),pe&&(Oe+=ve)}var Dt=ie.length-3;ft=ie[Dt],Et=ie[Dt+1],xt=ie[Dt+2],(Ci=ee===0?ft:Et)>=q&&Ci<=J&&Wl(Se,ft,Et,xt),Dt=Se.length-3,de&&Dt>=3&&(Se[Dt]!==Se[0]||Se[Dt+1]!==Se[1])&&Wl(Se,Se[0],Se[1],Se[2]),Se.length&&j.push(Se)}function ql(ie){var j=[];return j.size=ie.size,j.start=ie.start,j.end=ie.end,j}function Hl(ie,j,q,J,ee,de){for(var pe=0;pe<ie.length;pe++)Kn(ie[pe],j,q,J,ee,de,!1)}function Wl(ie,j,q,J){ie.push(j),ie.push(q),ie.push(J)}function Xa(ie,j,q,J,ee,de){var pe=(de-j)/(J-j);return ie.push(de),ie.push(q+(ee-q)*pe),ie.push(1),pe}function Zl(ie,j,q,J,ee,de){var pe=(de-q)/(ee-q);return ie.push(j+(J-j)*pe),ie.push(de),ie.push(1),pe}function $u(ie,j){for(var q=[],J=0;J<ie.length;J++){var ee,de=ie[J],pe=de.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")ee=We(de.geometry,j);else if(pe==="MultiLineString"||pe==="Polygon"){ee=[];for(var ve=0;ve<de.geometry.length;ve++)ee.push(We(de.geometry[ve],j))}else if(pe==="MultiPolygon")for(ee=[],ve=0;ve<de.geometry.length;ve++){for(var ue=[],Se=0;Se<de.geometry[ve].length;Se++)ue.push(We(de.geometry[ve][Se],j));ee.push(ue)}q.push(zs(de.id,pe,ee,de.tags))}return q}function We(ie,j){var q=[];q.size=ie.size,ie.start!==void 0&&(q.start=ie.start,q.end=ie.end);for(var J=0;J<ie.length;J+=3)q.push(ie[J]+j,ie[J+1],ie[J+2]);return q}function Ns(ie,j){if(ie.transformed)return ie;var q,J,ee,de=1<<ie.z,pe=ie.x,ve=ie.y;for(q=0;q<ie.features.length;q++){var ue=ie.features[q],Se=ue.geometry,Ne=ue.type;if(ue.geometry=[],Ne===1)for(J=0;J<Se.length;J+=2)ue.geometry.push(ys(Se[J],Se[J+1],j,de,pe,ve));else for(J=0;J<Se.length;J++){var Oe=[];for(ee=0;ee<Se[J].length;ee+=2)Oe.push(ys(Se[J][ee],Se[J][ee+1],j,de,pe,ve));ue.geometry.push(Oe)}}return ie.transformed=!0,ie}function ys(ie,j,q,J,ee,de){return[Math.round(q*(ie*J-ee)),Math.round(q*(j*J-de))]}function Ou(ie,j,q,J,ee){for(var de=j===ee.maxZoom?0:ee.tolerance/((1<<j)*ee.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:J,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ve=0;ve<ie.length;ve++){pe.numFeatures++,Qa(pe,ie[ve],de,ee);var ue=ie[ve].minX,Se=ie[ve].minY,Ne=ie[ve].maxX,Oe=ie[ve].maxY;ue<pe.minX&&(pe.minX=ue),Se<pe.minY&&(pe.minY=Se),Ne>pe.maxX&&(pe.maxX=Ne),Oe>pe.maxY&&(pe.maxY=Oe)}return pe}function Qa(ie,j,q,J){var ee=j.geometry,de=j.type,pe=[];if(de==="Point"||de==="MultiPoint")for(var ve=0;ve<ee.length;ve+=3)pe.push(ee[ve]),pe.push(ee[ve+1]),ie.numPoints++,ie.numSimplified++;else if(de==="LineString")Ue(pe,ee,ie,q,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ve=0;ve<ee.length;ve++)Ue(pe,ee[ve],ie,q,de==="Polygon",ve===0);else if(de==="MultiPolygon")for(var ue=0;ue<ee.length;ue++){var Se=ee[ue];for(ve=0;ve<Se.length;ve++)Ue(pe,Se[ve],ie,q,!0,ve===0)}if(pe.length){var Ne=j.tags||null;if(de==="LineString"&&J.lineMetrics){for(var Oe in Ne={},j.tags)Ne[Oe]=j.tags[Oe];Ne.mapbox_clip_start=ee.start/ee.size,Ne.mapbox_clip_end=ee.end/ee.size}var Re={geometry:pe,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Ne};j.id!==null&&(Re.id=j.id),ie.features.push(Re)}}function Ue(ie,j,q,J,ee,de){var pe=J*J;if(J>0&&j.size<(ee?pe:J))q.numPoints+=j.length/3;else{for(var ve=[],ue=0;ue<j.length;ue+=3)(J===0||j[ue+2]>pe)&&(q.numSimplified++,ve.push(j[ue]),ve.push(j[ue+1])),q.numPoints++;ee&&function(Se,Ne){for(var Oe=0,Re=0,ft=Se.length,Et=ft-2;Re<ft;Et=Re,Re+=2)Oe+=(Se[Re]-Se[Et])*(Se[Re+1]+Se[Et+1]);if(Oe>0===Ne)for(Re=0,ft=Se.length;Re<ft/2;Re+=2){var xt=Se[Re],ei=Se[Re+1];Se[Re]=Se[ft-2-Re],Se[Re+1]=Se[ft-1-Re],Se[ft-2-Re]=xt,Se[ft-1-Re]=ei}}(ve,de),ie.push(ve)}}function Bt(ie,j){var q=(j=this.options=function(ee,de){for(var pe in de)ee[pe]=de[pe];return ee}(Object.create(this.options),j)).debug;if(q&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ee,de){var pe=[];if(ee.type==="FeatureCollection")for(var ve=0;ve<ee.features.length;ve++)aa(pe,ee.features[ve],de,ve);else aa(pe,ee.type==="Feature"?ee:{geometry:ee},de);return pe}(ie,j);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(ee,de){var pe=de.buffer/de.extent,ve=ee,ue=Qt(ee,1,-1-pe,pe,0,-1,2,de),Se=Qt(ee,1,1-pe,2+pe,0,-1,2,de);return(ue||Se)&&(ve=Qt(ee,1,-pe,1+pe,0,-1,2,de)||[],ue&&(ve=$u(ue,1).concat(ve)),Se&&(ve=ve.concat($u(Se,-1)))),ve}(J,j),J.length&&this.splitTile(J,0,0,0),q&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Lt(ie,j,q){return 32*((1<<ie)*q+j)+ie}function zr(ie,j){return j?ie.properties[j]:ie.id}function hn(ie,j){if(ie==null)return!0;if(ie.type==="Feature")return zr(ie,j)!=null;if(ie.type==="FeatureCollection"){const q=new Set;for(const J of ie.features){const ee=zr(J,j);if(ee==null||q.has(ee))return!1;q.add(ee)}return!0}return!1}function Rt(ie,j){const q=new Map;if(ie!=null)if(ie.type==="Feature")q.set(zr(ie,j),ie);else for(const J of ie.features)q.set(zr(J,j),J);return q}Bt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Bt.prototype.splitTile=function(ie,j,q,J,ee,de,pe){for(var ve=[ie,j,q,J],ue=this.options,Se=ue.debug;ve.length;){J=ve.pop(),q=ve.pop(),j=ve.pop(),ie=ve.pop();var Ne=1<<j,Oe=Lt(j,q,J),Re=this.tiles[Oe];if(!Re&&(Se>1&&console.time("creation"),Re=this.tiles[Oe]=Ou(ie,j,q,J,ue),this.tileCoords.push({z:j,x:q,y:J}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,q,J,Re.numFeatures,Re.numPoints,Re.numSimplified),console.timeEnd("creation"));var ft="z"+j;this.stats[ft]=(this.stats[ft]||0)+1,this.total++}if(Re.source=ie,ee){if(j===ue.maxZoom||j===ee)continue;var Et=1<<ee-j;if(q!==Math.floor(de/Et)||J!==Math.floor(pe/Et))continue}else if(j===ue.indexMaxZoom||Re.numPoints<=ue.indexMaxPoints)continue;if(Re.source=null,ie.length!==0){Se>1&&console.time("clipping");var xt,ei,Ct,Ci,xi,rr,Dt=.5*ue.buffer/ue.extent,Vi=.5-Dt,kr=.5+Dt,gs=1+Dt;xt=ei=Ct=Ci=null,xi=Qt(ie,Ne,q-Dt,q+kr,0,Re.minX,Re.maxX,ue),rr=Qt(ie,Ne,q+Vi,q+gs,0,Re.minX,Re.maxX,ue),ie=null,xi&&(xt=Qt(xi,Ne,J-Dt,J+kr,1,Re.minY,Re.maxY,ue),ei=Qt(xi,Ne,J+Vi,J+gs,1,Re.minY,Re.maxY,ue),xi=null),rr&&(Ct=Qt(rr,Ne,J-Dt,J+kr,1,Re.minY,Re.maxY,ue),Ci=Qt(rr,Ne,J+Vi,J+gs,1,Re.minY,Re.maxY,ue),rr=null),Se>1&&console.timeEnd("clipping"),ve.push(xt||[],j+1,2*q,2*J),ve.push(ei||[],j+1,2*q,2*J+1),ve.push(Ct||[],j+1,2*q+1,2*J),ve.push(Ci||[],j+1,2*q+1,2*J+1)}}},Bt.prototype.getTile=function(ie,j,q){var J=this.options,ee=J.extent,de=J.debug;if(ie<0||ie>24)return null;var pe=1<<ie,ve=Lt(ie,j=(j%pe+pe)%pe,q);if(this.tiles[ve])return Ns(this.tiles[ve],ee);de>1&&console.log("drilling down to z%d-%d-%d",ie,j,q);for(var ue,Se=ie,Ne=j,Oe=q;!ue&&Se>0;)Se--,Ne=Math.floor(Ne/2),Oe=Math.floor(Oe/2),ue=this.tiles[Lt(Se,Ne,Oe)];return ue&&ue.source?(de>1&&console.log("found parent tile z%d-%d-%d",Se,Ne,Oe),de>1&&console.time("drilling down"),this.splitTile(ue.source,Se,Ne,Oe,ie,j,q),de>1&&console.timeEnd("drilling down"),this.tiles[ve]?Ns(this.tiles[ve],ee):null):null};class la extends E{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,q){return u._(this,void 0,void 0,function*(){const J=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ee=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!ee)return null;const de=new class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=ve.length,this._features=ve}feature(ve){return new class{constructor(ue){this._feature=ue,this.extent=u.W,this.type=ue.type,this.properties=ue.tags,"id"in ue&&!isNaN(ue.id)&&(this.id=parseInt(ue.id,10))}loadGeometry(){if(this._feature.type===1){const ue=[];for(const Se of this._feature.geometry)ue.push([new u.P(Se[0],Se[1])]);return ue}{const ue=[];for(const Se of this._feature.geometry){const Ne=[];for(const Oe of Se)Ne.push(new u.P(Oe[0],Oe[1]));ue.push(Ne)}return ue}}toGeoJSON(ue,Se,Ne){return Y.call(this,ue,Se,Ne)}}(this._features[ve])}}(ee.features);let pe=gi(de);return pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),{vectorTile:de,rawData:pe.buffer}})}loadData(j){return u._(this,void 0,void 0,function*(){var q;(q=this._pendingRequest)===null||q===void 0||q.abort();const J=!!(j&&j.request&&j.request.collectResourceTiming)&&new u.bs(j.request);this._pendingRequest=new AbortController;try{let ee=yield this.loadGeoJSON(j,this._pendingRequest);if(delete this._pendingRequest,typeof ee!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(K(ee,!0),j.filter){const pe=u.by(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(ue=>`${ue.key}: ${ue.message}`).join(", "));ee={type:"FeatureCollection",features:ee.features.filter(ue=>pe.value.evaluate({zoom:0},ue))}}this._geoJSONIndex=j.cluster?new fs(function({superclusterOptions:pe,clusterProperties:ve}){if(!ve||!pe)return pe;const ue={},Se={},Ne={accumulated:null,zoom:0},Oe={properties:null},Re=Object.keys(ve);for(const ft of Re){const[Et,xt]=ve[ft],ei=u.by(xt),Ct=u.by(typeof Et=="string"?[Et,["accumulated"],["get",ft]]:Et);ue[ft]=ei.value,Se[ft]=Ct.value}return pe.map=ft=>{Oe.properties=ft;const Et={};for(const xt of Re)Et[xt]=ue[xt].evaluate(Ne,Oe);return Et},pe.reduce=(ft,Et)=>{Oe.properties=Et;for(const xt of Re)Ne.accumulated=ft[xt],ft[xt]=Se[xt].evaluate(Ne,Oe)},pe}(j)).load(ee.features):function(pe,ve){return new Bt(pe,ve)}(ee,j.geojsonVtOptions),this.loaded={};const de={};if(J){const pe=J.finish();pe&&(de.resourceTiming={},de.resourceTiming[j.source]=JSON.parse(JSON.stringify(pe)))}return de}catch(ee){if(delete this._pendingRequest,u.bz(ee))return{abandoned:!0};throw ee}})}reloadTile(j){const q=this.loaded;return q&&q[j.uid]?super.reloadTile(j):this.loadTile(j)}loadGeoJSON(j,q){return u._(this,void 0,void 0,function*(){const{promoteId:J}=j;if(j.request){const ee=yield u.h(j.request,q);return this._dataUpdateable=hn(ee.data,J)?Rt(ee.data,J):void 0,ee.data}if(typeof j.data=="string")try{const ee=JSON.parse(j.data);return this._dataUpdateable=hn(ee,J)?Rt(ee,J):void 0,ee}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return function(ee,de,pe){var ve,ue,Se,Ne;if(de.removeAll&&ee.clear(),de.remove)for(const Oe of de.remove)ee.delete(Oe);if(de.add)for(const Oe of de.add){const Re=zr(Oe,pe);Re!=null&&ee.set(Re,Oe)}if(de.update)for(const Oe of de.update){let Re=ee.get(Oe.id);if(Re==null)continue;const ft=!Oe.removeAllProperties&&(((ve=Oe.removeProperties)===null||ve===void 0?void 0:ve.length)>0||((ue=Oe.addOrUpdateProperties)===null||ue===void 0?void 0:ue.length)>0);if((Oe.newGeometry||Oe.removeAllProperties||ft)&&(Re=Object.assign({},Re),ee.set(Oe.id,Re),ft&&(Re.properties=Object.assign({},Re.properties))),Oe.newGeometry&&(Re.geometry=Oe.newGeometry),Oe.removeAllProperties)Re.properties={};else if(((Se=Oe.removeProperties)===null||Se===void 0?void 0:Se.length)>0)for(const Et of Oe.removeProperties)Object.prototype.hasOwnProperty.call(Re.properties,Et)&&delete Re.properties[Et];if(((Ne=Oe.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const{key:Et,value:xt}of Oe.addOrUpdateProperties)Re.properties[Et]=xt}}(this._dataUpdateable,j.dataDiff,J),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class So{constructor(j){this.self=j,this.actor=new u.C(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(q,J)=>{if(this.externalWorkerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.externalWorkerSourceTypes[q]=J},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=q=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(q)},this.actor.registerMessageHandler("loadDEMTile",(q,J)=>this._getDEMWorkerSource(q,J.source).loadTile(J)),this.actor.registerMessageHandler("removeDEMTile",(q,J)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(q,J.source).removeTile(J)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(q,J)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterExpansionZoom(J)})),this.actor.registerMessageHandler("getClusterChildren",(q,J)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterChildren(J)})),this.actor.registerMessageHandler("getClusterLeaves",(q,J)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(q,J.type,J.source).getClusterLeaves(J)})),this.actor.registerMessageHandler("loadData",(q,J)=>this._getWorkerSource(q,J.type,J.source).loadData(J)),this.actor.registerMessageHandler("loadTile",(q,J)=>this._getWorkerSource(q,J.type,J.source).loadTile(J)),this.actor.registerMessageHandler("reloadTile",(q,J)=>this._getWorkerSource(q,J.type,J.source).reloadTile(J)),this.actor.registerMessageHandler("abortTile",(q,J)=>this._getWorkerSource(q,J.type,J.source).abortTile(J)),this.actor.registerMessageHandler("removeTile",(q,J)=>this._getWorkerSource(q,J.type,J.source).removeTile(J)),this.actor.registerMessageHandler("removeSource",(q,J)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[q]||!this.workerSources[q][J.type]||!this.workerSources[q][J.type][J.source])return;const ee=this.workerSources[q][J.type][J.source];delete this.workerSources[q][J.type][J.source],ee.removeSource!==void 0&&ee.removeSource(J)})),this.actor.registerMessageHandler("removeMap",q=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q]})),this.actor.registerMessageHandler("setReferrer",(q,J)=>u._(this,void 0,void 0,function*(){this.referrer=J})),this.actor.registerMessageHandler("syncRTLPluginState",(q,J)=>this._syncRTLPluginState(q,J)),this.actor.registerMessageHandler("importScript",(q,J)=>u._(this,void 0,void 0,function*(){this.self.importScripts(J)})),this.actor.registerMessageHandler("setImages",(q,J)=>this._setImages(q,J)),this.actor.registerMessageHandler("updateLayers",(q,J)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(q).update(J.layers,J.removedIds)})),this.actor.registerMessageHandler("setLayers",(q,J)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(q).replace(J)}))}_setImages(j,q){return u._(this,void 0,void 0,function*(){this.availableImages[j]=q;for(const J in this.workerSources[j]){const ee=this.workerSources[j][J];for(const de in ee)ee[de].availableImages=q}})}_syncRTLPluginState(j,q){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(q.pluginStatus!=="loading")return u.bA.setState(q),q;const J=q.pluginURL;if(this.self.importScripts(J),u.bA.isParsed()){const ee={pluginStatus:"loaded",pluginURL:J};return u.bA.setState(ee),ee}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${J}`)})}_getAvailableImages(j){let q=this.availableImages[j];return q||(q=[]),q}_getLayerIndex(j){let q=this.layerIndexes[j];return q||(q=this.layerIndexes[j]=new l),q}_getWorkerSource(j,q,J){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][q]||(this.workerSources[j][q]={}),!this.workerSources[j][q][J]){const ee={sendAsync:(de,pe)=>(de.targetMapId=j,this.actor.sendAsync(de,pe))};switch(q){case"vector":this.workerSources[j][q][J]=new E(ee,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][q][J]=new la(ee,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][q][J]=new this.externalWorkerSourceTypes[q](ee,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][q][J]}_getDEMWorkerSource(j,q){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][q]||(this.demWorkerSources[j][q]=new A),this.demWorkerSources[j][q]}}return u.i(self)&&(self.worker=new So(self)),So}),s("index",["exports","./shared"],function(u,l){var y="4.1.2";let w,I;const E={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:b=>new Promise((o,d)=>{const f=requestAnimationFrame(o);b.signal.addEventListener("abort",()=>{cancelAnimationFrame(f),d(l.c())})}),getImageData(b,o=0){return this.getImageCanvasContext(b).getImageData(-o,-o,b.width+2*o,b.height+2*o)},getImageCanvasContext(b){const o=window.document.createElement("canvas"),d=o.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return o.width=b.width,o.height=b.height,d.drawImage(b,0,0,b.width,b.height),d},resolveURL:b=>(w||(w=document.createElement("a")),w.href=b,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(I==null&&(I=matchMedia("(prefers-reduced-motion: reduce)")),I.matches)}};class A{static testProp(o){if(!A.docStyle)return o[0];for(let d=0;d<o.length;d++)if(o[d]in A.docStyle)return o[d];return o[0]}static create(o,d,f){const g=window.document.createElement(o);return d!==void 0&&(g.className=d),f&&f.appendChild(g),g}static createNS(o,d){return window.document.createElementNS(o,d)}static disableDrag(){A.docStyle&&A.selectProp&&(A.userSelect=A.docStyle[A.selectProp],A.docStyle[A.selectProp]="none")}static enableDrag(){A.docStyle&&A.selectProp&&(A.docStyle[A.selectProp]=A.userSelect)}static setTransform(o,d){o.style[A.transformProp]=d}static addEventListener(o,d,f,g={}){o.addEventListener(d,f,"passive"in g?g:g.capture)}static removeEventListener(o,d,f,g={}){o.removeEventListener(d,f,"passive"in g?g:g.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",A.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",A.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",A.suppressClickInternal,!0)},0)}static getScale(o){const d=o.getBoundingClientRect();return{x:d.width/o.offsetWidth||1,y:d.height/o.offsetHeight||1,boundingClientRect:d}}static getPoint(o,d,f){const g=d.boundingClientRect;return new l.P((f.clientX-g.left)/d.x-o.clientLeft,(f.clientY-g.top)/d.y-o.clientTop)}static mousePos(o,d){const f=A.getScale(o);return A.getPoint(o,f,d)}static touchPos(o,d){const f=[],g=A.getScale(o);for(let x=0;x<d.length;x++)f.push(A.getPoint(o,g,d[x]));return f}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}A.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,A.selectProp=A.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),A.transformProp=A.testProp(["transform","WebkitTransform"]);const R={supported:!1,testSupport:function(b){!Y&&K&&(ae?Te(b):G=b)}};let G,K,Y=!1,ae=!1;function Te(b){const o=b.createTexture();b.bindTexture(b.TEXTURE_2D,o);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,K),b.isContextLost())return;R.supported=!0}catch{}b.deleteTexture(o),Y=!0}var _e,be;typeof document<"u"&&(K=document.createElement("img"),K.onload=function(){G&&Te(G),G=null,ae=!0},K.onerror=function(){Y=!0,G=null},K.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(b){let o,d,f,g;b.resetRequestQueue=()=>{o=[],d=0,f=0,g={}},b.addThrottleControl=O=>{const D=f++;return g[D]=O,D},b.removeThrottleControl=O=>{delete g[O],P()},b.getImage=(O,D,F=!0)=>new Promise((B,W)=>{R.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),l.e(O,{type:"image"}),o.push({abortController:D,requestParameters:O,supportImageRefresh:F,state:"queued",onError:re=>{W(re)},onSuccess:re=>{B(re)}}),P()});const x=O=>l._(this,void 0,void 0,function*(){O.state="running";const{requestParameters:D,supportImageRefresh:F,onError:B,onSuccess:W,abortController:re}=O,te=F===!1&&!l.i(self)&&!l.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((he,Me)=>he&&Me==="accept",!0));d++;const ne=te?C(D,re):l.m(D,re);try{const he=yield ne;delete O.abortController,O.state="completed",he.data instanceof HTMLImageElement||l.b(he.data)?W(he):he.data&&W({data:yield(X=he.data,typeof createImageBitmap=="function"?l.d(X):l.f(X)),cacheControl:he.cacheControl,expires:he.expires})}catch(he){delete O.abortController,B(he)}finally{d--,P()}var X}),P=()=>{const O=(()=>{for(const D of Object.keys(g))if(g[D]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=d;D<O&&o.length>0;D++){const F=o.shift();F.abortController.signal.aborted?D--:x(F)}},C=(O,D)=>new Promise((F,B)=>{const W=new Image,re=O.url,te=O.credentials;te&&te==="include"?W.crossOrigin="use-credentials":(te&&te==="same-origin"||!l.s(re))&&(W.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{W.src="",B(l.c())}),W.fetchPriority="high",W.onload=()=>{W.onerror=W.onload=null,F({data:W})},W.onerror=()=>{W.onerror=W.onload=null,D.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},W.src=re})}(_e||(_e={})),_e.resetRequestQueue(),function(b){b.Glyphs="Glyphs",b.Image="Image",b.Source="Source",b.SpriteImage="SpriteImage",b.SpriteJSON="SpriteJSON",b.Style="Style",b.Tile="Tile",b.Unknown="Unknown"}(be||(be={}));class ke{constructor(o){this._transformRequestFn=o}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeSpriteURL(o,d,f){const g=function(x){const P=x.match(Ae);if(!P)throw new Error(`Unable to parse URL "${x}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(o);return g.path+=`${d}${f}`,function(x){const P=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${P}`}(g)}setTransformRequest(o){this._transformRequestFn=o}}const Ae=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ve(b){var o=new l.A(3);return o[0]=b[0],o[1]=b[1],o[2]=b[2],o}var Ze,lt=function(b,o,d){return b[0]=o[0]-d[0],b[1]=o[1]-d[1],b[2]=o[2]-d[2],b};Ze=new l.A(3),l.A!=Float32Array&&(Ze[0]=0,Ze[1]=0,Ze[2]=0);var ct=function(b){var o=b[0],d=b[1];return o*o+d*d};function ut(b){const o=[];if(typeof b=="string")o.push({id:"default",url:b});else if(b&&b.length>0){const d=[];for(const{id:f,url:g}of b){const x=`${f}${g}`;d.indexOf(x)===-1&&(d.push(x),o.push({id:f,url:g}))}}return o}(function(){var b=new l.A(2);l.A!=Float32Array&&(b[0]=0,b[1]=0)})();class nt{constructor(o,d,f,g){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(d,g)}update(o,d,f){const{width:g,height:x}=o,P=!(this.size&&this.size[0]===g&&this.size[1]===x||f),{context:C}=this,{gl:O}=C;if(this.useMipmap=!!(d&&d.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!d||d.premultiply!==!1)),P)this.size=[g,x],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.b(o)?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,o):O.texImage2D(O.TEXTURE_2D,0,this.format,g,x,0,this.format,O.UNSIGNED_BYTE,o.data);else{const{x:D,y:F}=f||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.b(o)?O.texSubImage2D(O.TEXTURE_2D,0,D,F,O.RGBA,O.UNSIGNED_BYTE,o):O.texSubImage2D(O.TEXTURE_2D,0,D,F,g,x,O.RGBA,O.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)}bind(o,d,f){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),f!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=x.LINEAR),o!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,o),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,f||o),this.filter=o),d!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,d),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function It(b){const{userImage:o}=b;return!!(o&&o.render&&o.render())&&(b.data.replace(new Uint8Array(o.data.buffer)),!0)}class ht extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,promiseResolve:f}of this.requestors)f(this._getImagesForIds(d));this.requestors=[]}}getImage(o){const d=this.images[o];if(d&&!d.data&&d.spriteData){const f=d.spriteData;d.data=new l.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),d.spriteData=null}return d}addImage(o,d){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let f=!0;const g=d.data||d.spriteData;return this._validateStretch(d.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${o}" has invalid "stretchX" value`))),f=!1),this._validateStretch(d.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${o}" has invalid "stretchY" value`))),f=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${o}" has invalid "content" value`))),f=!1),f}_validateStretch(o,d){if(!o)return!0;let f=0;for(const g of o){if(g[0]<f||g[1]<g[0]||d<g[1])return!1;f=g[1]}return!0}_validateContent(o,d){if(!o)return!0;if(o.length!==4)return!1;const f=d.spriteData,g=f&&f.width||d.data.width,x=f&&f.height||d.data.height;return!(o[0]<0||g<o[0]||o[1]<0||x<o[1]||o[2]<0||g<o[2]||o[3]<0||x<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,d,f=!0){const g=this.getImage(o);if(f&&(g.data.width!==d.data.width||g.data.height!==d.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=g.version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((d,f)=>{let g=!0;if(!this.isLoaded())for(const x of o)this.images[x]||(g=!1);this.isLoaded()||g?d(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:d})})}_getImagesForIds(o){const d={};for(const f of o){let g=this.getImage(f);g||(this.fire(new l.k("styleimagemissing",{id:f})),g=this.getImage(f)),g?d[f]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],f=this.getImage(o);if(!f)return null;if(d&&d.position.version===f.version)return d.position;if(d)d.position.version=f.version;else{const g={w:f.data.width+2,h:f.data.height+2,x:0,y:0},x=new l.I(g,f);this.patterns[o]={bin:g,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new nt(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:d,h:f}=l.p(o),g=this.atlasImage;g.resize({width:d||1,height:f||1});for(const x in this.patterns){const{bin:P}=this.patterns[x],C=P.x+1,O=P.y+1,D=this.getImage(x).data,F=D.width,B=D.height;l.R.copy(D,g,{x:0,y:0},{x:C,y:O},{width:F,height:B}),l.R.copy(D,g,{x:0,y:B-1},{x:C,y:O-1},{width:F,height:1}),l.R.copy(D,g,{x:0,y:0},{x:C,y:O+B},{width:F,height:1}),l.R.copy(D,g,{x:F-1,y:0},{x:C-1,y:O},{width:1,height:B}),l.R.copy(D,g,{x:0,y:0},{x:C+F,y:O},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const f=this.getImage(d);f||l.w(`Image with ID: "${d}" was not found`),It(f)&&this.updateImage(d,f)}}}const hi=1e20;function Zi(b,o,d,f,g,x,P,C,O){for(let D=o;D<o+f;D++)gi(b,d*x+D,x,g,P,C,O);for(let D=d;D<d+g;D++)gi(b,D*x+o,1,f,P,C,O)}function gi(b,o,d,f,g,x,P){x[0]=0,P[0]=-hi,P[1]=hi,g[0]=b[o];for(let C=1,O=0,D=0;C<f;C++){g[C]=b[o+C*d];const F=C*C;do{const B=x[O];D=(g[C]-g[B]+F-B*B)/(C-B)/2}while(D<=P[O]&&--O>-1);O++,x[O]=C,P[O]=D,P[O+1]=hi}for(let C=0,O=0;C<f;C++){for(;P[O+1]<C;)O++;const D=x[O],F=C-D;b[o+C*d]=g[D]+F*F}}class Ut{constructor(o,d){this.requestManager=o,this.localIdeographFontFamily=d,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return l._(this,void 0,void 0,function*(){const d=[];for(const x in o)for(const P of o[x])d.push(this._getAndCacheGlyphsPromise(x,P));const f=yield Promise.all(d),g={};for(const{stack:x,id:P,glyph:C}of f)g[x]||(g[x]={}),g[x][P]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return g})}_getAndCacheGlyphsPromise(o,d){return l._(this,void 0,void 0,function*(){let f=this.entries[o];f||(f=this.entries[o]={glyphs:{},requests:{},ranges:{}});let g=f.glyphs[d];if(g!==void 0)return{stack:o,id:d,glyph:g};if(g=this._tinySDF(f,o,d),g)return f.glyphs[d]=g,{stack:o,id:d,glyph:g};const x=Math.floor(d/256);if(256*x>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[x])return{stack:o,id:d,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[x]){const C=Ut.loadGlyphRange(o,x,this.url,this.requestManager);f.requests[x]=C}const P=yield f.requests[x];for(const C in P)this._doesCharSupportLocalGlyph(+C)||(f.glyphs[+C]=P[+C]);return f.ranges[x]=!0,{stack:o,id:d,glyph:P[d]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](o)||l.u["Hangul Syllables"](o)||l.u.Hiragana(o)||l.u.Katakana(o))}_tinySDF(o,d,f){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;let x=o.tinySDF;if(!x){let C="400";/bold/i.test(d)?C="900":/medium/i.test(d)?C="500":/light/i.test(d)&&(C="200"),x=o.tinySDF=new Ut.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:C})}const P=x.draw(String.fromCharCode(f));return{id:f,bitmap:new l.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ut.loadGlyphRange=function(b,o,d,f){return l._(this,void 0,void 0,function*(){const g=256*o,x=g+255,P=f.transformRequest(d.replace("{fontstack}",b).replace("{range}",`${g}-${x}`),be.Glyphs),C=yield l.l(P,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${o}, ${g}-${x}`);const O={};for(const D of l.n(C.data))O[D.id]=D;return O})},Ut.TinySDF=class{constructor({fontSize:b=24,buffer:o=3,radius:d=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:P="normal"}={}){this.buffer=o,this.cutoff=f,this.radius=d;const C=this.size=b+4*o,O=this._createCanvas(C),D=this.ctx=O.getContext("2d",{willReadFrequently:!0});D.font=`${P} ${x} ${b}px ${g}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(b){const o=document.createElement("canvas");return o.width=o.height=b,o}draw(b){const{width:o,actualBoundingBoxAscent:d,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(b),P=Math.ceil(d),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-g))),O=Math.min(this.size-this.buffer,P+Math.ceil(f)),D=C+2*this.buffer,F=O+2*this.buffer,B=Math.max(D*F,0),W=new Uint8ClampedArray(B),re={data:W,width:D,height:F,glyphWidth:C,glyphHeight:O,glyphTop:P,glyphLeft:0,glyphAdvance:o};if(C===0||O===0)return re;const{ctx:te,buffer:ne,gridInner:X,gridOuter:he}=this;te.clearRect(ne,ne,C,O),te.fillText(b,ne,ne+P);const Me=te.getImageData(ne,ne,C,O);he.fill(hi,0,B),X.fill(0,0,B);for(let oe=0;oe<O;oe++)for(let ge=0;ge<C;ge++){const Ie=Me.data[4*(oe*C+ge)+3]/255;if(Ie===0)continue;const Ee=(oe+ne)*D+ge+ne;if(Ie===1)he[Ee]=0,X[Ee]=hi;else{const Pe=.5-Ie;he[Ee]=Pe>0?Pe*Pe:0,X[Ee]=Pe<0?Pe*Pe:0}}Zi(he,0,0,D,F,D,this.f,this.v,this.z),Zi(X,ne,ne,C,O,D,this.f,this.v,this.z);for(let oe=0;oe<B;oe++){const ge=Math.sqrt(he[oe])-Math.sqrt(X[oe]);W[oe]=Math.round(255-255*(ge/this.radius+this.cutoff))}return re}};class ir{constructor(){this.specification=l.v.light.position}possiblyEvaluate(o,d){return l.y(o.expression.evaluate(d))}interpolate(o,d,f){return{x:l.z.number(o.x,d.x,f),y:l.z.number(o.y,d.y,f),z:l.z.number(o.z,d.z,f)}}}let ps;class Rr extends l.E{constructor(o){super(),ps=ps||new l.q({anchor:new l.D(l.v.light.anchor),position:new ir,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(ps),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(l.r,o,d))for(const f in o){const g=o[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),g):this._transitionable.setValue(f,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,f){return(!f||f.validate!==!1)&&l.t(this,o.call(l.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class _r{constructor(o,d){this.width=o,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,d){const f=o.join(",")+String(d);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(o,d)),this.dashEntry[f]}getDashRanges(o,d,f){const g=[];let x=o.length%2==1?-o[o.length-1]*f:0,P=o[0]*f,C=!0;g.push({left:x,right:P,isDash:C,zeroLength:o[0]===0});let O=o[0];for(let D=1;D<o.length;D++){C=!C;const F=o[D];x=O*f,O+=F,P=O*f,g.push({left:x,right:P,isDash:C,zeroLength:F===0})}return g}addRoundDash(o,d,f){const g=d/2;for(let x=-f;x<=f;x++){const P=this.width*(this.nextRow+f+x);let C=0,O=o[C];for(let D=0;D<this.width;D++){D/O.right>1&&(O=o[++C]);const F=Math.abs(D-O.left),B=Math.abs(D-O.right),W=Math.min(F,B);let re;const te=x/f*(g+1);if(O.isDash){const ne=g-Math.abs(te);re=Math.sqrt(W*W+ne*ne)}else re=g-Math.sqrt(W*W+te*te);this.data[P+D]=Math.max(0,Math.min(255,re+128))}}}addRegularDash(o){for(let C=o.length-1;C>=0;--C){const O=o[C],D=o[C+1];O.zeroLength?o.splice(C,1):D&&D.isDash===O.isDash&&(D.left=O.left,o.splice(C,1))}const d=o[0],f=o[o.length-1];d.isDash===f.isDash&&(d.left=f.left-this.width,f.right=d.right+this.width);const g=this.width*this.nextRow;let x=0,P=o[x];for(let C=0;C<this.width;C++){C/P.right>1&&(P=o[++x]);const O=Math.abs(C-P.left),D=Math.abs(C-P.right),F=Math.min(O,D);this.data[g+C]=Math.max(0,Math.min(255,(P.isDash?F:-F)+128))}}addDash(o,d){const f=d?7:0,g=2*f+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let x=0;for(let C=0;C<o.length;C++)x+=o[C];if(x!==0){const C=this.width/x,O=this.getDashRanges(o,this.width,C);d?this.addRoundDash(O,C,f):this.addRegularDash(O)}const P={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:x};return this.nextRow+=g,this.dirty=!0,P}bind(o){const d=o.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const cn="maplibre_preloaded_worker_pool";class fs{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<fs.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[cn]}numActive(){return Object.keys(this.active).length}}const un=Math.floor(E.hardwareConcurrency/2);let En,is;function ms(){return En||(En=new fs),En}fs.workerCount=l.B(globalThis)?Math.max(Math.min(un,3),1):1;class He{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d;const f=this.workerPool.acquire(d);for(let g=0;g<f.length;g++){const x=new l.C(f[g],d);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,d){const f=[];for(const g of this.actors)f.push(g.sendAsync({type:o,data:d}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,d){for(const f of this.actors)f.registerMessageHandler(o,d)}}function Kt(){return is||(is=new He(ms(),l.G),is.registerMessageHandler("getResource",(b,o,d)=>l.m(o,d))),is}function Pi(b,o){const d=l.F();return l.H(d,d,[1,1,0]),l.J(d,d,[.5*b.width,.5*b.height,1]),l.K(d,d,b.calculatePosMatrix(o.toUnwrapped()))}function zs(b,o,d,f,g,x){const P=function(B,W,re){if(B)for(const te of B){const ne=W[te];if(ne&&ne.source===re&&ne.type==="fill-extrusion")return!0}else for(const te in W){const ne=W[te];if(ne.source===re&&ne.type==="fill-extrusion")return!0}return!1}(g&&g.layers,o,b.id),C=x.maxPitchScaleFactor(),O=b.tilesIn(f,C,P);O.sort(oa);const D=[];for(const B of O)D.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,d,b._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,g,x,C,Pi(b.transform,B.tileID))});const F=function(B){const W={},re={};for(const te of B){const ne=te.queryResults,X=te.wrappedTileID,he=re[X]=re[X]||{};for(const Me in ne){const oe=ne[Me],ge=he[Me]=he[Me]||{},Ie=W[Me]=W[Me]||[];for(const Ee of oe)ge[Ee.featureIndex]||(ge[Ee.featureIndex]=!0,Ie.push(Ee))}}return W}(D);for(const B in F)F[B].forEach(W=>{const re=W.feature,te=b.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=te});return F}function oa(b,o){const d=b.tileID,f=o.tileID;return d.overscaledZ-f.overscaledZ||d.canonical.y-f.canonical.y||d.wrap-f.wrap||d.canonical.x-f.canonical.x}function aa(b,o,d){return l._(this,void 0,void 0,function*(){let f=b;if(b.url?f=(yield l.h(o.transformRequest(b.url,be.Source),d)).data:yield E.frameAsync(d),!f)return null;const g=l.L(l.e(f,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(g.vectorLayerIds=f.vector_layers.map(x=>x.id)),g})}class vr{constructor(o,d){o&&(d?this.setSouthWest(o).setNorthEast(d):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof l.M?new l.M(o.lng,o.lat):l.M.convert(o),this}setSouthWest(o){return this._sw=o instanceof l.M?new l.M(o.lng,o.lat):l.M.convert(o),this}extend(o){const d=this._sw,f=this._ne;let g,x;if(o instanceof l.M)g=o,x=o;else{if(!(o instanceof vr))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(vr.convert(o)):this.extend(l.M.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(l.M.convert(o)):this;if(g=o._sw,x=o._ne,!g||!x)return this}return d||f?(d.lng=Math.min(g.lng,d.lng),d.lat=Math.min(g.lat,d.lat),f.lng=Math.max(x.lng,f.lng),f.lat=Math.max(x.lat,f.lat)):(this._sw=new l.M(g.lng,g.lat),this._ne=new l.M(x.lng,x.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:d,lat:f}=l.M.convert(o);let g=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(o){return o instanceof vr?o:o&&new vr(o)}static fromLngLat(o,d=0){const f=360*d/40075017,g=f/Math.cos(Math.PI/180*o.lat);return new vr(new l.M(o.lng-g,o.lat-f),new l.M(o.lng+g,o.lat+f))}}class Ka{constructor(o,d,f){this.bounds=vr.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=f||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),f=Math.floor(l.N(this.bounds.getWest())*d),g=Math.floor(l.O(this.bounds.getNorth())*d),x=Math.ceil(l.N(this.bounds.getEast())*d),P=Math.ceil(l.O(this.bounds.getSouth())*d);return o.x>=f&&o.x<x&&o.y>=g&&o.y<P}}class $e extends l.E{constructor(o,d,f,g){if(super(),this.id=o,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield aa(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(l.e(this,o),o.bounds&&(this.tileBounds=new Ka(o.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new l.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(o){return l._(this,void 0,void 0,function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(d,be.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};f.request.collectResourceTiming=this._collectResourceTiming;let g="reloadTile";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((x,P)=>{o.reloadPromise={resolve:x,reject:P}})}else o.actor=this.dispatcher.getActor(),g="loadTile";o.abortController=new AbortController;try{const x=yield o.actor.sendAsync({type:g,data:f},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,x)}catch(x){if(delete o.abortController,o.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,d){if(d&&d.resourceTiming&&(o.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&o.setExpiryData(d),o.loadVectorData(d,this.map.painter),o.reloadPromise){const f=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(f.resolve).catch(f.reject)}}abortTile(o){return l._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"abortTile",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return l._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"removeTile",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ya extends l.E{constructor(o,d,f,g){super(),this.id=o,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.L(d,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield aa(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(l.e(this,o),o.bounds&&(this.tileBounds=new Ka(o.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new l.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return l.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return l._(this,void 0,void 0,function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const f=yield _e.getImage(this.map._requestManager.transformRequest(d,be.Tile),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&o.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const g=this.map.painter.context,x=g.gl,P=f.data;o.texture=this.map.painter.getTileTexture(P.width),o.texture?o.texture.update(P,{useMipmap:!0}):(o.texture=new nt(g,P,x.RGBA,{useMipmap:!0}),o.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),o.state="loaded"}}catch(f){if(delete o.abortController,o.aborted)o.state="unloaded";else if(f)throw o.state="errored",f}})}abortTile(o){return l._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return l._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class Cu extends Ya{constructor(o,d,f,g){super(o,d,f,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(o){return l._(this,void 0,void 0,function*(){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(d,be.Tile);o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const g=yield _e.getImage(f,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(g&&g.data){const x=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&o.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const P=l.b(x)&&l.S()?x:yield this.readImageNow(x),C={type:this.type,uid:o.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const O=yield o.actor.sendAsync({type:"loadDEMTile",data:C});o.dem=O,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(g){if(delete o.abortController,o.aborted)o.state="unloaded";else if(g)throw o.state="errored",g}})}readImageNow(o){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const d=o.width+2,f=o.height+2;try{return new l.R({width:d,height:f},yield l.V(o,-1,-1,d,f))}catch{}}return E.getImageData(o,1)})}_getNeighboringTiles(o){const d=o.canonical,f=Math.pow(2,d.z),g=(d.x-1+f)%f,x=d.x===0?o.wrap-1:o.wrap,P=(d.x+1+f)%f,C=d.x+1===f?o.wrap+1:o.wrap,O={};return O[new l.Q(o.overscaledZ,x,d.z,g,d.y).key]={backfilled:!1},O[new l.Q(o.overscaledZ,C,d.z,P,d.y).key]={backfilled:!1},d.y>0&&(O[new l.Q(o.overscaledZ,x,d.z,g,d.y-1).key]={backfilled:!1},O[new l.Q(o.overscaledZ,o.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},O[new l.Q(o.overscaledZ,C,d.z,P,d.y-1).key]={backfilled:!1}),d.y+1<f&&(O[new l.Q(o.overscaledZ,x,d.z,g,d.y+1).key]={backfilled:!1},O[new l.Q(o.overscaledZ,o.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},O[new l.Q(o.overscaledZ,C,d.z,P,d.y+1).key]={backfilled:!1}),O}unloadTile(o){return l._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class Qt extends l.E{constructor(o,d,f,g){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(g),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const x=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*x,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*x,extent:l.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.W,radius:(d.clusterRadius||50)*x,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,d,f){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:o,limit:d,offset:f}})}_updateWorkerData(o){return l._(this,void 0,void 0,function*(){const d=l.e({type:this.type},this.workerOptions);o?d.dataDiff=o:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(E.resolveURL(this._data),be.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"loadData",data:d});if(this._pendingLoads--,this._removed||f.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;f.resourceTiming&&f.resourceTiming[this.id]&&(g=f.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(x,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(f){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(f))}})}loaded(){return this._pendingLoads===0}loadTile(o){return l._(this,void 0,void 0,function*(){const d=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const f={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const g=yield this.actor.sendAsync({type:d,data:f},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(g,this.map.painter,d==="reloadTile")})}abortTile(o){return l._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return l._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Dr=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Kn extends l.E{constructor(o,d,f,g){super(),this.id=o,this.dispatcher=f,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=d}load(o){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield _e.getImage(this.map._requestManager.transformRequest(this.url,be.Image),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,o&&(this.coordinates=o),this._finishLoading())}catch(d){this._request=null,this.fire(new l.j(d))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const d=o.map(l.Y.fromLngLat);this.tileID=function(g){let x=1/0,P=1/0,C=-1/0,O=-1/0;for(const W of g)x=Math.min(x,W.x),P=Math.min(P,W.y),C=Math.max(C,W.x),O=Math.max(O,W.y);const D=Math.max(C-x,O-P),F=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),B=Math.pow(2,F);return new l.a0(F,Math.floor((x+C)/2*B),Math.floor((P+O)/2*B))}(d),this.minzoom=this.maxzoom=this.tileID.z;const f=d.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,l.W,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,l.W),this._boundsArray.emplaceBack(f[2].x,f[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Dr.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new nt(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let f=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,f=!0)}f&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ql extends Kn{constructor(o,d,f,g){super(o,d,f,g),this.roundZoom=!0,this.type="video",this.options=d}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const d of o.urls)this.urls.push(this.map._requestManager.transformRequest(d,be.Source).url);try{const d=yield l.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new l.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const d=this.video.seekable;o<d.start(0)||o>d.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Dr.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new nt(o,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let f=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,f=!0)}f&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Hl extends Kn{constructor(o,d,f,g){super(o,d,f,g),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(P=>typeof P!="number"))||this.fire(new l.j(new l.a1(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${o}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${o}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,f=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Dr.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new nt(d,this.canvas,f.RGBA,{premultiply:!0});let g=!1;for(const x in this.tiles){const P=this.tiles[x];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,g=!0)}g&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Wl={},Xa=b=>{switch(b){case"geojson":return Qt;case"image":return Kn;case"raster":return Ya;case"raster-dem":return Cu;case"vector":return $e;case"video":return ql;case"canvas":return Hl}return Wl[b]},Zl="RTLPluginLoaded";class $u extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Kt()}_syncState(o){return this.status=o,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:o,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return l._(this,arguments,void 0,function*(d,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=E.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Zl))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let We=null;function Ns(){return We||(We=new $u),We}class ys{constructor(o,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=l.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const d=o+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,d,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(g,x){const P={};if(!x)return P;for(const C of g){const O=C.layerIds.map(D=>x.getLayer(D)).filter(Boolean);if(O.length!==0){C.layers=O,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(D=>O.filter(F=>F.id===D)[0]));for(const D of O)P[D.id]=C}}return P}(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.a5){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.a5&&x.hasRTLText){this.hasRTLText=!0,Ns().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const x=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(g).queryRadius(x))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const f in this.buckets){const g=this.buckets[f];g.uploadPending()&&g.upload(o)}const d=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new nt(o,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new nt(o,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,d,f,g,x,P,C,O,D,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:x,scale:P,tileSize:this.tileSize,pixelPosMatrix:F,transform:O,params:C,queryPadding:this.queryPadding*D},o,d,f):{}}querySourceFeatures(o,d){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),x=d&&d.sourceLayer?d.sourceLayer:"",P=g._geojsonTileLayer||g[x];if(!P)return;const C=l.a6(d&&d.filter),{z:O,x:D,y:F}=this.tileID.canonical,B={z:O,x:D,y:F};for(let W=0;W<P.length;W++){const re=P.feature(W);if(C.needGeometry){const X=l.a7(re,!0);if(!C.filter(new l.a8(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!C.filter(new l.a8(this.tileID.overscaledZ),re))continue;const te=f.getId(re,x),ne=new l.a9(re,O,D,F,te);ne.tile=B,o.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const f=l.aa(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(d)if(this.expirationTime<d)g=!0;else{const x=this.expirationTime-d;x?this.expirationTime=f+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!d.style.hasLayer(g))continue;const x=this.buckets[g],P=x.layers[0].sourceLayer||"_geojsonTileLayer",C=f[P],O=o[P];if(!C||!O||Object.keys(O).length===0)continue;x.update(O,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=d&&d.style&&d.style.getLayer(g);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<E.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=E.now()+o}setDependencies(o,d){const f={};for(const g of d)f[g]=!0;this.dependencies[o]=f}hasDependency(o,d){for(const f of o){const g=this.dependencies[f];if(g){for(const x of d)if(g[x])return!0}}return!1}}class Ou{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,f){const g=o.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const x={value:d,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout(()=>{this.remove(o,x)},f)),this.data[g].push(x),this.order.push(g),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const f=o.wrapped().key,g=d===void 0?0:this.data[f].indexOf(d),x=this.data[f][g];return this.data[f].splice(g,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const f in this.data)for(const g of this.data[f])o(g.value)||d.push(g);for(const f of d)this.remove(f.value.tileID,f)}}class Qa{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,f){const g=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][g]=this.stateChanges[o][g]||{},l.e(this.stateChanges[o][g],f),this.deletedStates[o]===null){this.deletedStates[o]={};for(const x in this.state[o])x!==g&&(this.deletedStates[o][x]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][g]===null){this.deletedStates[o][g]={};for(const x in this.state[o][g])f[x]||(this.deletedStates[o][g][x]=null)}else for(const x in f)this.deletedStates[o]&&this.deletedStates[o][g]&&this.deletedStates[o][g][x]===null&&delete this.deletedStates[o][g][x]}removeFeatureState(o,d,f){if(this.deletedStates[o]===null)return;const g=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&d!==void 0)this.deletedStates[o][g]!==null&&(this.deletedStates[o][g]=this.deletedStates[o][g]||{},this.deletedStates[o][g][f]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][g])for(f in this.deletedStates[o][g]={},this.stateChanges[o][g])this.deletedStates[o][g][f]=null;else this.deletedStates[o][g]=null;else this.deletedStates[o]=null}getState(o,d){const f=String(d),g=l.e({},(this.state[o]||{})[f],(this.stateChanges[o]||{})[f]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const x=this.deletedStates[o][d];if(x===null)return{};for(const P in x)delete g[P]}return g}initializeTileState(o,d){o.setFeatureState(this.state,d)}coalesceChanges(o,d){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const x={};for(const P in this.stateChanges[g])this.state[g][P]||(this.state[g][P]={}),l.e(this.state[g][P],this.stateChanges[g][P]),x[P]=this.state[g][P];f[g]=x}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const x={};if(this.deletedStates[g]===null)for(const P in this.state[g])x[P]={},this.state[g][P]={};else for(const P in this.deletedStates[g]){if(this.deletedStates[g][P]===null)this.state[g][P]={};else for(const C of Object.keys(this.deletedStates[g][P]))delete this.state[g][P][C];x[P]=this.state[g][P]}f[g]=f[g]||{},l.e(f[g],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in o)o[g].setFeatureState(f,d)}}class Ue extends l.E{constructor(o,d,f){super(),this.id=o,this.dispatcher=f,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,x,P,C)=>{const O=new(Xa(x.type))(g,x,P,C);if(O.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${O.id}`);return O})(o,d,f,this),this._tiles={},this._cache=new Ou(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Qa,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const d=this._tiles[o];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,d,f){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,d,f)}catch(g){o.state="errored",g.status!==404?this._source.fire(new l.j(g,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new l.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const f=this._tiles[d];f.upload(o),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Bt).map(o=>o.key)}getRenderableIds(o){const d=[];for(const f in this._tiles)this._isIdRenderable(f,o)&&d.push(this._tiles[f]);return o?d.sort((f,g)=>{const x=f.tileID,P=g.tileID,C=new l.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),O=new l.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-P.overscaledZ||O.y-C.y||O.x-C.x}).map(f=>f.tileID.key):d.map(f=>f.tileID).sort(Bt).map(f=>f.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,d){return l._(this,void 0,void 0,function*(){const f=this._tiles[o];f&&(f.state!=="loading"&&(f.state=d),yield this._loadTile(f,o,d))})}_tileLoaded(o,d,f){o.timeAdded=E.now(),f==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const d=this.getRenderableIds();for(let g=0;g<d.length;g++){const x=d[g];if(o.neighboringTiles&&o.neighboringTiles[x]){const P=this.getTileByID(x);f(o,P),f(P,o)}}function f(g,x){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let P=x.tileID.canonical.x-g.tileID.canonical.x;const C=x.tileID.canonical.y-g.tileID.canonical.y,O=Math.pow(2,g.tileID.canonical.z),D=x.tileID.key;P===0&&C===0||Math.abs(C)>1||(Math.abs(P)>1&&(Math.abs(P+O)===1?P+=O:Math.abs(P-O)===1&&(P-=O)),x.dem&&g.dem&&(g.dem.backfillBorder(x.dem,P,C),g.neighboringTiles&&g.neighboringTiles[D]&&(g.neighboringTiles[D].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,f,g){for(const x in this._tiles){let P=this._tiles[x];if(g[x]||!P.hasData()||P.tileID.overscaledZ<=d||P.tileID.overscaledZ>f)continue;let C=P.tileID;for(;P&&P.tileID.overscaledZ>d+1;){const D=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[D.key],P&&P.hasData()&&(C=D)}let O=C;for(;O.overscaledZ>d;)if(O=O.scaledTo(O.overscaledZ-1),o[O.key]){g[C.key]=C;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const f=this._loadedParentTiles[o.key];return f&&f.tileID.overscaledZ>=d?f:null}for(let f=o.overscaledZ-1;f>=d;f--){const g=o.scaledTo(f),x=this._getLoadedTile(g);if(x)return x}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const d=Math.ceil(o.width/this._source.tileSize)+1,f=Math.ceil(o.height/this._source.tileSize)+1,g=Math.floor(d*f*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const f={};for(const g in this._tiles){const x=this._tiles[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+d),f[x.tileID.key]=x}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(o,d){if(this.transform=o,this.terrain=d,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new l.Q(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(f=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(f=f.filter(F=>this._source.hasTile(F)))):f=[];const g=o.coveringZoomLevel(this._source),x=Math.max(g-Ue.maxOverzooming,this._source.minzoom),P=Math.max(g+Ue.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const B of f)if(B.canonical.z>this._source.minzoom){const W=B.scaledTo(B.canonical.z-1);F[W.key]=W;const re=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));F[re.key]=re}f=f.concat(Object.values(F))}const C=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const O=this._updateRetainedTiles(f,g);if(Lt(this._source.type)){const F={},B={},W=Object.keys(O),re=E.now();for(const te of W){const ne=O[te],X=this._tiles[te];if(!X||X.fadeEndTime!==0&&X.fadeEndTime<=re)continue;const he=this.findLoadedParent(ne,x);he&&(this._addTile(he.tileID),F[he.tileID.key]=he.tileID),B[te]=ne}this._retainLoadedChildren(B,g,P,O);for(const te in F)O[te]||(this._coveredTiles[te]=!0,O[te]=F[te]);if(d){const te={},ne={};for(const X of f)this._tiles[X.key].hasData()?te[X.key]=X:ne[X.key]=X;for(const X in ne){const he=ne[X].children(this._source.maxzoom);this._tiles[he[0].key]&&this._tiles[he[1].key]&&this._tiles[he[2].key]&&this._tiles[he[3].key]&&(te[he[0].key]=O[he[0].key]=he[0],te[he[1].key]=O[he[1].key]=he[1],te[he[2].key]=O[he[2].key]=he[2],te[he[3].key]=O[he[3].key]=he[3],delete ne[X])}for(const X in ne){const he=this.findLoadedParent(ne[X],this._source.minzoom);if(he){te[he.tileID.key]=O[he.tileID.key]=he.tileID;for(const Me in te)te[Me].isChildOf(he.tileID)&&delete te[Me]}}for(const X in this._tiles)te[X]||(this._coveredTiles[X]=!0)}}for(const F in O)this._tiles[F].clearFadeHold();const D=l.ab(this._tiles,O);for(const F of D){const B=this._tiles[F];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,d){const f={},g={},x=Math.max(d-Ue.maxOverzooming,this._source.minzoom),P=Math.max(d+Ue.maxUnderzooming,this._source.minzoom),C={};for(const O of o){const D=this._addTile(O);f[O.key]=O,D.hasData()||d<this._source.maxzoom&&(C[O.key]=O)}this._retainLoadedChildren(C,d,P,f);for(const O of o){let D=this._tiles[O.key];if(D.hasData())continue;if(d+1>this._source.maxzoom){const B=O.children(this._source.maxzoom)[0],W=this.getTile(B);if(W&&W.hasData()){f[B.key]=B;continue}}else{const B=O.children(this._source.maxzoom);if(f[B[0].key]&&f[B[1].key]&&f[B[2].key]&&f[B[3].key])continue}let F=D.wasRequested();for(let B=O.overscaledZ-1;B>=x;--B){const W=O.scaledTo(B);if(g[W.key])break;if(g[W.key]=!0,D=this.getTile(W),!D&&F&&(D=this._addTile(W)),D){const re=D.hasData();if((F||re)&&(f[W.key]=W),F=D.wasRequested(),re)break}}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let f,g=this._tiles[o].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}d.push(g.key);const x=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;g=x}for(const x of d)this._loadedParentTiles[x]=f}}_addTile(o){let d=this._tiles[o.key];if(d)return d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const f=d;return d||(d=new ys(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(d,o.key,d.state)),d.uses++,this._tiles[o.key]=d,f||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const f=d.getExpiryTimeout();f&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},f))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,d,f){const g=[],x=this.transform;if(!x)return g;const P=f?x.getCameraQueryGeometry(o):o,C=o.map(te=>x.pointCoordinate(te,this.terrain)),O=P.map(te=>x.pointCoordinate(te,this.terrain)),D=this.getIds();let F=1/0,B=1/0,W=-1/0,re=-1/0;for(const te of O)F=Math.min(F,te.x),B=Math.min(B,te.y),W=Math.max(W,te.x),re=Math.max(re,te.y);for(let te=0;te<D.length;te++){const ne=this._tiles[D[te]];if(ne.holdingForFade())continue;const X=ne.tileID,he=Math.pow(2,x.zoom-ne.tileID.overscaledZ),Me=d*ne.queryPadding*l.W/ne.tileSize/he,oe=[X.getTilePoint(new l.Y(F,B)),X.getTilePoint(new l.Y(W,re))];if(oe[0].x-Me<l.W&&oe[0].y-Me<l.W&&oe[1].x+Me>=0&&oe[1].y+Me>=0){const ge=C.map(Ee=>X.getTilePoint(Ee)),Ie=O.map(Ee=>X.getTilePoint(Ee));g.push({tile:ne,tileID:X,queryGeometry:ge,cameraQueryGeometry:Ie,scale:he})}}return g}getVisibleCoordinates(o){const d=this.getRenderableIds(o).map(f=>this._tiles[f].tileID);for(const f of d)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Lt(this._source.type)){const o=E.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=o)return!0}return!1}setFeatureState(o,d,f){this._state.updateState(o=o||"_geojsonTileLayer",d,f)}removeFeatureState(o,d,f){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,f)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,f){const g=this._tiles[o];g&&g.setDependencies(d,f)}reloadTilesForDependencies(o,d){for(const f in this._tiles)this._tiles[f].hasDependency(o,d)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(o,d))}}function Bt(b,o){const d=Math.abs(2*b.wrap)-+(b.wrap<0),f=Math.abs(2*o.wrap)-+(o.wrap<0);return b.overscaledZ-o.overscaledZ||f-d||o.canonical.y-b.canonical.y||o.canonical.x-b.canonical.x}function Lt(b){return b==="raster"||b==="image"||b==="video"}Ue.maxOverzooming=10,Ue.maxUnderzooming=3;class zr{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=l.ac(o,0,1);let d=1,f=this._distances[d];const g=o*this.paddedLength+this.padding;for(;f<g&&d<this._distances.length;)f=this._distances[++d];const x=d-1,P=this._distances[x],C=f-P,O=C>0?(g-P)/C:0;return this.points[x].mult(1-O).add(this.points[d].mult(O))}}function hn(b,o){let d=!0;return b==="always"||b!=="never"&&o!=="never"||(d=!1),d}class Rt{constructor(o,d,f){const g=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/f),this.yCellCount=Math.ceil(d/f);for(let P=0;P<this.xCellCount*this.yCellCount;P++)g.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,f,g,x){this._forEachCell(d,f,g,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(x)}insertCircle(o,d,f,g){this._forEachCell(d-g,f-g,d+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(f),this.circles.push(g)}_insertBoxCell(o,d,f,g,x,P){this.boxCells[x].push(P)}_insertCircleCell(o,d,f,g,x,P){this.circleCells[x].push(P)}_query(o,d,f,g,x,P,C){if(f<0||o>this.width||g<0||d>this.height)return[];const O=[];if(o<=0&&d<=0&&this.width<=f&&this.height<=g){if(x)return[{key:null,x1:o,y1:d,x2:f,y2:g}];for(let D=0;D<this.boxKeys.length;D++)O.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const F=this.circles[3*D],B=this.circles[3*D+1],W=this.circles[3*D+2];O.push({key:this.circleKeys[D],x1:F-W,y1:B-W,x2:F+W,y2:B+W})}}else this._forEachCell(o,d,f,g,this._queryCell,O,{hitTest:x,overlapMode:P,seenUids:{box:{},circle:{}}},C);return O}query(o,d,f,g){return this._query(o,d,f,g,!1,null)}hitTest(o,d,f,g,x,P){return this._query(o,d,f,g,!0,x,P).length>0}hitTestCircle(o,d,f,g,x){const P=o-f,C=o+f,O=d-f,D=d+f;if(C<0||P>this.width||D<0||O>this.height)return!1;const F=[];return this._forEachCell(P,O,C,D,this._queryCellCircle,F,{hitTest:!0,overlapMode:g,circle:{x:o,y:d,radius:f},seenUids:{box:{},circle:{}}},x),F.length>0}_queryCell(o,d,f,g,x,P,C,O){const{seenUids:D,hitTest:F,overlapMode:B}=C,W=this.boxCells[x];if(W!==null){const te=this.bboxes;for(const ne of W)if(!D.box[ne]){D.box[ne]=!0;const X=4*ne,he=this.boxKeys[ne];if(o<=te[X+2]&&d<=te[X+3]&&f>=te[X+0]&&g>=te[X+1]&&(!O||O(he))&&(!F||!hn(B,he.overlapMode))&&(P.push({key:he,x1:te[X],y1:te[X+1],x2:te[X+2],y2:te[X+3]}),F))return!0}}const re=this.circleCells[x];if(re!==null){const te=this.circles;for(const ne of re)if(!D.circle[ne]){D.circle[ne]=!0;const X=3*ne,he=this.circleKeys[ne];if(this._circleAndRectCollide(te[X],te[X+1],te[X+2],o,d,f,g)&&(!O||O(he))&&(!F||!hn(B,he.overlapMode))){const Me=te[X],oe=te[X+1],ge=te[X+2];if(P.push({key:he,x1:Me-ge,y1:oe-ge,x2:Me+ge,y2:oe+ge}),F)return!0}}}return!1}_queryCellCircle(o,d,f,g,x,P,C,O){const{circle:D,seenUids:F,overlapMode:B}=C,W=this.boxCells[x];if(W!==null){const te=this.bboxes;for(const ne of W)if(!F.box[ne]){F.box[ne]=!0;const X=4*ne,he=this.boxKeys[ne];if(this._circleAndRectCollide(D.x,D.y,D.radius,te[X+0],te[X+1],te[X+2],te[X+3])&&(!O||O(he))&&!hn(B,he.overlapMode))return P.push(!0),!0}}const re=this.circleCells[x];if(re!==null){const te=this.circles;for(const ne of re)if(!F.circle[ne]){F.circle[ne]=!0;const X=3*ne,he=this.circleKeys[ne];if(this._circlesCollide(te[X],te[X+1],te[X+2],D.x,D.y,D.radius)&&(!O||O(he))&&!hn(B,he.overlapMode))return P.push(!0),!0}}}_forEachCell(o,d,f,g,x,P,C,O){const D=this._convertToXCellCoord(o),F=this._convertToYCellCoord(d),B=this._convertToXCellCoord(f),W=this._convertToYCellCoord(g);for(let re=D;re<=B;re++)for(let te=F;te<=W;te++)if(x.call(this,o,d,f,g,this.xCellCount*te+re,P,C,O))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,f,g,x,P){const C=g-o,O=x-d,D=f+P;return D*D>C*C+O*O}_circleAndRectCollide(o,d,f,g,x,P,C){const O=(P-g)/2,D=Math.abs(o-(g+O));if(D>O+f)return!1;const F=(C-x)/2,B=Math.abs(d-(x+F));if(B>F+f)return!1;if(D<=O||B<=F)return!0;const W=D-O,re=B-F;return W*W+re*re<=f*f}}function la(b,o,d,f,g){const x=l.F();return o?(l.J(x,x,[1/g,1/g,1]),d||l.ad(x,x,f.angle)):l.K(x,f.labelPlaneMatrix,b),x}function So(b,o,d,f,g){if(o){const x=l.ae(b);return l.J(x,x,[g,g,1]),d||l.ad(x,x,-f.angle),x}return f.glCoordMatrix}function ie(b,o,d){let f;d?(f=[b.x,b.y,d(b.x,b.y),1],l.af(f,f,o)):(f=[b.x,b.y,0,1],Et(f,f,o));const g=f[3];return{point:new l.P(f[0]/g,f[1]/g),signedDistanceFromCamera:g}}function j(b,o){return .5+b/o*.5}function q(b,o){const d=b[0]/b[3],f=b[1]/b[3];return d>=-o[0]&&d<=o[0]&&f>=-o[1]&&f<=o[1]}function J(b,o,d,f,g,x,P,C,O,D){const F=f?b.textSizeData:b.iconSizeData,B=l.ag(F,d.transform.zoom),W=[256/d.width*2+1,256/d.height*2+1],re=f?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;re.clear();const te=b.lineVertexArray,ne=f?b.text.placedSymbolArray:b.icon.placedSymbolArray,X=d.transform.width/d.transform.height;let he=!1;for(let Me=0;Me<ne.length;Me++){const oe=ne.get(Me);if(oe.hidden||oe.writingMode===l.ah.vertical&&!he){ft(oe.numGlyphs,re);continue}let ge;if(he=!1,D?(ge=[oe.anchorX,oe.anchorY,D(oe.anchorX,oe.anchorY),1],l.af(ge,ge,o)):(ge=[oe.anchorX,oe.anchorY,0,1],Et(ge,ge,o)),!q(ge,W)){ft(oe.numGlyphs,re);continue}const Ie=j(d.transform.cameraToCenterDistance,ge[3]),Ee=l.ai(F,B,oe),Pe=P?Ee/Ie:Ee*Ie,Be=new l.P(oe.anchorX,oe.anchorY),ze=ie(Be,g,D).point,Fe={projections:{},offsets:{}},rt=pe(oe,Pe,!1,C,o,g,x,b.glyphOffsetArray,te,re,ze,Be,Fe,X,O,D);he=rt.useVertical,(rt.notEnoughRoom||he||rt.needsFlipping&&pe(oe,Pe,!0,C,o,g,x,b.glyphOffsetArray,te,re,ze,Be,Fe,X,O,D).notEnoughRoom)&&ft(oe.numGlyphs,re)}f?b.text.dynamicLayoutVertexBuffer.updateData(re):b.icon.dynamicLayoutVertexBuffer.updateData(re)}function ee(b,o,d,f,g,x,P,C,O,D,F,B,W){const re=C.glyphStartIndex+C.numGlyphs,te=C.lineStartIndex,ne=C.lineStartIndex+C.lineLength,X=o.getoffsetX(C.glyphStartIndex),he=o.getoffsetX(re-1),Me=Oe(b*X,d,f,g,x,P,C.segment,te,ne,O,D,F,B,W);if(!Me)return null;const oe=Oe(b*he,d,f,g,x,P,C.segment,te,ne,O,D,F,B,W);return oe?{first:Me,last:oe}:null}function de(b,o,d,f){return b===l.ah.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*f?{useVertical:!0}:(b===l.ah.vertical?o.y<d.y:o.x>d.x)?{needsFlipping:!0}:null}function pe(b,o,d,f,g,x,P,C,O,D,F,B,W,re,te,ne){const X=o/24,he=b.lineOffsetX*X,Me=b.lineOffsetY*X;let oe;if(b.numGlyphs>1){const ge=b.glyphStartIndex+b.numGlyphs,Ie=b.lineStartIndex,Ee=b.lineStartIndex+b.lineLength,Pe=ee(X,C,he,Me,d,F,B,b,O,x,W,te,ne);if(!Pe)return{notEnoughRoom:!0};const Be=ie(Pe.first.point,P,ne).point,ze=ie(Pe.last.point,P,ne).point;if(f&&!d){const Fe=de(b.writingMode,Be,ze,re);if(Fe)return Fe}oe=[Pe.first];for(let Fe=b.glyphStartIndex+1;Fe<ge-1;Fe++)oe.push(Oe(X*C.getoffsetX(Fe),he,Me,d,F,B,b.segment,Ie,Ee,O,x,W,te,ne));oe.push(Pe.last)}else{if(f&&!d){const Ie=ie(B,g,ne).point,Ee=b.lineStartIndex+b.segment+1,Pe=new l.P(O.getx(Ee),O.gety(Ee)),Be=ie(Pe,g,ne),ze=Be.signedDistanceFromCamera>0?Be.point:ve(B,Pe,Ie,1,g,ne),Fe=de(b.writingMode,Ie,ze,re);if(Fe)return Fe}const ge=Oe(X*C.getoffsetX(b.glyphStartIndex),he,Me,d,F,B,b.segment,b.lineStartIndex,b.lineStartIndex+b.lineLength,O,x,W,te,ne);if(!ge)return{notEnoughRoom:!0};oe=[ge]}for(const ge of oe)l.aj(D,ge.point,ge.angle);return{}}function ve(b,o,d,f,g,x){const P=ie(b.add(b.sub(o)._unit()),g,x).point,C=d.sub(P);return d.add(C._mult(f/C.mag()))}function ue(b,o){const{projectionCache:d,lineVertexArray:f,labelPlaneMatrix:g,tileAnchorPoint:x,distanceFromAnchor:P,getElevation:C,previousVertex:O,direction:D,absOffsetX:F}=o;if(d.projections[b])return d.projections[b];const B=new l.P(f.getx(b),f.gety(b)),W=ie(B,g,C);if(W.signedDistanceFromCamera>0)return d.projections[b]=W.point,W.point;const re=b-D;return ve(P===0?x:new l.P(f.getx(re),f.gety(re)),B,O,F-P+1,g,C)}function Se(b,o,d){return b._unit()._perp()._mult(o*d)}function Ne(b,o,d,f,g,x,P,C){const{projectionCache:O,direction:D}=C;if(O.offsets[b])return O.offsets[b];const F=d.add(o);if(b+D<f||b+D>=g)return O.offsets[b]=F,F;const B=ue(b+D,C),W=Se(B.sub(d),P,D),re=d.add(W),te=B.add(W);return O.offsets[b]=l.ak(x,F,re,te)||F,O.offsets[b]}function Oe(b,o,d,f,g,x,P,C,O,D,F,B,W,re){const te=f?b-o:b+o;let ne=te>0?1:-1,X=0;f&&(ne*=-1,X=Math.PI),ne<0&&(X+=Math.PI);let he,Me,oe=ne>0?C+P:C+P+1,ge=g,Ie=g,Ee=0,Pe=0;const Be=Math.abs(te),ze=[];let Fe;for(;Ee+Pe<=Be;){if(oe+=ne,oe<C||oe>=O)return null;Ee+=Pe,Ie=ge,Me=he;const Je={projectionCache:B,lineVertexArray:D,labelPlaneMatrix:F,tileAnchorPoint:x,distanceFromAnchor:Ee,getElevation:re,previousVertex:Ie,direction:ne,absOffsetX:Be};if(ge=ue(oe,Je),d===0)ze.push(Ie),Fe=ge.sub(Ie);else{let St;const zt=ge.sub(Ie);St=zt.mag()===0?Se(ue(oe+ne,Je).sub(ge),d,ne):Se(zt,d,ne),Me||(Me=Ie.add(St)),he=Ne(oe,St,ge,C,O,Me,d,Je),ze.push(Me),Fe=he.sub(Me)}Pe=Fe.mag()}const rt=Fe._mult((Be-Ee)/Pe)._add(Me||Ie),$t=X+Math.atan2(ge.y-Ie.y,ge.x-Ie.x);return ze.push(rt),{point:rt,angle:W?$t:0,path:ze}}const Re=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ft(b,o){for(let d=0;d<b;d++){const f=o.length;o.resize(f+4),o.float32.set(Re,3*f)}}function Et(b,o,d){const f=o[0],g=o[1];return b[0]=d[0]*f+d[4]*g+d[12],b[1]=d[1]*f+d[5]*g+d[13],b[3]=d[3]*f+d[7]*g+d[15],b}const xt=100;class ei{constructor(o,d=new Rt(o.width+200,o.height+200,25),f=new Rt(o.width+200,o.height+200,25)){this.transform=o,this.grid=d,this.ignoredGrid=f,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+xt,this.screenBottomBoundary=o.height+xt,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,d,f,g,x,P){const C=this.projectAndGetPerspectiveRatio(g,o.anchorPointX,o.anchorPointY,P),O=f*C.perspectiveRatio,D=o.x1*O+C.point.x,F=o.y1*O+C.point.y,B=o.x2*O+C.point.x,W=o.y2*O+C.point.y;return!this.isInsideGrid(D,F,B,W)||d!=="always"&&this.grid.hitTest(D,F,B,W,d,x)||C.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[D,F,B,W],offscreen:this.isOffscreen(D,F,B,W)}}placeCollisionCircles(o,d,f,g,x,P,C,O,D,F,B,W,re,te){const ne=[],X=new l.P(d.anchorX,d.anchorY),he=ie(X,P,te),Me=j(this.transform.cameraToCenterDistance,he.signedDistanceFromCamera),oe=(F?x/Me:x*Me)/l.ao,ge=ie(X,C,te).point,Ie=ee(oe,g,d.lineOffsetX*oe,d.lineOffsetY*oe,!1,ge,X,d,f,C,{projections:{},offsets:{}},!1,te);let Ee=!1,Pe=!1,Be=!0;if(Ie){const ze=.5*W*Me+re,Fe=new l.P(-100,-100),rt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),$t=new zr,Je=Ie.first,St=Ie.last;let zt=[];for(let jt=Je.path.length-1;jt>=1;jt--)zt.push(Je.path[jt]);for(let jt=1;jt<St.path.length;jt++)zt.push(St.path[jt]);const Yt=2.5*ze;if(O){const jt=zt.map(Vt=>ie(Vt,O,te));zt=jt.some(Vt=>Vt.signedDistanceFromCamera<=0)?[]:jt.map(Vt=>Vt.point)}let kt=[];if(zt.length>0){const jt=zt[0].clone(),Vt=zt[0].clone();for(let Fi=1;Fi<zt.length;Fi++)jt.x=Math.min(jt.x,zt[Fi].x),jt.y=Math.min(jt.y,zt[Fi].y),Vt.x=Math.max(Vt.x,zt[Fi].x),Vt.y=Math.max(Vt.y,zt[Fi].y);kt=jt.x>=Fe.x&&Vt.x<=rt.x&&jt.y>=Fe.y&&Vt.y<=rt.y?[zt]:Vt.x<Fe.x||jt.x>rt.x||Vt.y<Fe.y||jt.y>rt.y?[]:l.al([zt],Fe.x,Fe.y,rt.x,rt.y)}for(const jt of kt){$t.reset(jt,.25*ze);let Vt=0;Vt=$t.length<=.5*ze?1:Math.ceil($t.paddedLength/Yt)+1;for(let Fi=0;Fi<Vt;Fi++){const Ti=Fi/Math.max(Vt-1,1),bs=$t.lerp(Ti),ur=bs.x+xt,Ei=bs.y+xt;ne.push(ur,Ei,ze,0);const Hr=ur-ze,Cn=Ei-ze,to=ur+ze,ul=Ei+ze;if(Be=Be&&this.isOffscreen(Hr,Cn,to,ul),Pe=Pe||this.isInsideGrid(Hr,Cn,to,ul),o!=="always"&&this.grid.hitTestCircle(ur,Ei,ze,o,B)&&(Ee=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ee}}}}return{circles:!D&&Ee||!Pe||Me<this.perspectiveRatioCutoff?[]:ne,offscreen:Be,collisionDetected:Ee}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let f=1/0,g=1/0,x=-1/0,P=-1/0;for(const F of o){const B=new l.P(F.x+xt,F.y+xt);f=Math.min(f,B.x),g=Math.min(g,B.y),x=Math.max(x,B.x),P=Math.max(P,B.y),d.push(B)}const C=this.grid.query(f,g,x,P).concat(this.ignoredGrid.query(f,g,x,P)),O={},D={};for(const F of C){const B=F.key;if(O[B.bucketInstanceId]===void 0&&(O[B.bucketInstanceId]={}),O[B.bucketInstanceId][B.featureIndex])continue;const W=[new l.P(F.x1,F.y1),new l.P(F.x2,F.y1),new l.P(F.x2,F.y2),new l.P(F.x1,F.y2)];l.am(d,W)&&(O[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(o,d,f,g,x,P){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:P,overlapMode:d},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,f,g,x,P){const C=f?this.ignoredGrid:this.grid,O={bucketInstanceId:g,featureIndex:x,collisionGroupID:P,overlapMode:d};for(let D=0;D<o.length;D+=4)C.insertCircle(O,o[D],o[D+1],o[D+2])}projectAndGetPerspectiveRatio(o,d,f,g){let x;return g?(x=[d,f,g(d,f),1],l.af(x,x,o)):(x=[d,f,0,1],Et(x,x,o)),{point:new l.P((x[0]/x[3]+1)/2*this.transform.width+xt,(-x[1]/x[3]+1)/2*this.transform.height+xt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(o,d,f,g){return f<xt||o>=this.screenRightBoundary||g<xt||d>this.screenBottomBoundary}isInsideGrid(o,d,f,g){return f>=0&&o<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=l.an([]);return l.H(o,o,[-100,-100,0]),o}}function Ct(b,o,d){return o*(l.W/(b.tileSize*Math.pow(2,d-b.tileID.overscaledZ)))}class Ci{constructor(o,d,f,g){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class xi{constructor(o,d,f,g,x){this.text=new Ci(o?o.text:null,d,f,x),this.icon=new Ci(o?o.icon:null,d,g,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rr{constructor(o,d,f){this.text=o,this.icon=d,this.skipFade=f}}class Dt{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class Vi{constructor(o,d,f,g,x){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=x}}class kr{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:f=>f.collisionGroupID===d}}return this.collisionGroups[o]}}function gs(b,o,d,f,g){const{horizontalAlign:x,verticalAlign:P}=l.at(b);return new l.P(-(x-.5)*o+f[0]*g,-(P-.5)*d+f[1]*g)}function Gr(b,o,d,f,g,x){const{x1:P,x2:C,y1:O,y2:D,anchorPointX:F,anchorPointY:B}=b,W=new l.P(o,d);return f&&W._rotate(g?x:-x),{x1:P+W.x,y1:O+W.y,x2:C+W.x,y2:D+W.y,anchorPointX:F,anchorPointY:B}}class rs{constructor(o,d,f,g,x){this.transform=o.clone(),this.terrain=d,this.collisionIndex=new ei(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new kr(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,f,g){const x=f.getBucket(d),P=f.latestFeatureIndex;if(!x||!P||d.id!==x.layerIds[0])return;const C=f.collisionBoxArray,O=x.layers[0].layout,D=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),F=f.tileSize/l.W,B=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),W=O.get("text-pitch-alignment")==="map",re=O.get("text-rotation-alignment")==="map",te=Ct(f,1,this.transform.zoom),ne=la(B,W,re,this.transform,te);let X=null;if(W){const Me=So(B,W,re,this.transform,te);X=l.K([],this.transform.labelPlaneMatrix,Me)}this.retainedQueryData[x.bucketInstanceId]=new Vi(x.bucketInstanceId,P,x.sourceLayerIndex,x.index,f.tileID);const he={bucket:x,layout:O,posMatrix:B,textLabelPlaneMatrix:ne,labelToScreenMatrix:X,scale:D,textPixelRatio:F,holdingForFade:f.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.ag(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(g)for(const Me of x.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:ge,symbolInstanceEnd:Ie}=Me;o.push({sortKey:oe,symbolInstanceStart:ge,symbolInstanceEnd:Ie,parameters:he})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:he})}attemptAnchorPlacement(o,d,f,g,x,P,C,O,D,F,B,W,re,te,ne,X){const he=l.ap[o.textAnchor],Me=[o.textOffset0,o.textOffset1],oe=gs(he,f,g,Me,x),ge=this.collisionIndex.placeCollisionBox(Gr(d,oe.x,oe.y,P,C,this.transform.angle),B,O,D,F.predicate,X);if((!ne||this.collisionIndex.placeCollisionBox(Gr(ne,oe.x,oe.y,P,C,this.transform.angle),B,O,D,F.predicate,X).box.length!==0)&&ge.box.length>0){let Ie;if(this.prevPlacement&&this.prevPlacement.variableOffsets[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID].text&&(Ie=this.prevPlacement.variableOffsets[W.crossTileID].anchor),W.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[W.crossTileID]={textOffset:Me,width:f,height:g,anchor:he,textBoxScale:x,prevAnchor:Ie},this.markUsedJustification(re,he,W,te),re.allowVerticalPlacement&&(this.markUsedOrientation(re,te,W),this.placedOrientations[W.crossTileID]=te),{shift:oe,placedGlyphBoxes:ge}}}placeLayerBucketPart(o,d,f){const{bucket:g,layout:x,posMatrix:P,textLabelPlaneMatrix:C,labelToScreenMatrix:O,textPixelRatio:D,holdingForFade:F,collisionBoxArray:B,partiallyEvaluatedTextSize:W,collisionGroup:re}=o.parameters,te=x.get("text-optional"),ne=x.get("icon-optional"),X=l.aq(x,"text-overlap","text-allow-overlap"),he=X==="always",Me=l.aq(x,"icon-overlap","icon-allow-overlap"),oe=Me==="always",ge=x.get("text-rotation-alignment")==="map",Ie=x.get("text-pitch-alignment")==="map",Ee=x.get("icon-text-fit")!=="none",Pe=x.get("symbol-z-order")==="viewport-y",Be=he&&(oe||!g.hasIconData()||ne),ze=oe&&(he||!g.hasTextData()||te);!g.collisionArrays&&B&&g.deserializeCollisionBoxes(B);const Fe=this.retainedQueryData[g.bucketInstanceId].tileID,rt=this.terrain?(Je,St)=>this.terrain.getElevation(Fe,Je,St):null,$t=(Je,St)=>{var zt,Yt;if(d[Je.crossTileID])return;if(F)return void(this.placements[Je.crossTileID]=new rr(!1,!1,!1));let kt=!1,jt=!1,Vt=!0,Fi=null,Ti={box:null,offscreen:null},bs={box:null,offscreen:null},ur=null,Ei=null,Hr=null,Cn=0,to=0,ul=0;St.textFeatureIndex?Cn=St.textFeatureIndex:Je.useRuntimeCollisionCircles&&(Cn=Je.featureIndex),St.verticalTextFeatureIndex&&(to=St.verticalTextFeatureIndex);const hl=St.textBox;if(hl){const Gi=Di=>{let Pr=l.ah.horizontal;if(g.allowVerticalPlacement&&!Di&&this.prevPlacement){const Gs=this.prevPlacement.placedOrientations[Je.crossTileID];Gs&&(this.placedOrientations[Je.crossTileID]=Gs,Pr=Gs,this.markUsedOrientation(g,Pr,Je))}return Pr},Oi=(Di,Pr)=>{if(g.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&St.verticalTextBox){for(const Gs of g.writingModes)if(Gs===l.ah.vertical?(Ti=Pr(),bs=Ti):Ti=Di(),Ti&&Ti.box&&Ti.box.length)break}else Ti=Di()},Yi=Je.textAnchorOffsetStartIndex,fc=Je.textAnchorOffsetEndIndex;if(fc===Yi){const Di=(Pr,Gs)=>{const Jt=this.collisionIndex.placeCollisionBox(Pr,X,D,P,re.predicate,rt);return Jt&&Jt.box&&Jt.box.length&&(this.markUsedOrientation(g,Gs,Je),this.placedOrientations[Je.crossTileID]=Gs),Jt};Oi(()=>Di(hl,l.ah.horizontal),()=>{const Pr=St.verticalTextBox;return g.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&Pr?Di(Pr,l.ah.vertical):{box:null,offscreen:null}}),Gi(Ti&&Ti.box&&Ti.box.length)}else{let Di=l.ap[(Yt=(zt=this.prevPlacement)===null||zt===void 0?void 0:zt.variableOffsets[Je.crossTileID])===null||Yt===void 0?void 0:Yt.anchor];const Pr=(Jt,Sm,W0)=>{const dl=Jt.x2-Jt.x1,pl=Jt.y2-Jt.y1,ep=Je.textBoxScale,Tm=Ee&&Me==="never"?Sm:null;let fl={box:[],offscreen:!1},Z0=X==="never"?1:2,Mm="never";Di&&Z0++;for(let J0=0;J0<Z0;J0++){for(let Yu=Yi;Yu<fc;Yu++){const K0=g.textAnchorOffsets.get(Yu);if(Di&&K0.textAnchor!==Di)continue;const Xu=this.attemptAnchorPlacement(K0,Jt,dl,pl,ep,ge,Ie,D,P,re,Mm,Je,g,W0,Tm,rt);if(Xu&&(fl=Xu.placedGlyphBoxes,fl&&fl.box&&fl.box.length))return kt=!0,Fi=Xu.shift,fl}Di?Di=null:Mm=X}return fl};Oi(()=>Pr(hl,St.iconBox,l.ah.horizontal),()=>{const Jt=St.verticalTextBox;return g.allowVerticalPlacement&&!(Ti&&Ti.box&&Ti.box.length)&&Je.numVerticalGlyphVertices>0&&Jt?Pr(Jt,St.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),Ti&&(kt=Ti.box,Vt=Ti.offscreen);const Gs=Gi(Ti&&Ti.box);if(!kt&&this.prevPlacement){const Jt=this.prevPlacement.variableOffsets[Je.crossTileID];Jt&&(this.variableOffsets[Je.crossTileID]=Jt,this.markUsedJustification(g,Jt.anchor,Je,Gs))}}}if(ur=Ti,kt=ur&&ur.box&&ur.box.length>0,Vt=ur&&ur.offscreen,Je.useRuntimeCollisionCircles){const Gi=g.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex),Oi=l.ai(g.textSizeData,W,Gi),Yi=x.get("text-padding");Ei=this.collisionIndex.placeCollisionCircles(X,Gi,g.lineVertexArray,g.glyphOffsetArray,Oi,P,C,O,f,Ie,re.predicate,Je.collisionCircleDiameter,Yi,rt),Ei.circles.length&&Ei.collisionDetected&&!f&&l.w("Collisions detected, but collision boxes are not shown"),kt=he||Ei.circles.length>0&&!Ei.collisionDetected,Vt=Vt&&Ei.offscreen}if(St.iconFeatureIndex&&(ul=St.iconFeatureIndex),St.iconBox){const Gi=Oi=>{const Yi=Ee&&Fi?Gr(Oi,Fi.x,Fi.y,ge,Ie,this.transform.angle):Oi;return this.collisionIndex.placeCollisionBox(Yi,Me,D,P,re.predicate,rt)};bs&&bs.box&&bs.box.length&&St.verticalIconBox?(Hr=Gi(St.verticalIconBox),jt=Hr.box.length>0):(Hr=Gi(St.iconBox),jt=Hr.box.length>0),Vt=Vt&&Hr.offscreen}const io=te||Je.numHorizontalGlyphVertices===0&&Je.numVerticalGlyphVertices===0,$n=ne||Je.numIconVertices===0;if(io||$n?$n?io||(jt=jt&&kt):kt=jt&&kt:jt=kt=jt&&kt,kt&&ur&&ur.box&&this.collisionIndex.insertCollisionBox(ur.box,X,x.get("text-ignore-placement"),g.bucketInstanceId,bs&&bs.box&&to?to:Cn,re.ID),jt&&Hr&&this.collisionIndex.insertCollisionBox(Hr.box,Me,x.get("icon-ignore-placement"),g.bucketInstanceId,ul,re.ID),Ei&&(kt&&this.collisionIndex.insertCollisionCircles(Ei.circles,X,x.get("text-ignore-placement"),g.bucketInstanceId,Cn,re.ID),f)){const Gi=g.bucketInstanceId;let Oi=this.collisionCircleArrays[Gi];Oi===void 0&&(Oi=this.collisionCircleArrays[Gi]=new Dt);for(let Yi=0;Yi<Ei.circles.length;Yi+=4)Oi.circles.push(Ei.circles[Yi+0]),Oi.circles.push(Ei.circles[Yi+1]),Oi.circles.push(Ei.circles[Yi+2]),Oi.circles.push(Ei.collisionDetected?1:0)}if(Je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Je.crossTileID]=new rr(kt||Be,jt||ze,Vt||g.justReloaded),d[Je.crossTileID]=!0};if(Pe){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Je=g.getSortedSymbolIndexes(this.transform.angle);for(let St=Je.length-1;St>=0;--St){const zt=Je[St];$t(g.symbolInstances.get(zt),g.collisionArrays[zt])}}else for(let Je=o.symbolInstanceStart;Je<o.symbolInstanceEnd;Je++)$t(g.symbolInstances.get(Je),g.collisionArrays[Je]);if(f&&g.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[g.bucketInstanceId];l.ar(Je.invProjMatrix,P),Je.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(o,d,f,g){let x;x=g===l.ah.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[l.as(d)];const P=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const C of P)C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:f.crossTileID)}markUsedOrientation(o,d,f){const g=d===l.ah.horizontal||d===l.ah.horizontalOnly?d:0,x=d===l.ah.vertical?d:0,P=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const C of P)o.text.placedSymbolArray.get(C).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let f=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const g=d?d.symbolFadeChange(o):1,x=d?d.opacities:{},P=d?d.variableOffsets:{},C=d?d.placedOrientations:{};for(const O in this.placements){const D=this.placements[O],F=x[O];F?(this.opacities[O]=new xi(F,g,D.text,D.icon),f=f||D.text!==F.text.placed||D.icon!==F.icon.placed):(this.opacities[O]=new xi(null,g,D.text,D.icon,D.skipFade),f=f||D.text||D.icon)}for(const O in x){const D=x[O];if(!this.opacities[O]){const F=new xi(D,g,!1,!1);F.isHidden()||(this.opacities[O]=F,f=f||D.text.placed||D.icon.placed)}}for(const O in P)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=P[O]);for(const O in C)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=C[O]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const f={};for(const g of d){const x=g.getBucket(o);x&&g.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,f,g.collisionBoxArray)}}updateBucketOpacities(o,d,f){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const g=o.layers[0],x=g.layout,P=new xi(null,0,!1,!1,!0),C=x.get("text-allow-overlap"),O=x.get("icon-allow-overlap"),D=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=x.get("text-rotation-alignment")==="map",B=x.get("text-pitch-alignment")==="map",W=x.get("icon-text-fit")!=="none",re=new xi(null,0,C&&(O||!o.hasIconData()||x.get("icon-optional")),O&&(C||!o.hasTextData()||x.get("text-optional")),!0);!o.collisionArrays&&f&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(f);const te=(ne,X,he)=>{for(let Me=0;Me<X/4;Me++)ne.opacityVertexArray.emplaceBack(he);ne.hasVisibleVertices=ne.hasVisibleVertices||he!==qr};for(let ne=0;ne<o.symbolInstances.length;ne++){const X=o.symbolInstances.get(ne),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:Me,crossTileID:oe}=X;let ge=this.opacities[oe];d[oe]?ge=P:ge||(ge=re,this.opacities[oe]=ge),d[oe]=!0;const Ie=X.numIconVertices>0,Ee=this.placedOrientations[X.crossTileID],Pe=Ee===l.ah.vertical,Be=Ee===l.ah.horizontal||Ee===l.ah.horizontalOnly;if(he>0||Me>0){const ze=u0(ge.text);te(o.text,he,Pe?qr:ze),te(o.text,Me,Be?qr:ze);const Fe=ge.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(Je=>{Je>=0&&(o.text.placedSymbolArray.get(Je).hidden=Fe||Pe?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=Fe||Be?1:0);const rt=this.variableOffsets[X.crossTileID];rt&&this.markUsedJustification(o,rt.anchor,X,Ee);const $t=this.placedOrientations[X.crossTileID];$t&&(this.markUsedJustification(o,"left",X,$t),this.markUsedOrientation(o,$t,X))}if(Ie){const ze=u0(ge.icon),Fe=!(W&&X.verticalPlacedIconSymbolIndex&&Pe);X.placedIconSymbolIndex>=0&&(te(o.icon,X.numIconVertices,Fe?ze:qr),o.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=ge.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(te(o.icon,X.numVerticalIconVertices,Fe?qr:ze),o.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const ze=o.collisionArrays[ne];if(ze){let Fe=new l.P(0,0);if(ze.textBox||ze.verticalTextBox){let $t=!0;if(D){const Je=this.variableOffsets[oe];Je?(Fe=gs(Je.anchor,Je.width,Je.height,Je.textOffset,Je.textBoxScale),F&&Fe._rotate(B?this.transform.angle:-this.transform.angle)):$t=!1}ze.textBox&&Fs(o.textCollisionBox.collisionVertexArray,ge.text.placed,!$t||Pe,Fe.x,Fe.y),ze.verticalTextBox&&Fs(o.textCollisionBox.collisionVertexArray,ge.text.placed,!$t||Be,Fe.x,Fe.y)}const rt=!!(!Be&&ze.verticalIconBox);ze.iconBox&&Fs(o.iconCollisionBox.collisionVertexArray,ge.icon.placed,rt,W?Fe.x:0,W?Fe.y:0),ze.verticalIconBox&&Fs(o.iconCollisionBox.collisionVertexArray,ge.icon.placed,!rt,W?Fe.x:0,W?Fe.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ne.invProjMatrix,o.placementViewportMatrix=ne.viewportMatrix,o.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const f=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*f>o}setStale(){this.stale=!0}}function Fs(b,o,d,f,g){b.emplaceBack(o?1:0,d?1:0,f||0,g||0),b.emplaceBack(o?1:0,d?1:0,f||0,g||0),b.emplaceBack(o?1:0,d?1:0,f||0,g||0),b.emplaceBack(o?1:0,d?1:0,f||0,g||0)}const c0=Math.pow(2,25),Qb=Math.pow(2,24),di=Math.pow(2,17),Lf=Math.pow(2,16),Rf=Math.pow(2,9),Bs=Math.pow(2,8),js=Math.pow(2,1);function u0(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const o=b.placed?1:0,d=Math.floor(127*b.opacity);return d*c0+o*Qb+d*di+o*Lf+d*Rf+o*Bs+d*js+o}const qr=0;class dn{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,f,g,x){const P=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(P,g,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((C,O)=>C.sortKey-O.sortKey));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,x())return!0;return!1}}class h0{constructor(o,d,f,g,x,P,C,O){this.placement=new rs(o,d,P,C,O),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,d,f){const g=E.now(),x=()=>!this._forceFullPlacement&&E.now()-g>2;for(;this._currentPlacementIndex>=0;){const P=d[o[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=C)&&(!P.maxzoom||P.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new dn(P)),this._inProgressLayer.continuePlacement(f[P.source],this.placement,this._showCollisionBoxes,P,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const ca=512/l.W/2;class cr{constructor(o,d,f){this.tileID=o,this.bucketInstanceId=f,this._symbolsByKey={};const g=new Map;for(let x=0;x<d.length;x++){const P=d.get(x),C=P.key,O=g.get(C);O?O.push(P):g.set(C,[P])}for(const[x,P]of g){const C={positions:P.map(O=>({x:Math.floor(O.anchorX*ca),y:Math.floor(O.anchorY*ca)})),crossTileIDs:P.map(O=>O.crossTileID)};if(C.positions.length>128){const O=new l.au(C.positions.length,16,Uint16Array);for(const{x:D,y:F}of C.positions)O.add(D,F);O.finish(),delete C.positions,C.index=O}this._symbolsByKey[x]=C}}getScaledCoordinates(o,d){const{x:f,y:g,z:x}=this.tileID.canonical,{x:P,y:C,z:O}=d.canonical,D=ca/Math.pow(2,O-x),F=(C*l.W+o.anchorY)*D,B=g*l.W*ca;return{x:Math.floor((P*l.W+o.anchorX)*D-f*l.W*ca),y:Math.floor(F-B)}}findMatches(o,d,f){const g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let x=0;x<o.length;x++){const P=o.get(x);if(P.crossTileID)continue;const C=this._symbolsByKey[P.key];if(!C)continue;const O=this.getScaledCoordinates(P,d);if(C.index){const D=C.index.range(O.x-g,O.y-g,O.x+g,O.y+g).sort();for(const F of D){const B=C.crossTileIDs[F];if(!f[B]){f[B]=!0,P.crossTileID=B;break}}}else if(C.positions)for(let D=0;D<C.positions.length;D++){const F=C.positions[D],B=C.crossTileIDs[D];if(Math.abs(F.x-O.x)<=g&&Math.abs(F.y-O.y)<=g&&!f[B]){f[B]=!0,P.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Lu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class el{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const f in this.indexes){const g=this.indexes[f],x={};for(const P in g){const C=g[P];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),x[C.tileID.key]=C}this.indexes[f]=x}this.lng=o}addBucket(o,d,f){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<d.symbolInstances.length;x++)d.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const g=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const P=this.indexes[x];if(Number(x)>o.overscaledZ)for(const C in P){const O=P[C];O.tileID.isChildOf(o)&&O.findMatches(d.symbolInstances,o,g)}else{const C=P[o.scaledTo(Number(x)).key];C&&C.findMatches(d.symbolInstances,o,g)}}for(let x=0;x<d.symbolInstances.length;x++){const P=d.symbolInstances.get(x);P.crossTileID||(P.crossTileID=f.generate(),g[P.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new cr(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const f of d.getCrossTileIDsLists())for(const g of f)delete this.usedCrossTileIDs[o][g]}removeStaleBuckets(o){let d=!1;for(const f in this.indexes){const g=this.indexes[f];for(const x in g)o[g[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[x]),delete g[x],d=!0)}return d}}class Ji{constructor(){this.layerIndexes={},this.crossTileIDs=new Lu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,f){let g=this.layerIndexes[o.id];g===void 0&&(g=this.layerIndexes[o.id]=new el);let x=!1;const P={};g.handleWrapJump(f);for(const C of d){const O=C.getBucket(o);O&&o.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,O,this.crossTileIDs)&&(x=!0),P[O.bucketInstanceId]=!0)}return g.removeStaleBuckets(P)&&(x=!0),x}pruneUnusedLayers(o){const d={};o.forEach(f=>{d[f]=!0});for(const f in this.layerIndexes)d[f]||delete this.layerIndexes[f]}}const tl=(b,o)=>l.t(b,o&&o.filter(d=>d.identifier!=="source.canvas")),kn=l.av();class Ed extends l.E{constructor(o,d={}){super(),this._rtlPluginLoaded=()=>{for(const f in this.sourceCaches){const g=this.sourceCaches[f].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[f].reload()}},this.map=o,this.dispatcher=new He(ms(),o._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(f,g)=>this.getGlyphs(f,g)),this.dispatcher.registerMessageHandler("getImages",(f,g)=>this.getImages(f,g)),this.imageManager=new ht,this.imageManager.setEventedParent(this),this.glyphManager=new Ut(o._requestManager,d.localIdeographFontFamily),this.lineAtlas=new _r(256,512),this.crossTileSymbolIndex=new Ji,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.ax()),Ns().on(Zl,this._rtlPluginLoaded),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const g=this.sourceCaches[f.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const P in this._layers){const C=this._layers[P];C.source===x.id&&this._validateLayer(C)}})}loadURL(o,d={},f){this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const g=this.map._requestManager.transformRequest(o,be.Style);this._loadStyleRequest=new AbortController,l.h(g,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,d,f)}).catch(x=>{this._loadStyleRequest=null,x&&this.fire(new l.j(x))})}loadJSON(o,d={},f){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(o,d,f)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(kn,{validate:!1})}_load(o,d,f){var g;const x=d.transformStyle?d.transformStyle(f,o):o;if(!d.validate||!tl(this,l.x(x))){this._loaded=!0,this.stylesheet=x;for(const P in x.sources)this.addSource(P,x.sources[P],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new Rr(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const o=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",o),this._order=o.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of o){const f=l.az(d);f.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=f}}_loadSprite(o,d=!1,f=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(x,P,C,O){return l._(this,void 0,void 0,function*(){const D=ut(x),F=C>1?"@2x":"",B={},W={};for(const{id:re,url:te}of D){const ne=P.transformRequest(P.normalizeSpriteURL(te,F,".json"),be.SpriteJSON);B[re]=l.h(ne,O);const X=P.transformRequest(P.normalizeSpriteURL(te,F,".png"),be.SpriteImage);W[re]=_e.getImage(X,O)}return yield Promise.all([...Object.values(B),...Object.values(W)]),function(re,te){return l._(this,void 0,void 0,function*(){const ne={};for(const X in re){ne[X]={};const he=E.getImageCanvasContext((yield te[X]).data),Me=(yield re[X]).data;for(const oe in Me){const{width:ge,height:Ie,x:Ee,y:Pe,sdf:Be,pixelRatio:ze,stretchX:Fe,stretchY:rt,content:$t}=Me[oe];ne[X][oe]={data:null,pixelRatio:ze,sdf:Be,stretchX:Fe,stretchY:rt,content:$t,spriteData:{width:ge,height:Ie,x:Ee,y:Pe,context:he}}}}return ne})}(B,W)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(x=>{if(this._spriteRequest=null,x)for(const P in x){this._spritesImagesIds[P]=[];const C=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter(O=>!(O in x)):[];for(const O of C)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in x[P]){const D=P==="default"?O:`${P}:${O}`;this._spritesImagesIds[P].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,x[P][O],!1):this.imageManager.addImage(D,x[P][O]),d&&(this._changedImages[D]=!0)}}}).catch(x=>{this._spriteRequest=null,g=x,this.fire(new l.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),f&&f(g)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(o){const d=this.sourceCaches[o.source];if(!d)return;const f=o.sourceLayer;if(!f)return;const g=d.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(f)===-1)&&this.fire(new l.j(new Error(`Source layer "${f}" does not exist on source "${g.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const d=this._serializedAllLayers();if(!o||o.length===0)return Object.values(d);const f=[];for(const g of o)d[g]&&f.push(d[g]);return f}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const d=Object.keys(this._layers);for(const f of d){const g=this._layers[f];g.type!=="custom"&&(o[f]=g.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const d=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(g.length||x.length)&&this._updateWorkerLayers(g,x);for(const P in this._updatedSources){const C=this._updatedSources[P];if(C==="reload")this._reloadSource(P);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const f={};for(const g in this.sourceCaches){const x=this.sourceCaches[g];f[g]=x.used,x.used=!1}for(const g of this._order){const x=this._layers[g];x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const g in f){const x=this.sourceCaches[g];f[g]!==x.used&&x.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(o),this.z=o.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(o),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,d={}){var f;this._checkLoaded();const g=this.serialize();if(o=d.transformStyle?d.transformStyle(g,o):o,((f=d.validate)===null||f===void 0||f)&&tl(this,l.x(o)))return!1;(o=l.aA(o)).layers=l.ay(o.layers);const x=l.aB(g,o),P=this._getOperationsToPerform(x);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const C of P.operations)C();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const d=[],f=[];for(const g of o)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":d.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":d.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":d.push(()=>{});break;default:f.push(g.command)}return{operations:d,unimplemented:f}}addImage(o,d){if(this.getImage(o))return this.fire(new l.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,d),this._afterImageUpdated(o)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new l.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,d,f={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.x.source,`sources.${o}`,d,null,f))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const g=this.sourceCaches[o]=new Ue(o,d,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:o})),g.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===o)return this.fire(new l.j(new Error(`Source "${o}" cannot be removed while layer "${f}" is using it.`)));const d=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,d){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const f=this.sourceCaches[o].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(d),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,d,f={}){this._checkLoaded();const g=o.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let x;if(o.type==="custom"){if(tl(this,l.aC(o)))return;x=l.az(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(g,o.source),o=l.aA(o),o=l.e(o,{source:g})),this._validate(l.x.layer,`layers.${g}`,o,{arrayIndex:-1},f))return;x=l.az(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:g}})}const P=d?this._order.indexOf(d):this._order.length;if(d&&P===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${d}".`)));else{if(this._order.splice(P,0,g),this._layerOrderChanged=!0,this._layers[g]=x,this._removedLayers[g]&&x.source&&x.type!=="custom"){const C=this._removedLayers[g];delete this._removedLayers[g],C.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new l.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const f=this._order.indexOf(o);this._order.splice(f,1);const g=d?this._order.indexOf(d):this._order.length;d&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${o}" before non-existing layer "${d}".`))):(this._order.splice(g,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${o}".`)));d.setEventedParent(null);const f=this._order.indexOf(o);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,d,f){this._checkLoaded();const g=this.getLayer(o);g?g.minzoom===d&&g.maxzoom===f||(d!=null&&(g.minzoom=d),f!=null&&(g.maxzoom=f),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,d,f={}){this._checkLoaded();const g=this.getLayer(o);if(g){if(!l.aD(g.filter,d))return d==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.x.filter,`layers.${g.id}.filter`,d,null,f)||(g.filter=l.aA(d),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return l.aA(this.getLayer(o).filter)}setLayoutProperty(o,d,f,g={}){this._checkLoaded();const x=this.getLayer(o);x?l.aD(x.getLayoutProperty(d),f)||(x.setLayoutProperty(d,f,g),this._updateLayer(x)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,d){const f=this.getLayer(o);if(f)return f.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,d,f,g={}){this._checkLoaded();const x=this.getLayer(o);x?l.aD(x.getPaintProperty(d),f)||(x.setPaintProperty(d,f,g)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,d){return this.getLayer(o).getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const f=o.source,g=o.sourceLayer,x=this.sourceCaches[f];if(x===void 0)return void this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)));const P=x.getSource().type;P==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||g?(o.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),x.setFeatureState(g,o.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,d){this._checkLoaded();const f=o.source,g=this.sourceCaches[f];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)));const x=g.getSource().type,P=x==="vector"?o.sourceLayer:void 0;x!=="vector"||P?d&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(P,o.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const d=o.source,f=o.sourceLayer,g=this.sourceCaches[d];if(g!==void 0)return g.getSource().type!=="vector"||f?(o.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(f,o.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=l.aE(this.sourceCaches,x=>x.serialize()),d=this._serializeByIds(this._order),f=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aF({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:o,layers:d,terrain:f},x=>x!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const d=P=>this._layers[P].type==="fill-extrusion",f={},g=[];for(let P=this._order.length-1;P>=0;P--){const C=this._order[P];if(d(C)){f[C]=P;for(const O of o){const D=O[C];if(D)for(const F of D)g.push(F)}}}g.sort((P,C)=>C.intersectionZ-P.intersectionZ);const x=[];for(let P=this._order.length-1;P>=0;P--){const C=this._order[P];if(d(C))for(let O=g.length-1;O>=0;O--){const D=g[O].feature;if(f[D.layer.id]<P)break;x.push(D),g.pop()}else for(const O of o){const D=O[C];if(D)for(const F of D)x.push(F.feature)}}return x}queryRenderedFeatures(o,d,f){d&&d.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const g={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const C of d.layers){const O=this._layers[C];if(!O)return this.fire(new l.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];g[O.source]=!0}}const x=[];d.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const C in this.sourceCaches)d.layers&&!g[C]||x.push(zs(this.sourceCaches[C],this._layers,P,o,d,f));return this.placement&&x.push(function(C,O,D,F,B,W,re){const te={},ne=W.queryRenderedSymbols(F),X=[];for(const he of Object.keys(ne).map(Number))X.push(re[he]);X.sort(oa);for(const he of X){const Me=he.featureIndex.lookupSymbolFeatures(ne[he.bucketInstanceId],O,he.bucketIndex,he.sourceLayerIndex,B.filter,B.layers,B.availableImages,C);for(const oe in Me){const ge=te[oe]=te[oe]||[],Ie=Me[oe];Ie.sort((Ee,Pe)=>{const Be=he.featureSortOrder;if(Be){const ze=Be.indexOf(Ee.featureIndex);return Be.indexOf(Pe.featureIndex)-ze}return Pe.featureIndex-Ee.featureIndex});for(const Ee of Ie)ge.push(Ee)}}for(const he in te)te[he].forEach(Me=>{const oe=Me.feature,ge=D[C[he].source].getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ge});return te}(this._layers,P,this.sourceCaches,o,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,d){d&&d.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",d.filter,null,d);const f=this.sourceCaches[o];return f?function(g,x){const P=g.getRenderableIds().map(D=>g.getTileByID(D)),C=[],O={};for(let D=0;D<P.length;D++){const F=P[D],B=F.tileID.canonical.key;O[B]||(O[B]=!0,F.querySourceFeatures(C,x))}return C}(f,d):[]}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const f=this.light.getLight();let g=!1;for(const P in o)if(!l.aD(o[P],f[P])){g=!0;break}if(!g)return;const x={now:E.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(x)}_validate(o,d,f,g,x={}){return(!x||x.validate!==!1)&&tl(this,o.call(l.x,l.e({key:d,style:this.serialize(),value:f,styleSpec:l.v},g)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ns().off(Zl,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const f=this.sourceCaches[d];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const d in this.sourceCaches)this.sourceCaches[d].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,d,f,g,x=!1){let P=!1,C=!1;const O={};for(const D of this._order){const F=this._layers[D];if(F.type!=="symbol")continue;if(!O[F.source]){const W=this.sourceCaches[F.source];O[F.source]=W.getRenderableIds(!0).map(re=>W.getTileByID(re)).sort((re,te)=>te.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(te.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(F,O[F.source],o.center.lng);P=P||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(E.now(),o.zoom))&&(this.pauseablePlacement=new h0(o,this.map.terrain,this._order,x,d,f,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(E.now()),C=!0),P&&this.pauseablePlacement.placement.setStale()),C||P)for(const D of this._order){const F=this._layers[D];F.type==="symbol"&&this.placement.updateLayerOpacities(F,O[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(E.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d){return l._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,d.icons),f})}getGlyphs(o,d){return l._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(d.stacks),g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,d={}){this._checkLoaded(),o&&this._validate(l.x.glyphs,"glyphs",o,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,d,f={},g){this._checkLoaded();const x=[{id:o,url:d}],P=[...ut(this.stylesheet.sprite),...x];this._validate(l.x.sprite,"sprite",P,null,f)||(this.stylesheet.sprite=P,this._loadSprite(x,!0,g))}removeSprite(o){this._checkLoaded();const d=ut(this.stylesheet.sprite);if(d.find(f=>f.id===o)){if(this._spritesImagesIds[o])for(const f of this._spritesImagesIds[o])this.imageManager.removeImage(f),this._changedImages[f]=!0;d.splice(d.findIndex(f=>f.id===o),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return ut(this.stylesheet.sprite)}setSprite(o,d={},f){this._checkLoaded(),o&&this._validate(l.x.sprite,"sprite",o,null,d)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,f):(this._unloadSprite(),f&&f(null)))}}var Yn=l.X([{name:"a_pos",type:"Int16",components:2}]),Df="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Jl={prelude:ai(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ai(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ai(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ai(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ai(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ai("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ai(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ai(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ai(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ai(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ai(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ai(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ai(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ai(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ai(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ai(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ai(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ai(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ai("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Df),terrainDepth:ai("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Df),terrainCoords:ai("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Df)};function ai(b,o){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=o.match(/attribute ([\w]+) ([\w]+)/g),g=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=x?x.concat(g):g,C={};return{fragmentSource:b=b.replace(d,(O,D,F,B,W)=>(C[W]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${F} ${B} ${W};
#else
uniform ${F} ${B} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${F} ${B} ${W} = u_${W};
#endif
`)),vertexSource:o=o.replace(d,(O,D,F,B,W)=>{const re=B==="float"?"vec2":"vec4",te=W.match(/color/)?"color":re;return C[W]?D==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${F} ${re} a_${W};
varying ${F} ${B} ${W};
#else
uniform ${F} ${B} u_${W};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${F} ${B} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${te}(a_${W}, u_${W}_t);
#else
    ${F} ${B} ${W} = u_${W};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${F} ${re} a_${W};
#else
uniform ${F} ${B} u_${W};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${F} ${B} ${W} = a_${W};
#else
    ${F} ${B} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${F} ${B} ${W} = unpack_mix_${te}(a_${W}, u_${W}_t);
#else
    ${F} ${B} ${W} = u_${W};
#endif
`}),staticAttributes:f,staticUniforms:P}}class kd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,f,g,x,P,C,O,D){this.context=o;let F=this.boundPaintVertexBuffers.length!==g.length;for(let B=0;!F&&B<g.length;B++)this.boundPaintVertexBuffers[B]!==g[B]&&(F=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==f||F||this.boundIndexBuffer!==x||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==D?this.freshBind(d,f,g,x,P,C,O,D):(o.bindVertexArray.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),O&&O.bind(),D&&D.bind())}freshBind(o,d,f,g,x,P,C,O){const D=o.numAttributes,F=this.context,B=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=O,d.enableAttributes(B,o);for(const W of f)W.enableAttributes(B,o);P&&P.enableAttributes(B,o),C&&C.enableAttributes(B,o),O&&O.enableAttributes(B,o),d.bind(),d.setVertexAttribPointers(B,o,x);for(const W of f)W.bind(),W.setVertexAttribPointers(B,o,x);P&&(P.bind(),P.setVertexAttribPointers(B,o,x)),g&&g.bind(),C&&(C.bind(),C.setVertexAttribPointers(B,o,x)),O&&(O.bind(),O.setVertexAttribPointers(B,o,x)),F.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Xn(b){const o=[];for(let d=0;d<b.length;d++){if(b[d]===null)continue;const f=b[d].split(" ");o.push(f.pop())}return o}class zf{constructor(o,d,f,g,x,P){const C=o.gl;this.program=C.createProgram();const O=Xn(d.staticAttributes),D=f?f.getBinderAttributes():[],F=O.concat(D),B=Jl.prelude.staticUniforms?Xn(Jl.prelude.staticUniforms):[],W=d.staticUniforms?Xn(d.staticUniforms):[],re=f?f.getBinderUniforms():[],te=B.concat(W).concat(re),ne=[];for(const Ee of te)ne.indexOf(Ee)<0&&ne.push(Ee);const X=f?f.defines():[];x&&X.push("#define OVERDRAW_INSPECTOR;"),P&&X.push("#define TERRAIN3D;");const he=X.concat(Jl.prelude.fragmentSource,d.fragmentSource).join(`
`),Me=X.concat(Jl.prelude.vertexSource,d.vertexSource).join(`
`),oe=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(oe,he),C.compileShader(oe),!C.getShaderParameter(oe,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(oe)}`);C.attachShader(this.program,oe);const ge=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ge,Me),C.compileShader(ge),!C.getShaderParameter(ge,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(ge)}`);C.attachShader(this.program,ge),this.attributes={};const Ie={};this.numAttributes=F.length;for(let Ee=0;Ee<this.numAttributes;Ee++)F[Ee]&&(C.bindAttribLocation(this.program,Ee,F[Ee]),this.attributes[F[Ee]]=Ee);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(ge),C.deleteShader(oe);for(let Ee=0;Ee<ne.length;Ee++){const Pe=ne[Ee];if(Pe&&!Ie[Pe]){const Be=C.getUniformLocation(this.program,Pe);Be&&(Ie[Pe]=Be)}}this.fixedUniforms=g(o,Ie),this.terrainUniforms=((Ee,Pe)=>({u_depth:new l.aG(Ee,Pe.u_depth),u_terrain:new l.aG(Ee,Pe.u_terrain),u_terrain_dim:new l.aH(Ee,Pe.u_terrain_dim),u_terrain_matrix:new l.aI(Ee,Pe.u_terrain_matrix),u_terrain_unpack:new l.aJ(Ee,Pe.u_terrain_unpack),u_terrain_exaggeration:new l.aH(Ee,Pe.u_terrain_exaggeration)}))(o,Ie),this.binderUniforms=f?f.getUniforms(o,Ie):[]}draw(o,d,f,g,x,P,C,O,D,F,B,W,re,te,ne,X,he,Me){const oe=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(f),o.setStencilMode(g),o.setColorMode(x),o.setCullFace(P),O){o.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,O.depthTexture),o.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,O.texture);for(const Ie in this.terrainUniforms)this.terrainUniforms[Ie].set(O[Ie])}for(const Ie in this.fixedUniforms)this.fixedUniforms[Ie].set(C[Ie]);ne&&ne.setUniforms(o,this.binderUniforms,re,{zoom:te});let ge=0;switch(d){case oe.LINES:ge=2;break;case oe.TRIANGLES:ge=3;break;case oe.LINE_STRIP:ge=1}for(const Ie of W.get()){const Ee=Ie.vaos||(Ie.vaos={});(Ee[D]||(Ee[D]=new kd)).bind(o,this,F,ne?ne.getPaintVertexBuffers():[],B,Ie.vertexOffset,X,he,Me),oe.drawElements(d,Ie.primitiveLength*ge,oe.UNSIGNED_SHORT,Ie.primitiveOffset*ge*2)}}}function Ru(b,o,d){const f=1/Ct(d,1,o.transform.tileZoom),g=Math.pow(2,d.tileID.overscaledZ),x=d.tileSize*Math.pow(2,o.transform.tileZoom)/g,P=x*(d.tileID.canonical.x+d.tileID.wrap*g),C=x*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[f,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[P>>16,C>>16],u_pixel_coord_lower:[65535&P,65535&C]}}const d0=(b,o,d,f)=>{const g=o.style.light,x=g.properties.get("position"),P=[x.x,x.y,x.z],C=function(){var D=new l.A(9);return l.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();g.properties.get("anchor")==="viewport"&&function(D,F){var B=Math.sin(F),W=Math.cos(F);D[0]=W,D[1]=B,D[2]=0,D[3]=-B,D[4]=W,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(C,-o.transform.angle),function(D,F,B){var W=F[0],re=F[1],te=F[2];D[0]=W*B[0]+re*B[3]+te*B[6],D[1]=W*B[1]+re*B[4]+te*B[7],D[2]=W*B[2]+re*B[5]+te*B[8]}(P,P,C);const O=g.properties.get("color");return{u_matrix:b,u_lightpos:P,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[O.r,O.g,O.b],u_vertical_gradient:+d,u_opacity:f}},ew=(b,o,d,f,g,x,P)=>l.e(d0(b,o,d,f),Ru(x,o,P),{u_height_factor:-Math.pow(2,g.overscaledZ)/P.tileSize/8}),Ad=b=>({u_matrix:b}),p0=(b,o,d,f)=>l.e(Ad(b),Ru(d,o,f)),f0=(b,o)=>({u_matrix:b,u_world:o}),tw=(b,o,d,f,g)=>l.e(p0(b,o,d,f),{u_world:g}),m0=(b,o,d,f)=>{const g=b.transform;let x,P;if(f.paint.get("circle-pitch-alignment")==="map"){const C=Ct(d,1,g.zoom);x=!0,P=[C,C]}else x=!1,P=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:b.translatePosMatrix(o.posMatrix,d,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:P}},iw=(b,o,d)=>{const f=Ct(d,1,o.zoom),g=Math.pow(2,o.zoom-d.tileID.overscaledZ),x=d.tileID.overscaleFactor();return{u_matrix:b,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[o.pixelsToGLUnits[0]/(f*g),o.pixelsToGLUnits[1]/(f*g)],u_overscale_factor:x}},Pd=(b,o,d=1)=>({u_matrix:b,u_color:o,u_overlay:0,u_overlay_scale:d}),Nf=b=>({u_matrix:b}),y0=(b,o,d,f)=>({u_matrix:b,u_extrude_scale:Ct(o,1,d),u_intensity:f});function g0(b,o){const d=Math.pow(2,o.canonical.z),f=o.canonical.y;return[new l.Y(0,f/d).toLngLat().lat,new l.Y(0,(f+1)/d).toLngLat().lat]}const Cd=(b,o,d,f)=>{const g=b.transform;return{u_matrix:zu(b,o,d,f),u_ratio:1/Ct(o,1,g.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},il=(b,o,d,f,g)=>l.e(Cd(b,o,d,g),{u_image:0,u_image_height:f}),$d=(b,o,d,f,g)=>{const x=b.transform,P=Du(o,x);return{u_matrix:zu(b,o,d,g),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Ct(o,1,x.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[P,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},pn=(b,o,d,f,g,x)=>{const P=b.lineAtlas,C=Du(o,b.transform),O=d.layout.get("line-cap")==="round",D=P.getDash(f.from,O),F=P.getDash(f.to,O),B=D.width*g.fromScale,W=F.width*g.toScale;return l.e(Cd(b,o,d,x),{u_patternscale_a:[C/B,-D.height/2],u_patternscale_b:[C/W,-F.height/2],u_sdfgamma:P.width/(256*Math.min(B,W)*b.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:F.y,u_mix:g.t})};function Du(b,o){return 1/Ct(b,1,o.tileZoom)}function zu(b,o,d,f){return b.translatePosMatrix(f?f.posMatrix:o.tileID.posMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Nu=(b,o,d,f,g)=>{return{u_matrix:b,u_tl_parent:o,u_scale_parent:d,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(P=g.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(x=g.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Od(g.paint.get("raster-hue-rotate"))};var x,P};function Od(b){b*=Math.PI/180;const o=Math.sin(b),d=Math.cos(b);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const Fu=(b,o,d,f,g,x,P,C,O,D)=>{const F=g.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:F.width/F.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:P,u_coord_matrix:C,u_is_text:+O,u_pitch_with_map:+f,u_texsize:D,u_texture:0}},Kl=(b,o,d,f,g,x,P,C,O,D,F)=>{const B=g.transform;return l.e(Fu(b,o,d,f,g,x,P,C,O,D),{u_gamma_scale:f?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+F})},rw=(b,o,d,f,g,x,P,C,O,D)=>l.e(Kl(b,o,d,f,g,x,P,C,!0,O,!0),{u_texsize_icon:D,u_texture_icon:1}),sw=(b,o,d)=>({u_matrix:b,u_opacity:o,u_color:d}),_0=(b,o,d,f,g,x)=>l.e(function(P,C,O,D){const F=O.imageManager.getPattern(P.from.toString()),B=O.imageManager.getPattern(P.to.toString()),{width:W,height:re}=O.imageManager.getPixelSize(),te=Math.pow(2,D.tileID.overscaledZ),ne=D.tileSize*Math.pow(2,O.transform.tileZoom)/te,X=ne*(D.tileID.canonical.x+D.tileID.wrap*te),he=ne*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[W,re],u_mix:C.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/Ct(D,1,O.transform.tileZoom),u_pixel_coord_upper:[X>>16,he>>16],u_pixel_coord_lower:[65535&X,65535&he]}}(f,x,d,g),{u_matrix:b,u_opacity:o}),nw={fillExtrusion:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_lightpos:new l.aK(b,o.u_lightpos),u_lightintensity:new l.aH(b,o.u_lightintensity),u_lightcolor:new l.aK(b,o.u_lightcolor),u_vertical_gradient:new l.aH(b,o.u_vertical_gradient),u_opacity:new l.aH(b,o.u_opacity)}),fillExtrusionPattern:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_lightpos:new l.aK(b,o.u_lightpos),u_lightintensity:new l.aH(b,o.u_lightintensity),u_lightcolor:new l.aK(b,o.u_lightcolor),u_vertical_gradient:new l.aH(b,o.u_vertical_gradient),u_height_factor:new l.aH(b,o.u_height_factor),u_image:new l.aG(b,o.u_image),u_texsize:new l.aL(b,o.u_texsize),u_pixel_coord_upper:new l.aL(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(b,o.u_pixel_coord_lower),u_scale:new l.aK(b,o.u_scale),u_fade:new l.aH(b,o.u_fade),u_opacity:new l.aH(b,o.u_opacity)}),fill:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix)}),fillPattern:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_image:new l.aG(b,o.u_image),u_texsize:new l.aL(b,o.u_texsize),u_pixel_coord_upper:new l.aL(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(b,o.u_pixel_coord_lower),u_scale:new l.aK(b,o.u_scale),u_fade:new l.aH(b,o.u_fade)}),fillOutline:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_world:new l.aL(b,o.u_world)}),fillOutlinePattern:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_world:new l.aL(b,o.u_world),u_image:new l.aG(b,o.u_image),u_texsize:new l.aL(b,o.u_texsize),u_pixel_coord_upper:new l.aL(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(b,o.u_pixel_coord_lower),u_scale:new l.aK(b,o.u_scale),u_fade:new l.aH(b,o.u_fade)}),circle:(b,o)=>({u_camera_to_center_distance:new l.aH(b,o.u_camera_to_center_distance),u_scale_with_map:new l.aG(b,o.u_scale_with_map),u_pitch_with_map:new l.aG(b,o.u_pitch_with_map),u_extrude_scale:new l.aL(b,o.u_extrude_scale),u_device_pixel_ratio:new l.aH(b,o.u_device_pixel_ratio),u_matrix:new l.aI(b,o.u_matrix)}),collisionBox:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_camera_to_center_distance:new l.aH(b,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(b,o.u_pixels_to_tile_units),u_extrude_scale:new l.aL(b,o.u_extrude_scale),u_overscale_factor:new l.aH(b,o.u_overscale_factor)}),collisionCircle:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_inv_matrix:new l.aI(b,o.u_inv_matrix),u_camera_to_center_distance:new l.aH(b,o.u_camera_to_center_distance),u_viewport_size:new l.aL(b,o.u_viewport_size)}),debug:(b,o)=>({u_color:new l.aM(b,o.u_color),u_matrix:new l.aI(b,o.u_matrix),u_overlay:new l.aG(b,o.u_overlay),u_overlay_scale:new l.aH(b,o.u_overlay_scale)}),clippingMask:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix)}),heatmap:(b,o)=>({u_extrude_scale:new l.aH(b,o.u_extrude_scale),u_intensity:new l.aH(b,o.u_intensity),u_matrix:new l.aI(b,o.u_matrix)}),heatmapTexture:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_world:new l.aL(b,o.u_world),u_image:new l.aG(b,o.u_image),u_color_ramp:new l.aG(b,o.u_color_ramp),u_opacity:new l.aH(b,o.u_opacity)}),hillshade:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_image:new l.aG(b,o.u_image),u_latrange:new l.aL(b,o.u_latrange),u_light:new l.aL(b,o.u_light),u_shadow:new l.aM(b,o.u_shadow),u_highlight:new l.aM(b,o.u_highlight),u_accent:new l.aM(b,o.u_accent)}),hillshadePrepare:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_image:new l.aG(b,o.u_image),u_dimension:new l.aL(b,o.u_dimension),u_zoom:new l.aH(b,o.u_zoom),u_unpack:new l.aJ(b,o.u_unpack)}),line:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_ratio:new l.aH(b,o.u_ratio),u_device_pixel_ratio:new l.aH(b,o.u_device_pixel_ratio),u_units_to_pixels:new l.aL(b,o.u_units_to_pixels)}),lineGradient:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_ratio:new l.aH(b,o.u_ratio),u_device_pixel_ratio:new l.aH(b,o.u_device_pixel_ratio),u_units_to_pixels:new l.aL(b,o.u_units_to_pixels),u_image:new l.aG(b,o.u_image),u_image_height:new l.aH(b,o.u_image_height)}),linePattern:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_texsize:new l.aL(b,o.u_texsize),u_ratio:new l.aH(b,o.u_ratio),u_device_pixel_ratio:new l.aH(b,o.u_device_pixel_ratio),u_image:new l.aG(b,o.u_image),u_units_to_pixels:new l.aL(b,o.u_units_to_pixels),u_scale:new l.aK(b,o.u_scale),u_fade:new l.aH(b,o.u_fade)}),lineSDF:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_ratio:new l.aH(b,o.u_ratio),u_device_pixel_ratio:new l.aH(b,o.u_device_pixel_ratio),u_units_to_pixels:new l.aL(b,o.u_units_to_pixels),u_patternscale_a:new l.aL(b,o.u_patternscale_a),u_patternscale_b:new l.aL(b,o.u_patternscale_b),u_sdfgamma:new l.aH(b,o.u_sdfgamma),u_image:new l.aG(b,o.u_image),u_tex_y_a:new l.aH(b,o.u_tex_y_a),u_tex_y_b:new l.aH(b,o.u_tex_y_b),u_mix:new l.aH(b,o.u_mix)}),raster:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_tl_parent:new l.aL(b,o.u_tl_parent),u_scale_parent:new l.aH(b,o.u_scale_parent),u_buffer_scale:new l.aH(b,o.u_buffer_scale),u_fade_t:new l.aH(b,o.u_fade_t),u_opacity:new l.aH(b,o.u_opacity),u_image0:new l.aG(b,o.u_image0),u_image1:new l.aG(b,o.u_image1),u_brightness_low:new l.aH(b,o.u_brightness_low),u_brightness_high:new l.aH(b,o.u_brightness_high),u_saturation_factor:new l.aH(b,o.u_saturation_factor),u_contrast_factor:new l.aH(b,o.u_contrast_factor),u_spin_weights:new l.aK(b,o.u_spin_weights)}),symbolIcon:(b,o)=>({u_is_size_zoom_constant:new l.aG(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(b,o.u_is_size_feature_constant),u_size_t:new l.aH(b,o.u_size_t),u_size:new l.aH(b,o.u_size),u_camera_to_center_distance:new l.aH(b,o.u_camera_to_center_distance),u_pitch:new l.aH(b,o.u_pitch),u_rotate_symbol:new l.aG(b,o.u_rotate_symbol),u_aspect_ratio:new l.aH(b,o.u_aspect_ratio),u_fade_change:new l.aH(b,o.u_fade_change),u_matrix:new l.aI(b,o.u_matrix),u_label_plane_matrix:new l.aI(b,o.u_label_plane_matrix),u_coord_matrix:new l.aI(b,o.u_coord_matrix),u_is_text:new l.aG(b,o.u_is_text),u_pitch_with_map:new l.aG(b,o.u_pitch_with_map),u_texsize:new l.aL(b,o.u_texsize),u_texture:new l.aG(b,o.u_texture)}),symbolSDF:(b,o)=>({u_is_size_zoom_constant:new l.aG(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(b,o.u_is_size_feature_constant),u_size_t:new l.aH(b,o.u_size_t),u_size:new l.aH(b,o.u_size),u_camera_to_center_distance:new l.aH(b,o.u_camera_to_center_distance),u_pitch:new l.aH(b,o.u_pitch),u_rotate_symbol:new l.aG(b,o.u_rotate_symbol),u_aspect_ratio:new l.aH(b,o.u_aspect_ratio),u_fade_change:new l.aH(b,o.u_fade_change),u_matrix:new l.aI(b,o.u_matrix),u_label_plane_matrix:new l.aI(b,o.u_label_plane_matrix),u_coord_matrix:new l.aI(b,o.u_coord_matrix),u_is_text:new l.aG(b,o.u_is_text),u_pitch_with_map:new l.aG(b,o.u_pitch_with_map),u_texsize:new l.aL(b,o.u_texsize),u_texture:new l.aG(b,o.u_texture),u_gamma_scale:new l.aH(b,o.u_gamma_scale),u_device_pixel_ratio:new l.aH(b,o.u_device_pixel_ratio),u_is_halo:new l.aG(b,o.u_is_halo)}),symbolTextAndIcon:(b,o)=>({u_is_size_zoom_constant:new l.aG(b,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(b,o.u_is_size_feature_constant),u_size_t:new l.aH(b,o.u_size_t),u_size:new l.aH(b,o.u_size),u_camera_to_center_distance:new l.aH(b,o.u_camera_to_center_distance),u_pitch:new l.aH(b,o.u_pitch),u_rotate_symbol:new l.aG(b,o.u_rotate_symbol),u_aspect_ratio:new l.aH(b,o.u_aspect_ratio),u_fade_change:new l.aH(b,o.u_fade_change),u_matrix:new l.aI(b,o.u_matrix),u_label_plane_matrix:new l.aI(b,o.u_label_plane_matrix),u_coord_matrix:new l.aI(b,o.u_coord_matrix),u_is_text:new l.aG(b,o.u_is_text),u_pitch_with_map:new l.aG(b,o.u_pitch_with_map),u_texsize:new l.aL(b,o.u_texsize),u_texsize_icon:new l.aL(b,o.u_texsize_icon),u_texture:new l.aG(b,o.u_texture),u_texture_icon:new l.aG(b,o.u_texture_icon),u_gamma_scale:new l.aH(b,o.u_gamma_scale),u_device_pixel_ratio:new l.aH(b,o.u_device_pixel_ratio),u_is_halo:new l.aG(b,o.u_is_halo)}),background:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_opacity:new l.aH(b,o.u_opacity),u_color:new l.aM(b,o.u_color)}),backgroundPattern:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_opacity:new l.aH(b,o.u_opacity),u_image:new l.aG(b,o.u_image),u_pattern_tl_a:new l.aL(b,o.u_pattern_tl_a),u_pattern_br_a:new l.aL(b,o.u_pattern_br_a),u_pattern_tl_b:new l.aL(b,o.u_pattern_tl_b),u_pattern_br_b:new l.aL(b,o.u_pattern_br_b),u_texsize:new l.aL(b,o.u_texsize),u_mix:new l.aH(b,o.u_mix),u_pattern_size_a:new l.aL(b,o.u_pattern_size_a),u_pattern_size_b:new l.aL(b,o.u_pattern_size_b),u_scale_a:new l.aH(b,o.u_scale_a),u_scale_b:new l.aH(b,o.u_scale_b),u_pixel_coord_upper:new l.aL(b,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(b,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(b,o.u_tile_units_to_pixels)}),terrain:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_texture:new l.aG(b,o.u_texture),u_ele_delta:new l.aH(b,o.u_ele_delta)}),terrainDepth:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_ele_delta:new l.aH(b,o.u_ele_delta)}),terrainCoords:(b,o)=>({u_matrix:new l.aI(b,o.u_matrix),u_texture:new l.aG(b,o.u_texture),u_terrain_coords_id:new l.aH(b,o.u_terrain_coords_id),u_ele_delta:new l.aH(b,o.u_ele_delta)})};class rl{constructor(o,d,f){this.context=o;const g=o.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ld={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vs{constructor(o,d,f,g){this.length=d.length,this.attributes=f,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let f=0;f<this.attributes.length;f++){const g=d.attributes[this.attributes[f].name];g!==void 0&&o.enableVertexAttribArray(g)}}setVertexAttribPointers(o,d,f){for(let g=0;g<this.attributes.length;g++){const x=this.attributes[g],P=d.attributes[x.name];P!==void 0&&o.vertexAttribPointer(P,x.components,o[Ld[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ss=new WeakMap;function Yl(b){var o;if(ss.has(b))return ss.get(b);{const d=(o=b.getParameter(b.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return ss.set(b,d),d}}class ii{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Rd extends ii{getDefault(){return l.aO.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Ff extends ii{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Bf extends ii{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Dd extends ii{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class jf extends ii{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Vf extends ii{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class zd extends ii{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class v0 extends ii{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class b0 extends ii{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Xl extends ii{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class ow extends ii{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class aw extends ii{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class lw extends ii{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class cw extends ii{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class uw extends ii{getDefault(){return l.aO.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class hw extends ii{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Uf extends ii{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class Nd extends ii{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Gf extends ii{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class qf extends ii{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Ql extends ii{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class w0 extends ii{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class x0 extends ii{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Hf extends ii{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class sl extends ii{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class S0 extends ii{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ec extends ii{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class tc extends ii{getDefault(){return null}set(o){var d;if(o===this.current&&!this.dirty)return;const f=this.gl;Yl(f)?f.bindVertexArray(o):(d=f.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class T0 extends ii{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Wf extends ii{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class ri extends ii{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ic extends ii{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class dw extends ic{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class M0 extends ic{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Bu extends ic{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class pw{constructor(o,d,f,g,x){this.context=o,this.width=d,this.height=f;const P=o.gl,C=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new dw(o,C),g)this.depthAttachment=x?new Bu(o,C):new M0(o,C);else if(x)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const f=this.depthAttachment.get();f&&o.deleteRenderbuffer(f)}o.deleteFramebuffer(this.framebuffer)}}class sr{constructor(o,d,f){this.blendFunction=o,this.blendColor=d,this.mask=f}}sr.Replace=[1,0],sr.disabled=new sr(sr.Replace,l.aO.transparent,[!1,!1,!1,!1]),sr.unblended=new sr(sr.Replace,l.aO.transparent,[!0,!0,!0,!0]),sr.alphaBlended=new sr([1,771],l.aO.transparent,[!0,!0,!0,!0]);class I0{constructor(o){var d,f;if(this.gl=o,this.clearColor=new Rd(this),this.clearDepth=new Ff(this),this.clearStencil=new Bf(this),this.colorMask=new Dd(this),this.depthMask=new jf(this),this.stencilMask=new Vf(this),this.stencilFunc=new zd(this),this.stencilOp=new v0(this),this.stencilTest=new b0(this),this.depthRange=new Xl(this),this.depthTest=new ow(this),this.depthFunc=new aw(this),this.blend=new lw(this),this.blendFunc=new cw(this),this.blendColor=new uw(this),this.blendEquation=new hw(this),this.cullFace=new Uf(this),this.cullFaceSide=new Nd(this),this.frontFace=new Gf(this),this.program=new qf(this),this.activeTexture=new Ql(this),this.viewport=new w0(this),this.bindFramebuffer=new x0(this),this.bindRenderbuffer=new Hf(this),this.bindTexture=new sl(this),this.bindVertexBuffer=new S0(this),this.bindElementBuffer=new ec(this),this.bindVertexArray=new tc(this),this.pixelStoreUnpack=new T0(this),this.pixelStoreUnpackPremultiplyAlpha=new Wf(this),this.pixelStoreUnpackFlipY=new ri(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),Yl(o)){this.HALF_FLOAT=o.HALF_FLOAT;const g=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=o.RGBA16F)!==null&&d!==void 0?d:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(f=o.RGB16F)!==null&&f!==void 0?f:g==null?void 0:g.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const g=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new rl(this,o,d)}createVertexBuffer(o,d,f){return new Vs(this,o,d,f)}createRenderbuffer(o,d,f){const g=this.gl,x=g.createRenderbuffer();return this.bindRenderbuffer.set(x),g.renderbufferStorage(g.RENDERBUFFER,o,d,f),this.bindRenderbuffer.set(null),x}createFramebuffer(o,d,f,g){return new pw(this,o,d,f,g)}clear({color:o,depth:d,stencil:f}){const g=this.gl;let x=0;o&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),f!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),g.clear(x)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){l.aD(o.blendFunction,sr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return Yl(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var d;return Yl(this.gl)?this.gl.deleteVertexArray(o):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class ti{constructor(o,d,f){this.func=o,this.mask=d,this.range=f}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);const ju=7680;class Ii{constructor(o,d,f,g,x,P){this.test=o,this.ref=d,this.mask=f,this.fail=g,this.depthFail=x,this.pass=P}}Ii.disabled=new Ii({func:519,mask:0},0,0,ju,ju,ju);class Si{constructor(o,d,f){this.enable=o,this.mode=d,this.frontFace=f}}let rc;function Fd(b,o,d,f,g,x,P){const C=b.context,O=C.gl,D=b.useProgram("collisionBox"),F=[];let B=0,W=0;for(let oe=0;oe<f.length;oe++){const ge=f[oe],Ie=o.getTile(ge),Ee=Ie.getBucket(d);if(!Ee)continue;let Pe=ge.posMatrix;g[0]===0&&g[1]===0||(Pe=b.translatePosMatrix(ge.posMatrix,Ie,g,x));const Be=P?Ee.textCollisionBox:Ee.iconCollisionBox,ze=Ee.collisionCircleArray;if(ze.length>0){const Fe=l.F(),rt=Pe;l.aP(Fe,Ee.placementInvProjMatrix,b.transform.glCoordMatrix),l.aP(Fe,Fe,Ee.placementViewportMatrix),F.push({circleArray:ze,circleOffset:W,transform:rt,invTransform:Fe,coord:ge}),B+=ze.length/4,W=B}Be&&D.draw(C,O.LINES,ti.disabled,Ii.disabled,b.colorModeForRenderPass(),Si.disabled,iw(Pe,b.transform,Ie),b.style.map.terrain&&b.style.map.terrain.getTerrainData(ge),d.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,b.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!P||!F.length)return;const re=b.useProgram("collisionCircle"),te=new l.aQ;te.resize(4*B),te._trim();let ne=0;for(const oe of F)for(let ge=0;ge<oe.circleArray.length/4;ge++){const Ie=4*ge,Ee=oe.circleArray[Ie+0],Pe=oe.circleArray[Ie+1],Be=oe.circleArray[Ie+2],ze=oe.circleArray[Ie+3];te.emplace(ne++,Ee,Pe,Be,ze,0),te.emplace(ne++,Ee,Pe,Be,ze,1),te.emplace(ne++,Ee,Pe,Be,ze,2),te.emplace(ne++,Ee,Pe,Be,ze,3)}(!rc||rc.length<2*B)&&(rc=function(oe){const ge=2*oe,Ie=new l.aS;Ie.resize(ge),Ie._trim();for(let Ee=0;Ee<ge;Ee++){const Pe=6*Ee;Ie.uint16[Pe+0]=4*Ee+0,Ie.uint16[Pe+1]=4*Ee+1,Ie.uint16[Pe+2]=4*Ee+2,Ie.uint16[Pe+3]=4*Ee+2,Ie.uint16[Pe+4]=4*Ee+3,Ie.uint16[Pe+5]=4*Ee+0}return Ie}(B));const X=C.createIndexBuffer(rc,!0),he=C.createVertexBuffer(te,l.aR.members,!0);for(const oe of F){const ge={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(Me=b.transform).cameraToCenterDistance,u_viewport_size:[Me.width,Me.height]};re.draw(C,O.TRIANGLES,ti.disabled,Ii.disabled,b.colorModeForRenderPass(),Si.disabled,ge,b.style.map.terrain&&b.style.map.terrain.getTerrainData(oe.coord),d.id,he,X,l.$.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,b.transform.zoom,null,null,null)}var Me;he.destroy(),X.destroy()}Si.disabled=new Si(!1,1029,2305),Si.backCCW=new Si(!0,1029,2305);const E0=l.an(new Float32Array(16));function Bd(b,o,d,f,g,x){const{horizontalAlign:P,verticalAlign:C}=l.at(b);return new l.P((-(P-.5)*o/g+f[0])*x,(-(C-.5)*d/g+f[1])*x)}function jd(b,o,d,f,g,x,P,C,O,D,F){const B=b.text.placedSymbolArray,W=b.text.dynamicLayoutVertexArray,re=b.icon.dynamicLayoutVertexArray,te={};W.clear();for(let ne=0;ne<B.length;ne++){const X=B.get(ne),he=X.hidden||!X.crossTileID||b.allowVerticalPlacement&&!X.placedOrientation?null:f[X.crossTileID];if(he){const Me=new l.P(X.anchorX,X.anchorY),oe=ie(Me,d?P:x,F),ge=j(g.cameraToCenterDistance,oe.signedDistanceFromCamera);let Ie=l.ai(b.textSizeData,O,X)*ge/l.ao;d&&(Ie*=b.tilePixelRatio/C);const{width:Ee,height:Pe,anchor:Be,textOffset:ze,textBoxScale:Fe}=he,rt=Bd(Be,Ee,Pe,ze,Fe,Ie),$t=d?ie(Me.add(rt),x,F).point:oe.point.add(o?rt.rotate(-g.angle):rt),Je=b.allowVerticalPlacement&&X.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let St=0;St<X.numGlyphs;St++)l.aj(W,$t,Je);D&&X.associatedIconIndex>=0&&(te[X.associatedIconIndex]={shiftedAnchor:$t,angle:Je})}else ft(X.numGlyphs,W)}if(D){re.clear();const ne=b.icon.placedSymbolArray;for(let X=0;X<ne.length;X++){const he=ne.get(X);if(he.hidden)ft(he.numGlyphs,re);else{const Me=te[X];if(Me)for(let oe=0;oe<he.numGlyphs;oe++)l.aj(re,Me.shiftedAnchor,Me.angle);else ft(he.numGlyphs,re)}}b.icon.dynamicLayoutVertexBuffer.updateData(re)}b.text.dynamicLayoutVertexBuffer.updateData(W)}function Zf(b,o,d){return d.iconsInText&&o?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function k0(b,o,d,f,g,x,P,C,O,D,F,B){const W=b.context,re=W.gl,te=b.transform,ne=C==="map",X=O==="map",he=C!=="viewport"&&d.layout.get("symbol-placement")!=="point",Me=ne&&!X&&!he,oe=!d.layout.get("symbol-sort-key").isConstant();let ge=!1;const Ie=b.depthModeForSublayer(0,ti.ReadOnly),Ee=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Pe=[];for(const Be of f){const ze=o.getTile(Be),Fe=ze.getBucket(d);if(!Fe)continue;const rt=g?Fe.text:Fe.icon;if(!rt||!rt.segments.get().length||!rt.hasVisibleVertices)continue;const $t=rt.programConfigurations.get(d.id),Je=g||Fe.sdfIcons,St=g?Fe.textSizeData:Fe.iconSizeData,zt=X||te.pitch!==0,Yt=b.useProgram(Zf(Je,g,Fe),$t),kt=l.ag(St,te.zoom),jt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Be);let Vt,Fi,Ti,bs,ur=[0,0],Ei=null;if(g)Fi=ze.glyphAtlasTexture,Ti=re.LINEAR,Vt=ze.glyphAtlasTexture.size,Fe.iconsInText&&(ur=ze.imageAtlasTexture.size,Ei=ze.imageAtlasTexture,bs=zt||b.options.rotating||b.options.zooming||St.kind==="composite"||St.kind==="camera"?re.LINEAR:re.NEAREST);else{const Di=d.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;Fi=ze.imageAtlasTexture,Ti=Je||b.options.rotating||b.options.zooming||Di||zt?re.LINEAR:re.NEAREST,Vt=ze.imageAtlasTexture.size}const Hr=Ct(ze,1,b.transform.zoom),Cn=la(Be.posMatrix,X,ne,b.transform,Hr),to=So(Be.posMatrix,X,ne,b.transform,Hr),ul=Ee&&Fe.hasTextData(),hl=d.layout.get("icon-text-fit")!=="none"&&ul&&Fe.hasIconData();if(he){const Di=b.style.map.terrain?(Gs,Jt)=>b.style.map.terrain.getElevation(Be,Gs,Jt):null,Pr=d.layout.get("text-rotation-alignment")==="map";J(Fe,Be.posMatrix,b,g,Cn,to,X,D,Pr,Di)}const io=b.translatePosMatrix(Be.posMatrix,ze,x,P),$n=he||g&&Ee||hl?E0:Cn,Gi=b.translatePosMatrix(to,ze,x,P,!0),Oi=Je&&d.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Yi;Yi=Je?Fe.iconsInText?rw(St.kind,kt,Me,X,b,io,$n,Gi,Vt,ur):Kl(St.kind,kt,Me,X,b,io,$n,Gi,g,Vt,!0):Fu(St.kind,kt,Me,X,b,io,$n,Gi,g,Vt);const fc={program:Yt,buffers:rt,uniformValues:Yi,atlasTexture:Fi,atlasTextureIcon:Ei,atlasInterpolation:Ti,atlasInterpolationIcon:bs,isSDF:Je,hasHalo:Oi};if(oe&&Fe.canOverlap){ge=!0;const Di=rt.segments.get();for(const Pr of Di)Pe.push({segments:new l.$([Pr]),sortKey:Pr.sortKey,state:fc,terrainData:jt})}else Pe.push({segments:rt.segments,sortKey:0,state:fc,terrainData:jt})}ge&&Pe.sort((Be,ze)=>Be.sortKey-ze.sortKey);for(const Be of Pe){const ze=Be.state;if(W.activeTexture.set(re.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,re.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(W.activeTexture.set(re.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),ze.isSDF){const Fe=ze.uniformValues;ze.hasHalo&&(Fe.u_is_halo=1,Vd(ze.buffers,Be.segments,d,b,ze.program,Ie,F,B,Fe,Be.terrainData)),Fe.u_is_halo=0}Vd(ze.buffers,Be.segments,d,b,ze.program,Ie,F,B,ze.uniformValues,Be.terrainData)}}function Vd(b,o,d,f,g,x,P,C,O,D){const F=f.context;g.draw(F,F.gl.TRIANGLES,x,P,C,Si.disabled,O,D,d.id,b.layoutVertexBuffer,b.indexBuffer,o,d.paint,f.transform.zoom,b.programConfigurations.get(d.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function A0(b,o,d,f,g){if(!d||!f||!f.imageAtlas)return;const x=f.imageAtlas.patternPositions;let P=x[d.to.toString()],C=x[d.from.toString()];if(!P&&C&&(P=C),!C&&P&&(C=P),!P||!C){const O=g.getPaintProperty(o);P=x[O],C=x[O]}P&&C&&b.setConstantPatternPositions(P,C)}function Jf(b,o,d,f,g,x,P){const C=b.context.gl,O="fill-pattern",D=d.paint.get(O),F=D&&D.constantOr(1),B=d.getCrossfadeParameters();let W,re,te,ne,X;P?(re=F&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=C.LINES):(re=F?"fillPattern":"fill",W=C.TRIANGLES);const he=D.constantOr(null);for(const Me of f){const oe=o.getTile(Me);if(F&&!oe.patternsLoaded())continue;const ge=oe.getBucket(d);if(!ge)continue;const Ie=ge.programConfigurations.get(d.id),Ee=b.useProgram(re,Ie),Pe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Me);F&&(b.context.activeTexture.set(C.TEXTURE0),oe.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ie.updatePaintBuffers(B)),A0(Ie,O,he,oe,d);const Be=Pe?Me:null,ze=b.translatePosMatrix(Be?Be.posMatrix:Me.posMatrix,oe,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(P){ne=ge.indexBuffer2,X=ge.segments2;const Fe=[C.drawingBufferWidth,C.drawingBufferHeight];te=re==="fillOutlinePattern"&&F?tw(ze,b,B,oe,Fe):f0(ze,Fe)}else ne=ge.indexBuffer,X=ge.segments,te=F?p0(ze,b,B,oe):Ad(ze);Ee.draw(b.context,W,g,b.stencilModeForClipping(Me),x,Si.disabled,te,Pe,d.id,ge.layoutVertexBuffer,ne,X,d.paint,b.transform.zoom,Ie)}}function sc(b,o,d,f,g,x,P){const C=b.context,O=C.gl,D="fill-extrusion-pattern",F=d.paint.get(D),B=F.constantOr(1),W=d.getCrossfadeParameters(),re=d.paint.get("fill-extrusion-opacity"),te=F.constantOr(null);for(const ne of f){const X=o.getTile(ne),he=X.getBucket(d);if(!he)continue;const Me=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ne),oe=he.programConfigurations.get(d.id),ge=b.useProgram(B?"fillExtrusionPattern":"fillExtrusion",oe);B&&(b.context.activeTexture.set(O.TEXTURE0),X.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),oe.updatePaintBuffers(W)),A0(oe,D,te,X,d);const Ie=b.translatePosMatrix(ne.posMatrix,X,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ee=d.paint.get("fill-extrusion-vertical-gradient"),Pe=B?ew(Ie,b,Ee,re,ne,W,X):d0(Ie,b,Ee,re);ge.draw(C,C.gl.TRIANGLES,g,x,P,Si.backCCW,Pe,Me,d.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,d.paint,b.transform.zoom,oe,b.style.map.terrain&&he.centroidVertexBuffer)}}function Kf(b,o,d,f,g,x,P){const C=b.context,O=C.gl,D=d.fbo;if(!D)return;const F=b.useProgram("hillshade"),B=b.style.map.terrain&&b.style.map.terrain.getTerrainData(o);C.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,D.colorAttachment.get()),F.draw(C,O.TRIANGLES,g,x,P,Si.disabled,((W,re,te,ne)=>{const X=te.paint.get("hillshade-shadow-color"),he=te.paint.get("hillshade-highlight-color"),Me=te.paint.get("hillshade-accent-color");let oe=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=W.transform.angle);const ge=!W.options.moving;return{u_matrix:ne?ne.posMatrix:W.transform.calculatePosMatrix(re.tileID.toUnwrapped(),ge),u_image:0,u_latrange:g0(0,re.tileID),u_light:[te.paint.get("hillshade-exaggeration"),oe],u_shadow:X,u_highlight:he,u_accent:Me}})(b,d,f,B?o:null),B,f.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function P0(b,o,d,f,g,x){const P=b.context,C=P.gl,O=o.dem;if(O&&O.data){const D=O.dim,F=O.stride,B=O.getPixels();if(P.activeTexture.set(C.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||b.getTileTexture(F),o.demTexture){const re=o.demTexture;re.update(B,{premultiply:!1}),re.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else o.demTexture=new nt(P,B,C.RGBA,{premultiply:!1}),o.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);P.activeTexture.set(C.TEXTURE0);let W=o.fbo;if(!W){const re=new nt(P,{width:D,height:D,data:null},C.RGBA);re.bind(C.LINEAR,C.CLAMP_TO_EDGE),W=o.fbo=P.createFramebuffer(D,D,!0,!1),W.colorAttachment.set(re.texture)}P.bindFramebuffer.set(W.framebuffer),P.viewport.set([0,0,D,D]),b.useProgram("hillshadePrepare").draw(P,C.TRIANGLES,f,g,x,Si.disabled,((re,te)=>{const ne=te.stride,X=l.F();return l.aN(X,0,l.W,-l.W,0,0,1),l.H(X,X,[0,-l.W,0]),{u_matrix:X,u_image:1,u_dimension:[ne,ne],u_zoom:re.overscaledZ,u_unpack:te.getUnpackVector()}})(o.tileID,O),null,d.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function C0(b,o,d,f,g,x){const P=f.paint.get("raster-fade-duration");if(!x&&P>0){const C=E.now(),O=(C-b.timeAdded)/P,D=o?(C-o.timeAdded)/P:-1,F=d.getSource(),B=g.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),W=!o||Math.abs(o.tileID.overscaledZ-B)>Math.abs(b.tileID.overscaledZ-B),re=W&&b.refreshedUponExpiration?1:l.ac(W?O:1-D,0,1);return b.refreshedUponExpiration&&O>=1&&(b.refreshedUponExpiration=!1),o?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}const Ud=new l.aO(1,0,0,1),Yf=new l.aO(0,1,0,1),fw=new l.aO(0,0,1,1),$0=new l.aO(1,0,1,1),Ki=new l.aO(0,1,1,1);function ua(b,o,d,f){nc(b,0,o+d/2,b.transform.width,d,f)}function Us(b,o,d,f){nc(b,o-d/2,0,d,b.transform.height,f)}function nc(b,o,d,f,g,x){const P=b.context,C=P.gl;C.enable(C.SCISSOR_TEST),C.scissor(o*b.pixelRatio,d*b.pixelRatio,f*b.pixelRatio,g*b.pixelRatio),P.clear({color:x}),C.disable(C.SCISSOR_TEST)}function Xf(b,o,d){const f=b.context,g=f.gl,x=d.posMatrix,P=b.useProgram("debug"),C=ti.disabled,O=Ii.disabled,D=b.colorModeForRenderPass(),F="$debug",B=b.style.map.terrain&&b.style.map.terrain.getTerrainData(d);f.activeTexture.set(g.TEXTURE0);const W=o.getTileByID(d.key).latestRawTileData,re=Math.floor((W&&W.byteLength||0)/1024),te=o.getTile(d).tileSize,ne=512/Math.min(te,512)*(d.overscaledZ/b.transform.zoom)*.5;let X=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(X+=` => ${d.overscaledZ}`),function(he,Me){he.initDebugOverlayCanvas();const oe=he.debugOverlayCanvas,ge=he.context.gl,Ie=he.debugOverlayCanvas.getContext("2d");Ie.clearRect(0,0,oe.width,oe.height),Ie.shadowColor="white",Ie.shadowBlur=2,Ie.lineWidth=1.5,Ie.strokeStyle="white",Ie.textBaseline="top",Ie.font="bold 36px Open Sans, sans-serif",Ie.fillText(Me,5,5),Ie.strokeText(Me,5,5),he.debugOverlayTexture.update(oe),he.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}(b,`${X} ${re}kB`),P.draw(f,g.TRIANGLES,C,O,sr.alphaBlended,Si.disabled,Pd(x,l.aO.transparent,ne),null,F,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),P.draw(f,g.LINE_STRIP,C,O,D,Si.disabled,Pd(x,l.aO.red),B,F,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function Qf(b,o,d){const f=b.context,g=f.gl,x=b.colorModeForRenderPass(),P=new ti(g.LEQUAL,ti.ReadWrite,b.depthRangeFor3D),C=b.useProgram("terrain"),O=o.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,b.width,b.height]);for(const D of d){const F=b.renderToTexture.getTexture(D),B=o.getTerrainData(D.tileID);f.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,F.texture);const W={u_matrix:b.transform.calculatePosMatrix(D.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(b.transform.zoom)};C.draw(f,g.TRIANGLES,P,Ii.disabled,x,Si.backCCW,W,B,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}class oc{constructor(o,d){this.context=new I0(o),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ue.maxUnderzooming+Ue.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ji}resize(o,d,f){if(this.width=Math.floor(o*f),this.height=Math.floor(d*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const o=this.context,d=new l.aV;d.emplaceBack(0,0),d.emplaceBack(l.W,0),d.emplaceBack(0,l.W),d.emplaceBack(l.W,l.W),this.tileExtentBuffer=o.createVertexBuffer(d,Yn.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const f=new l.aV;f.emplaceBack(0,0),f.emplaceBack(l.W,0),f.emplaceBack(0,l.W),f.emplaceBack(l.W,l.W),this.debugBuffer=o.createVertexBuffer(f,Yn.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const g=new l.Z;g.emplaceBack(0,0,0,0),g.emplaceBack(l.W,0,l.W,0),g.emplaceBack(0,l.W,0,l.W),g.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=o.createVertexBuffer(g,Dr.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const x=new l.aV;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,Yn.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const P=new l.aW;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(P);const C=new l.aX;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(C);const O=this.context.gl;this.stencilClearMode=new Ii({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=l.F();l.aN(f,0,this.width,this.height,0,0,1),l.J(f,f,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,d.TRIANGLES,ti.disabled,this.stencilClearMode,sr.disabled,Si.disabled,Nf(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,d){if(this.currentStencilSource===o.source||!o.isTileClipped()||!d||!d.length)return;this.currentStencilSource=o.source;const f=this.context,g=f.gl;this.nextStencilID+d.length>256&&this.clearStencil(),f.setColorMode(sr.disabled),f.setDepthMode(ti.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of d){const C=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);x.draw(f,g.TRIANGLES,ti.disabled,new Ii({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),sr.disabled,Si.disabled,Nf(P.posMatrix),O,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new Ii({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){const d=this.context.gl;return new Ii({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,f=o.sort((P,C)=>C.overscaledZ-P.overscaledZ),g=f[f.length-1].overscaledZ,x=f[0].overscaledZ-g+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const P={};for(let C=0;C<x;C++)P[C+g]=new Ii({func:d.GEQUAL,mask:255},C+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=x,[P,f]}return[{[g]:Ii.disabled},f]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new sr([o.CONSTANT_COLOR,o.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?sr.unblended:sr.alphaBlended}depthModeForSublayer(o,d,f){if(!this.opaquePassEnabledForLayer())return ti.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new ti(f||this.context.gl.LEQUAL,d,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(E.now()),this.imageManager.beginFrame();const f=this.style._order,g=this.style.sourceCaches,x={},P={},C={};for(const O in g){const D=g[O];D.used&&D.prepare(this.context),x[O]=D.getVisibleCoordinates(),P[O]=x[O].slice().reverse(),C[O]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<f.length;O++)if(this.style._layers[f[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const O of f){const D=this.style._layers[O];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const F=P[D.source];(D.type==="custom"||F.length)&&this.renderLayer(this,g[D.source],D,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[f[this.currentLayer]],D=g[O.source],F=x[O.source];this._renderTileClippingMasks(O,F),this.renderLayer(this,D,O,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const O=this.style._layers[f[this.currentLayer]],D=g[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O))continue;const F=(O.type==="symbol"?C:P)[O.source];this._renderTileClippingMasks(O,x[O.source]),this.renderLayer(this,D,O,F)}if(this.options.showTileBoundaries){const O=function(D,F){let B=null;const W=Object.values(D._layers).flatMap(X=>X.source&&!X.isHidden(F)?[D.sourceCaches[X.source]]:[]),re=W.filter(X=>X.getSource().type==="vector"),te=W.filter(X=>X.getSource().type!=="vector"),ne=X=>{(!B||B.getSource().maxzoom<X.getSource().maxzoom)&&(B=X)};return re.forEach(X=>ne(X)),B||te.forEach(X=>ne(X)),B}(this.style,this.transform.zoom);O&&function(D,F,B){for(let W=0;W<B.length;W++)Xf(D,F,B[W])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const D=O.transform.padding;ua(O,O.transform.height-(D.top||0),3,Ud),ua(O,D.bottom||0,3,Yf),Us(O,D.left||0,3,fw),Us(O,O.transform.width-(D.right||0),3,$0);const F=O.transform.centerPoint;(function(B,W,re,te){nc(B,W-1,re-10,2,20,te),nc(B,W-10,re-1,20,2,te)})(O,F.x,O.transform.height-F.y,Ki)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,f=this.transform.projMatrix;let g=this.terrainFacilitator.dirty;g||(g=o?!l.aY(d,f):!l.aZ(d,f)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(l.a_(d,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(x,P){const C=x.context,O=C.gl,D=sr.unblended,F=new ti(O.LEQUAL,ti.ReadWrite,[0,1]),B=P.getTerrainMesh(),W=P.sourceCache.getRenderableTiles(),re=x.useProgram("terrainDepth");C.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),C.clear({color:l.aO.transparent,depth:1});for(const te of W){const ne=P.getTerrainData(te.tileID),X={u_matrix:x.transform.calculatePosMatrix(te.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(x.transform.zoom)};re.draw(C,O.TRIANGLES,F,Ii.disabled,D,Si.backCCW,X,ne,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain),function(x,P){const C=x.context,O=C.gl,D=sr.unblended,F=new ti(O.LEQUAL,ti.ReadWrite,[0,1]),B=P.getTerrainMesh(),W=P.getCoordsTexture(),re=P.sourceCache.getRenderableTiles(),te=x.useProgram("terrainCoords");C.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),C.clear({color:l.aO.transparent,depth:1}),P.coordsIndex=[];for(const ne of re){const X=P.getTerrainData(ne.tileID);C.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,W.texture);const he={u_matrix:x.transform.calculatePosMatrix(ne.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(x.transform.zoom)};te.draw(C,O.TRIANGLES,F,Ii.disabled,D,Si.backCCW,he,X,"terrain",B.vertexBuffer,B.indexBuffer,B.segments),P.coordsIndex.push(ne.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain))}renderLayer(o,d,f,g){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(g||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(x,P,C,O,D){if(x.renderPass!=="translucent")return;const F=Ii.disabled,B=x.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(W,re,te,ne,X,he,Me){const oe=re.transform,ge=X==="map",Ie=he==="map";for(const Ee of W){const Pe=ne.getTile(Ee),Be=Pe.getBucket(te);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const ze=l.ag(Be.textSizeData,oe.zoom),Fe=Ct(Pe,1,re.transform.zoom),rt=la(Ee.posMatrix,Ie,ge,re.transform,Fe),$t=te.layout.get("icon-text-fit")!=="none"&&Be.hasIconData();if(ze){const Je=Math.pow(2,oe.zoom-Pe.tileID.overscaledZ);jd(Be,ge,Ie,Me,oe,rt,Ee.posMatrix,Je,ze,$t,re.style.map.terrain?(St,zt)=>re.style.map.terrain.getElevation(Ee,St,zt):null)}}}(O,x,C,P,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),D),C.paint.get("icon-opacity").constantOr(1)!==0&&k0(x,P,C,O,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),F,B),C.paint.get("text-opacity").constantOr(1)!==0&&k0(x,P,C,O,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),F,B),P.map.showCollisionBoxes&&(Fd(x,P,C,O,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),!0),Fd(x,P,C,O,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),!1))})(o,d,f,g,this.style.placement.variableOffsets);break;case"circle":(function(x,P,C,O){if(x.renderPass!=="translucent")return;const D=C.paint.get("circle-opacity"),F=C.paint.get("circle-stroke-width"),B=C.paint.get("circle-stroke-opacity"),W=!C.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(F.constantOr(1)===0||B.constantOr(1)===0))return;const re=x.context,te=re.gl,ne=x.depthModeForSublayer(0,ti.ReadOnly),X=Ii.disabled,he=x.colorModeForRenderPass(),Me=[];for(let oe=0;oe<O.length;oe++){const ge=O[oe],Ie=P.getTile(ge),Ee=Ie.getBucket(C);if(!Ee)continue;const Pe=Ee.programConfigurations.get(C.id),Be=x.useProgram("circle",Pe),ze=Ee.layoutVertexBuffer,Fe=Ee.indexBuffer,rt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ge),$t={programConfiguration:Pe,program:Be,layoutVertexBuffer:ze,indexBuffer:Fe,uniformValues:m0(x,ge,Ie,C),terrainData:rt};if(W){const Je=Ee.segments.get();for(const St of Je)Me.push({segments:new l.$([St]),sortKey:St.sortKey,state:$t})}else Me.push({segments:Ee.segments,sortKey:0,state:$t})}W&&Me.sort((oe,ge)=>oe.sortKey-ge.sortKey);for(const oe of Me){const{programConfiguration:ge,program:Ie,layoutVertexBuffer:Ee,indexBuffer:Pe,uniformValues:Be,terrainData:ze}=oe.state;Ie.draw(re,te.TRIANGLES,ne,X,he,Si.disabled,Be,ze,C.id,Ee,Pe,oe.segments,C.paint,x.transform.zoom,ge)}})(o,d,f,g);break;case"heatmap":(function(x,P,C,O){if(C.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const D=x.context,F=D.gl,B=Ii.disabled,W=new sr([F.ONE,F.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(re,te,ne){const X=re.gl;re.activeTexture.set(X.TEXTURE1),re.viewport.set([0,0,te.width/4,te.height/4]);let he=ne.heatmapFbo;if(he)X.bindTexture(X.TEXTURE_2D,he.colorAttachment.get()),re.bindFramebuffer.set(he.framebuffer);else{const Me=X.createTexture();X.bindTexture(X.TEXTURE_2D,Me),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),he=ne.heatmapFbo=re.createFramebuffer(te.width/4,te.height/4,!1,!1),function(oe,ge,Ie,Ee){var Pe,Be;const ze=oe.gl,Fe=(Pe=oe.HALF_FLOAT)!==null&&Pe!==void 0?Pe:ze.UNSIGNED_BYTE,rt=(Be=oe.RGBA16F)!==null&&Be!==void 0?Be:ze.RGBA;ze.texImage2D(ze.TEXTURE_2D,0,rt,ge.width/4,ge.height/4,0,ze.RGBA,Fe,null),Ee.colorAttachment.set(Ie)}(re,te,Me,he)}})(D,x,C),D.clear({color:l.aO.transparent});for(let re=0;re<O.length;re++){const te=O[re];if(P.hasRenderableParent(te))continue;const ne=P.getTile(te),X=ne.getBucket(C);if(!X)continue;const he=X.programConfigurations.get(C.id),Me=x.useProgram("heatmap",he),{zoom:oe}=x.transform;Me.draw(D,F.TRIANGLES,ti.disabled,B,W,Si.disabled,y0(te.posMatrix,ne,oe,C.paint.get("heatmap-intensity")),null,C.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,C.paint,x.transform.zoom,he)}D.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),function(D,F){const B=D.context,W=B.gl,re=F.heatmapFbo;if(!re)return;B.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,re.colorAttachment.get()),B.activeTexture.set(W.TEXTURE1);let te=F.colorRampTexture;te||(te=F.colorRampTexture=new nt(B,F.colorRamp,W.RGBA)),te.bind(W.LINEAR,W.CLAMP_TO_EDGE),D.useProgram("heatmapTexture").draw(B,W.TRIANGLES,ti.disabled,Ii.disabled,D.colorModeForRenderPass(),Si.disabled,((ne,X,he,Me)=>{const oe=l.F();l.aN(oe,0,ne.width,ne.height,0,0,1);const ge=ne.context.gl;return{u_matrix:oe,u_world:[ge.drawingBufferWidth,ge.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}})(D,F),null,F.id,D.viewportBuffer,D.quadTriangleIndexBuffer,D.viewportSegments,F.paint,D.transform.zoom)}(x,C))})(o,d,f,g);break;case"line":(function(x,P,C,O){if(x.renderPass!=="translucent")return;const D=C.paint.get("line-opacity"),F=C.paint.get("line-width");if(D.constantOr(1)===0||F.constantOr(1)===0)return;const B=x.depthModeForSublayer(0,ti.ReadOnly),W=x.colorModeForRenderPass(),re=C.paint.get("line-dasharray"),te=C.paint.get("line-pattern"),ne=te.constantOr(1),X=C.paint.get("line-gradient"),he=C.getCrossfadeParameters(),Me=ne?"linePattern":re?"lineSDF":X?"lineGradient":"line",oe=x.context,ge=oe.gl;let Ie=!0;for(const Ee of O){const Pe=P.getTile(Ee);if(ne&&!Pe.patternsLoaded())continue;const Be=Pe.getBucket(C);if(!Be)continue;const ze=Be.programConfigurations.get(C.id),Fe=x.context.program.get(),rt=x.useProgram(Me,ze),$t=Ie||rt.program!==Fe,Je=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ee),St=te.constantOr(null);if(St&&Pe.imageAtlas){const kt=Pe.imageAtlas,jt=kt.patternPositions[St.to.toString()],Vt=kt.patternPositions[St.from.toString()];jt&&Vt&&ze.setConstantPatternPositions(jt,Vt)}const zt=Je?Ee:null,Yt=ne?$d(x,Pe,C,he,zt):re?pn(x,Pe,C,re,he,zt):X?il(x,Pe,C,Be.lineClipsArray.length,zt):Cd(x,Pe,C,zt);if(ne)oe.activeTexture.set(ge.TEXTURE0),Pe.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),ze.updatePaintBuffers(he);else if(re&&($t||x.lineAtlas.dirty))oe.activeTexture.set(ge.TEXTURE0),x.lineAtlas.bind(oe);else if(X){const kt=Be.gradients[C.id];let jt=kt.texture;if(C.gradientVersion!==kt.version){let Vt=256;if(C.stepInterpolant){const Fi=P.getSource().maxzoom,Ti=Ee.canonical.z===Fi?Math.ceil(1<<x.transform.maxZoom-Ee.canonical.z):1;Vt=l.ac(l.aT(Be.maxLineLength/l.W*1024*Ti),256,oe.maxTextureSize)}kt.gradient=l.aU({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:Vt,image:kt.gradient||void 0,clips:Be.lineClipsArray}),kt.texture?kt.texture.update(kt.gradient):kt.texture=new nt(oe,kt.gradient,ge.RGBA),kt.version=C.gradientVersion,jt=kt.texture}oe.activeTexture.set(ge.TEXTURE0),jt.bind(C.stepInterpolant?ge.NEAREST:ge.LINEAR,ge.CLAMP_TO_EDGE)}rt.draw(oe,ge.TRIANGLES,B,x.stencilModeForClipping(Ee),W,Si.disabled,Yt,Je,C.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,C.paint,x.transform.zoom,ze,Be.layoutVertexBuffer2),Ie=!1}})(o,d,f,g);break;case"fill":(function(x,P,C,O){const D=C.paint.get("fill-color"),F=C.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const B=x.colorModeForRenderPass(),W=C.paint.get("fill-pattern"),re=x.opaquePassEnabledForLayer()&&!W.constantOr(1)&&D.constantOr(l.aO.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===re){const te=x.depthModeForSublayer(1,x.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);Jf(x,P,C,O,te,B,!1)}if(x.renderPass==="translucent"&&C.paint.get("fill-antialias")){const te=x.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);Jf(x,P,C,O,te,B,!0)}})(o,d,f,g);break;case"fill-extrusion":(function(x,P,C,O){const D=C.paint.get("fill-extrusion-opacity");if(D!==0&&x.renderPass==="translucent"){const F=new ti(x.context.gl.LEQUAL,ti.ReadWrite,x.depthRangeFor3D);if(D!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))sc(x,P,C,O,F,Ii.disabled,sr.disabled),sc(x,P,C,O,F,x.stencilModeFor3D(),x.colorModeForRenderPass());else{const B=x.colorModeForRenderPass();sc(x,P,C,O,F,Ii.disabled,B)}}})(o,d,f,g);break;case"hillshade":(function(x,P,C,O){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const D=x.context,F=x.depthModeForSublayer(0,ti.ReadOnly),B=x.colorModeForRenderPass(),[W,re]=x.renderPass==="translucent"?x.stencilConfigForOverlap(O):[{},O];for(const te of re){const ne=P.getTile(te);ne.needsHillshadePrepare!==void 0&&ne.needsHillshadePrepare&&x.renderPass==="offscreen"?P0(x,ne,C,F,Ii.disabled,B):x.renderPass==="translucent"&&Kf(x,te,ne,C,F,W[te.overscaledZ],B)}D.viewport.set([0,0,x.width,x.height])})(o,d,f,g);break;case"raster":(function(x,P,C,O){if(x.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!O.length)return;const D=x.context,F=D.gl,B=P.getSource(),W=x.useProgram("raster"),re=x.colorModeForRenderPass(),[te,ne]=B instanceof Kn?[{},O]:x.stencilConfigForOverlap(O),X=ne[ne.length-1].overscaledZ,he=!x.options.moving;for(const Me of ne){const oe=x.depthModeForSublayer(Me.overscaledZ-X,C.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,F.LESS),ge=P.getTile(Me);ge.registerFadeDuration(C.paint.get("raster-fade-duration"));const Ie=P.findLoadedParent(Me,0),Ee=C0(ge,Ie,P,C,x.transform,x.style.map.terrain);let Pe,Be;const ze=C.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;D.activeTexture.set(F.TEXTURE0),ge.texture.bind(ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(F.TEXTURE1),Ie?(Ie.texture.bind(ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Pe=Math.pow(2,Ie.tileID.overscaledZ-ge.tileID.overscaledZ),Be=[ge.tileID.canonical.x*Pe%1,ge.tileID.canonical.y*Pe%1]):ge.texture.bind(ze,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const Fe=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Me),rt=Fe?Me:null,$t=rt?rt.posMatrix:x.transform.calculatePosMatrix(Me.toUnwrapped(),he),Je=Nu($t,Be||[0,0],Pe||1,Ee,C);B instanceof Kn?W.draw(D,F.TRIANGLES,oe,Ii.disabled,re,Si.disabled,Je,Fe,C.id,B.boundsBuffer,x.quadTriangleIndexBuffer,B.boundsSegments):W.draw(D,F.TRIANGLES,oe,te[Me.overscaledZ],re,Si.disabled,Je,Fe,C.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}})(o,d,f,g);break;case"background":(function(x,P,C,O){const D=C.paint.get("background-color"),F=C.paint.get("background-opacity");if(F===0)return;const B=x.context,W=B.gl,re=x.transform,te=re.tileSize,ne=C.paint.get("background-pattern");if(x.isPatternMissing(ne))return;const X=!ne&&D.a===1&&F===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==X)return;const he=Ii.disabled,Me=x.depthModeForSublayer(0,X==="opaque"?ti.ReadWrite:ti.ReadOnly),oe=x.colorModeForRenderPass(),ge=x.useProgram(ne?"backgroundPattern":"background"),Ie=O||re.coveringTiles({tileSize:te,terrain:x.style.map.terrain});ne&&(B.activeTexture.set(W.TEXTURE0),x.imageManager.bind(x.context));const Ee=C.getCrossfadeParameters();for(const Pe of Ie){const Be=O?Pe.posMatrix:x.transform.calculatePosMatrix(Pe.toUnwrapped()),ze=ne?_0(Be,F,x,ne,{tileID:Pe,tileSize:te},Ee):sw(Be,F,D),Fe=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Pe);ge.draw(B,W.TRIANGLES,Me,he,oe,Si.disabled,ze,Fe,C.id,x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}})(o,0,f,g);break;case"custom":(function(x,P,C){const O=x.context,D=C.implementation;if(x.renderPass==="offscreen"){const F=D.prerender;F&&(x.setCustomLayerDefaults(),O.setColorMode(x.colorModeForRenderPass()),F.call(D,O.gl,x.transform.customLayerMatrix()),O.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),O.setColorMode(x.colorModeForRenderPass()),O.setStencilMode(Ii.disabled);const F=D.renderingMode==="3d"?new ti(x.context.gl.LEQUAL,ti.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,ti.ReadOnly);O.setDepthMode(F),D.render(O.gl,x.transform.customLayerMatrix()),O.setDirty(),x.setBaseState(),O.bindFramebuffer.set(null)}})(o,0,f)}}translatePosMatrix(o,d,f,g,x){if(!f[0]&&!f[1])return o;const P=x?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(P){const D=Math.sin(P),F=Math.cos(P);f=[f[0]*F-f[1]*D,f[0]*D+f[1]*F]}const C=[x?f[0]:Ct(d,f[0],this.transform.zoom),x?f[1]:Ct(d,f[1],this.transform.zoom),0],O=new Float32Array(16);return l.H(O,o,C),O}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),f=this.imageManager.getPattern(o.to.toString());return!d||!f}useProgram(o,d){this.cache=this.cache||{};const f=o+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new zf(this.context,Jl[o],d,nw[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new nt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:d}=this.context.gl;return this.width!==o||this.height!==d}}class nl{constructor(o,d){this.points=o,this.planes=d}static fromInvProjectionMatrix(o,d,f){const g=Math.pow(2,f),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const O=1/(C=l.af([],C,o))[3]/d*g;return l.a$(C,C,[O,O,1/C[3],O])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const O=function(W,re){var te=re[0],ne=re[1],X=re[2],he=te*te+ne*ne+X*X;return he>0&&(he=1/Math.sqrt(he)),W[0]=re[0]*he,W[1]=re[1]*he,W[2]=re[2]*he,W}([],function(W,re,te){var ne=re[0],X=re[1],he=re[2],Me=te[0],oe=te[1],ge=te[2];return W[0]=X*ge-he*oe,W[1]=he*Me-ne*ge,W[2]=ne*oe-X*Me,W}([],lt([],x[C[0]],x[C[1]]),lt([],x[C[2]],x[C[1]]))),D=-((F=O)[0]*(B=x[C[1]])[0]+F[1]*B[1]+F[2]*B[2]);var F,B;return O.concat(D)});return new nl(x,P)}}class ac{constructor(o,d){this.min=o,this.max=d,this.center=function(f,g,x){return f[0]=.5*g[0],f[1]=.5*g[1],f[2]=.5*g[2],f}([],function(f,g,x){return f[0]=g[0]+x[0],f[1]=g[1]+x[1],f[2]=g[2]+x[2],f}([],this.min,this.max))}quadrant(o){const d=[o%2==0,o<2],f=Ve(this.min),g=Ve(this.max);for(let x=0;x<d.length;x++)f[x]=d[x]?this.min[x]:this.center[x],g[x]=d[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new ac(f,g)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let g=0;g<o.planes.length;g++){const x=o.planes[g];let P=0;for(let C=0;C<d.length;C++)l.b0(x,d[C])>=0&&P++;if(P===0)return 0;P!==d.length&&(f=!1)}if(f)return 2;for(let g=0;g<3;g++){let x=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let C=0;C<o.points.length;C++){const O=o.points[C][g]-this.min[g];x=Math.min(x,O),P=Math.max(P,O)}if(P<0||x>this.max[g]-this.min[g])return 0}return 1}}class Vu{constructor(o=0,d=0,f=0,g=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=f,this.right=g}interpolate(o,d,f){return d.top!=null&&o.top!=null&&(this.top=l.z.number(o.top,d.top,f)),d.bottom!=null&&o.bottom!=null&&(this.bottom=l.z.number(o.bottom,d.bottom,f)),d.left!=null&&o.left!=null&&(this.left=l.z.number(o.left,d.left,f)),d.right!=null&&o.right!=null&&(this.right=l.z.number(o.right,d.right,f)),this}getCenter(o,d){const f=l.ac((this.left+o-this.right)/2,0,o),g=l.ac((this.top+d-this.bottom)/2,0,d);return new l.P(f,g)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Vu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const em=85.051129;class Gd{constructor(o,d,f,g,x){this.tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=f??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Vu,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new Gd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const d=-l.b1(o,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var f=new l.A(4);return l.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,g,x){var P=g[0],C=g[1],O=g[2],D=g[3],F=Math.sin(x),B=Math.cos(x);f[0]=P*B+O*F,f[1]=C*B+D*F,f[2]=P*-F+O*B,f[3]=C*-F+D*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=l.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,f){this._unmodified=!1,this._edgeInsets.interpolate(o,d,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new l.b2(0,o)];if(this._renderWorldCopies){const f=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),x=this.pointCoordinate(new l.P(this.width,this.height)),P=this.pointCoordinate(new l.P(0,this.height)),C=Math.floor(Math.min(f.x,g.x,x.x,P.x)),O=Math.floor(Math.max(f.x,g.x,x.x,P.x)),D=1;for(let F=C-D;F<=O+D;F++)F!==0&&d.push(new l.b2(F,o))}return d}coveringTiles(o){var d,f;let g=this.coveringZoomLevel(o);const x=g;if(o.minzoom!==void 0&&g<o.minzoom)return[];o.maxzoom!==void 0&&g>o.maxzoom&&(g=o.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),C=l.Y.fromLngLat(this.center),O=Math.pow(2,g),D=[O*P.x,O*P.y,0],F=[O*C.x,O*C.y,0],B=nl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let W=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=g);const re=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,te=oe=>({aabb:new ac([oe*O,0,0],[(oe+1)*O,O,0]),zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),ne=[],X=[],he=g,Me=o.reparseOverscaled?x:g;if(this._renderWorldCopies)for(let oe=1;oe<=3;oe++)ne.push(te(-oe)),ne.push(te(oe));for(ne.push(te(0));ne.length>0;){const oe=ne.pop(),ge=oe.x,Ie=oe.y;let Ee=oe.fullyVisible;if(!Ee){const rt=oe.aabb.intersects(B);if(rt===0)continue;Ee=rt===2}const Pe=o.terrain?D:F,Be=oe.aabb.distanceX(Pe),ze=oe.aabb.distanceY(Pe),Fe=Math.max(Math.abs(Be),Math.abs(ze));if(oe.zoom===he||Fe>re+(1<<he-oe.zoom)-2&&oe.zoom>=W){const rt=he-oe.zoom,$t=D[0]-.5-(ge<<rt),Je=D[1]-.5-(Ie<<rt);X.push({tileID:new l.Q(oe.zoom===he?Me:oe.zoom,oe.wrap,oe.zoom,ge,Ie),distanceSq:ct([F[0]-.5-ge,F[1]-.5-Ie]),tileDistanceToCamera:Math.sqrt($t*$t+Je*Je)})}else for(let rt=0;rt<4;rt++){const $t=(ge<<1)+rt%2,Je=(Ie<<1)+(rt>>1),St=oe.zoom+1;let zt=oe.aabb.quadrant(rt);if(o.terrain){const Yt=new l.Q(St,oe.wrap,St,$t,Je),kt=o.terrain.getMinMaxElevation(Yt),jt=(d=kt.minElevation)!==null&&d!==void 0?d:this.elevation,Vt=(f=kt.maxElevation)!==null&&f!==void 0?f:this.elevation;zt=new ac([zt.min[0],zt.min[1],jt],[zt.max[0],zt.max[1],Vt])}ne.push({aabb:zt,zoom:St,x:$t,y:Je,wrap:oe.wrap,fullyVisible:Ee})}}return X.sort((oe,ge)=>oe.distanceSq-ge.distanceSq).map(oe=>oe.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=l.ac(o.lat,-85.051129,em);return new l.P(l.N(o.lng)*this.worldSize,l.O(d)*this.worldSize)}unproject(o){return new l.Y(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const d=this.elevation,f=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,o),x=o.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-x))return;const P=f+d-x,C=Math.cos(this._pitch)*this.cameraToCenterDistance/P/l.b3(1,g.lat),O=this.scaleZoom(C/this.tileSize);this._elevation=x,this._center=g,this.zoom=O}setLocationAtPoint(o,d){const f=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o),P=new l.Y(x.x-(f.x-g.x),x.y-(f.y-g.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,d){return d?this.coordinatePoint(this.locationCoordinate(o),d.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,d){return this.coordinateLocation(this.pointCoordinate(o,d))}locationCoordinate(o){return l.Y.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,d){if(d){const W=d.pointCoordinate(o);if(W!=null)return W}const f=[o.x,o.y,0,1],g=[o.x,o.y,1,1];l.af(f,f,this.pixelMatrixInverse),l.af(g,g,this.pixelMatrixInverse);const x=f[3],P=g[3],C=f[1]/x,O=g[1]/P,D=f[2]/x,F=g[2]/P,B=D===F?0:(0-D)/(F-D);return new l.Y(l.z.number(f[0]/x,g[0]/P,B)/this.worldSize,l.z.number(C,O,B)/this.worldSize)}coordinatePoint(o,d=0,f=this.pixelMatrix){const g=[o.x*this.worldSize,o.y*this.worldSize,d,1];return l.af(g,g,f),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new vr().extend(this.pointLocation(new l.P(0,o))).extend(this.pointLocation(new l.P(this.width,o))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new vr([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,em])}calculatePosMatrix(o,d=!1){const f=o.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];const x=o.canonical,P=this.worldSize/this.zoomScale(x.z),C=x.x+Math.pow(2,x.z)*o.wrap,O=l.an(new Float64Array(16));return l.H(O,O,[C*P,x.y*P,0]),l.J(O,O,[P/l.W,P/l.W,1]),l.K(O,d?this.alignedProjMatrix:this.projMatrix,O),g[f]=new Float32Array(O),g[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,d){d=l.ac(+d,this.minZoom,this.maxZoom);const f={center:new l.M(o.lng,o.lat),zoom:d};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const oe=179.9999999999;g=[-oe,oe]}const x=this.tileSize*this.zoomScale(f.zoom);let P=0,C=x,O=0,D=x,F=0,B=0;const{x:W,y:re}=this.size;if(this.latRange){const oe=this.latRange;P=l.O(oe[1])*x,C=l.O(oe[0])*x,C-P<re&&(F=re/(C-P))}g&&(O=l.b1(l.N(g[0])*x,0,x),D=l.b1(l.N(g[1])*x,0,x),D<O&&(D+=x),D-O<W&&(B=W/(D-O)));const{x:te,y:ne}=this.project.call({worldSize:x},o);let X,he;const Me=Math.max(B||0,F||0);if(Me){const oe=new l.P(B?(D+O)/2:te,F?(C+P)/2:ne);return f.center=this.unproject.call({worldSize:x},oe).wrap(),f.zoom+=this.scaleZoom(Me),f}if(this.latRange){const oe=re/2;ne-oe<P&&(he=P+oe),ne+oe>C&&(he=C-oe)}if(g){const oe=(O+D)/2;let ge=te;this._renderWorldCopies&&(ge=l.b1(te,oe-x/2,oe+x/2));const Ie=W/2;ge-Ie<O&&(X=O+Ie),ge+Ie>D&&(X=D-Ie)}if(X!==void 0||he!==void 0){const oe=new l.P(X??te,he??ne);f.center=this.unproject.call({worldSize:x},oe).wrap()}return f}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:d,zoom:f}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=f,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let g=l.an(new Float64Array(16));l.J(g,g,[this.width/2,-this.height/2,1]),l.H(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.an(new Float64Array(16)),l.J(g,g,[1,-1,1]),l.H(g,g,[-1,-1,0]),l.J(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const x=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),C=x-P*this._pixelPerMeter/Math.cos(this._pitch),O=P<0?C:x,D=Math.PI/2+this._pitch,F=this._fov*(.5+o.y/this.height),B=Math.sin(F)*O/Math.sin(l.ac(Math.PI-D-F,.01,Math.PI-.01)),W=this.getHorizon(),re=2*Math.atan(W/this.cameraToCenterDistance)*(.5+o.y/(2*W)),te=Math.sin(re)*O/Math.sin(l.ac(Math.PI-D-re,.01,Math.PI-.01)),ne=Math.min(B,te),X=1.01*(Math.cos(Math.PI/2-this._pitch)*ne+O),he=this.height/50;g=new Float64Array(16),l.b4(g,this._fov,this.width/this.height,he,X),g[8]=2*-o.x/this.width,g[9]=2*o.y/this.height,l.J(g,g,[1,-1,1]),l.H(g,g,[0,0,-this.cameraToCenterDistance]),l.b5(g,g,this._pitch),l.ad(g,g,this.angle),l.H(g,g,[-d,-f,0]),this.mercatorMatrix=l.J([],g,[this.worldSize,this.worldSize,this.worldSize]),l.J(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,g),l.H(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=l.ar([],g),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,g);const Me=this.width%2/2,oe=this.height%2/2,ge=Math.cos(this.angle),Ie=Math.sin(this.angle),Ee=d-Math.round(d)+ge*Me+Ie*oe,Pe=f-Math.round(f)+ge*oe+Ie*Me,Be=new Float64Array(g);if(l.H(Be,Be,[Ee>.5?Ee-1:Ee,Pe>.5?Pe-1:Pe,0]),this.alignedProjMatrix=Be,g=l.ar(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new l.P(0,0)),d=[o.x*this.worldSize,o.y*this.worldSize,0,1];return l.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,o))}getCameraQueryGeometry(o){const d=this.getCameraPoint();if(o.length===1)return[o[0],d];{let f=d.x,g=d.y,x=d.x,P=d.y;for(const C of o)f=Math.min(f,C.x),g=Math.min(g,C.y),x=Math.max(x,C.x),P=Math.max(P,C.y);return[new l.P(f,g),new l.P(x,g),new l.P(x,P),new l.P(f,P),new l.P(f,g)]}}lngLatToCameraDepth(o,d){const f=this.locationCoordinate(o),g=[f.x*this.worldSize,f.y*this.worldSize,d,1];return l.af(g,g,this.projMatrix),g[2]/g[3]}}function tm(b,o){let d,f=!1,g=null,x=null;const P=()=>{g=null,f&&(b.apply(x,d),g=setTimeout(P,o),f=!1)};return(...C)=>(f=!0,x=this,d=C,g||P(),g)}class im{constructor(o){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let f;return d.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(f=g)}),(f&&f[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:f,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=tm(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const d=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,g),P=Math.round(d.lng*x)/x,C=Math.round(d.lat*x)/x,O=this._map.getBearing(),D=this._map.getPitch();let F="";if(F+=o?`/${P}/${C}/${f}`:`${f}/${C}/${P}`,(O||D)&&(F+="/"+Math.round(10*O)/10),D&&(F+=`/${Math.round(D)}`),this._hashName){const B=this._hashName;let W=!1;const re=window.location.hash.slice(1).split("&").map(te=>{const ne=te.split("=")[0];return ne===B?(W=!0,`${ne}=${F}`):te}).filter(te=>te);return W||re.push(`${B}=${F}`),`#${re.join("&")}`}return`#${F}`}}const Qn={linearity:.3,easing:l.b6(0,0,.3,1)},O0=l.e({deceleration:2500,maxSpeed:1400},Qn),L0=l.e({deceleration:20,maxSpeed:1400},Qn),R0=l.e({deceleration:1e3,maxSpeed:360},Qn),D0=l.e({deceleration:1e3,maxSpeed:90},Qn);class z0{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:E.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=E.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)d.zoom+=x.zoomDelta||0,d.bearing+=x.bearingDelta||0,d.pitch+=x.pitchDelta||0,x.panDelta&&d.pan._add(x.panDelta),x.around&&(d.around=x.around),x.pinchAround&&(d.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(d.pan.mag()){const x=Gu(d.pan.mag(),f,l.e({},O0,o||{}));g.offset=d.pan.mult(x.amount/d.pan.mag()),g.center=this._map.transform.center,Uu(g,x)}if(d.zoom){const x=Gu(d.zoom,f,L0);g.zoom=this._map.transform.zoom+x.amount,Uu(g,x)}if(d.bearing){const x=Gu(d.bearing,f,R0);g.bearing=this._map.transform.bearing+l.ac(x.amount,-179,179),Uu(g,x)}if(d.pitch){const x=Gu(d.pitch,f,D0);g.pitch=this._map.transform.pitch+x.amount,Uu(g,x)}if(g.zoom||g.bearing){const x=d.pinchAround===void 0?d.around:d.pinchAround;g.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function Uu(b,o){(!b.duration||b.duration<o.duration)&&(b.duration=o.duration,b.easing=o.easing)}function Gu(b,o,d){const{maxSpeed:f,linearity:g,deceleration:x}=d,P=l.ac(b*g/(o/1e3),-f,f),C=Math.abs(P)/(x*g);return{easing:d.easing,duration:1e3*C,amount:P*(C/2)}}class Ar extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,f,g={}){const x=A.mousePos(d.getCanvas(),f),P=d.unproject(x);super(o,l.e({point:x,lngLat:P,originalEvent:f},g)),this._defaultPrevented=!1,this.target=d}}class lc extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,f){const g=o==="touchend"?f.changedTouches:f.touches,x=A.touchPos(d.getCanvasContainer(),g),P=x.map(O=>d.unproject(O)),C=x.reduce((O,D,F,B)=>O.add(D.div(B.length)),new l.P(0,0));super(o,{points:x,point:C,lngLats:P,lngLat:d.unproject(C),originalEvent:f}),this._defaultPrevented=!1}}class fn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,f){super(o,{originalEvent:f}),this._defaultPrevented=!1}}class eo{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new fn(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Ar(o.type,this._map,o))}mouseup(o){this._map.fire(new Ar(o.type,this._map,o))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ar(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Ar(o.type,this._map,o))}mouseover(o){this._map.fire(new Ar(o.type,this._map,o))}mouseout(o){this._map.fire(new Ar(o.type,this._map,o))}touchstart(o){return this._firePreventable(new lc(o.type,this._map,o))}touchmove(o){this._map.fire(new lc(o.type,this._map,o))}touchend(o){this._map.fire(new lc(o.type,this._map,o))}touchcancel(o){this._map.fire(new lc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class N0{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Ar(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Ar(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _s{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(l.P.convert(o),this._map.terrain)}}class cc{constructor(o,d){this._map=o,this._tr=new _s(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(A.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const f=d;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=f,this._box||(this._box=A.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(g.x,f.x),P=Math.max(g.x,f.x),C=Math.min(g.y,f.y),O=Math.max(g.y,f.y);A.setTransform(this._box,`translate(${x}px,${C}px)`),this._box.style.width=P-x+"px",this._box.style.height=O-C+"px"}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const f=this._startPos,g=d;if(this.reset(),A.suppressClick(),f.x!==g.x||f.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(f,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(A.remove(this._box),this._box=null),A.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new l.k(o,{originalEvent:d}))}}function rm(b,o){if(b.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${o.length}`);const d={};for(let f=0;f<b.length;f++)d[b[f].identifier]=o[f];return d}class mw{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,d,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const x=new l.P(0,0);for(const P of g)x._add(P);return x.div(g.length)}(d),this.touches=rm(f,d)))}touchmove(o,d,f){if(this.aborted||!this.centroid)return;const g=rm(f,d);for(const x in this.touches){const P=g[x];(!P||P.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(o,d,f){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class sm{constructor(o){this.singleTap=new mw(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,d,f){this.singleTap.touchstart(o,d,f)}touchmove(o,d,f){this.singleTap.touchmove(o,d,f)}touchend(o,d,f){const g=this.singleTap.touchend(o,d,f);if(g){const x=o.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(g)<30;if(x&&P||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class F0{constructor(o){this._tr=new _s(o),this._zoomIn=new sm({numTouches:1,numTaps:2}),this._zoomOut=new sm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,f){this._zoomIn.touchstart(o,d,f),this._zoomOut.touchstart(o,d,f)}touchmove(o,d,f){this._zoomIn.touchmove(o,d,f),this._zoomOut.touchmove(o,d,f)}touchend(o,d,f){const g=this._zoomIn.touchend(o,d,f),x=this._zoomOut.touchend(o,d,f),P=this._tr;return g?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(g)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class To{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const d=this._moveFunction(...o);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(o,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,d){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const g=d.length?d[0]:d;return!this._moved&&g.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(f,g))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&A.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ha={0:1,2:2};class st{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const d=A.mouseButton(o);this._eventButton=d}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(d,f){const g=ha[f];return d.buttons===void 0||(d.buttons&g)!==g}(o,this._eventButton)}isValidEndEvent(o){return A.mouseButton(o)===this._eventButton}}class nm{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const ol=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=function(o){o.preventDefault()}},uc=({enable:b,clickTolerance:o,bearingDegreesPerPixelMoved:d=.8})=>{const f=new st({checkCorrectEvent:g=>A.mouseButton(g)===0&&g.ctrlKey||A.mouseButton(g)===2});return new To({clickTolerance:o,move:(g,x)=>({bearingDelta:(x.x-g.x)*d}),moveStateManager:f,enable:b,assignEvents:ol})},om=({enable:b,clickTolerance:o,pitchDegreesPerPixelMoved:d=-.5})=>{const f=new st({checkCorrectEvent:g=>A.mouseButton(g)===0&&g.ctrlKey||A.mouseButton(g)===2});return new To({clickTolerance:o,move:(g,x)=>({pitchDelta:(x.y-g.y)*d}),moveStateManager:f,enable:b,assignEvents:ol})};class tt{constructor(o,d){this._clickTolerance=o.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(o,d,f){return this._calculateTransform(o,d,f)}touchmove(o,d,f){if(this._active&&!(f.length<this.minTouchs()))return o.preventDefault(),this._calculateTransform(o,d,f)}touchend(o,d,f){this._calculateTransform(o,d,f),this._active&&f.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,f){f.length>0&&(this._active=!0);const g=rm(f,d),x=new l.P(0,0),P=new l.P(0,0);let C=0;for(const D in g){const F=g[D],B=this._touches[D];B&&(x._add(F),P._add(F.sub(B)),C++,g[D]=F)}if(this._touches=g,C<this.minTouchs()||!P.mag())return;const O=P.div(C);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,d,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,f){if(!this._firstTwoTouches)return;o.preventDefault();const[g,x]=this._firstTwoTouches,P=qd(f,d,g),C=qd(f,d,x);if(!P||!C)return;const O=this._aroundCenter?null:P.add(C).div(2);return this._move([P,C],O,o)}touchend(o,d,f){if(!this._firstTwoTouches)return;const[g,x]=this._firstTwoTouches,P=qd(f,d,g),C=qd(f,d,x);P&&C||(this._active&&A.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function qd(b,o,d){for(let f=0;f<b.length;f++)if(b[f].identifier===d)return o[f]}function B0(b,o){return Math.log(b/o)/Math.LN2}class Hd extends qu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const f=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(B0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:B0(this._distance,f),pinchAround:d}}}function am(b,o){return 180*b.angleWith(o)/Math.PI}class lm extends qu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d,f){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:am(this._vector,g),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,f=am(o,this._startVector);return Math.abs(f)<d}}function cm(b){return Math.abs(b.y)>Math.abs(b.x)}class j0 extends qu{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,d,f){super.touchstart(o,d,f),this._currentTouchCount=f.length}_start(o){this._lastPoints=o,cm(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,x,f.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(o,d,f){if(this._valid!==void 0)return this._valid;const g=o.mag()>=2,x=d.mag()>=2;if(!g&&!x)return;if(!g||!x)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const P=o.y>0==d.y>0;return cm(o)&&cm(d)&&P}}const al={panStep:100,bearingStep:15,pitchStep:10};class $i{constructor(o){this._tr=new _s(o);const d=al;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,f=0,g=0,x=0,P=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?f=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?f=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?g=1:(o.preventDefault(),P=-1);break;case 40:o.shiftKey?g=-1:(o.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:C=>{const O=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Wd,zoom:d?Math.round(O.zoom)+d*(o.shiftKey?2:1):O.zoom,bearing:O.bearing+f*this._bearingStep,pitch:O.pitch+g*this._pitchStep,offset:[-x*this._panStep,-P*this._panStep],center:O.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wd(b){return b*(2-b)}const Zd=4.000244140625;class um{constructor(o,d){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=o,this._tr=new _s(o),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!o[this._map.cooperativeGestures._bypassKey])return;let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const f=E.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,d!==0&&d%Zd==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=A.mousePos(this._map.getCanvas(),o),f=this._tr;this._around=d.y>f.transform.height/2-f.transform.getHorizon()?l.M.convert(this._aroundCenter?f.center:f.unproject(d)):l.M.convert(f.center),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Zd?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&O!==0&&(O=1/O);const D=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(D*O))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,f=this._startZoom,g=this._easing;let x,P=!1;if(this._type==="wheel"&&f&&g){const C=Math.min((E.now()-this._lastWheelEventTime)/200,1),O=g(C);x=l.z.number(f,d,O),C<1?this._frameId||(this._frameId=!0):P=!0}else x=d,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:x-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=l.b7;if(this._prevEase){const f=this._prevEase,g=(E.now()-f.start)/f.duration,x=f.easing(g+.01)-f.easing(g),P=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-P*P);d=l.b6(P,C,.25,1)}return this._prevEase={start:E.now(),duration:o,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class hm{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class V0{constructor(o){this._tr=new _s(o),this.reset()}reset(){this._active=!1}dblclick(o,d){return o.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yw{constructor(){this._tap=new sm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,d,f){if(!this._swipePoint)if(this._tapTime){const g=d[0],x=o.timeStamp-this._tapTime<500,P=this._tapPoint.dist(g)<30;x&&P?f.length>0&&(this._swipePoint=g,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(o,d,f)}touchmove(o,d,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=d[0],x=g.y-this._swipePoint.y;return this._swipePoint=g,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,d,f)}touchend(o,d,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const g=this._tap.touchend(o,d,f);g&&(this._tapTime=o.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class An{constructor(o,d,f){this._el=o,this._mousePan=d,this._touchPan=f}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hu{constructor(o,d,f){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class yt{constructor(o,d,f,g){this._el=o,this._touchZoom=d,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class bt{constructor(o,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=A.create("div","maplibregl-cooperative-gesture-screen",o);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=d,this._container.appendChild(g);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=f,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(A.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(o){this._onCooperativeGesture(o.touches.length===1)}wheel(o){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!o[this._bypassKey])}_onCooperativeGesture(o){this._enabled&&o&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ll=b=>b.zoom||b.drag||b.pitch||b.rotate;class dm extends l.k{}function Wu(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class vs{constructor(o,d){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,x)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=g.type==="renderFrame"?void 0:g,C={needsRenderFrame:!1},O={},D={},F=g.touches,B=F?this._getMapTouches(F):void 0,W=B?A.touchPos(this._map.getCanvas(),B):A.mousePos(this._map.getCanvas(),g);for(const{handlerName:ne,handler:X,allowed:he}of this._handlers){if(!X.isEnabled())continue;let Me;this._blockedByActive(D,he,ne)?X.reset():X[x||g.type]&&(Me=X[x||g.type](g,W,B),this.mergeHandlerResult(C,O,Me,ne,P),Me&&Me.needsRenderFrame&&this._triggerRenderFrame()),(Me||X.isActive())&&(D[ne]=X)}const re={};for(const ne in this._previousActiveHandlers)D[ne]||(re[ne]=P);this._previousActiveHandlers=D,(Object.keys(re).length||Wu(C))&&(this._changes.push([C,O,re]),this._triggerRenderFrame()),(Object.keys(D).length||Wu(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:te}=C;te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],te(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new z0(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,x,P]of this._listeners)A.addEventListener(g,x,g===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[o,d,f]of this._listeners)A.removeEventListener(o,d,o===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(o){const d=this._map,f=d.getCanvasContainer();this._add("mapEvent",new eo(d,o));const g=d.boxZoom=new cc(d,o);this._add("boxZoom",g),o.interactive&&o.boxZoom&&g.enable();const x=d.cooperativeGestures=new bt(d,o.cooperativeGestures);this._add("cooperativeGestures",x),o.cooperativeGestures&&x.enable();const P=new F0(d),C=new V0(d);d.doubleClickZoom=new hm(C,P),this._add("tapZoom",P),this._add("clickZoom",C),o.interactive&&o.doubleClickZoom&&d.doubleClickZoom.enable();const O=new yw;this._add("tapDragZoom",O);const D=d.touchPitch=new j0(d);this._add("touchPitch",D),o.interactive&&o.touchPitch&&d.touchPitch.enable(o.touchPitch);const F=uc(o),B=om(o);d.dragRotate=new Hu(o,F,B),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]),o.interactive&&o.dragRotate&&d.dragRotate.enable();const W=(({enable:Me,clickTolerance:oe})=>{const ge=new st({checkCorrectEvent:Ie=>A.mouseButton(Ie)===0&&!Ie.ctrlKey});return new To({clickTolerance:oe,move:(Ie,Ee)=>({around:Ee,panDelta:Ee.sub(Ie)}),activateOnStart:!0,moveStateManager:ge,enable:Me,assignEvents:ol})})(o),re=new tt(o,d);d.dragPan=new An(f,W,re),this._add("mousePan",W),this._add("touchPan",re,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&d.dragPan.enable(o.dragPan);const te=new lm,ne=new Hd;d.touchZoomRotate=new yt(f,ne,te,O),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&d.touchZoomRotate.enable(o.touchZoomRotate);const X=d.scrollZoom=new um(d,()=>this._triggerRenderFrame());this._add("scrollZoom",X,["mousePan"]),o.interactive&&o.scrollZoom&&d.scrollZoom.enable(o.scrollZoom);const he=d.keyboard=new $i(d);this._add("keyboard",he),o.interactive&&o.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new N0(d))}_add(o,d,f){this._handlers.push({handlerName:o,handler:d,allowed:f}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ll(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,f){for(const g in o)if(g!==f&&(!d||d.indexOf(g)<0))return!0;return!1}_getMapTouches(o){const d=[];for(const f of o)this._el.contains(f.target)&&d.push(f);return d}mergeHandlerResult(o,d,f,g,x){if(!f)return;l.e(o,f);const P={handlerName:g,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(d.zoom=P),f.panDelta!==void 0&&(d.drag=P),f.pitchDelta!==void 0&&(d.pitch=P),f.bearingDelta!==void 0&&(d.rotate=P)}_applyChanges(){const o={},d={},f={};for(const[g,x,P]of this._changes)g.panDelta&&(o.panDelta=(o.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(o.around=g.around),g.pinchAround!==void 0&&(o.pinchAround=g.pinchAround),g.noInertia&&(o.noInertia=g.noInertia),l.e(d,x),l.e(f,P);this._updateMapTransform(o,d,f),this._changes=[]}_updateMapTransform(o,d,f){const g=this._map,x=g._getTransformForUpdate(),P=g.terrain;if(!(Wu(o)||P&&this._terrainMovement))return this._fireEvents(d,f,!0);let{panDelta:C,zoomDelta:O,bearingDelta:D,pitchDelta:F,around:B,pinchAround:W}=o;W!==void 0&&(B=W),g._stop(!0),B=B||g.transform.centerPoint;const re=x.pointLocation(C?B.sub(C):B);D&&(x.bearing+=D),F&&(x.pitch+=F),O&&(x.zoom+=O),P?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?x.center=x.pointLocation(x.centerPoint.sub(C)):x.setLocationAtPoint(re,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,x.setLocationAtPoint(re,B),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,x.recalculateZoom(g.terrain)})):x.setLocationAtPoint(re,B),g._applyUpdatedTransform(x),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,f,!0)}_fireEvents(o,d,f){const g=ll(this._eventsInProgress),x=ll(o),P={};for(const F in o){const{originalEvent:B}=o[F];this._eventsInProgress[F]||(P[`${F}start`]=B),this._eventsInProgress[F]=o[F]}!g&&x&&this._fireEvent("movestart",x.originalEvent);for(const F in P)this._fireEvent(F,P[F]);x&&this._fireEvent("move",x.originalEvent);for(const F in o){const{originalEvent:B}=o[F];this._fireEvent(F,B)}const C={};let O;for(const F in this._eventsInProgress){const{handlerName:B,originalEvent:W}=this._eventsInProgress[F];this._handlersById[B].isActive()||(delete this._eventsInProgress[F],O=d[B]||W,C[`${F}end`]=O)}for(const F in C)this._fireEvent(F,C[F]);const D=ll(this._eventsInProgress);if(f&&(g||x)&&!D){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;!F||!F.essential&&E.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:O})),B(this._map.getBearing())&&this._map.resetNorth()):(B(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new l.k(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new dm("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class U0 extends l.E{constructor(o,d){super(),this._renderFrameCallback=()=>{const f=Math.min((E.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,f){return o=l.P.convert(o).mult(-1),this.panTo(this.transform.center,l.e({offset:o},d),f)}panTo(o,d,f){return this.easeTo(l.e({center:o},d),f)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,f){return this.easeTo(l.e({zoom:o},d),f)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,f){return this.easeTo(l.e({bearing:o},d),f)}resetNorth(o,d){return this.rotateTo(0,l.e({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=vr.convert(o);const f=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),f,d)}_cameraForBoxAndBearing(o,d,f,g){const x={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const rt=g.padding;g.padding={top:rt,bottom:rt,right:rt,left:rt}}g.padding=l.e(x,g.padding);const P=this.transform,C=P.padding,O=new vr(o,d),D=P.project(O.getNorthWest()),F=P.project(O.getNorthEast()),B=P.project(O.getSouthEast()),W=P.project(O.getSouthWest()),re=l.b8(-f),te=D.rotate(re),ne=F.rotate(re),X=B.rotate(re),he=W.rotate(re),Me=new l.P(Math.max(te.x,ne.x,he.x,X.x),Math.max(te.y,ne.y,he.y,X.y)),oe=new l.P(Math.min(te.x,ne.x,he.x,X.x),Math.min(te.y,ne.y,he.y,X.y)),ge=Me.sub(oe),Ie=(P.width-(C.left+C.right+g.padding.left+g.padding.right))/ge.x,Ee=(P.height-(C.top+C.bottom+g.padding.top+g.padding.bottom))/ge.y;if(Ee<0||Ie<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Pe=Math.min(P.scaleZoom(P.scale*Math.min(Ie,Ee)),g.maxZoom),Be=l.P.convert(g.offset),ze=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(l.b8(f)),Fe=Be.add(ze).mult(P.scale/P.zoomScale(Pe));return{center:P.unproject(D.add(B).div(2).sub(Fe)),zoom:Pe,bearing:f}}fitBounds(o,d,f){return this._fitInternal(this.cameraForBounds(o,d),d,f)}fitScreenCoordinates(o,d,f,g,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(o)),this.transform.pointLocation(l.P.convert(d)),f,g),g,x)}_fitInternal(o,d,f){return o?(delete(d=l.e(o,d)).padding,d.linear?this.easeTo(d,f):this.flyTo(d,f)):this}jumpTo(o,d){this.stop();const f=this._getTransformForUpdate();let g=!1,x=!1,P=!1;return"zoom"in o&&f.zoom!==+o.zoom&&(g=!0,f.zoom=+o.zoom),o.center!==void 0&&(f.center=l.M.convert(o.center)),"bearing"in o&&f.bearing!==+o.bearing&&(x=!0,f.bearing=+o.bearing),"pitch"in o&&f.pitch!==+o.pitch&&(P=!0,f.pitch=+o.pitch),o.padding==null||f.isPaddingEqual(o.padding)||(f.padding=o.padding),this._applyUpdatedTransform(f),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),g&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),x&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),P&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(o,d,f,g=0){const x=l.Y.fromLngLat(o,d),P=l.Y.fromLngLat(f,g),C=P.x-x.x,O=P.y-x.y,D=P.z-x.z,F=Math.hypot(C,O,D);if(F===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(C,O),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),re=180*Math.atan2(C,-O)/Math.PI;let te=180*Math.acos(B/F)/Math.PI;return te=D<0?90-te:90+te,{center:P.toLngLat(),zoom:W,pitch:te,bearing:re}}easeTo(o,d){var f;this._stop(!1,o.easeId),((o=l.e({offset:[0,0],duration:500,easing:l.b7},o)).animate===!1||!o.essential&&E.prefersReducedMotion)&&(o.duration=0);const g=this._getTransformForUpdate(),x=this.getZoom(),P=this.getBearing(),C=this.getPitch(),O=this.getPadding(),D="bearing"in o?this._normalizeBearing(o.bearing,P):P,F="pitch"in o?+o.pitch:C,B="padding"in o?o.padding:g.padding,W=l.P.convert(o.offset);let re=g.centerPoint.add(W);const te=g.pointLocation(re),{center:ne,zoom:X}=g.getConstrained(l.M.convert(o.center||te),(f=o.zoom)!==null&&f!==void 0?f:x);this._normalizeCenter(ne);const he=g.project(te),Me=g.project(ne).sub(he),oe=g.zoomScale(X-x);let ge,Ie;o.around&&(ge=l.M.convert(o.around),Ie=g.locationPoint(ge));const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||X!==x,this._rotating=this._rotating||P!==D,this._pitching=this._pitching||F!==C,this._padding=!g.isPaddingEqual(B),this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,Ee),this.terrain&&this._prepareElevation(ne),this._ease(Pe=>{if(this._zooming&&(g.zoom=l.z.number(x,X,Pe)),this._rotating&&(g.bearing=l.z.number(P,D,Pe)),this._pitching&&(g.pitch=l.z.number(C,F,Pe)),this._padding&&(g.interpolatePadding(O,B,Pe),re=g.centerPoint.add(W)),this.terrain&&!o.freezeElevation&&this._updateElevation(Pe),ge)g.setLocationAtPoint(ge,Ie);else{const Be=g.zoomScale(g.zoom-x),ze=X>x?Math.min(2,oe):Math.max(.5,oe),Fe=Math.pow(ze,1-Pe),rt=g.unproject(he.add(Me.mult(Pe*Fe)).mult(Be));g.setLocationAtPoint(g.renderWorldCopies?rt.wrap():rt,re)}this._applyUpdatedTransform(g),this._fireMoveEvents(d)},Pe=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,Pe)},o),this}_prepareEase(o,d,f={}){this._moving=!0,d||f.moving||this.fire(new l.k("movestart",o)),this._zooming&&!f.zooming&&this.fire(new l.k("zoomstart",o)),this._rotating&&!f.rotating&&this.fire(new l.k("rotatestart",o)),this._pitching&&!f.pitching&&this.fire(new l.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&d!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(f-(d-(f*o+this._elevationStart))/(1-o)),this._elevationTarget=d}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const d=o.clone(),{center:f,zoom:g,pitch:x,bearing:P,elevation:C}=this.transformCameraUpdate(d);f&&(d.center=f),g!==void 0&&(d.zoom=g),x!==void 0&&(d.pitch=x),P!==void 0&&(d.bearing=P),C!==void 0&&(d.elevation=C),this.transform.apply(d)}_fireMoveEvents(o){this.fire(new l.k("move",o)),this._zooming&&this.fire(new l.k("zoom",o)),this._rotating&&this.fire(new l.k("rotate",o)),this._pitching&&this.fire(new l.k("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const f=this._zooming,g=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new l.k("zoomend",o)),g&&this.fire(new l.k("rotateend",o)),x&&this.fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}flyTo(o,d){var f;if(!o.essential&&E.prefersReducedMotion){const Yt=l.L(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Yt,d)}this.stop(),o=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},o);const g=this._getTransformForUpdate(),x=this.getZoom(),P=this.getBearing(),C=this.getPitch(),O=this.getPadding(),D="bearing"in o?this._normalizeBearing(o.bearing,P):P,F="pitch"in o?+o.pitch:C,B="padding"in o?o.padding:g.padding,W=l.P.convert(o.offset);let re=g.centerPoint.add(W);const te=g.pointLocation(re),{center:ne,zoom:X}=g.getConstrained(l.M.convert(o.center||te),(f=o.zoom)!==null&&f!==void 0?f:x);this._normalizeCenter(ne);const he=g.zoomScale(X-x),Me=g.project(te),oe=g.project(ne).sub(Me);let ge=o.curve;const Ie=Math.max(g.width,g.height),Ee=Ie/he,Pe=oe.mag();if("minZoom"in o){const Yt=l.ac(Math.min(o.minZoom,x,X),g.minZoom,g.maxZoom),kt=Ie/g.zoomScale(Yt-x);ge=Math.sqrt(kt/Pe*2)}const Be=ge*ge;function ze(Yt){const kt=(Ee*Ee-Ie*Ie+(Yt?-1:1)*Be*Be*Pe*Pe)/(2*(Yt?Ee:Ie)*Be*Pe);return Math.log(Math.sqrt(kt*kt+1)-kt)}function Fe(Yt){return(Math.exp(Yt)-Math.exp(-Yt))/2}function rt(Yt){return(Math.exp(Yt)+Math.exp(-Yt))/2}const $t=ze(!1);let Je=function(Yt){return rt($t)/rt($t+ge*Yt)},St=function(Yt){return Ie*((rt($t)*(Fe(kt=$t+ge*Yt)/rt(kt))-Fe($t))/Be)/Pe;var kt},zt=(ze(!0)-$t)/ge;if(Math.abs(Pe)<1e-6||!isFinite(zt)){if(Math.abs(Ie-Ee)<1e-6)return this.easeTo(o,d);const Yt=Ee<Ie?-1:1;zt=Math.abs(Math.log(Ee/Ie))/ge,St=function(){return 0},Je=function(kt){return Math.exp(Yt*ge*kt)}}return o.duration="duration"in o?+o.duration:1e3*zt/("screenSpeed"in o?+o.screenSpeed/ge:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=P!==D,this._pitching=F!==C,this._padding=!g.isPaddingEqual(B),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(ne),this._ease(Yt=>{const kt=Yt*zt,jt=1/Je(kt);g.zoom=Yt===1?X:x+g.scaleZoom(jt),this._rotating&&(g.bearing=l.z.number(P,D,Yt)),this._pitching&&(g.pitch=l.z.number(C,F,Yt)),this._padding&&(g.interpolatePadding(O,B,Yt),re=g.centerPoint.add(W)),this.terrain&&!o.freezeElevation&&this._updateElevation(Yt);const Vt=Yt===1?ne:g.unproject(Me.add(oe.mult(St(kt))).mult(jt));g.setLocationAtPoint(g.renderWorldCopies?Vt.wrap():Vt,re),this._applyUpdatedTransform(g),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,d)}if(!o){const f=this.handlers;f&&f.stop(!1)}return this}_ease(o,d,f){f.animate===!1||f.duration===0?(o(1),d()):(this._easeStart=E.now(),this._easeOptions=f,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,d){o=l.b1(o,-180,180);const f=Math.abs(o-d);return Math.abs(o-360-d)<f&&(o-=360),Math.abs(o+360-d)<f&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const f=o.lng-d.center.lng;o.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const Pn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class G0{constructor(o=Pn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=A.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=A.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){A.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const f=this._map._getUIString(`AttributionControl.${d}`);o.title=f,o.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const d=this._map.style.sourceCaches;for(const g in d){const x=d[g];if(x.used||x.usedForTerrain){const P=x.getSource();P.attribution&&o.indexOf(P.attribution)<0&&o.push(P.attribution)}}o=o.filter(g=>String(g).trim()),o.sort((g,x)=>g.length-x.length),o=o.filter((g,x)=>{for(let P=x+1;P<o.length;P++)if(o[P].indexOf(g)>=0)return!1;return!0});const f=o.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,o.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class hc{constructor(o={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const f=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=A.create("div","maplibregl-ctrl");const d=A.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){A.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ui{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,f=d?this._queue.concat(d):this._queue;for(const g of f)if(g.id===o)return void(g.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const f of d)if(!f.cancelled&&(f.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var nr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class q0 extends l.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,d){this.sourceCache.update(o,d),this._renderableTilesKeys=[];const f={};for(const g of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))f[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aN(g.posMatrix,0,l.W,0,l.W,0,1),this._tiles[g.key]=new ys(g,this.tileSize));for(const g in this._tiles)f[g]||delete this._tiles[g]}freeRtt(o){for(const d in this._tiles){const f=this._tiles[d];(!o||f.tileID.equals(o)||f.tileID.isChildOf(o)||o.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const d={};for(const f of this._renderableTilesKeys){const g=this._tiles[f].tileID;if(g.canonical.equals(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16),l.aN(x.posMatrix,0,l.W,0,l.W,0,1),d[f]=x}else if(g.canonical.isChildOf(o.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const P=g.canonical.z-o.canonical.z,C=g.canonical.x-(g.canonical.x>>P<<P),O=g.canonical.y-(g.canonical.y>>P<<P),D=l.W>>P;l.aN(x.posMatrix,0,D,0,D,0,1),l.H(x.posMatrix,x.posMatrix,[-C*D,-O*D,0]),d[f]=x}else if(o.canonical.isChildOf(g.canonical)){const x=o.clone();x.posMatrix=new Float64Array(16);const P=o.canonical.z-g.canonical.z,C=o.canonical.x-(o.canonical.x>>P<<P),O=o.canonical.y-(o.canonical.y>>P<<P),D=l.W>>P;l.aN(x.posMatrix,0,l.W,0,l.W,0,1),l.H(x.posMatrix,x.posMatrix,[C*D,O*D,0]),l.J(x.posMatrix,x.posMatrix,[1/2**P,1/2**P,0]),d[f]=x}}return d}getSourceTile(o,d){const f=this.sourceCache._source;let g=o.overscaledZ-this.deltaZoom;if(g>f.maxzoom&&(g=f.maxzoom),g<f.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(g).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!x||!x.dem)&&d)for(;g>=f.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(o.scaledTo(g--).key);return x}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=o)}}class Zu{constructor(o,d,f){this.painter=o,this.sourceCache=new q0(d),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,d,f,g=l.W){var x;if(!(d>=0&&d<g&&f>=0&&f<g))return 0;const P=this.getTerrainData(o),C=(x=P.tile)===null||x===void 0?void 0:x.dem;if(!C)return 0;const O=function(te,ne,X){var he=ne[0],Me=ne[1];return te[0]=X[0]*he+X[4]*Me+X[12],te[1]=X[1]*he+X[5]*Me+X[13],te}([],[d/g*l.W,f/g*l.W],P.u_terrain_matrix),D=[O[0]*C.dim,O[1]*C.dim],F=Math.floor(D[0]),B=Math.floor(D[1]),W=D[0]-F,re=D[1]-B;return C.get(F,B)*(1-W)*(1-re)+C.get(F+1,B)*W*(1-re)+C.get(F,B+1)*(1-W)*re+C.get(F+1,B+1)*W*re}getElevationForLngLatZoom(o,d){const{tileID:f,mercatorX:g,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(o,d);return this.getElevation(f,g%l.W,x%l.W,l.W)}getElevation(o,d,f,g=l.W){return this.getDEMElevation(o,d,f,g)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const g=this.painter.context,x=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new nt(g,x,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new nt(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const d=this.sourceCache.getSourceTile(o,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const g=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new nt(g,d.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),d.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const f=d&&d+d.tileID.key+o.key;if(f&&!this._demMatrixCache[f]){const g=this.sourceCache.sourceCache._source.maxzoom;let x=o.canonical.z-d.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=g?x=o.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=o.canonical.x-(o.canonical.x>>x<<x),C=o.canonical.y-(o.canonical.y>>x<<x),O=l.b9(new Float64Array(16),[1/(l.W<<x),1/(l.W<<x),0]);l.H(O,O,[P*l.W,C*l.W,0]),this._demMatrixCache[o.key]={matrix:O,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(o){const d=this.painter,f=d.width/devicePixelRatio,g=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new nt(d.context,{width:f,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new nt(d.context,{width:f,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(f,g,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,f,g))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,P=0;x<this._coordsTextureSize;x++)for(let C=0;C<this._coordsTextureSize;C++,P+=4)d[P+0]=255&C,d[P+1]=255&x,d[P+2]=C>>8<<4|x>>8,d[P+3]=0;const f=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),g=new nt(o,f,o.gl.RGBA,{premultiply:!1});return g.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),f=this.painter.context,g=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),f.bindFramebuffer.set(null);const x=d[0]+(d[2]>>4<<8),P=d[1]+((15&d[2])<<8),C=this.coordsIndex[255-d[3]],O=C&&this.sourceCache.getTileByID(C);if(!O)return null;const D=this._coordsTextureSize,F=(1<<O.tileID.canonical.z)*D;return new l.Y((O.tileID.canonical.x*D+x)/F+O.tileID.wrap,(O.tileID.canonical.y*D+P)/F,this.getElevation(O.tileID,x,P,D))}depthAtPoint(o){const d=new Uint8Array(4),f=this.painter.context,g=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),f.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,d=new l.ba,f=new l.aX,g=this.meshSize,x=l.W/g,P=g*g;for(let B=0;B<=g;B++)for(let W=0;W<=g;W++)d.emplaceBack(W*x,B*x,0);for(let B=0;B<P;B+=g+1)for(let W=0;W<g;W++)f.emplaceBack(W+B,g+W+B+1,g+W+B+2),f.emplaceBack(W+B,g+W+B+2,W+B+1);const C=d.length,O=C+2*(g+1);for(const B of[0,1])for(let W=0;W<=g;W++)for(const re of[0,1])d.emplaceBack(W*x,B*l.W,re);for(let B=0;B<2*g;B+=2)f.emplaceBack(O+B,O+B+1,O+B+3),f.emplaceBack(O+B,O+B+3,O+B+2),f.emplaceBack(C+B,C+B+3,C+B+1),f.emplaceBack(C+B,C+B+2,C+B+3);const D=d.length,F=D+2*(g+1);for(const B of[0,1])for(let W=0;W<=g;W++)for(const re of[0,1])d.emplaceBack(B*l.W,W*x,re);for(let B=0;B<2*g;B+=2)f.emplaceBack(D+B,D+B+1,D+B+3),f.emplaceBack(D+B,D+B+3,D+B+2),f.emplaceBack(F+B,F+B+3,F+B+1),f.emplaceBack(F+B,F+B+2,F+B+3);return this._mesh={indexBuffer:o.createIndexBuffer(f),vertexBuffer:o.createVertexBuffer(d,nr.members),segments:l.$.simpleSegment(0,0,d.length,f.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*l.bb/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,d){var f;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(o,d);return(f=this.getMinMaxElevation(g).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(o){const d=this.getTerrainData(o).tile,f={minElevation:null,maxElevation:null};return d&&d.dem&&(f.minElevation=d.dem.min*this.exaggeration,f.maxElevation=d.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(o,d){const f=l.Y.fromLngLat(o.wrap()),g=(1<<d)*l.W,x=f.x*g,P=f.y*g,C=Math.floor(x/l.W),O=Math.floor(P/l.W);return{tileID:new l.Q(d,0,d,C,O),mercatorX:x,mercatorY:P}}}class Jd{constructor(o,d,f){this._context=o,this._size=d,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new nt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(f.texture),{id:o,fbo:d,texture:f,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>o.id!==d),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const da={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class pm{constructor(o,d){this.painter=o,this.terrain=d,this.pool=new Jd(o.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(f=>!o._layers[f].isHidden(d)),this._coordsDescendingInv={};for(const f in o.sourceCaches){this._coordsDescendingInv[f]={};const g=o.sourceCaches[f].getVisibleCoordinates();for(const x of g){const P=this.terrain.sourceCache.getTerrainCoords(x);for(const C in P)this._coordsDescendingInv[f][C]||(this._coordsDescendingInv[f][C]=[]),this._coordsDescendingInv[f][C].push(P[C])}}this._coordsDescendingInvStr={};for(const f of o._order){const g=o._layers[f],x=g.source;if(da[g.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const P in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][P]=this._coordsDescendingInv[x][P].map(C=>C.key).sort().join()}}for(const f of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[g][f.tileID.key];x&&x!==f.rttCoords[g]&&(f.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const d=o.type,f=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(da[d]&&(this._prevType&&da[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(o.id),!g))return!0;if(da[this._prevType]||da[d]&&g){this._prevType=d;const x=this._stacks.length-1,P=this._stacks[x]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(Qf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[x]){const D=this.pool.getObjectForId(C.rtt[x].id);if(D.stamp===C.rtt[x].stamp){this.pool.useObject(D);continue}}const O=this.pool.getOrCreateFreeObject();this.pool.useObject(O),this.pool.stampObject(O),C.rtt[x]={id:O.id,stamp:O.stamp},f.context.bindFramebuffer.set(O.fbo.framebuffer),f.context.clear({color:l.aO.transparent,stencil:0}),f.currentStencilSource=void 0;for(let D=0;D<P.length;D++){const F=f.style._layers[P[D]],B=F.source?this._coordsDescendingInv[F.source][C.tileID.key]:[C.tileID];f.context.viewport.set([0,0,O.fbo.width,O.fbo.height]),f._renderTileClippingMasks(F,B),f.renderLayer(f,f.style.sourceCaches[F.source],F,B),F.source&&(C.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][C.tileID.key])}}return Qf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),da[d]}return!1}}const fm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ju=y,mm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Pn,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Kd=b=>{b.touchstart=b.dragStart,b.touchmoveWindow=b.dragMove,b.touchend=b.dragEnd},ym={showCompass:!0,showZoom:!0,visualizePitch:!1};class gm{constructor(o,d,f=!1){this.mousedown=P=>{this.startMouse(l.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),A.mousePos(this.element,P)),A.addEventListener(window,"mousemove",this.mousemove),A.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,A.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=A.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),A.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=A.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=o.dragRotate._mouseRotate.getClickTolerance(),x=o.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=uc({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:C,bearingDegreesPerPixelMoved:O=.8})=>{const D=new nm;return new To({clickTolerance:C,move:(F,B)=>({bearingDelta:(B.x-F.x)*O}),moveStateManager:D,enable:P,assignEvents:Kd})})({clickTolerance:g,enable:!0}),this.map=o,f&&(this.mousePitch=om({clickTolerance:x,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:C,pitchDegreesPerPixelMoved:O=-.5})=>{const D=new nm;return new To({clickTolerance:C,move:(F,B)=>({pitchDelta:(B.y-F.y)*O}),moveStateManager:D,enable:P,assignEvents:Kd})})({clickTolerance:x,enable:!0})),A.addEventListener(d,"mousedown",this.mousedown),A.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),A.addEventListener(d,"touchcancel",this.reset)}startMouse(o,d){this.mouseRotate.dragStart(o,d),this.mousePitch&&this.mousePitch.dragStart(o,d),A.disableDrag()}startTouch(o,d){this.touchRotate.dragStart(o,d),this.touchPitch&&this.touchPitch.dragStart(o,d),A.disableDrag()}moveMouse(o,d){const f=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(o,d)||{};if(g&&f.setBearing(f.getBearing()+g),this.mousePitch){const{pitchDelta:x}=this.mousePitch.dragMove(o,d)||{};x&&f.setPitch(f.getPitch()+x)}}moveTouch(o,d){const f=this.map,{bearingDelta:g}=this.touchRotate.dragMove(o,d)||{};if(g&&f.setBearing(f.getBearing()+g),this.touchPitch){const{pitchDelta:x}=this.touchPitch.dragMove(o,d)||{};x&&f.setPitch(f.getPitch()+x)}}off(){const o=this.element;A.removeEventListener(o,"mousedown",this.mousedown),A.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend),A.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){A.enableDrag(),A.removeEventListener(window,"mousemove",this.mousemove),A.removeEventListener(window,"mouseup",this.mouseup),A.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),A.removeEventListener(window,"touchend",this.touchend)}}let Mo;function Yd(b,o,d){const f=new l.M(b.lng,b.lat);if(b=new l.M(b.lng,b.lat),o){const g=new l.M(b.lng-360,b.lat),x=new l.M(b.lng+360,b.lat),P=d.locationPoint(b).distSqr(o);d.locationPoint(g).distSqr(o)<P?b=g:d.locationPoint(x).distSqr(o)<P&&(b=x)}for(;Math.abs(b.lng-d.center.lng)>180;){const g=d.locationPoint(b);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;b.lng>d.center.lng?b.lng-=360:b.lng+=360}return b.lng!==f.lng&&d.locationPoint(b).y>d.height/2-d.getHorizon()?b:f}const Ku={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Xd(b,o,d){const f=b.classList;for(const g in Ku)f.remove(`maplibregl-${d}-anchor-${g}`);f.add(`maplibregl-${d}-anchor-${o}`)}class dc extends l.E{constructor(o){if(super(),this._onKeyPress=d=>{const f=d.code,g=d.charCode||d.keyCode;f!=="Space"&&f!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=d=>{const f=d.originalEvent.target,g=this._element;this._popup&&(f===g||g.contains(f))&&this.togglePopup()},this._update=d=>{var f;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Yd(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),A.setTransform(this._element,`${Ku[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${x}`),E.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=l.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=A.create("div"),this._element.setAttribute("aria-label","Map marker");const d=A.createNS("http://www.w3.org/2000/svg","svg"),f=41,g=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${f}px`),d.setAttributeNS(null,"width",`${g}px`),d.setAttributeNS(null,"viewBox",`0 0 ${g} ${f}`);const x=A.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const P=A.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const C=A.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const he of O){const Me=A.createNS("http://www.w3.org/2000/svg","ellipse");Me.setAttributeNS(null,"opacity","0.04"),Me.setAttributeNS(null,"cx","10.5"),Me.setAttributeNS(null,"cy","5.80029008"),Me.setAttributeNS(null,"rx",he.rx),Me.setAttributeNS(null,"ry",he.ry),C.appendChild(Me)}const D=A.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const F=A.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(F);const B=A.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const W=A.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(W);const re=A.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(6.0, 7.0)"),re.setAttributeNS(null,"fill","#FFFFFF");const te=A.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ne=A.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#000000"),ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962");const X=A.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),te.appendChild(ne),te.appendChild(X),P.appendChild(C),P.appendChild(D),P.appendChild(B),P.appendChild(re),P.appendChild(te),d.appendChild(P),d.setAttributeNS(null,"height",f*this._scale+"px"),d.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Xd(this._element,this._anchor,"marker"),o&&o.className)for(const d of o.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),A.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=l.M.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const g=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var d,f;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,x=g.terrain.depthAtPoint(this._pos),P=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,P)-x<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/g.transform._pixelPerMeter,O=Math.sin(g.getPitch()*Math.PI/180)*C,D=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),F=g.transform.lngLatToCameraDepth(this._lngLat,P+O)-D>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=l.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,d){return o===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const _m={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let pc=0,pa=!1;const vm={maxWidth:100,unit:"metric"};function Qd(b,o,d){const f=d&&d.maxWidth||100,g=b._container.clientHeight/2,x=b.unproject([0,g]),P=b.unproject([f,g]),C=x.distanceTo(P);if(d&&d.unit==="imperial"){const O=3.2808*C;O>5280?cl(o,f,O/5280,b._getUIString("ScaleControl.Miles")):cl(o,f,O,b._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?cl(o,f,C/1852,b._getUIString("ScaleControl.NauticalMiles")):C>=1e3?cl(o,f,C/1e3,b._getUIString("ScaleControl.Kilometers")):cl(o,f,C,b._getUIString("ScaleControl.Meters"))}function cl(b,o,d,f){const g=function(x){const P=Math.pow(10,`${Math.floor(x)}`.length-1);let C=x/P;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(O){const D=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*D)/D}(C),P*C}(d);b.style.width=o*(g/d)+"px",b.innerHTML=`${g}&nbsp;${f}`}const bm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},wm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xm(b){if(b){if(typeof b=="number"){const o=Math.round(Math.abs(b)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,b),"top-left":new l.P(o,o),"top-right":new l.P(-o,o),bottom:new l.P(0,-b),"bottom-left":new l.P(o,-o),"bottom-right":new l.P(-o,-o),left:new l.P(b,0),right:new l.P(-b,0)}}if(b instanceof l.P||Array.isArray(b)){const o=l.P.convert(b);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:l.P.convert(b.center||[0,0]),top:l.P.convert(b.top||[0,0]),"top-left":l.P.convert(b["top-left"]||[0,0]),"top-right":l.P.convert(b["top-right"]||[0,0]),bottom:l.P.convert(b.bottom||[0,0]),"bottom-left":l.P.convert(b["bottom-left"]||[0,0]),"bottom-right":l.P.convert(b["bottom-right"]||[0,0]),left:l.P.convert(b.left||[0,0]),right:l.P.convert(b.right||[0,0])}}return xm(new l.P(0,0))}const H0=y;u.AJAXError=l.be,u.Evented=l.E,u.LngLat=l.M,u.MercatorCoordinate=l.Y,u.Point=l.P,u.addProtocol=l.bf,u.config=l.a,u.removeProtocol=l.bg,u.AttributionControl=G0,u.BoxZoomHandler=cc,u.CanvasSource=Hl,u.CooperativeGesturesHandler=bt,u.DoubleClickZoomHandler=hm,u.DragPanHandler=An,u.DragRotateHandler=Hu,u.EdgeInsets=Vu,u.FullscreenControl=class extends l.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var o;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=d==null?void 0:d.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){A.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=A.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);A.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Qt,u.GeolocateControl=class extends l.E{constructor(b){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const d=new l.M(o.coords.longitude,o.coords.latitude),f=o.coords.accuracy,g=this._map.getBearing(),x=l.e({bearing:g},this.options.fitBoundsOptions),P=vr.fromLngLat(d,f);this._map.fitBounds(P,x,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const d=new l.M(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&pa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=A.create("button","maplibregl-ctrl-geolocate",this._container),A.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new dc({element:this._dotElement}),this._circleElement=A.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},_m,b)}onAdd(b){return this._map=b,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(o=!1){if(Mo!==void 0&&!o)return Mo;if(window.navigator.permissions===void 0)return Mo=!!window.navigator.geolocation,Mo;try{Mo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Mo=!!window.navigator.geolocation}return Mo})}().then(o=>this._setupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),A.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pc=0,pa=!1}_isOutOfMapMaxBounds(b){const o=this._map.getMaxBounds(),d=b.coords;return o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const b=this._map.getBounds(),o=b.getSouthEast(),d=b.getNorthEast(),f=o.distanceTo(d),g=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pc--,pa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pc++,pc>1?(b={maximumAge:6e5,timeout:0},pa=!0):(b=this.options.positionOptions,pa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=im,u.ImageSource=Kn,u.KeyboardHandler=$i,u.LngLatBounds=vr,u.LogoControl=hc,u.Map=class extends U0{constructor(b){if(l.bc.mark(l.bd.create),(b=l.e({},mm,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Gd(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies),{bearingSnap:b.bearingSnap}),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._maxTileCacheZoomLevels=b.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=b.collectResourceTiming,this._renderTaskQueue=new Ui,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},fm,b.locale),this._clickTolerance=b.clickTolerance,this._overridePixelRatio=b.pixelRatio,this._maxCanvasSize=b.maxCanvasSize,this.transformCameraUpdate=b.transformCameraUpdate,this._imageQueueHandle=_e.addThrottleControl(()=>this.isMoving()),this._requestManager=new ke(b.transformRequest),typeof b.container=="string"){if(this._container=document.getElementById(b.container),!this._container)throw new Error(`Container '${b.container}' not found.`)}else{if(!(b.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const d=tm(f=>{this._trackResize&&!this._removed&&this.resize(f)._update()},50);this._resizeObserver=new ResizeObserver(f=>{o?d(f):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new vs(this,b),this._hash=b.hash&&new im(typeof b.hash=="string"&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,l.e({},b.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=b.localIdeographFontFamily,this._validateStyle=b.validateStyle,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new G0(typeof b.attributionControl=="boolean"?void 0:b.attributionControl)),b.maplibreLogo&&this.addControl(new hc,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new l.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new l.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new l.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(b,o){if(o===void 0&&(o=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=b.onAdd(this);this._controls.push(b);const f=this._controlPositions[o];return o.indexOf("bottom")!==-1?f.insertBefore(d,f.firstChild):f.appendChild(d),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(b);return o>-1&&this._controls.splice(o,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}calculateCameraOptionsFromTo(b,o,d,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,o,d,f)}resize(b){var o;const d=this._containerDimensions(),f=d[0],g=d[1],x=this._getClampedPixelRatio(f,g);if(this._resizeCanvas(f,g,x),this.painter.resize(f,g,x),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const O=this._getClampedPixelRatio(f,g);this._resizeCanvas(f,g,O),this.painter.resize(f,g,O)}this.transform.resize(f,g),(o=this._requestedCameraState)===null||o===void 0||o.resize(f,g);const P=!this._moving;return P&&(this.stop(),this.fire(new l.k("movestart",b)).fire(new l.k("move",b))),this.fire(new l.k("resize",b)),P&&this.fire(new l.k("moveend",b)),this}_getClampedPixelRatio(b,o){const{0:d,1:f}=this._maxCanvasSize,g=this.getPixelRatio(),x=b*g,P=o*g;return Math.min(x>d?d/x:1,P>f?f/P:1)*g}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(vr.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this._update()}project(b){return this.transform.locationPoint(l.M.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.pointLocation(l.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,o,d){if(b==="mouseenter"||b==="mouseover"){let f=!1;return{layer:o,listener:d,delegates:{mousemove:x=>{const P=this.getLayer(o)?this.queryRenderedFeatures(x.point,{layers:[o]}):[];P.length?f||(f=!0,d.call(this,new Ar(b,this,x.originalEvent,{features:P}))):f=!1},mouseout:()=>{f=!1}}}}if(b==="mouseleave"||b==="mouseout"){let f=!1;return{layer:o,listener:d,delegates:{mousemove:P=>{(this.getLayer(o)?this.queryRenderedFeatures(P.point,{layers:[o]}):[]).length?f=!0:f&&(f=!1,d.call(this,new Ar(b,this,P.originalEvent)))},mouseout:P=>{f&&(f=!1,d.call(this,new Ar(b,this,P.originalEvent)))}}}}{const f=g=>{const x=this.getLayer(o)?this.queryRenderedFeatures(g.point,{layers:[o]}):[];x.length&&(g.features=x,d.call(this,g),delete g.features)};return{layer:o,listener:d,delegates:{[b]:f}}}}on(b,o,d){if(d===void 0)return super.on(b,o);const f=this._createDelegatedListener(b,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(f);for(const g in f.delegates)this.on(g,f.delegates[g]);return this}once(b,o,d){if(d===void 0)return super.once(b,o);const f=this._createDelegatedListener(b,o,d);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(b,o,d){return d===void 0?super.off(b,o):(this._delegatedListeners&&this._delegatedListeners[b]&&(f=>{const g=this._delegatedListeners[b];for(let x=0;x<g.length;x++){const P=g[x];if(P.layer===o&&P.listener===d){for(const C in P.delegates)this.off(C,P.delegates[C]);return g.splice(x,1),this}}})(),this)}queryRenderedFeatures(b,o){if(!this.style)return[];let d;const f=b instanceof l.P||Array.isArray(b),g=f?b:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(f?{}:b)||{},g instanceof l.P||typeof g[0]=="number")d=[l.P.convert(g)];else{const x=l.P.convert(g[0]),P=l.P.convert(g[1]);d=[x,new l.P(P.x,x.y),P,new l.P(x.x,P.y),x]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(b,o){return this.style.querySourceFeatures(b,o)}setStyle(b,o){return(o=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(b,o))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const o=this._locale[b];if(o==null)throw new Error(`Missing UI string '${b}'`);return o}_updateStyle(b,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(b,o));const d=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new Ed(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,o,d):this.style.loadJSON(b,o,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ed(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,o){if(typeof b=="string"){const d=this._requestManager.transformRequest(b,be.Style);l.h(d,new AbortController).then(f=>{this._updateDiff(f.data,o)}).catch(f=>{f&&this.fire(new l.j(f))})}else typeof b=="object"&&this._updateDiff(b,o)}_updateDiff(b,o){try{this.style.setState(b,o)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(b,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(b,o){return this._lazyInitEmptyStyle(),this.style.addSource(b,o),this._update(!0)}isSourceLoaded(b){const o=this.style&&this.style.sourceCaches[b];if(o!==void 0)return o.loaded();this.fire(new l.j(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const o=this.style.sourceCaches[b.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&o.reload();for(const d in this.style._layers){const f=this.style._layers[d];f.type==="hillshade"&&f.source===b.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Zu(this.painter,o,b),this.painter.renderToTexture=new pm(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==b.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:b})),this}getTerrain(){var b,o;return(o=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const o in b){const d=b[o]._tiles;for(const f in d){const g=d[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,o,d={}){const{pixelRatio:f=1,sdf:g=!1,stretchX:x,stretchY:P,content:C}=d;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||l.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:D,data:F}=o,B=o;return this.style.addImage(b,{data:new l.R({width:O,height:D},new Uint8Array(F)),pixelRatio:f,stretchX:x,stretchY:P,content:C,sdf:g,version:0,userImage:B}),B.onAdd&&B.onAdd(this,b),this}}{const{width:O,height:D,data:F}=E.getImageData(o);this.style.addImage(b,{data:new l.R({width:O,height:D},F),pixelRatio:f,stretchX:x,stretchY:P,content:C,sdf:g,version:0})}}updateImage(b,o){const d=this.style.getImage(b);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=o instanceof HTMLImageElement||l.b(o)?E.getImageData(o):o,{width:g,height:x,data:P}=f;if(g===void 0||x===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==d.data.width||x!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(o instanceof HTMLImageElement||l.b(o));return d.data.replace(P,C),this.style.updateImage(b,d),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return _e.getImage(this._requestManager.transformRequest(b,be.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,o){return this._lazyInitEmptyStyle(),this.style.addLayer(b,o),this._update(!0)}moveLayer(b,o){return this.style.moveLayer(b,o),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,o,d){return this.style.setLayerZoomRange(b,o,d),this._update(!0)}setFilter(b,o,d={}){return this.style.setFilter(b,o,d),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,o,d,f={}){return this.style.setPaintProperty(b,o,d,f),this._update(!0)}getPaintProperty(b,o){return this.style.getPaintProperty(b,o)}setLayoutProperty(b,o,d,f={}){return this.style.setLayoutProperty(b,o,d,f),this._update(!0)}getLayoutProperty(b,o){return this.style.getLayoutProperty(b,o)}setGlyphs(b,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,o,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,o,d,f=>{f||this._update(!0)}),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,o,d=>{d||this._update(!0)}),this}setLight(b,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(b,o){return this.style.setFeatureState(b,o),this._update()}removeFeatureState(b,o){return this.style.removeFeatureState(b,o),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,o=0;return this._container&&(b=this._container.clientWidth||400,o=this._container.clientHeight||300),[b,o]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const o=this._canvasContainer=A.create("div","maplibregl-canvas-container",b);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=A.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),f=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],f);const g=this._controlContainer=A.create("div","maplibregl-control-container",b),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{x[P]=A.create("div",`maplibregl-ctrl-${P} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,o,d){this._canvas.width=Math.floor(d*b),this._canvas.height=Math.floor(d*o),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const b={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{o={requestedAttributes:b},f&&(o.statusMessage=f.statusMessage,o.type=f.type)},{once:!0});const d=this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b);if(!d){const f="Failed to initialize WebGL";throw o?(o.message=f,new Error(JSON.stringify(o))):new Error(f)}this.painter=new oc(d,this.transform),R.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,x=E.now();this.style.zoomHistory.update(g,x);const P=new l.a8(g,{now:x,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=P.crossFadingFactor();C===1&&C===this._crossFadingFactor||(d=!0,this._crossFadingFactor=C),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),_e.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),A.remove(this._canvasContainer),A.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(b=>{l.bc.frame(b),this._frameRequest=null,this._render(b)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return Ju}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Ar,u.MapTouchEvent=lc,u.MapWheelEvent=fn,u.Marker=dc,u.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const o=this._map.getZoom(),d=o===this._map.getMaxZoom(),f=o===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,d)=>{const f=this._map._getUIString(`NavigationControl.${d}`);o.title=f,o.setAttribute("aria-label",f)},this.options=l.e({},ym,b),this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),A.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),A.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=A.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gm(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){A.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,o){const d=A.create("button",b,this._container);return d.type="button",d.addEventListener("click",o),d}},u.Popup=class extends l.E{constructor(b){super(),this.remove=()=>(this._content&&A.remove(this._content),this._container&&(A.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=A.create("div","maplibregl-popup",this._map.getContainer()),this._tip=A.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Yd(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!o)return;const f=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const x=xm(this.options.offset);if(!g){const C=this._container.offsetWidth,O=this._container.offsetHeight;let D;D=f.y+x.bottom.y<O?["top"]:f.y>this._map.transform.height-O?["bottom"]:[],f.x<C/2?D.push("left"):f.x>this._map.transform.width-C/2&&D.push("right"),g=D.length===0?"bottom":D.join("-")}let P=f.add(x[g]);this.options.subpixelPositioning||(P=P.round()),A.setTransform(this._container,`${Ku[g]} translate(${P.x}px,${P.y}px)`),Xd(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(bm),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=l.M.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const o=document.createDocumentFragment(),d=document.createElement("body");let f;for(d.innerHTML=b;f=d.firstChild,f;)o.appendChild(f);return this.setDOMContent(o)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=A.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){this._container&&this._container.classList.add(b)}removeClassName(b){this._container&&this._container.classList.remove(b)}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=A.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(wm);b&&b.focus()}},u.RasterDEMTileSource=Cu,u.RasterTileSource=Ya,u.ScaleControl=class{constructor(b){this._onMove=()=>{Qd(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Qd(this._map,this._container,this.options)},this.options=l.e({},vm,b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){A.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=um,u.Style=Ed,u.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=A.create("button","maplibregl-ctrl-terrain",this._container),A.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){A.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=j0,u.TwoFingersTouchRotateHandler=lm,u.TwoFingersTouchZoomHandler=Hd,u.TwoFingersTouchZoomRotateHandler=yt,u.VectorTileSource=$e,u.VideoSource=ql,u.addSourceType=(b,o)=>l._(void 0,void 0,void 0,function*(){if(Xa(b))throw new Error(`A source type called "${b}" already exists.`);((d,f)=>{Wl[d]=f})(b,o)}),u.clearPrewarmedResources=function(){const b=En;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(cn),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return Ns().getRTLTextPluginStatus()},u.getVersion=function(){return H0},u.getWorkerCount=function(){return fs.workerCount},u.getWorkerUrl=function(){return l.a.WORKER_URL},u.importScriptInWorkers=function(b){return Kt().broadcast("importScript",b)},u.prewarm=function(){ms().acquire(cn)},u.setMaxParallelImageRequests=function(b){l.a.MAX_PARALLEL_IMAGE_REQUESTS=b},u.setRTLTextPlugin=function(b,o){return Ns().setRTLTextPlugin(b,o)},u.setWorkerCount=function(b){fs.workerCount=b},u.setWorkerUrl=function(b){l.a.WORKER_URL=b}});var a=i;return a})})(x6);var cse=x6.exports;const Id=lse(cse);function use(e,t,i){let r;const{map:s}=a0();nd(e,s,w=>i(5,r=w));let{position:a="bottom-right"}=t,{compact:u=!1}=t,{customAttribution:l=void 0}=t,y=null;return xf(()=>{r!=null&&r.loaded()&&y&&r.removeControl(y)}),e.$$set=w=>{"position"in w&&i(1,a=w.position),"compact"in w&&i(2,u=w.compact),"customAttribution"in w&&i(3,l=w.customAttribution)},e.$$.update=()=>{e.$$.dirty&62&&r&&!y&&(i(4,y=new Id.AttributionControl({compact:u,customAttribution:l})),r.addControl(y,a))},[s,a,u,l,y,r]}class hse extends Wa{constructor(t){super(),Ha(this,t,use,null,ra,{position:1,compact:2,customAttribution:3})}}var dse=pse;function pse(e){var t,i,r;if(e){if(Array.isArray(e)){for(t=[],i=e.length,r=0;r<i;r++){var s=e[r];s!=null&&t.push(s)}return t}if(typeof e=="object"){t={};var a=Object.keys(e);for(i=a.length,r=0;r<i;r++){var u=a[r],l=e[u];l!=null&&(t[u]=l)}return t}}}function fse(e,t,i){let r;const{map:s}=a0();nd(e,s,y=>i(4,r=y));let{position:a="top-left"}=t,{container:u=void 0}=t,l=null;return xf(()=>{r!=null&&r.loaded()&&l&&r.removeControl(l)}),e.$$set=y=>{"position"in y&&i(1,a=y.position),"container"in y&&i(2,u=y.container)},e.$$.update=()=>{if(e.$$.dirty&30&&r&&!l){let y;typeof u=="string"?y=document.querySelector(u)??void 0:y=u,i(3,l=new Id.FullscreenControl({container:y})),r.addControl(l,a)}},[s,a,u,l,r]}class T6 extends Wa{constructor(t){super(),Ha(this,t,fse,null,ra,{position:1,container:2})}}function mse(e,t,i){let r;const{map:s}=a0();nd(e,s,A=>i(8,r=A));let{position:a="top-left"}=t,{positionOptions:u=void 0}=t,{fitBoundsOptions:l=void 0}=t,{trackUserLocation:y=!1}=t,{showAccuracyCircle:w=!0}=t,{showUserLocation:I=!0}=t,E=null;return xf(()=>{r!=null&&r.loaded()&&E&&r.removeControl(E)}),e.$$set=A=>{"position"in A&&i(1,a=A.position),"positionOptions"in A&&i(2,u=A.positionOptions),"fitBoundsOptions"in A&&i(3,l=A.fitBoundsOptions),"trackUserLocation"in A&&i(4,y=A.trackUserLocation),"showAccuracyCircle"in A&&i(5,w=A.showAccuracyCircle),"showUserLocation"in A&&i(6,I=A.showUserLocation)},e.$$.update=()=>{e.$$.dirty&510&&r&&!E&&(i(7,E=new Id.GeolocateControl({positionOptions:u,fitBoundsOptions:l,trackUserLocation:y,showAccuracyCircle:w,showUserLocation:I})),r.addControl(E,a))},[s,a,u,l,y,w,I,E,r]}class M6 extends Wa{constructor(t){super(),Ha(this,t,mse,null,ra,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function yse(e){let t=e.getCenter(),i=Math.round(e.getZoom()*100)/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,r),a=Math.round(t.lat*s)/s,u=Math.round(t.lng*s)/s,l=`${i}/${a}/${u}`,y=e.getBearing(),w=e.getPitch();return(y||w)&&(l+=`/${Math.round(y*10)/10}`),w&&(l+=`/${Math.round(w)}`),`#${l}`}function gse(e){return e.replace("#","").split("/").map(parseFloat)}var rv=bE;function bE(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?BC(e,t):{}.toString.call(e)=="[object Set]"?BC(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?vse(e,t):_se(e,t)}function _se(e,t){return e.toString()===t.toString()}function BC(e,t){var i=e.length;if(i!=t.length)return!1;for(var r=0;r<i;r++)if(!bE(e[r],t[r]))return!1;return!0}function vse(e,t){var i=Object.keys(e),r=i.length;if(r!=Object.keys(t).length)return!1;for(var s=0;s<r;s++){var a=i[s];if(!(t.hasOwnProperty(a)&&bE(e[a],t[a])))return!1}return!0}function bse(e,t,i){let r;const{map:s}=a0();nd(e,s,I=>i(6,r=I));let{position:a="top-left"}=t,{showCompass:u=!0}=t,{showZoom:l=!0}=t,{visualizePitch:y=!1}=t,w=null;return xf(()=>{r!=null&&r.loaded()&&w&&r.removeControl(w)}),e.$$set=I=>{"position"in I&&i(1,a=I.position),"showCompass"in I&&i(2,u=I.showCompass),"showZoom"in I&&i(3,l=I.showZoom),"visualizePitch"in I&&i(4,y=I.visualizePitch)},e.$$.update=()=>{e.$$.dirty&126&&r&&!w&&(i(5,w=new Id.NavigationControl({showCompass:u,showZoom:l,visualizePitch:y})),r.addControl(w,a))},[s,a,u,l,y,w,r]}class I6 extends Wa{constructor(t){super(),Ha(this,t,bse,null,ra,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function wse(e,t,i){let r;const{map:s}=a0();nd(e,s,w=>i(5,r=w));let{position:a="bottom-left"}=t,{maxWidth:u=void 0}=t,{unit:l="metric"}=t,y=null;return xf(()=>{r!=null&&r.loaded()&&y&&r.removeControl(y)}),e.$$set=w=>{"position"in w&&i(1,a=w.position),"maxWidth"in w&&i(2,u=w.maxWidth),"unit"in w&&i(3,l=w.unit)},e.$$.update=()=>{e.$$.dirty&62&&r&&!y&&(i(4,y=new Id.ScaleControl({maxWidth:u,unit:l})),r.addControl(y,a))},[s,a,u,l,y,r]}class E6 extends Wa{constructor(t){super(),Ha(this,t,wse,null,ra,{position:1,maxWidth:2,unit:3})}}const{window:xse}=PF,Sse=e=>({map:e[0]&8,loadedImages:e[0]&16,allImagesLoaded:e[0]&32}),jC=e=>({map:e[3],loadedImages:e[4],allImagesLoaded:e[5]});function VC(e){let t,i,r=e[2]&&UC(e);const s=e[37].default,a=MF(s,e,e[36],jC);return{c(){r&&r.c(),t=vn(),a&&a.c()},m(u,l){r&&r.m(u,l),yo(u,t,l),a&&a.m(u,l),i=!0},p(u,l){u[2]?r?(r.p(u,l),l[0]&4&&fr(r,1)):(r=UC(u),r.c(),fr(r,1),r.m(t.parentNode,t)):r&&(s$(),Vr(r,1,1,()=>{r=null}),n$()),a&&a.p&&(!i||l[0]&56|l[1]&32)&&EF(a,s,u,u[36],i?IF(s,u[36],l,Sse):kF(u[36]),jC)},i(u){i||(fr(r),fr(a,u),i=!0)},o(u){Vr(r),Vr(a,u),i=!1},d(u){u&&qn(t),r&&r.d(u),a&&a.d(u)}}}function UC(e){let t,i,r,s,a,u,l,y;return t=new I6({props:{position:e[6]}}),r=new M6({props:{position:e[6],fitBoundsOptions:{maxZoom:12}}}),a=new T6({props:{position:e[6]}}),l=new E6({props:{position:e[6]}}),{c(){xn(t.$$.fragment),i=vn(),xn(r.$$.fragment),s=vn(),xn(a.$$.fragment),u=vn(),xn(l.$$.fragment)},m(w,I){rn(t,w,I),yo(w,i,I),rn(r,w,I),yo(w,s,I),rn(a,w,I),yo(w,u,I),rn(l,w,I),y=!0},p(w,I){const E={};I[0]&64&&(E.position=w[6]),t.$set(E);const A={};I[0]&64&&(A.position=w[6]),r.$set(A);const R={};I[0]&64&&(R.position=w[6]),a.$set(R);const G={};I[0]&64&&(G.position=w[6]),l.$set(G)},i(w){y||(fr(t.$$.fragment,w),fr(r.$$.fragment,w),fr(a.$$.fragment,w),fr(l.$$.fragment,w),y=!0)},o(w){Vr(t.$$.fragment,w),Vr(r.$$.fragment,w),Vr(a.$$.fragment,w),Vr(l.$$.fragment,w),y=!1},d(w){w&&(qn(i),qn(s),qn(u)),sn(t,w),sn(r,w),sn(a,w),sn(l,w)}}}function Tse(e){let t,i,r,s,a,u=e[3]&&e[0]&&VC(e);return{c(){t=Vn("div"),u&&u.c(),Cs(t,"class",i=Y3(e[1])+" svelte-p00lfq"),Cs(t,"data-testid","map-container"),X3(t,"expand-map",!e[1])},m(l,y){yo(l,t,y),u&&u.m(t,null),r=!0,s||(a=[$F(xse,"hashchange",e[10]),AF(e[9].call(null,t))],s=!0)},p(l,y){l[3]&&l[0]?u?(u.p(l,y),y[0]&9&&fr(u,1)):(u=VC(l),u.c(),fr(u,1),u.m(t,null)):u&&(s$(),Vr(u,1,1,()=>{u=null}),n$()),(!r||y[0]&2&&i!==(i=Y3(l[1])+" svelte-p00lfq"))&&Cs(t,"class",i),(!r||y[0]&2)&&X3(t,"expand-map",!l[1])},i(l){r||(fr(u),r=!0)},o(l){Vr(u),r=!1},d(l){l&&qn(t),u&&u.d(),s=!1,wf(a)}}}function Mse(e,t,i){let r,s,a,u,{$$slots:l={},$$scope:y}=t,{map:w=null}=t,{class:I=void 0}=t,{style:E}=t,{diffStyleUpdates:A=!1}=t,{center:R=void 0}=t,{zoom:G=void 0}=t,{pitch:K=0}=t,{bearing:Y=0}=t,{bounds:ae=void 0}=t,{hash:Te=!1}=t,{loaded:_e=!1}=t,{minZoom:be=0}=t,{maxZoom:ke=22}=t,{zoomOnDoubleClick:Ae=!0}=t,{locale:Ve=void 0}=t,{interactive:Ze=!0}=t,{attributionControl:lt=!0}=t,{cooperativeGestures:ct=!1}=t,{preserveDrawingBuffer:ut=!1}=t,{maxBounds:nt=void 0}=t,{images:It=[]}=t,{standardControls:ht=!1}=t,{filterLayers:hi=void 0}=t,{transformRequest:Zi=void 0}=t;const gi=RF(),{map:Ut,loadedImages:ir}=ose();nd(e,Ut,He=>i(3,a=He)),nd(e,ir,He=>i(4,u=He));let ps=new Set;async function Rr(He,Kt=!1){if(a&&!(!a.loaded()&&!Kt))if("url"in He){ps.add(He.id);try{let Pi=await a.loadImage(He.url);a==null||a.addImage(He.id,Pi.data,He.options),u.add(He.id),ir.set(u)}catch(Pi){gi("error",Pi)}finally{ps.delete(He.id)}}else a.addImage(He.id,He.data,He.options),u.add(He.id),ir.set(u)}let _r,cn,fs,un;function En(He){return ms(),rx(Ut,a=new Id.Map(dse({container:He,style:E,locale:Ve,center:R,zoom:G,pitch:K,bearing:Y,minZoom:be,maxZoom:ke,interactive:Ze,preserveDrawingBuffer:ut,maxBounds:nt,bounds:ae,attributionControl:lt,transformRequest:Zi,cooperativeGestures:ct})),a),a.on("load",Kt=>{Kt.target.getContainer().setAttribute("data-testid","map"),Kt.target.getCanvas().setAttribute("data-testid","map-canvas"),i(0,_e=!0),gi("load",a)}),a.on("error",Kt=>gi("error",{...Kt,map:a})),a.on("movestart",Kt=>gi("movestart",{...Kt,map:a})),a.on("moveend",Kt=>{if(i(11,R=Kt.target.getCenter()),i(12,G=Kt.target.getZoom()),i(13,ae=Kt.target.getBounds()),gi("moveend",{...Kt,map:a}),Te){let Pi=window.location.href.replace(/(#.+)?$/,yse(a));window.history.replaceState(window.history.state,"",Pi)}}),a.on("zoomstart",Kt=>gi("zoomstart",{...Kt,map:a})),a.on("zoom",Kt=>{i(12,G=Kt.target.getZoom()),gi("zoom",{...Kt,map:a})}),a.on("zoomend",Kt=>{i(12,G=Kt.target.getZoom()),gi("zoomend",{...Kt,map:a})}),a.on("style.load",()=>{if(a){const Kt=a.getStyle();if(i(33,_r=Kt.layers.map(Pi=>Pi.id)),i(34,cn=Object.keys(Kt.sources)),un)for(const[Pi,zs]of Object.entries(un))a.addSource(Pi,zs);if(fs)for(const Pi of fs)a.addLayer(Pi);for(const Pi of It)Rr(Pi,!0)}}),a.on("styledata",Kt=>{if(a&&hi){const Pi=a.getStyle().layers;if(Pi)for(let zs of Pi)hi(zs)||a.setLayoutProperty(zs.id,"visibility","none")}gi("styledata",{...Kt,map:a})}),{destroy(){i(0,_e=!1),a==null||a.remove(),rx(Ut,a=null,a)}}}let is=E;function ms(){if(Te){let He=gse(window.location.hash);He.length>=3&&(i(12,G=He[0]),i(11,R=[He[2],He[1]])),He.length==5&&(i(16,Y=He[3]),i(15,K=He[4]))}}return e.$$set=He=>{"map"in He&&i(14,w=He.map),"class"in He&&i(1,I=He.class),"style"in He&&i(17,E=He.style),"diffStyleUpdates"in He&&i(18,A=He.diffStyleUpdates),"center"in He&&i(11,R=He.center),"zoom"in He&&i(12,G=He.zoom),"pitch"in He&&i(15,K=He.pitch),"bearing"in He&&i(16,Y=He.bearing),"bounds"in He&&i(13,ae=He.bounds),"hash"in He&&i(19,Te=He.hash),"loaded"in He&&i(0,_e=He.loaded),"minZoom"in He&&i(20,be=He.minZoom),"maxZoom"in He&&i(21,ke=He.maxZoom),"zoomOnDoubleClick"in He&&i(22,Ae=He.zoomOnDoubleClick),"locale"in He&&i(23,Ve=He.locale),"interactive"in He&&i(24,Ze=He.interactive),"attributionControl"in He&&i(25,lt=He.attributionControl),"cooperativeGestures"in He&&i(26,ct=He.cooperativeGestures),"preserveDrawingBuffer"in He&&i(27,ut=He.preserveDrawingBuffer),"maxBounds"in He&&i(28,nt=He.maxBounds),"images"in He&&i(29,It=He.images),"standardControls"in He&&i(2,ht=He.standardControls),"filterLayers"in He&&i(30,hi=He.filterLayers),"transformRequest"in He&&i(31,Zi=He.transformRequest),"$$scope"in He&&i(36,y=He.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&4&&i(6,r=typeof ht=="boolean"?void 0:ht),e.$$.dirty[0]&8&&i(14,w=a),e.$$.dirty[0]&393224|e.$$.dirty[1]&28&&a&&!rv(E,is)){const He=a.getStyle();if(_r&&(fs=He.layers.filter(Kt=>!_r.includes(Kt.id))),cn){const Kt=Object.keys(He.sources).filter(Pi=>!cn.includes(Pi));un={};for(const Pi of Kt)un[Pi]=He.sources[Pi]}i(35,is=E),a.setStyle(E,{diff:A}),rx(ir,u=new Set,u),i(32,ps=new Set)}if(e.$$.dirty[0]&536870937|e.$$.dirty[1]&2&&_e&&a!=null&&a.loaded())for(let He of It)!u.has(He.id)&&!ps.has(He.id)&&!a.hasImage(He.id)&&Rr(He);e.$$.dirty[0]&536870928&&i(5,s=It.every(He=>u.has(He.id))),e.$$.dirty[0]&2056&&R&&!rv(R,a==null?void 0:a.getCenter())&&(a==null||a.panTo(R)),e.$$.dirty[0]&4104&&G&&!rv(G,a==null?void 0:a.getZoom())&&(a==null||a.zoomTo(G)),e.$$.dirty[0]&8200&&ae&&!rv(ae,a==null?void 0:a.getBounds())&&(a==null||a.fitBounds(ae)),e.$$.dirty[0]&4194312&&(Ae?a==null||a.doubleClickZoom.enable():a==null||a.doubleClickZoom.disable())},[_e,I,ht,a,u,s,r,Ut,ir,En,ms,R,G,ae,w,K,Y,E,A,Te,be,ke,Ae,Ve,Ze,lt,ct,ut,nt,It,hi,Zi,ps,_r,cn,is,y,l]}class Ise extends Wa{constructor(t){super(),Ha(this,t,Mse,Tse,ra,{map:14,class:1,style:17,diffStyleUpdates:18,center:11,zoom:12,pitch:15,bearing:16,bounds:13,hash:19,loaded:0,minZoom:20,maxZoom:21,zoomOnDoubleClick:22,locale:23,interactive:24,attributionControl:25,cooperativeGestures:26,preserveDrawingBuffer:27,maxBounds:28,images:29,standardControls:2,filterLayers:30,transformRequest:31},null,[-1,-1])}}var l0=Uint8Array,k6=Uint16Array,Ese=Int32Array,kse=new l0([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ase=new l0([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),A6=function(e,t){for(var i=new k6(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];for(var s=new Ese(i[30]),r=1;r<30;++r)for(var a=i[r];a<i[r+1];++a)s[a]=a-i[r]<<5|r;return{b:i,r:s}},P6=A6(kse,2),Pse=P6.b,Cse=P6.r;Pse[28]=258,Cse[258]=28;A6(Ase,0);var $se=new k6(32768);for(bi=0;bi<32768;++bi)Sl=(bi&43690)>>1|(bi&21845)<<1,Sl=(Sl&52428)>>2|(Sl&13107)<<2,Sl=(Sl&61680)>>4|(Sl&3855)<<4,$se[bi]=((Sl&65280)>>8|(Sl&255)<<8)>>1;var Sl,bi,Xb=new l0(288);for(bi=0;bi<144;++bi)Xb[bi]=8;var bi;for(bi=144;bi<256;++bi)Xb[bi]=9;var bi;for(bi=256;bi<280;++bi)Xb[bi]=7;var bi;for(bi=280;bi<288;++bi)Xb[bi]=8;var bi,Ose=new l0(32);for(bi=0;bi<32;++bi)Ose[bi]=5;var bi,Lse=new l0(0),Rse=typeof TextDecoder<"u"&&new TextDecoder,Dse=0;try{Rse.decode(Lse,{stream:!0}),Dse=1}catch{}function zse(e){let t,i,r,s,a,u,l,y,w,I;return t=new I6({props:{position:"top-left"}}),r=new M6({props:{position:"top-left",fitBoundsOptions:{maxZoom:12}}}),a=new T6({props:{position:"top-left"}}),l=new E6({}),w=new hse({props:{customAttribution:'A <strong class="text-red-500">custom</strong> attribution'}}),{c(){xn(t.$$.fragment),i=vn(),xn(r.$$.fragment),s=vn(),xn(a.$$.fragment),u=vn(),xn(l.$$.fragment),y=vn(),xn(w.$$.fragment)},m(E,A){rn(t,E,A),yo(E,i,A),rn(r,E,A),yo(E,s,A),rn(a,E,A),yo(E,u,A),rn(l,E,A),yo(E,y,A),rn(w,E,A),I=!0},p:Ds,i(E){I||(fr(t.$$.fragment,E),fr(r.$$.fragment,E),fr(a.$$.fragment,E),fr(l.$$.fragment,E),fr(w.$$.fragment,E),I=!0)},o(E){Vr(t.$$.fragment,E),Vr(r.$$.fragment,E),Vr(a.$$.fragment,E),Vr(l.$$.fragment,E),Vr(w.$$.fragment,E),I=!1},d(E){E&&(qn(i),qn(s),qn(u),qn(y)),sn(t,E),sn(r,E),sn(a,E),sn(l,E),sn(w,E)}}}function Nse(e){let t,i,r;function s(u){e[2](u)}let a={class:Fse,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:e[1].center,zoom:e[1].zoom,attributionControl:!1,$$slots:{default:[zse]},$$scope:{ctx:e}};return e[0]!==void 0&&(a.map=e[0]),t=new Ise({props:a}),Xv.push(()=>UF(t,"map",s)),{c(){xn(t.$$.fragment)},m(u,l){rn(t,u,l),r=!0},p(u,[l]){const y={};l&8&&(y.$$scope={dirty:l,ctx:u}),!i&&l&1&&(i=!0,y.map=u[0],BF(()=>i=!1)),t.$set(y)},i(u){r||(fr(t.$$.fragment,u),r=!0)},o(u){Vr(t.$$.fragment,u),r=!1},d(u){sn(t,u)}}}let Fse="h-full w-full";function Bse(e,t,i){let r,s=t$(Yp);pM(()=>{Id.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",!0),r.on("moveend",()=>{Yp.set({center:[r.getCenter().lng,r.getCenter().lat],zoom:r.getZoom()})});const u=Yp.subscribe(l=>{(r.getCenter().lng!==l.center[0]||r.getCenter().lat!==l.center[1]||r.getZoom()!==l.zoom)&&r.jumpTo({center:l.center,zoom:l.zoom})});return()=>{u()}});function a(u){r=u,i(0,r)}return[r,s,a]}class jse extends Wa{constructor(t){super(),Ha(this,t,Bse,Nse,ra,{})}}function Vse(e){let t;return{c(){t=Vn("div"),Cs(t,"class","w-full h-full")},m(i,r){yo(i,t,r),e[3](t)},p:Ds,i:Ds,o:Ds,d(i){i&&qn(t),e[3](null)}}}function Use(e,t,i){let{content:r}=t,{language:s="json"}=t,a,u,l;pM(async()=>{u=(await it(()=>import("./monaco-Pit5849K.js").then(w=>w.a),__vite__mapDeps([280,281]))).default,a=u.editor.create(l,{value:r,language:s})}),xf(()=>{var w;(w=a==null?void 0:a.getModel())==null||w.dispose(),a==null||a.dispose()});function y(w){Xv[w?"unshift":"push"](()=>{l=w,i(0,l)})}return e.$$set=w=>{"content"in w&&i(1,r=w.content),"language"in w&&i(2,s=w.language)},[l,r,s,y]}class GC extends Wa{constructor(t){super(),Ha(this,t,Use,Vse,ra,{content:1,language:2})}}function Gse(e){let t,i,r,s,a,u,l,y,w,I,E,A,R,G,K,Y,ae,Te,_e,be,ke;return s=new GC({props:{content:'{"key":"value"}',language:"json"}}),w=new sse({}),K=new GC({props:{content:'{"key":"value"}',language:"json"}}),be=new jse({}),{c(){t=Vn("div"),i=Vn("div"),r=Vn("div"),xn(s.$$.fragment),a=vn(),u=Vn("div"),u.innerHTML='<input type="text" placeholder="Enter URL" class="input input-bordered w-full mr-2"/> <button class="btn btn-outline">Fetch</button>',l=vn(),y=Vn("div"),xn(w.$$.fragment),I=vn(),E=Vn("div"),E.innerHTML='<button class="btn btn-outline-white btn-md my-2">⇦</button> <button class="btn btn-outline-white btn-md my-2">⇨</button> <button class="btn btn-circle btn-sm my-2">⟳</button> <button class="btn btn-circle btn-sm my-2">≡</button>',A=vn(),R=Vn("div"),G=Vn("div"),xn(K.$$.fragment),Y=vn(),ae=Vn("div"),ae.innerHTML='<input type="text" placeholder="Enter URL" class="input input-bordered w-full mr-2"/> <button class="btn btn-outline">Fetch</button>',Te=vn(),_e=Vn("div"),xn(be.$$.fragment),Cs(r,"class","flex-1 p-4 overflow-auto bg-gray-50"),Cs(u,"class","flex items-center p-4 bg-gray-200"),Cs(y,"class","flex-1"),Cs(i,"class","flex-1 flex flex-col"),Cs(E,"class","flex flex-col justify-center items-center p-2 bg-gray-500 shadow z-10 md:w-16 md:flex"),Cs(G,"class","flex-1 p-4 overflow-auto bg-gray-50"),Cs(ae,"class","flex items-center p-4 bg-gray-200"),Cs(_e,"class","flex-1"),Cs(R,"class","flex-1 flex flex-col"),Cs(t,"class","flex flex-col md:flex-row h-screen")},m(Ae,Ve){yo(Ae,t,Ve),Js(t,i),Js(i,r),rn(s,r,null),Js(i,a),Js(i,u),Js(i,l),Js(i,y),rn(w,y,null),Js(t,I),Js(t,E),Js(t,A),Js(t,R),Js(R,G),rn(K,G,null),Js(R,Y),Js(R,ae),Js(R,Te),Js(R,_e),rn(be,_e,null),ke=!0},p:Ds,i(Ae){ke||(fr(s.$$.fragment,Ae),fr(w.$$.fragment,Ae),fr(K.$$.fragment,Ae),fr(be.$$.fragment,Ae),ke=!0)},o(Ae){Vr(s.$$.fragment,Ae),Vr(w.$$.fragment,Ae),Vr(K.$$.fragment,Ae),Vr(be.$$.fragment,Ae),ke=!1},d(Ae){Ae&&qn(t),sn(s),sn(w),sn(K),sn(be)}}}class qse extends Wa{constructor(t){super(),Ha(this,t,null,Gse,ra,{})}}new qse({target:document.getElementById("app")});export{Pt as $,c5 as A,Hoe as B,Va as C,vg as D,cB as E,gt as F,ds as G,Rle as H,MK as I,Fle as J,Ble as K,Ole as L,Eg as M,SI as N,Rs as O,on as P,tO as Q,ia as R,Nle as S,L2 as T,Qr as U,At as V,vle as W,XH as X,fu as Y,Zg as Z,it as _,Su as a,Tb as a$,Az as a0,oi as a1,h5 as a2,aI as a3,d5 as a4,u5 as a5,PP as a6,fce as a7,lae as a8,k$ as a9,Td as aA,Ht as aB,vu as aC,Ko as aD,Sb as aE,tr as aF,S$ as aG,nb as aH,Bae as aI,TI as aJ,Dle as aK,zle as aL,Lae as aM,Rae as aN,Nae as aO,zae as aP,Dae as aQ,Ll as aR,ni as aS,an as aT,wt as aU,Ge as aV,bQ as aW,zP as aX,hs as aY,yi as aZ,WY as a_,sa as aa,tI as ab,zj as ac,Moe as ad,gr as ae,Sn as af,Mn as ag,cd as ah,Z_ as ai,_ae as aj,KD as ak,nG as al,Yh as am,bd as an,Rte as ao,BO as ap,mr as aq,Gl as ar,rE as as,pL as at,_u as au,H$ as av,wi as aw,cy as ax,si as ay,z4 as az,xo as b,she as b$,mf as b0,eue as b1,Sf as b2,mi as b3,Voe as b4,Xne as b5,du as b6,uL as b7,SB as b8,mR as b9,B2 as bA,Wi as bB,F2 as bC,V2 as bD,w1 as bE,D4 as bF,hx as bG,jI as bH,CP as bI,bae as bJ,oce as bK,mce as bL,U$ as bM,y2 as bN,Dte as bO,o$ as bP,xP as bQ,PG as bR,aZ as bS,yk as bT,fb as bU,ooe as bV,mX as bW,soe as bX,ln as bY,Foe as bZ,jz as b_,wle as ba,Za as bb,GY as bc,RI as bd,Qce as be,PR as bf,Ple as bg,qle as bh,zK as bi,j1 as bj,B1 as bk,Tle as bl,Cle as bm,fd as bn,eae as bo,zk as bp,VW as bq,Xoe as br,xd as bs,Toe as bt,bx as bu,Ale as bv,ci as bw,ku as bx,xu as by,Ga as bz,ug as c,wo as c$,nhe as c0,ahe as c1,Nie as c2,Cie as c3,Tj as c4,vP as c5,bR as c6,Ot as c7,Mu as c8,pce as c9,mo as cA,gb as cB,O1 as cC,XV as cD,h7 as cE,SL as cF,AL as cG,IL as cH,d7 as cI,s1 as cJ,fne as cK,kB as cL,cf as cM,zM as cN,u8 as cO,MG as cP,Yce as cQ,Hg as cR,roe as cS,Tce as cT,cg as cU,wT as cV,fE as cW,kne as cX,xM as cY,$O as cZ,ib as c_,yae as ca,Wn as cb,cne as cc,qoe as cd,t8 as ce,nne as cf,af as cg,PL as ch,S7 as ci,G7 as cj,iS as ck,Eu as cl,Wg as cm,KO as cn,qY as co,Lle as cp,VM as cq,lI as cr,bg as cs,EK as ct,Ule as cu,IK as cv,Vle as cw,Jo as cx,Joe as cy,$L as cz,v as d,gd as d$,NV as d0,DV as d1,ehe as d2,CQ as d3,jle as d4,qM as d5,Gg as d6,cI as d7,Jn as d8,Pf as d9,ru as dA,_g as dB,es as dC,k7 as dD,Xg as dE,Ej as dF,g7 as dG,_7 as dH,F7 as dI,Ug as dJ,lhe as dK,rhe as dL,Gae as dM,Zse as dN,cce as dO,yce as dP,ek as dQ,joe as dR,aue as dS,wQ as dT,hb as dU,Hue as dV,Iu as dW,Tu as dX,ed as dY,Yne as dZ,coe as d_,YI as da,eE as db,pD as dc,aO as dd,ob as de,YM as df,vb as dg,xg as dh,R$ as di,Hn as dj,xV as dk,RM as dl,SV as dm,eoe as dn,zoe as dp,WO as dq,jO as dr,Oae as ds,ar as dt,Vb as du,dae as dv,JW as dw,gae as dx,uae as dy,sA as dz,Ni as e,Jk as e$,vC as e0,fg as e1,FB as e2,CM as e3,Fg as e4,gle as e5,rae as e6,Nl as e7,the as e8,Wne as e9,pk as eA,Hv as eB,Une as eC,cae as eD,xL as eE,A7 as eF,vee as eG,Yr as eH,wee as eI,fz as eJ,Up as eK,xS as eL,rne as eM,P7 as eN,TQ as eO,oZ as eP,wv as eQ,Ioe as eR,aoe as eS,mu as eT,W$ as eU,B8 as eV,df as eW,ble as eX,$G as eY,CG as eZ,YU as e_,Hne as ea,n9 as eb,fk as ec,MM as ed,Ece as ee,GJ as ef,goe as eg,Qi as eh,kce as ei,Pce as ej,Boe as ek,Ub as el,XI as em,JI as en,KI as eo,QI as ep,ZI as eq,Ice as er,t0 as es,wM as et,mz as eu,rM as ev,bf as ew,yz as ex,Tee as ey,dE as ez,me as f,q1 as f$,Zo as f0,Mb as f1,une as f2,xae as f3,ef as f4,OB as f5,ja as f6,Xce as f7,yr as f8,mne as f9,vo as fA,Rne as fB,Vl as fC,Er as fD,Ij as fE,WM as fF,ZM as fG,mb as fH,yb as fI,aU as fJ,bS as fK,jW as fL,qae as fM,fe as fN,gU as fO,k4 as fP,xb as fQ,CL as fR,Zy as fS,t7 as fT,m7 as fU,U7 as fV,q7 as fW,Aee as fX,Sj as fY,A4 as fZ,Pj as f_,Vg as fa,nn as fb,lue as fc,See as fd,qQ as fe,oL as ff,oV as fg,i8 as fh,Sce as fi,yoe as fj,i7 as fk,bo as fl,bne as fm,K9 as fn,tB as fo,b2 as fp,sB as fq,Da as fr,Nx as fs,DL as ft,In as fu,dle as fv,_d as fw,gne as fx,sne as fy,Qse as fz,qt as g,R4 as g$,rI as g0,b7 as g1,y7 as g2,TL as g3,n7 as g4,D7 as g5,Zoe as g6,EL as g7,vU as g8,E1 as g9,YF as gA,yne as gB,Pne as gC,Cne as gD,Cee as gE,Yoe as gF,EU as gG,r7 as gH,s7 as gI,QV as gJ,kU as gK,FL as gL,VU as gM,gee as gN,Coe as gO,xoe as gP,ZO as gQ,JO as gR,Bee as gS,dU as gT,UU as gU,BL as gV,yM as gW,gM as gX,uS as gY,OG as gZ,Wo as g_,Koe as ga,kL as gb,T7 as gc,fi as gd,OI as ge,PD as gf,tue as gg,iue as gh,rZ as gi,TM as gj,Op as gk,rue as gl,fae as gm,fG as gn,oU as go,NL as gp,yL as gq,Goe as gr,KV as gs,Uoe as gt,YV as gu,Ft as gv,FM as gw,DO as gx,tE as gy,RL as gz,lee as h,KX as h$,VI as h0,ace as h1,nce as h2,xle as h3,U as h4,Soe as h5,ihe as h6,Eoe as h7,koe as h8,rd as h9,wae as hA,iL as hB,rV as hC,uV as hD,_b as hE,$oe as hF,VK as hG,T$ as hH,_z as hI,K$ as hJ,zne as hK,Dne as hL,e9 as hM,Q8 as hN,ine as hO,e8 as hP,pae as hQ,bu as hR,p$ as hS,EO as hT,Kne as hU,YO as hV,Ek as hW,hL as hX,lie as hY,bee as hZ,tQ as h_,ox as ha,Yb as hb,Kb as hc,vE as hd,Tn as he,gie as hf,y$ as hg,Qne as hh,lB as hi,pb as hj,loe as hk,ohe as hl,Cg as hm,aG as hn,oG as ho,sae as hp,mae as hq,J1 as hr,Mce as hs,ene as ht,N7 as hu,f$ as hv,m$ as hw,Xse as hx,Ky as hy,uv as hz,KK as i,IU as i$,r0 as i0,Woe as i1,iI as i2,uI as i3,wd as i4,toe as i5,q$ as i6,yle as i7,a5 as i8,nae as i9,hU as iA,pU as iB,j8 as iC,d$ as iD,uee as iE,pV as iF,woe as iG,pu as iH,Fa as iI,Wb as iJ,tae as iK,rz as iL,FD as iM,sz as iN,DQ as iO,cue as iP,WQ as iQ,Lg as iR,uue as iS,Dg as iT,Uee as iU,Ag as iV,qL as iW,mY as iX,lce as iY,LM as iZ,AU as i_,pR as ia,V$ as ib,er as ic,vM as id,mk as ie,lb as ig,fY as ih,ioe as ii,XY as ij,Mee as ik,_le as il,Bb as im,v9 as io,pne as ip,zb as iq,Fh as ir,tn as is,yj as it,NR as iu,ane as iv,lne as iw,one as ix,MB as iy,bU as iz,OT as j,HK as j$,x7 as j0,MU as j1,E$ as j2,c7 as j3,H7 as j4,ML as j5,UY as j6,zR as j7,Ul as j8,Ace as j9,Aoe as jA,YY as jB,k9 as jC,WG as jD,fC as jE,Qk as jF,H2 as jG,Fae as jH,Ba as jI,Xae as jJ,Yae as jK,oJ as jL,o0 as jM,nJ as jN,Kse as jO,NK as jP,yie as jQ,DK as jR,V1 as jS,G1 as jT,hne as jU,uhe as jV,qg as jW,Tt as jX,fP as jY,NI as jZ,qK as j_,o8 as ja,Cce as jb,YJ as jc,Ua as jd,jv as je,$le as jf,Mle as jg,Ele as jh,Ile as ji,kle as jj,Gle as jk,Sle as jl,kX as jm,dz as jn,RD as jo,Wse as jp,Z2 as jq,EX as jr,nE as js,qb as jt,Og as ju,Bl as jv,Lz as jw,lf as jx,Jue as jy,noe as jz,U8 as k,qre as k0,iae as k1,eG as k2,vae as k3,yG as k4,oae as k5,rG as k6,aae as k7,gce as k8,DD as k9,yee as ka,Ho as kb,jb as kc,hae as kd,Jse as ke,jne as kf,V7 as kg,Zee as kh,Jee as ki,jB as kj,uce as kk,hce as kl,Yse as km,qU as kn,GU as ko,gQ as kp,XF as kq,dce as kr,Hae as ks,Zae as kt,yQ as l,xue as m,mle as n,ad as o,md as p,pg as q,Tue as r,pt as s,NO as t,Xi as u,yd as v,Ane as w,Sg as x,M as y,Ce as z};
