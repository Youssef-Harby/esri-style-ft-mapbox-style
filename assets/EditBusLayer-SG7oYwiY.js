function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/deleteForwardEdits-CDZbz35M.js","assets/index-CEWggaxV.js","assets/index-BJXAwoda.css","assets/DeleteForwardEditsParameters-CpBjKiOL.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{eT as R,M as T,_ as V,ca as H,d as U,f as x,df as k,aV as p}from"./index-CEWggaxV.js";const P=R(),j=new Map,w=new Map;async function B(e,i,d){if(!e||!d)return!1;if(!i)return!0;const r=new URL(e).host;let t=j.get(r);if(!t){const n=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");t=(await T(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return t===i}async function N(e,i,d=!1){var n,a;if(!e||!i)return!0;const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),t=(n=w.get(r))==null?void 0:n.entries();if(t){for(const[l,c]of t)if(c.name===i){const u=!((a=c.stack)!=null&&a.hasForwardEdits());if(!u&&d){const[{deleteForwardEdits:m},{default:h}]=await Promise.all([V(()=>import("./deleteForwardEdits-CDZbz35M.js"),__vite__mapDeps([0,1,2])),V(()=>import("./DeleteForwardEditsParameters-CpBjKiOL.js"),__vite__mapDeps([3,1,2]))]);return m(r,l,new h({sessionId:P,moment:c.moment}))}return u}}return!0}function D(e,i){var t;if(!e)return!1;const d=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=(t=w.get(d))==null?void 0:t.entries();if(r){for(const[n,a]of r)if(a.name===i)return a.lockType==="edit"}return!1}const g=new H.EventEmitter;function O(e){return g.on("apply-edits",new WeakRef(e))}function W(e){return g.on("update-moment",new WeakRef(e))}function z(e,i,d=null,r=!1){const t=k();return r=i==null||r,g.emit("apply-edits",{serviceUrl:e,layerId:i,gdbVersion:d,mayReceiveServiceEdits:r,result:t.promise}),t}const E="esri.layers.mixins.EditBusLayer",$=Symbol(E);function C(e){return e!=null&&typeof e=="object"&&$ in e}function f(e){return e!=null&&typeof e=="object"&&"gdbVersion"in e}function b(e,i,d){const r=new URL(e).host,t=j.get(r),n=a=>!a||a===t;return n(i)&&n(d)||i===d}const G=e=>{var i;let d=class extends e{constructor(...r){super(...r),this[i]=!0,this._applyEditsHandler=t=>{const{serviceUrl:n,layerId:a,gdbVersion:l,mayReceiveServiceEdits:c,result:u}=t,m=n===this.url,h=a!=null&&this.layerId!=null&&a===this.layerId,A=f(this),S=f(this)&&b(n,l,this.gdbVersion);if(!m||A&&!S||!h&&!c)return;const L=u.then(s=>{var y;if(h&&(s.addedFeatures.length||s.updatedFeatures.length||s.deletedFeatures.length||s.addedAttachments.length||s.updatedAttachments.length||s.deletedAttachments.length))return this.emit("edits",p(s)),s;const I=(y=s.editedFeatures)==null?void 0:y.find(({layerId:F})=>F===this.layerId);if(I){const{adds:F,updates:M,deletes:v}=I.editedFeatures,_={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:F?F.map(({attributes:o})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],deletedFeatures:v?v.map(({attributes:o})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],updatedFeatures:M?M.map(({current:{attributes:o}})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],editedFeatures:p(s.editedFeatures),exceededTransferLimit:!1,historicMoment:p(s.historicMoment)};return this.emit("edits",_),_}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:p(s.editedFeatures),exceededTransferLimit:!1,historicMoment:p(s.historicMoment)}}).then(s=>("historicMoment"in this&&this.historicMoment!==s.historicMoment&&D(n,l)&&(this.historicMoment=s.historicMoment),s));this.emit("apply-edits",{result:L})},this._updateMomentHandler=t=>{const{serviceUrl:n,gdbVersion:a,moment:l}=t,c=n===this.url,u=f(this),m=f(this)&&b(n,a,this.gdbVersion),h=f(this)&&!b(n,this.gdbVersion,null);c&&u&&m&&h&&"historicMoment"in this&&this.historicMoment!==l&&(this.historicMoment=l)},this.when().then(()=>{this.addHandles(O(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(W(this._updateMomentHandler))},()=>{})}};return i=$,d=U([x(E)],d),d};export{G as F,B as a,D as c,z as h,N as i,C as p,P as t};
